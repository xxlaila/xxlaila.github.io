<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>æ‡’ç¾Šç¾Š</title>
  
  <subtitle>xxlila</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://xxlaila.github.io/"/>
  <updated>2019-10-22T02:26:30.845Z</updated>
  <id>https://xxlaila.github.io/</id>
  
  <author>
    <name>xxlaila</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>jenkinsè¿ç»´ç¯‡</title>
    <link href="https://xxlaila.github.io/2019/10/22/jenkins%E8%BF%90%E7%BB%B4%E7%AF%87/"/>
    <id>https://xxlaila.github.io/2019/10/22/jenkinsè¿ç»´ç¯‡/</id>
    <published>2019-10-22T01:22:52.000Z</published>
    <updated>2019-10-22T02:26:30.845Z</updated>
    
    <content type="html"><![CDATA[<h3 id="jenkins-å¯è§†åŒ–æ„å»º"><a href="#jenkins-å¯è§†åŒ–æ„å»º" class="headerlink" title="jenkins å¯è§†åŒ–æ„å»º"></a>jenkins å¯è§†åŒ–æ„å»º</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;åœ¨ä¹‹å‰é‡åˆ°è¿‡å¼€å‘æäº¤ä»£ç åï¼Œå®Œå…¨ä¸ç®¡æäº¤çš„ä»£ç æ˜¯å¦å‘å¸ƒæˆåŠŸï¼ŒåŠæ—¶åæ¥åŠ å…¥äº†ä¼ä¸šå¾®ä¿¡çš„å‘Šè­¦æœºåˆ¶ï¼Œä½†æ˜¯ä¾ç„¶æœ‰äººä¸ä¼šå»å…³æ³¨è¿™ä¸ªã€‚åªæœ‰åœ¨æµ‹è¯•äººå‘˜åœ¨åé¦ˆxxxä½ çš„ä»£ç æäº¤äº†æ²¡æœ‰ï¼Œè¿™æ—¶å€™ç ”å‘äººå‘˜æ‰å›å»çœ‹ï¼Œæœ‰æ—¶å€™ä¸€ä¸ªè§¦å‘æ„å»ºå¤±è´¥äº†ï¼Œæ‘†åœ¨é‚£é‡Œå¾ˆä¹…ï¼Œå¦‚æœ‰ä¸‹ä¸€ä¸ªå¼€å‘äººå‘˜è¦å¯¹è¿™ä¸ªå·¥ç¨‹ä¿®æ”¹æäº¤çš„æ—¶å€™å‘ç°è¿‡ä¸äº†ï¼Œè¿™æ—¶å€™å†æ¥è§£å†³ï¼Œæˆæœ¬å°±æœ‰ç‚¹å¤§ã€‚è¿™é‡Œå¯ä»¥å€ŸåŠ©çœ‹æ¿çš„å½¢å¼è®©ç ”å‘äººå‘˜å¯ä»¥éšæ—¶å…³æ³¨åˆ°è‡ªå·±çš„æäº¤çš„å·¥ç¨‹ï¼Œç»“åˆå‘Šè­¦æ¥åšï¼Œæ•ˆæœè¿˜æ˜¯ä¸é”™çš„ã€‚</p><a id="more"></a><h4 id="æ’ä»¶å®‰è£…"><a href="#æ’ä»¶å®‰è£…" class="headerlink" title="æ’ä»¶å®‰è£…"></a>æ’ä»¶å®‰è£…</h4><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å®‰è£…Build Monitor View æ’ä»¶ï¼Œç„¶ååœ¨ä¸»é¡µé¢æ·»åŠ <code>+</code>ä¸€ä¸ªè§†å›¾<br><img src="http://img.xxlaila.cn/1571707794737.jpg" alt="img"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å¯ä»¥æ ¹æ®jobçš„ç±»å‹æˆ–è€…æ ¹æ®è‡ªå·±çš„æ¡ä»¶è¿›è¡Œ<a href="https://xxlaila.github.io/2019/08/09/jenkins-job%E7%AE%A1%E7%90%86/">è¿‡æ»¤job</a>æ¥ç”Ÿæˆçœ‹æ¿ã€‚</p><ul><li>Build Monitor - View Settings: æ ¹æ®jobçš„ä¸€äº›çŠ¶æ€æ¥è¿›è¡Œæ’åº<br><img src="http://img.xxlaila.cn/1571708048469.jpg" alt="img"></li></ul><h3 id="jenkins-ç›‘æ§"><a href="#jenkins-ç›‘æ§" class="headerlink" title="jenkins ç›‘æ§"></a>jenkins ç›‘æ§</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æœ‰æ—¶å€™æˆ‘ä»¬æ²¡æœ‰ç›‘æ§ï¼Œä½†æ˜¯æœ‰æ—¶å€™éœ€è¦çœ‹çœ‹jenkinsçš„ä¸€äº›ç›‘æ§ä¿¡æ¯ï¼Œå¦‚ï¼šå†…å­˜ã€cpuã€ç³»ç»Ÿè´Ÿå€ºã€httpå“åº”æ—¶é—´ã€ç³»ç»Ÿè¿›ç¨‹æ•°ã€çº¿ç¨‹æ•°ç­‰ï¼Œæœ‰æ‡’å¾—å®‰è£…ç›‘æ§ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥å€ŸåŠ©jenkinsè‡ªå¸¦çš„ä¸€ä¸ªæ’ä»¶<code>Monitoring</code>ã€‚<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æ’ä»¶å®‰è£…å®Œæˆåï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç³»ç»Ÿç®¡ç†èœå•ä¸‹é¢çœ‹åˆ°<code>Monitoring of Jenkins master</code><br><img src="http://img.xxlaila.cn/1571708499625.jpg" alt="img"></p><p>ç‚¹å‡»è¿›å…¥ä»¥åæˆ‘ä»¬å¯ä»¥çœ‹åˆ°<br><img src="http://img.xxlaila.cn/1571708561404.jpg" alt="img"><br>é¡µé¢æ˜¾ç¤ºä¹±ç ï¼Œè¿™ä¸ªå¯ä»¥è‡ªå·±googleè§£å†³</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;jenkins-å¯è§†åŒ–æ„å»º&quot;&gt;&lt;a href=&quot;#jenkins-å¯è§†åŒ–æ„å»º&quot; class=&quot;headerlink&quot; title=&quot;jenkins å¯è§†åŒ–æ„å»º&quot;&gt;&lt;/a&gt;jenkins å¯è§†åŒ–æ„å»º&lt;/h3&gt;&lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;åœ¨ä¹‹å‰é‡åˆ°è¿‡å¼€å‘æäº¤ä»£ç åï¼Œå®Œå…¨ä¸ç®¡æäº¤çš„ä»£ç æ˜¯å¦å‘å¸ƒæˆåŠŸï¼ŒåŠæ—¶åæ¥åŠ å…¥äº†ä¼ä¸šå¾®ä¿¡çš„å‘Šè­¦æœºåˆ¶ï¼Œä½†æ˜¯ä¾ç„¶æœ‰äººä¸ä¼šå»å…³æ³¨è¿™ä¸ªã€‚åªæœ‰åœ¨æµ‹è¯•äººå‘˜åœ¨åé¦ˆxxxä½ çš„ä»£ç æäº¤äº†æ²¡æœ‰ï¼Œè¿™æ—¶å€™ç ”å‘äººå‘˜æ‰å›å»çœ‹ï¼Œæœ‰æ—¶å€™ä¸€ä¸ªè§¦å‘æ„å»ºå¤±è´¥äº†ï¼Œæ‘†åœ¨é‚£é‡Œå¾ˆä¹…ï¼Œå¦‚æœ‰ä¸‹ä¸€ä¸ªå¼€å‘äººå‘˜è¦å¯¹è¿™ä¸ªå·¥ç¨‹ä¿®æ”¹æäº¤çš„æ—¶å€™å‘ç°è¿‡ä¸äº†ï¼Œè¿™æ—¶å€™å†æ¥è§£å†³ï¼Œæˆæœ¬å°±æœ‰ç‚¹å¤§ã€‚è¿™é‡Œå¯ä»¥å€ŸåŠ©çœ‹æ¿çš„å½¢å¼è®©ç ”å‘äººå‘˜å¯ä»¥éšæ—¶å…³æ³¨åˆ°è‡ªå·±çš„æäº¤çš„å·¥ç¨‹ï¼Œç»“åˆå‘Šè­¦æ¥åšï¼Œæ•ˆæœè¿˜æ˜¯ä¸é”™çš„ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="jenkins" scheme="https://xxlaila.github.io//categories/jenkins/"/>
    
    
      <category term="jenkins" scheme="https://xxlaila.github.io//tags/jenkins/"/>
    
  </entry>
  
  <entry>
    <title>pipelineè¯­æ³•</title>
    <link href="https://xxlaila.github.io/2019/10/21/pipeline%E8%AF%AD%E6%B3%95/"/>
    <id>https://xxlaila.github.io/2019/10/21/pipelineè¯­æ³•/</id>
    <published>2019-10-21T07:26:19.000Z</published>
    <updated>2019-10-24T09:51:32.985Z</updated>
    
    <content type="html"><![CDATA[<h3 id="pipeline"><a href="#pipeline" class="headerlink" title="pipeline"></a>pipeline</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æœ€è¿‘åœ¨æµ‹è¯•k8sä¸Šçš„ci/cdï¼Œä¹‹å‰çš„ci/cdå…¶å®ä¹Ÿèƒ½æ»¡è¶³ç›®å‰å…ˆä¸šåŠ¡çš„éœ€æ±‚ï¼Œä½†æ˜¯æƒ³å°è¯•æ”¹è¿›ä¸€ä¸‹ï¼Œä¼˜åŒ–ä»¥å‰çš„jobï¼Œå¸Œæœ›åœ¨ç™»å½•ciçš„æ—¶å€™æ›´åŠ çš„ç®€æ´ï¼Œè€Œä¸”æŸ¥æ‰¾jobçš„æ—¶å€™ï¼Œç‚¹å‡»ä¸€ä¸ªjobå°±èƒ½æŸ¥çœ‹å®Œæ•´çš„ä¿¡æ¯ï¼Œä¸éœ€è¦jobä¹‹é—´çš„æ¥å›åˆ‡æ¢ï¼Œç­‰ç­‰å„ç§ç†ç”±ï¼ŒğŸ˜ğŸ˜ã€‚è¿™é‡Œä½¿ç”¨jenkins pipelineï¼Œèµ·åˆæµ‹è¯•çš„æ—¶å€™ä½¿ç”¨pipelineï¼Œæ²¡é—®é¢˜ä»¥åï¼Œä½¿ç”¨jenkinsfileã€‚</p><a id="more"></a><h3 id="pipeline-å¸¸ç”¨ä»‹ç»"><a href="#pipeline-å¸¸ç”¨ä»‹ç»" class="headerlink" title="pipeline å¸¸ç”¨ä»‹ç»"></a>pipeline å¸¸ç”¨ä»‹ç»</h3><h4 id="æ¸…ç†å†å²build"><a href="#æ¸…ç†å†å²build" class="headerlink" title="æ¸…ç†å†å²build"></a>æ¸…ç†å†å²build</h4><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æ™®é€šjobçš„æ—¶å€™æ¸…ç†å’Œä¿ç•™å†å²jobçš„build å¾ˆç®€å•ï¼Œå‹¾å‹¾å°±å¯ä»¥å•¦ï¼Œä½†æ˜¯pipelineå°±çš„ä½¿ç”¨ä¸€ä¸‹æ–¹å¼ï¼Œè€Œä¸”è¿˜çš„å†™åœ¨æœ€å‰é¢ï¼Œä¸ç„¶è¯†åˆ«ä¸äº†ï¼Œä¼šæŠ¥é”™çš„</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">options &#123;</span><br><span class="line">        buildDiscarder(logRotar(numToKeepStr: <span class="string">'8'</span>))</span><br><span class="line">        disableConcurrentBuilds()</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ul><li>buildDiscarder: ä¿æŒæ„å»ºçš„æœ€å¤§ä¸ªæ•°</li><li>disableConcurrentBuilds: ç¦æ­¢å¹¶å‘æ„å»º</li></ul><p>è¯¦ç»†å‚æ•°:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">buildDiscarder(logRotator(numToKeepStr: <span class="string">'8'</span>, artifactNumToKeepStr: <span class="string">'8'</span>, daysToKeepStr: <span class="string">'8'</span>, artifactDaysToKeepStr: <span class="string">'7'</span>))</span><br></pre></td></tr></table></figure><ul><li>artifactDaysToKeepStr: å‘å¸ƒåŒ…ä¿ç•™å¤©æ•°</li><li>artifactNumToKeepStr: å‘å¸ƒåŒ…æœ€å¤§ä¿ç•™#ä¸ªæ„å»º</li><li>daysToKeepStr: ä¿æŒæ„å»ºçš„å¤©æ•°</li><li>numToKeepStr: ä¿æŒæ„å»ºçš„æœ€å¤§ä¸ªæ•°</li></ul><h4 id="gitlabäº‹ä»¶è§¦å‘"><a href="#gitlabäº‹ä»¶è§¦å‘" class="headerlink" title="gitlabäº‹ä»¶è§¦å‘"></a>gitlabäº‹ä»¶è§¦å‘</h4><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ä¹‹å‰çš„æˆ‘ä»¬çš„ci/cdéƒ½æ˜¯å¼€å‘æäº¤åˆ°æŸä¸€ä¸ªåˆ†æ”¯ï¼Œç„¶åjenkinsä¼šè‡ªåŠ¨è§¦å‘ç¼–è¯‘ã€å‘å¸ƒï¼Œè€Œä¸”é…ç½®è¿™ä¸ªæ­¥éª¤ä¹Ÿéœ€è¦å¥½å‡ æ­¥æ‰èƒ½å®ç°ï¼Œä½†åœ¨pipelineä¸­ä¹Ÿå¯ä»¥é€šè¿‡ä»£ç å½¢å¼æœ€è¿™ç§è§¦å‘å™¨(å‹¾å­)è¿›è¡Œé…ç½®ã€‚è¿™æ ·è®©æ¯ä¸ªé¡¹ç›®éƒ½å’Œjenkinsè¿›è¡Œè€¦åˆï¼›è¿ç»´äººå‘˜åªéœ€è¦ä¸“æ³¨çš„ç»´æŠ¤Jenkinsfileï¼Œåˆ›å»ºå¯¹åº”çš„é¡¹ç›®å³å¯ã€‚gitlabè§¦å‘jenkinsçš„æ„å»ºéœ€è¦ä¾èµ–Gitlabæ’ä»¶ã€‚è¿™é‡Œéœ€è¦è‡ªè¡Œå®‰è£…</p><ul><li><p>æ¥å—å›ºå®šçš„åˆ†æ”¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">triggers &#123;</span><br><span class="line">        gitlab(triggersOnPush: <span class="literal">true</span>,</span><br><span class="line">              triggersOnMergeRequest: <span class="literal">true</span>,</span><br><span class="line">              branchFilterType: <span class="string">"NameBasedFilter"</span>,</span><br><span class="line">              includeBranchesSpec: <span class="string">"dev,test,master"</span>,</span><br><span class="line">              secretToken: <span class="string">"<span class="variable">$&#123;env.git_token&#125;</span>"</span>)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li><li><p>triggerOnPush: å½“Gitlabè§¦å‘pushäº‹ä»¶æ—¶ï¼Œæ˜¯å¦æ‰§è¡Œæ„å»º</p></li><li><p>triggerOnMergeRequest: å½“Gitlabè§¦å‘mergeRequestäº‹ä»¶æ—¶ï¼Œæ˜¯å¦æ‰§è¡Œæ„å»º</p></li><li><p>branchFilterType: åªæœ‰ç¬¦åˆæ¡ä»¶çš„åˆ†æ”¯æ‰ä¼šè§¦å‘æ„å»ºï¼Œå¿…é€‰ï¼Œå¦åˆ™æ— æ³•å®ç°è§¦å‘ã€‚</p><ul><li>All: æ‰€æœ‰åˆ†æ”¯</li><li>NameBasedFilter: åŸºäºåˆ†æ”¯åè¿›è¡Œè¿‡æ»¤ï¼Œå¤šä¸ªåˆ†æ”¯åä½¿ç”¨é€—å·åˆ†éš”<ul><li>includeBranchesSpec: åŸºäºbranchFilterTypeå€¼ï¼Œè¾“å…¥æœŸæœ›åŒ…æ‹¬çš„åˆ†æ”¯çš„è§„åˆ™</li><li>excludeBranchesSpec: åŸºäºbranchFilterTypeå€¼ï¼Œè¾“å…¥æœŸæœ›æ’é™¤çš„åˆ†æ”¯çš„è§„åˆ™</li></ul></li><li>RegexBasedFilter: åŸºäºæ­£åˆ™è¡¨è¾¾å¼å¯¹åˆ†æ”¯åè¿›è¡Œè¿‡æ»¤<ul><li>sourceBranchRegex: å®šä¹‰æœŸæœ›çš„é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼é™åˆ¶çš„åˆ†æ”¯è§„åˆ™<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æ‰€ä»¥åˆ†æ”¯ä¸é˜è¿°ï¼Œå…¶ä»–çš„ä¸¤ä¸ªé€‰é¡¹æ˜¯æœ€å®ç”¨çš„ï¼Œæˆ‘ä»¬åœ¨æ­£å¼ä½¿ç”¨çš„æ—¶å€™ä¸€å®šä¼šç”¨åˆ°è¿™ä¸ªï¼Œä¸Šé¢çš„ä¾‹å­æ˜¯ä¸€ä¸ªæ¥å—å›ºå®šçš„å‡ ä¸ªåˆ†æ”¯</li></ul></li></ul></li><li><p>åŒ¹é…çš„æ–¹å¼</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">triggers &#123;</span><br><span class="line">        gitlab(triggersOnPush: <span class="literal">true</span>,</span><br><span class="line">              triggersOnMergeRequest: <span class="literal">true</span>,</span><br><span class="line">              branchFilterType: <span class="string">"RegexBasedFilter"</span>,</span><br><span class="line">              sourceBranchRegex: <span class="string">"dev.*"</span>,</span><br><span class="line">              secretToken: <span class="string">"<span class="variable">$&#123;env.git_token&#125;</span>"</span>)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li></ul><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;è¿™é‡Œçš„git_tokenéœ€è¦åœ¨jenkinsçš„å…¨å±€å˜é‡é‡Œé¢æ·»åŠ ä¸€ä¸ª<code>Environment variables</code>å¯¹åº”çš„ä¸€ä¸ªé”®å€¼å³å¯ã€‚</p><p><strong>æ³¨</strong>: æ‰€æœ‰çš„è§¦å‘å™¨éƒ½éœ€è¦å…ˆæ‰‹åŠ¨æ‰§è¡Œä¸€æ¬¡ï¼Œè®©jenkinså®¶åœ¨å…¶ä¸­çš„é…ç½®ï¼Œå¯¹åº”çš„æŒ‡ä»¤æ‰ä¼šç”Ÿæ•ˆã€‚</p><ul><li>jenkins éªŒè¯<br><img src="http://img.xxlaila.cn/1571644117201.jpg" alt="img"></li><li>gitlabéªŒè¯<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;éœ€è¦å°†é¡¹ç›®å›è°ƒåœ°å€å†™å…¥åˆ°Gitlabé’©å­å½“ä¸­æ‰å¯ä»¥ã€‚ç»è¿‡æµ‹è¯•ä¸€ä¸ªpipelineçš„jobå¯ä»¥ç®¡ç†å¤šä¸ªåˆ†æ”¯çš„è§¦å‘ï¼Œé¿å…ä¹‹å‰çš„æ¯ä¸€ä¸ªåˆ†æ”¯çš„jobè¿›è¡Œè§¦å‘ã€‚</li></ul><h4 id="parameters-æ¨¡å—"><a href="#parameters-æ¨¡å—" class="headerlink" title="parameters æ¨¡å—"></a>parameters æ¨¡å—</h4><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;è¯¥æ¨¡å—éœ€è¦å®‰è£…ï¼ŒparametersæŒ‡ä»¤æä¾›ç”¨æˆ·åœ¨è§¦å‘Pipelineæ—¶åº”æä¾›çš„å‚æ•°åˆ—è¡¨ã€‚è¿™äº›ç”¨æˆ·æŒ‡å®šçš„å‚æ•°çš„å€¼é€šè¿‡è¯¥paramså¯¹è±¡å¯ç”¨äºPipelineæ­¥éª¤ã€‚ç ”å‘ç»å¸¸ä¼šæœ‰æ‰“å‡ºä¸€ä¸ªç‰¹æ€§åˆ†æ”¯ï¼Œè¿™ä¸ªåˆ†æ”¯ç”¨äºhotfixï¼Œè¿™ä¸ªæ—¶å€™å°±è¦ç»™ç ”å‘æäº¤ä¸€ä¸ªå¯ä»¥é€‰æ‹©çš„åˆ†æ”¯ï¼Œç„¶ä»–ä»¬å»éƒ¨ç½²åˆ°å¯¹åº”çš„ç¯å¢ƒã€‚</p><ul><li><p>å­—ç¬¦ä¸²å‚æ•°<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å®šä¹‰ä¸€ä¸ªå­—ç¬¦ä¸²å‚æ•°ï¼Œç”¨æˆ·å¯ä»¥åœ¨Jenkins UIä¸Šè¾“å…¥å­—ç¬¦ä¸²ï¼Œå¸¸è§ä½¿ç”¨è¿™ä¸ªå‚æ•°çš„åœºæ™¯æœ‰ï¼Œç”¨æˆ·åï¼Œæ”¶ä»¶äººé‚®ç®±ï¼Œæ–‡ä»¶ç½‘ç»œè·¯å¾„ï¼Œä¸»æœºåç§°çš„æˆ–è€…urlç­‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">parameters &#123;</span><br><span class="line">    string(name: <span class="string">'DEPLOY_ENV'</span>, defaultValue: <span class="string">'staging'</span>, description: <span class="string">''</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>å¸ƒå°”å€¼å‚æ•°<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å®šä¹‰ä¸€ä¸ªå¸ƒå°”ç±»å‹å‚æ•°ï¼Œç”¨æˆ·å¯ä»¥åœ¨Jenkins UIä¸Šé€‰æ‹©æ˜¯è¿˜æ˜¯å¦ï¼Œé€‰æ‹©æ˜¯è¡¨ç¤ºä»£ç ä¼šæ‰§è¡Œè¿™éƒ¨åˆ†ï¼Œå¦‚æœé€‰æ‹©å¦ï¼Œä¼šè·³è¿‡è¿™éƒ¨åˆ†ã€‚ä¸€èˆ¬éœ€è¦ä½¿ç”¨å¸ƒå°”å€¼çš„åœºæ™¯æœ‰ï¼Œæ‰§è¡Œä¸€äº›ç‰¹å®šé›†æˆçš„è„šæœ¬æˆ–åˆ™å·¥ä½œï¼Œæˆ–è€…äº‹åæ¸…é™¤ç¯å¢ƒï¼Œä¾‹å¦‚æ¸…æ¥šJenkinsçš„workspaceè¿™æ ·çš„åŠ¨ä½œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">parameters &#123;</span><br><span class="line">    booleanParam(name: <span class="string">'DEBUG_BUILD'</span>, defaultValue: <span class="literal">true</span>, description: <span class="string">''</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>é€‰æ‹©å‚æ•°<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;é€‰æ‹©ï¼ˆchoiceï¼‰çš„å‚æ•°å°±æ˜¯æ”¯æŒç”¨æˆ·ä»å¤šä¸ªé€‰æ‹©é¡¹ä¸­ï¼Œé€‰æ‹©ä¸€ä¸ªå€¼ç”¨æ¥è¡¨ç¤ºè¿™ä¸ªå˜é‡çš„å€¼ã€‚å·¥ä½œä¸­å¸¸ç”¨çš„åœºæ™¯ï¼Œæœ‰é€‰æ‹©æœåŠ¡å™¨ç±»å‹ï¼Œé€‰æ‹©ç‰ˆæœ¬å·ç­‰ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">parameters &#123;</span><br><span class="line">    choice(name: <span class="string">'ENV_TYPE'</span>, choices: [<span class="string">'dev'</span>, <span class="string">'test'</span>, <span class="string">'product'</span>], description: <span class="string">'dev env test'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å½“ç„¶parametersæ¨¡å—æˆ‘ä»¬ç”¨çš„æœ€å¤šçš„æ˜¯åœ¨æ‰‹åŠ¨çš„æ—¶å€™æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨ç‚¹å‡»è¿›è¡Œæ„å»ºéƒ¨ç½²ï¼Œè‡³äºå…¶ä»–çš„ç›®å‰æˆ‘æš‚æ—¶æœªç”¨åˆ°</p><ul><li>é€‰æ‹©åˆ†æ”¯éƒ¨ç½²<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent &#123;label <span class="string">'agent-node'</span>&#125;</span><br><span class="line">    parameters &#123;</span><br><span class="line">        gitParameter branchFilter: <span class="string">'origin/(.*)'</span>, defaultValue: <span class="string">'dev'</span>, name: <span class="string">'BRANCH'</span>, <span class="built_in">type</span>: <span class="string">'PT_BRANCH'</span></span><br><span class="line">    &#125;</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(<span class="string">'gitlib code'</span>) &#123;</span><br><span class="line">            steps&#123;</span><br><span class="line">                git branch:<span class="string">"<span class="variable">$&#123;params.BRANCH&#125;</span>"</span>, credentialsId:<span class="string">'gitlabUser'</span>, url: <span class="string">"http://gitlab.xxlaila.cn/xxx/kxl-eureka.git"</span></span><br><span class="line">                script &#123;</span><br><span class="line">                    build_tag = sh(returnStdout: <span class="literal">true</span>, script: <span class="string">'git rev-parse --short HEAD'</span>).trim()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>parameters<a href="https://wiki.jenkins.io/display/JENKINS/Git+Parameter+Plugin" target="_blank" rel="noopener">å®˜æ–¹å‚è€ƒ</a>ï¼Œä»‹ç»å¾—æŒºè¯¦ç»†çš„ï¼Œ<a href="https://mohamicorp.atlassian.net/wiki/spaces/DOC/pages/136740885/Triggering+Jenkins+Based+on+New+Tags" target="_blank" rel="noopener">è¾…åŠ©å‚è€ƒ</a><br><img src="http://img.xxlaila.cn/1571651950634.jpg" alt="img"></p><ul><li>è¿˜å¯ä»¥å†™æˆ<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">parameters &#123;</span><br><span class="line">    gitParameter(</span><br><span class="line">        branch: <span class="string">''</span>,</span><br><span class="line">        branchFilter: <span class="string">'origin/(.*)'</span>,</span><br><span class="line">        defaultValue: <span class="string">'dev'</span>,</span><br><span class="line">        description: <span class="string">'test code'</span>,</span><br><span class="line">        name: <span class="string">'BRANCH'</span>,</span><br><span class="line">        quickFilterEnabled: <span class="literal">false</span>,</span><br><span class="line">        selectedValue: <span class="string">'NONE'</span>,</span><br><span class="line">        sortMode: <span class="string">'NONE'</span>,</span><br><span class="line">        tagFilter: <span class="string">'*'</span>,</span><br><span class="line">        <span class="built_in">type</span>: <span class="string">'PT_BRANCH'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼šå½“è¿™é‡Œè®¾ç½®äº†å¯ä»¥é€‰æ‹©åˆ†æ”¯çš„æ—¶å€™ï¼Œç„¶ååœ¨ä¹‹å‰çš„è‡ªåŠ¨è§¦å‘å°±ä¼šæœ‰é—®é¢˜ï¼Œå°±æ˜¯åœ¨å»åˆ†æ”¯æ‹‰å»ä»£ç çš„æ—¶å€™å°±ä¸€åªæ˜¯devåˆ†æ”¯ï¼Œè€Œä¸æ˜¯å…¶ä»–çš„åˆ†æ”¯ï¼Œè¿™é‡Œä»ç„¶åœ¨æ¢ç´¢çš„æµ‹è¯•ä¸­ã€‚<br>ç¼–è¾‘jobå¯ä»¥çœ‹åˆ°<br><img src="http://img.xxlaila.cn/1571903055002.jpg" alt="img"></p><p><a href="https://jenkinsci.github.io/job-dsl-plugin/#path/buildPipelineView" target="_blank" rel="noopener">æ¨èå­¦ä¹ å‚è€ƒåœ°å€</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;pipeline&quot;&gt;&lt;a href=&quot;#pipeline&quot; class=&quot;headerlink&quot; title=&quot;pipeline&quot;&gt;&lt;/a&gt;pipeline&lt;/h3&gt;&lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;æœ€è¿‘åœ¨æµ‹è¯•k8sä¸Šçš„ci/cdï¼Œä¹‹å‰çš„ci/cdå…¶å®ä¹Ÿèƒ½æ»¡è¶³ç›®å‰å…ˆä¸šåŠ¡çš„éœ€æ±‚ï¼Œä½†æ˜¯æƒ³å°è¯•æ”¹è¿›ä¸€ä¸‹ï¼Œä¼˜åŒ–ä»¥å‰çš„jobï¼Œå¸Œæœ›åœ¨ç™»å½•ciçš„æ—¶å€™æ›´åŠ çš„ç®€æ´ï¼Œè€Œä¸”æŸ¥æ‰¾jobçš„æ—¶å€™ï¼Œç‚¹å‡»ä¸€ä¸ªjobå°±èƒ½æŸ¥çœ‹å®Œæ•´çš„ä¿¡æ¯ï¼Œä¸éœ€è¦jobä¹‹é—´çš„æ¥å›åˆ‡æ¢ï¼Œç­‰ç­‰å„ç§ç†ç”±ï¼ŒğŸ˜ğŸ˜ã€‚è¿™é‡Œä½¿ç”¨jenkins pipelineï¼Œèµ·åˆæµ‹è¯•çš„æ—¶å€™ä½¿ç”¨pipelineï¼Œæ²¡é—®é¢˜ä»¥åï¼Œä½¿ç”¨jenkinsfileã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="jenkins" scheme="https://xxlaila.github.io//categories/jenkins/"/>
    
    
      <category term="pipeline" scheme="https://xxlaila.github.io//tags/pipeline/"/>
    
  </entry>
  
  <entry>
    <title>elasticserch</title>
    <link href="https://xxlaila.github.io/2019/10/17/elasticserch%E6%97%A5%E5%B8%B8%E7%BB%B4%E6%8A%A4/"/>
    <id>https://xxlaila.github.io/2019/10/17/elasticserchæ—¥å¸¸ç»´æŠ¤/</id>
    <published>2019-10-17T03:23:17.000Z</published>
    <updated>2019-10-21T09:05:41.025Z</updated>
    
    <content type="html"><![CDATA[<h3 id="days-1"><a href="#days-1" class="headerlink" title="days 1"></a>days 1</h3><a id="more"></a><h4 id="elasticserch-ç´¢å¼•å’Œæ•°æ®æ“ä½œ"><a href="#elasticserch-ç´¢å¼•å’Œæ•°æ®æ“ä½œ" class="headerlink" title="elasticserch ç´¢å¼•å’Œæ•°æ®æ“ä½œ"></a>elasticserch ç´¢å¼•å’Œæ•°æ®æ“ä½œ</h4><ul><li><p>æŸ¥çœ‹ç´¢å¼•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># curl -XGET 'http://127.0.0.1:9200/_cat/indices?v'</span></span><br></pre></td></tr></table></figure></li><li><p>åˆ é™¤ç´¢å¼•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># curl -XGET 'http://127.0.0.1:9200/_cat/indices?v' |grep "red"|awk '&#123;print $3&#125;'|uniq &gt;l</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># for i in `cat a`;do  curl -XDELETE http://127.0.0.1:9200/$&#123;i&#125;;done</span></span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹shards</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># curl -XGET http://127.0.0.1:9200/_cat/shards</span></span><br></pre></td></tr></table></figure></li></ul><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shards æœ‰å‡ ç§ç±»å‹ï¼Œè¿™é‡Œè¯´ä¸€ä¸‹<code>UNASSIGNED</code>ï¼Œes é›†ç¾¤é‡Œé¢çš„åˆ†ç‰‡æ˜¯åˆ†é…åœ¨å¤šå°nodeä¸Šçš„ï¼Œä¸ºçš„å°±æ˜¯é«˜å¯ç”¨ï¼Œæ¯”å¦‚ä½ çš„æŸå°æœºå™¨crashäº†ï¼Œé‚£ä¹ˆé›†ç¾¤å°±ä¼šè®©å…¶ä»–å‰¯æœ¬é¡¶ä¸Šæ¥ï¼Œé¿å…å‡ºç°æŸä¸ªåˆ†ç‰‡ä¸èƒ½æä¾›æœåŠ¡çš„æƒ…å†µï¼Œä½†æ˜¯éš¾å…è¿˜æ˜¯ä¼šå‡ºç° UNASSIGNED shards çš„é”™è¯¯ã€‚</p><ul><li>åˆ é™¤shards UNASSIGNED<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># curl -XGET 'http://127.0.0.1:9200/_cat/shards'|grep "UNASSIGNED"|awk '&#123;print $1&#125;'|uniq &gt;l</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># for i in `cat l`;do curl -XDELETE http://127.0.0.1:9200/$i;done</span></span><br></pre></td></tr></table></figure></li></ul><h4 id="elasticserchéªŒè¯é›†ç¾¤"><a href="#elasticserchéªŒè¯é›†ç¾¤" class="headerlink" title="elasticserchéªŒè¯é›†ç¾¤"></a>elasticserchéªŒè¯é›†ç¾¤</h4><ul><li><p>é›†ç¾¤ç›¸å…³API</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">$ curl http://127.0.0.1:9200/_cat</span><br><span class="line">=^.^=</span><br><span class="line">/_cat/allocation</span><br><span class="line">/_cat/shards</span><br><span class="line">/_cat/shards/&#123;index&#125;</span><br><span class="line">/_cat/master</span><br><span class="line">/_cat/nodes</span><br><span class="line">/_cat/tasks</span><br><span class="line">/_cat/indices</span><br><span class="line">/_cat/indices/&#123;index&#125;</span><br><span class="line">/_cat/segments</span><br><span class="line">/_cat/segments/&#123;index&#125;</span><br><span class="line">/_cat/count</span><br><span class="line">/_cat/count/&#123;index&#125;</span><br><span class="line">/_cat/recovery</span><br><span class="line">/_cat/recovery/&#123;index&#125;</span><br><span class="line">/_cat/health</span><br><span class="line">/_cat/pending_tasks</span><br><span class="line">/_cat/aliases</span><br><span class="line">/_cat/aliases/&#123;<span class="built_in">alias</span>&#125;</span><br><span class="line">/_cat/thread_pool</span><br><span class="line">/_cat/thread_pool/&#123;thread_pools&#125;</span><br><span class="line">/_cat/plugins</span><br><span class="line">/_cat/fielddata</span><br><span class="line">/_cat/fielddata/&#123;fields&#125;</span><br><span class="line">/_cat/nodeattrs</span><br><span class="line">/_cat/repositories</span><br><span class="line">/_cat/snapshots/&#123;repository&#125;</span><br><span class="line">/_cat/templates</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹é›†ç¾¤åç§°ç­‰ä¿¡æ¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ curl http://127.0.0.1:9200</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"name"</span> : <span class="string">"elk_elasticsearch_data_2"</span>,</span><br><span class="line">  <span class="string">"cluster_name"</span> : <span class="string">"elk_elasticsearch"</span>,</span><br><span class="line">  <span class="string">"cluster_uuid"</span> : <span class="string">"T47wQwa6TT-6MHJVFM40Tw"</span>,</span><br><span class="line">  <span class="string">"version"</span> : &#123;</span><br><span class="line">    <span class="string">"number"</span> : <span class="string">"6.4.0"</span>,</span><br><span class="line">    <span class="string">"build_flavor"</span> : <span class="string">"default"</span>,</span><br><span class="line">    <span class="string">"build_type"</span> : <span class="string">"rpm"</span>,</span><br><span class="line">    <span class="string">"build_hash"</span> : <span class="string">"595516e"</span>,</span><br><span class="line">    <span class="string">"build_date"</span> : <span class="string">"2018-08-17T23:18:47.308994Z"</span>,</span><br><span class="line">    <span class="string">"build_snapshot"</span> : <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"lucene_version"</span> : <span class="string">"7.4.0"</span>,</span><br><span class="line">    <span class="string">"minimum_wire_compatibility_version"</span> : <span class="string">"5.6.0"</span>,</span><br><span class="line">    <span class="string">"minimum_index_compatibility_version"</span> : <span class="string">"5.0.0"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"tagline"</span> : <span class="string">"You Know, for Search"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ curl http://127.0.0.1:9200/_cat/nodes?v</span><br><span class="line">ip            heap.percent ram.percent cpu load_1m load_5m load_15m node.role master name</span><br><span class="line">172.21.16.198           29          85   0    0.10    0.04     0.05 mdi       -      elk_elasticsearch_data_2</span><br><span class="line">172.21.16.187           48          85   0    0.00    0.01     0.05 mdi       *      elk_elasticsearch_master</span><br><span class="line">172.21.16.206           25          86   0    0.08    0.03     0.05 mdi       -      elk_elasticsearch_data_3</span><br></pre></td></tr></table></figure></li><li><p>éªŒè¯é›†ç¾¤ç£ç›˜åˆ†é…æƒ…å†µ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ curl http://127.0.0.1:9200/_cat/allocation?v</span><br><span class="line">shards disk.indices disk.used disk.avail disk.total disk.percent host          ip            node</span><br><span class="line">    98          1gb     3.6gb     96.3gb     99.9gb            3 172.21.16.198 172.21.16.198 elk_elasticsearch_data_2</span><br><span class="line">    99      887.1mb     4.5gb     95.4gb     99.9gb            4 172.21.16.187 172.21.16.187 elk_elasticsearch_master</span><br><span class="line">    99        957mb     3.5gb     96.4gb     99.9gb            3 172.21.16.206 172.21.16.206 elk_elasticsearch_data_3</span><br></pre></td></tr></table></figure></li><li><p>éªŒè¯é›†ç¾¤å¥åº·çŠ¶å†µ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ curl http://127.0.0.1:9200/_cat/health?v </span><br><span class="line">epoch      timestamp cluster           status node.total node.data shards pri relo init unassign pending_tasks max_task_wait_time active_shards_percent</span><br><span class="line">1571648406 17:00:06  elk_elasticsearch green           3         3    296 148    0    0        0             0                  -                100.0%</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;days-1&quot;&gt;&lt;a href=&quot;#days-1&quot; class=&quot;headerlink&quot; title=&quot;days 1&quot;&gt;&lt;/a&gt;days 1&lt;/h3&gt;
    
    </summary>
    
      <category term="elasticserch" scheme="https://xxlaila.github.io//categories/elasticserch/"/>
    
    
      <category term="elasticserch" scheme="https://xxlaila.github.io//tags/elasticserch/"/>
    
  </entry>
  
  <entry>
    <title>nexusé…ç½®ldap</title>
    <link href="https://xxlaila.github.io/2019/10/15/nexus%E9%85%8D%E7%BD%AEldap/"/>
    <id>https://xxlaila.github.io/2019/10/15/nexusé…ç½®ldap/</id>
    <published>2019-10-15T09:28:34.000Z</published>
    <updated>2019-10-17T08:11:44.041Z</updated>
    
    <content type="html"><![CDATA[<h3 id="é…ç½®nexus"><a href="#é…ç½®nexus" class="headerlink" title="é…ç½®nexus"></a>é…ç½®nexus</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ç™»å½•nexusåœ¨è®¾ç½®é¡µï¼Œç‚¹å‡»ldapï¼Œ</p><a id="more"></a><p><img src="http://img.xxlaila.cn/1571131890608.jpg" alt="img"><br>å‚æ•°ä»‹ç»:</p><ul><li>Name: éšä¾¿å†™</li><li>LDAP server address: æ”¯æŒldapså’Œldap,è€Œç«¯å£åˆ™å–å†³äºé…ç½®ã€‚ å¦‚æœæ²¡æœ‰ç‰¹æ®Šé…ç½®ï¼Œldapé»˜è®¤ç«¯å£æ˜¯389</li><li>Search base: åªéœ€è¦å¡«DCå³å¯ï¼Œæ¯”å¦‚DC=example,DC=comã€‚ å…¶å®ƒå†…å®¹ï¼Œæ¯”å¦‚CNã€OUç­‰ï¼Œä¸éœ€è¦å¡«å†™</li><li>Authentication methodæœ‰ä»¥ä¸‹é€‰é¡¹:<ul><li>Simple Authentication</li><li>Anonymous Authentication</li><li>DIGEST-MD5</li><li>CRAM-MD5<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;é€šå¸¸é€‰æ‹©Simple Authenticationå³å¯ã€‚Username or DNã€Passwordé‡Œå¡«å†™è´¦æˆ·ã€å¯†ç ï¼Œè€Œ Connection rulesæ— éœ€ä¿®æ”¹ã€‚å¡«å†™å®Œæ¯•åï¼Œç‚¹å‡»ã€Verify connectionã€‘æŒ‰é’®ï¼Œå¯ä»¥éªŒè¯ä¿¡æ¯ã€‚ å¦‚æœæˆåŠŸï¼Œå³å¯ä¿å­˜ã€‚</li></ul></li></ul><h4 id="Choose-Users-and-Groups"><a href="#Choose-Users-and-Groups" class="headerlink" title="Choose Users and Groups"></a>Choose Users and Groups</h4><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;è¿™é¡¹æ•…åæ€ä¹‰å°±æ˜¯é…ç½®ç”¨æˆ·å’Œç»„çš„ï¼Œåœ¨æœ€å¼€å¤´çš„Configuration templateä¸­ï¼Œæœ‰å››ç§æ¨¡æ¿å¯é€‰ï¼š</p><ul><li>Active Directory</li><li>Generic Ldap Server</li><li>Posix with Dynamic Groups</li><li>Posix with Static Groups</li></ul><p>è¿™é‡Œé€‰æ‹©<code>Generic Ldap Server</code></p><ul><li>Base DN åœ¨LDAPä¸­æ‰¾åˆ°ç”¨æˆ·çš„åŸºæœ¬ä½ç½®ã€‚è¿™æ˜¯ç›¸å¯¹äºæœç´¢åŸºç¡€çš„ï¼ˆä¾‹å¦‚ou = peopleï¼‰ã€‚</li><li>User subtreeé€šå¸¸éœ€è¦å‹¾é€‰ã€‚ å¦‚æœæŠŠLDAPçš„Treeæ¯”ä½œç›®å½•çš„è¯ï¼Œå‹¾é€‰ä»¥åç›¸å½“äºé€’å½’æŸ¥æ‰¾å­ç›®å½•ã€‚</li><li>User filteré€šè¿‡è¿‡æ»¤è§„åˆ™ï¼Œå‡å°‘æœç´¢ä¿¡æ¯ï¼Œç”¨äºæå‡æ€§èƒ½ã€‚ ä»…ä»…åªæ˜¯æå‡æ€§èƒ½ï¼Œæ‰€ä»¥ï¼Œå¦‚æœä¸æ‡‚å®ƒç‰¹æ®Šçš„åŒ¹é…è§„åˆ™ï¼Œä¹Ÿå¯ä»¥ä¸å¡«ã€‚</li><li>ä¹‹å‰é€‰æ‹©äº†<code>Generic Ldap Server</code>æ¨¡ç‰ˆåï¼ŒUser ID attributeé»˜è®¤ä¸ºuidï¼ŒReal name attributeé»˜è®¤ä¸ºcnã€Email attributeé»˜è®¤ä¸ºmailã€Password attributeä¸ºç©ºã€‚</li><li>Map LDAP groups as roleså¦‚æœä¸å‹¾é€‰ï¼Œå°±ä¸ä¼šåŒæ­¥ç”¨æˆ·ç»„ä¿¡æ¯ã€‚ å¦‚æœå‹¾é€‰ï¼Œåˆ™å¯ä»¥é€‰æ‹©Group typeå’ŒGroup member of attributeã€‚ è‹¥æ— å¿…è¦ï¼Œä¿æŒé»˜è®¤å³å¯ï¼Œé»˜è®¤æ˜¯å‹¾é€‰çš„ã€‚<br><img src="http://img.xxlaila.cn/1571133103461.jpg" alt="img"></li><li>å¡«å†™å®Œæˆåï¼Œé€šè¿‡ã€Verify user mappingã€‘å¯ä»¥éªŒè¯æŸ¥è¯¢ç»“æœ<br><img src="http://img.xxlaila.cn/1571133221971.jpg" alt="img"><br>ç‚¹å‡»åˆ›å»º<br><img src="http://img.xxlaila.cn/1571133286829.jpg" alt="img"></li></ul><h4 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æ–°èµ·ä¸€ä¸ªçª—å£åˆ©ç”¨ldapé‡Œé¢çš„è´¦å·è¿›è¡Œç™»å½•ï¼Œå¯ä»¥ç™»å½•ï¼Œæ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯ç™»å½•ä¹‹åç”¨æˆ·æ²¡æœ‰ä»»ä½•æƒé™ï¼Œè¿™å¯¹äºç ”å‘æ¥è¯´åˆæ˜¯ä¸€ä¸ªä¸å¯æ¥å—çš„äº‹æƒ…ã€‚æ¥ä¸‹æ¥é…ç½®æƒé™</p><h5 id="ç¦æ­¢åŒ¿åè®¿é—®"><a href="#ç¦æ­¢åŒ¿åè®¿é—®" class="headerlink" title="ç¦æ­¢åŒ¿åè®¿é—®"></a>ç¦æ­¢åŒ¿åè®¿é—®</h5><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæ˜¯ä¸å…è®¸åŒ¿åç”¨æˆ·ä¸å¯ä»¥ç™»å½•å°±èƒ½è®¿é—®çš„ï¼Œè¿™æ ·æˆ‘ä»¬ldapå°±æ²¡æœ‰ä»»ä½•æ„ä¹‰äº†<br><img src="http://img.xxlaila.cn/1571133691247.jpg" alt="img"></p><ul><li>ç¦æ­¢åŒ¿åç”¨æˆ·<br><img src="http://img.xxlaila.cn/1571133811908.jpg" alt="img"></li></ul><h5 id="åˆ›å»ºè§’è‰²"><a href="#åˆ›å»ºè§’è‰²" class="headerlink" title="åˆ›å»ºè§’è‰²"></a>åˆ›å»ºè§’è‰²</h5><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;åœ¨Securityâ€”â€”&gt;Rolesâ€”â€”&gt;Create roleï¼Œè¿™é‡Œåˆ›å»ºè§’è‰²æœ‰ä¸¤ç§ã€‚ä¸€ç§æ˜¯nexus relosæœ¬åœ°è§’è‰²ï¼Œä¸€ç§æ˜¯External roles mappingå¤–éƒ¨æ˜ å°„çš„å½¢å¼ã€‚ä¸ºäº†æ»¡è¶³æˆ‘ä»¬ldapè´¦æˆ·ç™»å½•è¿›æ¥æœ‰æµè§ˆåº“çš„æƒé™ï¼Œç ”å‘åˆå¯ä»¥ä¸Šä¼ ç¬¬ä¸‰æ–¹ä¾èµ–åº“çš„æƒé™ï¼Œä½†æ˜¯ä¸èƒ½åˆ é™¤å’Œç§ä¸‹å¢åŠ åº“Repositoriesã€‚æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬éœ€è¦å•ç‹¬å»ºç«‹ä¸€ä¸ªæœ¬åœ°çš„relosï¼Œç„¶ååœ¨æ˜ å°„å¤–éƒ¨çš„ldapåˆ°è¿™ä¸ªæœ¬åœ°çš„rolesï¼Œè¿™æ ·ldapè´¦æˆ·ç™»å½•è¿›æ¥å°±èƒ½å®ç°æ—¥å¸¸çš„åŸºæœ¬æ“ä½œã€‚</p><ul><li><p>åˆ›å»ºnexus relosæœ¬åœ°è§’è‰²<br><img src="http://img.xxlaila.cn/1571296771150.jpg" alt="img"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;åˆ›å»ºå®Œæˆåï¼Œæˆ‘ä»¬éœ€è¦å¯¹ä»–èµ‹äºˆæƒé™ï¼Œå¯¹ç”¨æˆ·è¿›è¡Œæƒé™æ§åˆ¶ï¼Œæ²¡æœ‰æƒé™æ§åˆ¶ï¼Œå°±æ²¡åŠæ³•è¾¾æˆæˆ‘ä»¬ä¸Šé¢çš„ç›®æ ‡ã€‚ä¸‹é¢æ˜¯æˆ‘èµ‹äºˆçš„æƒé™ï¼Œå¯ä»¥ç»“åˆå®é™…éœ€æ±‚æ¥è¿›è¡Œèµ‹äºˆã€‚</p></li><li><p>æƒé™ä»‹ç»:</p><ul><li>ng-component-upload: æœ‰ä¸Šä¼ çš„æƒé™ï¼Œæ¯”å¦‚javaä¾èµ–çš„ä¸€äº›ç¬¬ä¸‰æ–¹åº“ï¼Œç ”å‘å¯ä»¥è‡ªå·±è¿›è¡Œä¸Šä¼ </li><li>ng-repository-admin-<em>-</em>-browse: æµè§ˆæ‰€æœ‰çš„repository</li><li>ng-repository-admin-<em>-</em>-read: å¯ä»¥æ‰€æœ‰è¯»å–repositoryçš„é…ç½®ä¿¡æ¯</li><li>ng-repository-view-maven2-maven-central-browse: å…·æœ‰æµè§ˆmaven-centralå†…å®¹</li><li>ng-repository-view-maven2-maven-central-read: è¯»å–maven-centralå†…å®¹ï¼Œåœ¨mavenç¼–è¯‘çš„æ—¶å€™å…·æœ‰ä¸‹è½½çš„æƒé™ï¼Œ(åé¢ä¸ä¸€ä¸€ä»‹ç»)</li><li>ng-repository-view-maven2-maven-public-browse</li><li>ng-repository-view-maven2-maven-public-read</li><li>ng-repository-view-maven2-maven-releases-browse</li><li>ng-repository-view-maven2-maven-releases-read</li><li>ng-repository-view-maven2-maven-snapshots-browse</li><li>ng-repository-view-maven2-maven-snapshots-read</li><li>ng-repository-view-npm-npm-kxl-all-browse: ä»¥ä¸‹æ˜¯è‡ªå·±åšçš„npmä»£ç†ç¼“å­˜ï¼Œå¯ä»¥å‚è€ƒä¹‹å‰çš„<a href="https://xxlaila.github.io/2019/08/23/nexus3æ­å»ºnpmç§æœ/">nexus3æ­å»ºnpmç§æœ</a></li><li>ng-repository-view-npm-npm-kxl-all-read</li><li>ng-repository-view-npm-npm-external-browse</li><li>ng-repository-view-npm-npm-external-read</li><li>ng-repository-view-npm-npm-internal-browse</li><li>ng-repository-view-npm-npm-internal-read</li><li>ng-search-read: è®©ç”¨æˆ·å…·æœ‰æ‰€æœ‰æƒé™ï¼Œæ²¡æœ‰æ­¤æƒé™ï¼Œç ”å‘æŸ¥æ‰¾ä¸€ä¸ªåŒ…ï¼Œä¼°è®¡ä¼šæ­»</li></ul></li><li><p>åˆ›å»ºæ˜¯External roles mappingå¤–éƒ¨æ˜ å°„<br><img src="http://img.xxlaila.cn/1571134166780.jpg" alt="img"><br><img src="http://img.xxlaila.cn/1571297568491.jpg" alt="img"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;åœ¨è¿›è¡ŒRoles ID è¿™æ ç›®ï¼Œéœ€è¦å¡«å†™çš„æ˜¯Usersï¼Œè¿™ä¸ªUsersä¼šåœ¨ldapä¸ŠåŒæ­¥Usersçš„ä¸€ä¸ªç”¨æˆ·ç»„ã€‚æ ¹æ®è‡ªå·±çš„ldapè´¦æˆ·ç»„è®¾ç½®æ¥è¿›è¡Œå¡«å†™ã€‚ä¸‹å›¾æ˜¯ldapçš„ç»„è®¾ç½®<br><img src="http://img.xxlaila.cn/1571298567078.jpg" alt="img"></p></li></ul><p><strong>æ³¨</strong>: å…¶å®åœ¨è¿™é‡Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è¿›è¡ŒPrivilegesçš„æƒé™èµ‹äºˆï¼Œä½†æ˜¯æˆ‘é€‰æ‹©çš„æ˜¯å…ˆåˆ›å»ºä¸€ä¸ªæœ¬åœ°çš„nexus relosã€‚ç„¶åæˆ‘ä»¬åœ¨Rolesæ å…³è”ä¹‹å‰åˆ›å»ºçš„<code>Developer</code>ï¼Œå®Œæˆä»¥åé€šè¿‡ldapè´¦æˆ·ç™»å½•è¿›è¡Œæµ‹è¯•</p><h5 id="æµ‹è¯•-1"><a href="#æµ‹è¯•-1" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h5><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;è¿™é‡Œä¸»è¦æ˜¯ä»å››ä¸ªæ–¹é¢æ¥æµ‹è¯•ldapè´¦æˆ·ã€‚åˆ†åˆ«æ˜¯: ç™»å½•é»˜è®¤çš„æƒé™ã€æµè§ˆæ‰€æœ‰åº“çš„æƒé™ã€Browseçš„æµè§ˆã€Browseåº“çš„ä¸Šä¼ </p><ul><li><p>ç™»å½•é»˜è®¤çš„æƒé™<br><img src="http://img.xxlaila.cn/1571297962563.jpg" alt="img"></p></li><li><p>æµè§ˆæ‰€æœ‰åº“çš„æƒé™<br><img src="http://img.xxlaila.cn/1571298121188.jpg" alt="img"></p></li><li><p>Browseçš„æµ<br><img src="http://img.xxlaila.cn/1571298018356.jpg" alt="img"><br><img src="http://img.xxlaila.cn/1571298167348.jpg" alt="img"></p></li><li><p>Browseåº“çš„ä¸Šä¼ <br><img src="http://img.xxlaila.cn/1571298224331.jpg" alt="img"><br><img src="http://img.xxlaila.cn/1571298260091.jpg" alt="img"></p></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;é…ç½®nexus&quot;&gt;&lt;a href=&quot;#é…ç½®nexus&quot; class=&quot;headerlink&quot; title=&quot;é…ç½®nexus&quot;&gt;&lt;/a&gt;é…ç½®nexus&lt;/h3&gt;&lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;ç™»å½•nexusåœ¨è®¾ç½®é¡µï¼Œç‚¹å‡»ldapï¼Œ&lt;/p&gt;
    
    </summary>
    
      <category term="nexus" scheme="https://xxlaila.github.io//categories/nexus/"/>
    
    
      <category term="nexus" scheme="https://xxlaila.github.io//tags/nexus/"/>
    
  </entry>
  
  <entry>
    <title>jenkinsé…ç½®å¤‡ä»½</title>
    <link href="https://xxlaila.github.io/2019/10/15/jenkins%E9%85%8D%E7%BD%AE%E5%A4%87%E4%BB%BD/"/>
    <id>https://xxlaila.github.io/2019/10/15/jenkinsé…ç½®å¤‡ä»½/</id>
    <published>2019-10-15T00:55:19.000Z</published>
    <updated>2019-10-22T02:07:09.415Z</updated>
    
    <content type="html"><![CDATA[<h3 id="jenkins-å¤‡ä»½"><a href="#jenkins-å¤‡ä»½" class="headerlink" title="jenkins å¤‡ä»½"></a>jenkins å¤‡ä»½</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å½“jenkinsåœ¨ç”¨èµ·æ¥çš„æ—¶å€™ï¼Œæˆ‘ä»¬éš¾ä¿ä»–ä¸ä¼šå‡ºæ•…éšœï¼Œä½†æ˜¯å‡ºäº†æ•…éšœæˆ‘ä»¬æ€ä¹ˆåšåˆ°å¿«é€Ÿçš„æ¢å¤å‘¢ï¼Œè¿™æ—¶å¤‡ä»½å°±æ˜¾å¾—å°¤ä¸ºé‡è¦äº†ã€‚ä½†jenkinsæœ¬èº«ä¸æä¾›å¤‡ä»½çš„åŠŸèƒ½ï¼Œæ‰€ä»¥è¿™é‡Œå°±éœ€è¦å€ŸåŠ©å¤–åŠ›ã€‚å¤‡ä»½å¯ä»¥å¤šæ ·åŒ–ï¼Œä¸€ç§æ˜¯æˆ‘ä»¬ç›´æ¥åˆ°jenkinsçš„ç›®å½•ä¸‹é¢æ‰‹åŠ¨å¤‡ä»½jenkinsç›®å½•ã€‚ä¸€ç§æ˜¯æˆ‘ä»¬å°±jenkinsè‡ªå¸¦çš„æ’ä»¶<code>thinBackup</code>å’Œ<code>Periodic Backup</code>è¿›è¡Œå¤‡ä»½æ¢å¤ï¼Œä¸‹é¢è¿›è¡Œåˆ†åˆ«ä»‹ç»</p><a id="more"></a><h3 id="thinBackupå¤‡ä»½"><a href="#thinBackupå¤‡ä»½" class="headerlink" title="thinBackupå¤‡ä»½"></a>thinBackupå¤‡ä»½</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ç™»å½•jenkinsâ€”â€”&gt;ç³»ç»Ÿç®¡ç†â€”â€”&gt;æ’ä»¶ç®¡ç†<br><img src="http://img.xxlaila.cn/1571101180571.jpg" alt="img"><br>å®‰è£…å®Œæˆä¹‹åé‡å¯jenkinsæœåŠ¡ï¼Œç™»å½•jenkinsåœ¨ç³»ç»Ÿç®¡ç†ç•Œé¢å¯ä»¥çœ‹åˆ°<br><img src="http://img.xxlaila.cn/1571101557754.jpg" alt="img"></p><h4 id="é…ç½®ThinBackup"><a href="#é…ç½®ThinBackup" class="headerlink" title="é…ç½®ThinBackup"></a>é…ç½®ThinBackup</h4><ul><li>ç‚¹å‡»ThinBackup<br><img src="http://img.xxlaila.cn/1571101640273.jpg" alt="img"><br>å¯ä»¥çœ‹åˆ°æœ‰ä¸‰ä¸ªé€‰é¡¹:</li><li>Backup Now: æ‰‹åŠ¨ç«‹å³å¤‡ä»½</li><li>Restore: æ¢å¤å¤‡ä»½</li><li>Settings: å¤‡ä»½å‚æ•°çš„è®¾ç½®</li></ul><h5 id="Settings"><a href="#Settings" class="headerlink" title="Settings"></a>Settings</h5><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ä¸‹é¢æ˜¯æˆ‘çš„å¤‡ä»½å‚æ•°ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦è‡ªå·±è®¾å®šå¤‡ä»½å‚æ•°ï¼Œè®¾ç½®å¥½å‹saveå³å¯ï¼Œ<code>Backup schedule for full backups</code>æ„æ€æ˜¯å‘¨ä¸€åˆ°å‘¨äº”æ¯å¤©å‡Œæ™¨ä¸¤ç‚¹è¿›è¡Œå¤‡ä»½<br><img src="http://img.xxlaila.cn/1571102057919.jpg" alt="img"></p><h5 id="Restore"><a href="#Restore" class="headerlink" title="Restore"></a>Restore</h5><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å¤‡ä»½æ–‡ä»¶æ˜¯ä»¥æ—¥æœŸ+æ—¶é—´èŠ‚ç‚¹ç»„æˆçš„æ–‡ä»¶åï¼Œæˆ‘ä»¬æ¢å¤ä»€ä¹ˆæ—¶é—´æ®µçš„ï¼Œç‚¹å‡»è¿›è¡Œæ¢å¤ï¼Œ<br><img src="http://img.xxlaila.cn/1571102188007.jpg" alt="img"></p><h3 id="Periodic-Backup"><a href="#Periodic-Backup" class="headerlink" title="Periodic Backup"></a>Periodic Backup</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å¤‡ä»½é™¤äº†ä¸Šé¢æåˆ°çš„æ’ä»¶è¿˜æœ‰ä¸€ä¸ªæ’ä»¶æ˜¯<code>Periodic Backup</code>ï¼Œå®‰è£…<code>Periodic Backup</code>ä¸é˜è¿°ï¼Œå®‰è£…å®Œæˆåå¯ä»¥åœ¨ç³»ç»Ÿç®¡ç†èœå•ä¸‹é¢æœ‰ä¸€ä¸ª<code>Periodic Backup Manager</code>èœå•<br><img src="http://img.xxlaila.cn/1571709136813.jpg" alt="img"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æ‰“å¼€<code>Periodic Backup Manager</code>ï¼Œç¬¬ä¸€æ¬¡æ‰“å¼€æ˜¯æ²¡æœ‰ä»»ä½•ä¸œè¥¿çš„ï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·±å»å»ºç«‹ä¸€ä¸ªè§„åˆ™ï¼Œç‚¹å‡»<code>Configure</code><br><img src="http://img.xxlaila.cn/1571709270639.jpg" alt="img"></p><p>é…ç½®é¡¹å¾ˆç®€å•:</p><ul><li></li><li>Temporary Directory: ä¸´æ—¶ç›®å½•</li><li>Backup schedule (cron): è¿›è¡Œå¤‡ä»½cronçš„è¡¨è¾¾å¼ï¼Œå¡«å†™å®Œæˆåç‚¹å‡»<code>Validate cron syntax</code>è¿›è¡ŒéªŒè¯</li><li>Maximum backups in location: æœ€å¤§ä½ç½®å¤‡ä»½ï¼Œä¿ç•™å¤šå°‘ä¸ªå¤‡ä»½æ–‡ä»¶</li><li>Store no older than (days): ä¿ç•™çš„æ—¶é—´</li><li>File Management Strategy: å¤‡ä»½ç­–ç•¥<ul><li>ConfigOnly: åªå¤‡ä»½é…ç½®æ–‡ä»¶</li><li>FullBackup: è¿›è¡Œå…¨é‡å¤‡ä»½ï¼Œå¯ä»¥é€šè¿‡Excludes listä¸­å¡«å…¥Anté£æ ¼è¡¨è¾¾å¼ï¼Œæ’é™¤ä¸å¸Œæœ›å¤‡ä»½çš„æ–‡ä»¶ï¼Œå¤šä¸ªè¡¨è¾¾å¼ä½¿ç”¨åˆ†å·åˆ†éš”</li></ul></li><li>Storage Strategy: å­˜å‚¨ç­–ç•¥ï¼Œå°±æ˜¯æ˜¯å¦éœ€è¦è¿›è¡Œå‹ç¼©å­˜å‚¨</li><li>Backup Location: å¤‡ä»½çš„ä½ç½®ï¼Œéƒ½æ˜¯æœ¬åœ°ç›®å½•<br><img src="http://img.xxlaila.cn/1571709879768.jpg" alt="img"></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;jenkins-å¤‡ä»½&quot;&gt;&lt;a href=&quot;#jenkins-å¤‡ä»½&quot; class=&quot;headerlink&quot; title=&quot;jenkins å¤‡ä»½&quot;&gt;&lt;/a&gt;jenkins å¤‡ä»½&lt;/h3&gt;&lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;å½“jenkinsåœ¨ç”¨èµ·æ¥çš„æ—¶å€™ï¼Œæˆ‘ä»¬éš¾ä¿ä»–ä¸ä¼šå‡ºæ•…éšœï¼Œä½†æ˜¯å‡ºäº†æ•…éšœæˆ‘ä»¬æ€ä¹ˆåšåˆ°å¿«é€Ÿçš„æ¢å¤å‘¢ï¼Œè¿™æ—¶å¤‡ä»½å°±æ˜¾å¾—å°¤ä¸ºé‡è¦äº†ã€‚ä½†jenkinsæœ¬èº«ä¸æä¾›å¤‡ä»½çš„åŠŸèƒ½ï¼Œæ‰€ä»¥è¿™é‡Œå°±éœ€è¦å€ŸåŠ©å¤–åŠ›ã€‚å¤‡ä»½å¯ä»¥å¤šæ ·åŒ–ï¼Œä¸€ç§æ˜¯æˆ‘ä»¬ç›´æ¥åˆ°jenkinsçš„ç›®å½•ä¸‹é¢æ‰‹åŠ¨å¤‡ä»½jenkinsç›®å½•ã€‚ä¸€ç§æ˜¯æˆ‘ä»¬å°±jenkinsè‡ªå¸¦çš„æ’ä»¶&lt;code&gt;thinBackup&lt;/code&gt;å’Œ&lt;code&gt;Periodic Backup&lt;/code&gt;è¿›è¡Œå¤‡ä»½æ¢å¤ï¼Œä¸‹é¢è¿›è¡Œåˆ†åˆ«ä»‹ç»&lt;/p&gt;
    
    </summary>
    
      <category term="jenkins" scheme="https://xxlaila.github.io//categories/jenkins/"/>
    
    
      <category term="jenkins" scheme="https://xxlaila.github.io//tags/jenkins/"/>
    
  </entry>
  
  <entry>
    <title>jenkinsé…ç½®ldap</title>
    <link href="https://xxlaila.github.io/2019/10/14/jenkins%E9%85%8D%E7%BD%AEldap/"/>
    <id>https://xxlaila.github.io/2019/10/14/jenkinsé…ç½®ldap/</id>
    <published>2019-10-14T03:49:32.000Z</published>
    <updated>2019-10-15T02:18:25.482Z</updated>
    
    <content type="html"><![CDATA[<h3 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å…¬å¸ç ”å‘äººå‘˜å’Œæµ‹è¯•äººå‘˜ï¼Œè¿˜æœ‰è¿ç»´äººå‘˜æœ‰æ—¶å€™ç™»å½•jenkinså»æŸ¥çœ‹ä¸€äº›jobçš„çŠ¶æ€æˆ–è€…æ˜¯å…¶ä»–çš„ä¸œè¥¿ï¼Œè™½ç„¶æœ‰ä¼ä¸šå¾®ä¿¡çš„é€šçŸ¥ï¼Œä½†æ˜¯æ„Ÿè§‰è¿˜æ˜¯ä¸èƒ½æ»¡è¶³ï¼Œæ¯”å¦‚jobé”™è¯¯äº†ï¼Œä¼ä¸šå¾®ä¿¡è™½ç„¶å§é”™è¯¯å‘ç»™äº†ç ”å‘äººå‘˜ï¼Œä½†æ˜¯ç ”å‘è¿˜æ˜¯è¦ç™»å½•jenkinsä¸Šå»çœ‹ï¼Œå°±æ„Ÿè§‰è¦èˆ’æœä¸€ç‚¹ï¼Œæµ‹è¯•ä¸Šåšçš„ä¸€äº›è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œæœ‰æ—¶å€™å¤±è´¥äº†ä»–ä»¬ä¹Ÿä¼šå»çœ‹æˆ–è€…æ˜¯å»å»ºç«‹ä¸€äº›è‡ªåŠ¨åŒ–çš„jobã€‚ä¹‹å‰å»ºç«‹äº†å…¬å…±çš„è´¦å·ï¼Œå¼€å‘å’Œæµ‹è¯•äººå‘˜éƒ½å»ç™»å½•ï¼Œä½†æ˜¯æœ‰æ—¶å€™ä»–ä»¬è¯¯æ“ä½œäº†ï¼Œå¯¼è‡´ä¸€äº›å…¶ä»–çš„ä¸œè¥¿å¤±è´¥æˆ–è€…é”™è¯¯ï¼Œè™½ç„¶åšäº†æƒé™æ§åˆ¶ï¼Œä½†æ˜¯ä»–ä»¬è¿˜æ˜¯æ­»ä¸æ‰¿è®¤ï¼Œæ‰€ä»¥è¿™é‡Œä»‹å…¥ldapã€‚è°åŠ¨çš„å°±çŸ¥é“äº†ï¼Œè¿™æ ·å°±ä¸æ€•äº†ã€‚</p><a id="more"></a><h3 id="å¼€å§‹é…ç½®"><a href="#å¼€å§‹é…ç½®" class="headerlink" title="å¼€å§‹é…ç½®"></a>å¼€å§‹é…ç½®</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ç™»å½•jenkinsâ€”â€”&gt;ç³»ç»Ÿç®¡ç†â€”â€”&gt;å…¨å±€å®‰å…¨é…ç½®<br><img src="http://img.xxlaila.cn/1571025388007.jpg" alt="img"><br>è®¿é—®æ§åˆ¶â€”â€”&gt;LDAP<br><img src="http://img.xxlaila.cn/1571027524602.jpg" alt="img"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;é…ç½®å®Œæˆä»¥åæˆ‘ä»¬éœ€è¦æµ‹è¯•ä¸€ä¸‹è¿æ¥æ˜¯å¦æ­£å¸¸ï¼Œç‚¹å‡»<code>Test LDAP setttings</code>ï¼Œè¾“å…¥åœ¨ldapçš„å…¶ä¸­ä¸€ä¸ªè´¦æˆ·æ¥è¿›è¡ŒéªŒè¯ï¼Œæ²¡é—®é¢˜çš„ç»“æœå¦‚ä¸‹:<br><img src="http://img.xxlaila.cn/1571027696951.jpg" alt="img"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;é…ç½®å®Œæˆå¹¶æµ‹è¯•é€šè¿‡åå°±å¯ä»¥ç”¨LDAPç›´æ¥ç™»å½•äº†<br><strong>æ³¨</strong>: å¯ç”¨äº†LDAPç™»å½•åå°†æ— æ³•å†ç”¨ä¹‹å‰çš„ç™»å½•æ–¹å¼ï¼ˆæœ¬åœ°è®¤è¯å°†æ— æ³•åœ¨ä½¿ç”¨ï¼‰ç™»å½•ï¼Œç™»å½•è¿›æ¥çš„ä»»ä½•ä¸€ä¸ªè´¦å·éƒ½æ˜¯ç®¡ç†å‘˜ï¼Œéƒ½æ˜¯ç®¡ç†ç€è‚¯å®šæ¥è¯´ä¸å®‰å…¨ï¼Œæƒé™é…ç½®è¯·ä¸‹çœ‹</p><p><a href="https://wiki.jenkins.io/display/JENKINS/LDAP+Plugin" target="_blank" rel="noopener">å®˜æ–¹å‚è€ƒ</a></p><h3 id="é…ç½®ldapçš„è´¦æˆ·æƒé™"><a href="#é…ç½®ldapçš„è´¦æˆ·æƒé™" class="headerlink" title="é…ç½®ldapçš„è´¦æˆ·æƒé™"></a>é…ç½®ldapçš„è´¦æˆ·æƒé™</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ä¸Šé¢æˆ‘ä»¬è™½ç„¶å§ldapé…ç½®å®Œæˆï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦å¯¹ç”¨æˆ·è¿›è¡Œæƒé™çš„é…ç½®ï¼Œä¸å¯èƒ½æ¯ä¸ªäººç™»å½•éƒ½èƒ½å¯¹æˆ‘ä»¬jenkinsè¿›è¡Œæ— é™åˆ¶çš„æ“ä½œï¼Œè¿™ä¸ç¬¦åˆæˆ‘ä»¬ä¹‹å‰çš„æ„å›¾ã€‚å®‰è£…<code>Role-based Authorization Strategy</code>æ’ä»¶</p><ul><li>åœ¨ç³»ç»Ÿç®¡ç†â€”â€”&gt;å…¨å±€å®‰å…¨é…ç½®,å¯ä»¥çœ‹åˆ°ä¸‹é¢é€‰é¡¹ï¼Œæ¯é¡¹ä»‹<a href="https://xxlaila.github.io/2019/08/09/jenkins%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90%E9%85%8D%E7%BD%AE/">å‚è€ƒ</a><br><img src="http://img.xxlaila.cn/1571034253089.jpg" alt="img"></li></ul><p>ä¿å­˜ä»¥åï¼Œè¿”å›ç³»ç»Ÿç®¡ç†ç•Œé¢å°±å¯ä»¥çœ‹åˆ°å¤šå¤„ä¸€ä¸ª<code>Manage and Assign Roles</code><br><img src="http://img.xxlaila.cn/1571034433352.jpg" alt="img"><br>ç‚¹å‡»è¿›å»</p><p><img src="http://img.xxlaila.cn/1571034507945.jpg" alt="img"></p><ul><li><strong>Manage Roles</strong>: è§’è‰²åˆ†ä¸ºGlobalå’ŒProjectï¼Œå¯åˆ›å»ºè§’è‰²åˆ†ç»„å’Œæ·»åŠ é¡¹ç›®ã€‚</li><li><strong>Assign Roles</strong>: å¢åŠ å…·ä½“çš„ç”¨æˆ·ï¼Œåˆ†é…åˆ°è§’è‰²ç»„ï¼ŒæŒ‡å®šé¡¹ç›®æƒé™ã€‚</li></ul><p><a href="https://xxlaila.github.io/2019/08/09/jenkins%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90%E9%85%8D%E7%BD%AE/">æƒé™è®¾ç½®</a></p><ul><li>ä¸‹é¢æˆ‘çš„é…ç½®ï¼Œå’Œä¹‹å‰çš„å¤§åŒå°å¼‚<br><img src="http://img.xxlaila.cn/1571038684383.jpg" alt="img"></li></ul><p><strong>æ³¨</strong>:  è¿™é‡Œæœ‰ä¸€ä¸ªå°é—®é¢˜ï¼Œè¿™æ ·é…ç½®ä»¥åï¼Œæ–°ç”¨æˆ·ç™»å½•è¿›æ¥ä»¥åå°±ä¼šæç¤ºæ²¡æœ‰æƒé™ï¼Œ<code>Access Denied,xxxxæ²¡æœ‰å…¨éƒ¨/Readæƒé™</code>ï¼Œè¿™æ˜¯å› ä¸ºåœ¨æ‰“å¼€jenkinsåï¼Œæ²¡æœ‰åˆ›å»ºç”¨æˆ·å‰ï¼Œå…ˆä¸è¦å‹¾é€‰ç³»ç»Ÿè®¾ç½®ä¸­å¯ç”¨å®‰å…¨é€‰é¡¹ï¼Œå¦‚æœå‹¾é€‰äº†ï¼Œå°±ä¼šå‡ºç°æ— æ³•è¿›å…¥jenkinsçš„ç°è±¡<br><img src="http://img.xxlaila.cn/1571037187865.jpg" alt="img"></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;åœ¨ç½‘ä¸Šçœ‹åˆ°æœ‰è¿™ç§çš„è§£å†³åŠæ³•ï¼Œæœ‰å‡ ç§æ–¹æ¡ˆï¼Œä¸€ä¸ªæ˜¯ä¿®æ”¹confing.xmlçš„æ–‡ä»¶ï¼Œä¿®æ”¹config.xmlæ–‡ä»¶çš„ä¸‰ç§æ–¹å¼æ„Ÿè§‰éƒ½ä¸å¤ªåˆ‡åˆå®é™…çš„ä¸šåŠ¡ï¼›ä¸‹é¢æ˜¯æˆ‘åšçš„ä¸¤ç§åŠæ³•ï¼Œæ¨èä½¿ç”¨ç¬¬äºŒç§</p><ul><li><p>Role-Based Strategy<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;åœ¨<code>Assign Roles</code>å§ç”¨æˆ·æ·»åŠ è¿›æ¥ï¼Œç„¶åå‹¾é€‰æƒé™ï¼Œ<br>ç³»ç»Ÿç®¡ç†â€”â€”&gt;Manage and Assign Rolesâ€”â€”&gt;Assign Roles<br><img src="http://img.xxlaila.cn/1571037604678.jpg" alt="img"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ä½†æ˜¯è¿™æœ‰ä¸€ä¸ªå¼Šç«¯ï¼Œå°±æ˜¯æ¯æ¬¡æ–°æ¥ä¸€ä¸ªç”¨æˆ·å°±å¾—å»æ·»åŠ ä¸€æ¬¡ç”¨æˆ·æƒé™ï¼Œè™½ç„¶æ»¡è¶³äº†ä¸šåŠ¡éœ€æ±‚ï¼Œä½†æ˜¯ä¸ç§‘å­¦</p></li><li><p>é¡¹ç›®çŸ©é˜µæˆæƒç­–ç•¥<br><img src="http://img.xxlaila.cn/1571041499340.jpg" alt="img"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;è¿™æ˜¯ä¸€ä¸ªå…¨å±€çš„é…ç½®ï¼Œç‰¹å®šç»„åªèƒ½æŒ‰ç…§æœ€å°çš„æƒé™æˆæƒï¼Œé¢å¤–çš„æƒé™å¯ä»¥åœ¨å…·ä½“çš„é¡¹ç›®æƒé™çŸ©é˜µé‡Œé¢åœ¨æ·»åŠ ã€‚ é»˜è®¤åªæœ‰<code>Anonymous Users</code>å’Œ<code>Authenticated Users</code>ï¼Œç®¡ç†å‘˜ç»„æ˜¯éœ€è¦æ·»åŠ çš„<code>admin</code></p></li><li><p>Anonymous Users: åŒ¿åç”¨æˆ·ï¼Œæ˜¾ç„¶ä¸èƒ½</p></li><li><p>Authenticated Users: è®¤è¯ç”¨æˆ·ï¼Œå°±æ˜¯åªè¦æ˜¯è®¤è¯çš„è´¦å·éƒ½å¯ä»¥æ‹¥æœ‰çš„æƒé™</p></li><li><p>admin: å°±æ˜¯æ‹¥æœ‰æ‰€æœ‰çš„æƒé™äº†ï¼Œè¿™ä¸ªç»„ä¸€èˆ¬åªèƒ½è¿ç»´äººå‘˜å’Œéƒ¨é—¨è€å¤§åŠ å…¥ã€‚</p></li></ul><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;åŠ å…¥adminç»„ä»¥åï¼Œä»–ä¼šè‡ªåŠ¨å»åŒæ­¥ldapçš„ç»„ç”¨æˆ·ï¼Œå¦‚æœç”¨æˆ·åœ¨ldapæ˜¯adminç»„ï¼Œé‚£ä¹ˆåœ¨è¿™é‡Œå°±ä¼šæ˜¯ç®¡ç†å‘˜æƒé™ï¼Œå¦‚æœç”¨æˆ·æ˜¯æ™®é€šç»„ï¼Œé‚£ä¹ˆå°±æ˜¯<code>Authenticated Users</code>ç»„èµ‹äºˆçš„æƒé™ï¼Œä½¿ç”¨è¿™ç§æ–¹å¼åªè¦ç”¨æˆ·æ˜¯ldapé‡Œé¢çš„ï¼Œå°±å¯ä»¥ç™»å½•æŸ¥çœ‹ã€‚è¿™æ ·å°±æ»¡è¶³äº†ä¸šåŠ¡åœºæ™¯éœ€æ±‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h3&gt;&lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;å…¬å¸ç ”å‘äººå‘˜å’Œæµ‹è¯•äººå‘˜ï¼Œè¿˜æœ‰è¿ç»´äººå‘˜æœ‰æ—¶å€™ç™»å½•jenkinså»æŸ¥çœ‹ä¸€äº›jobçš„çŠ¶æ€æˆ–è€…æ˜¯å…¶ä»–çš„ä¸œè¥¿ï¼Œè™½ç„¶æœ‰ä¼ä¸šå¾®ä¿¡çš„é€šçŸ¥ï¼Œä½†æ˜¯æ„Ÿè§‰è¿˜æ˜¯ä¸èƒ½æ»¡è¶³ï¼Œæ¯”å¦‚jobé”™è¯¯äº†ï¼Œä¼ä¸šå¾®ä¿¡è™½ç„¶å§é”™è¯¯å‘ç»™äº†ç ”å‘äººå‘˜ï¼Œä½†æ˜¯ç ”å‘è¿˜æ˜¯è¦ç™»å½•jenkinsä¸Šå»çœ‹ï¼Œå°±æ„Ÿè§‰è¦èˆ’æœä¸€ç‚¹ï¼Œæµ‹è¯•ä¸Šåšçš„ä¸€äº›è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œæœ‰æ—¶å€™å¤±è´¥äº†ä»–ä»¬ä¹Ÿä¼šå»çœ‹æˆ–è€…æ˜¯å»å»ºç«‹ä¸€äº›è‡ªåŠ¨åŒ–çš„jobã€‚ä¹‹å‰å»ºç«‹äº†å…¬å…±çš„è´¦å·ï¼Œå¼€å‘å’Œæµ‹è¯•äººå‘˜éƒ½å»ç™»å½•ï¼Œä½†æ˜¯æœ‰æ—¶å€™ä»–ä»¬è¯¯æ“ä½œäº†ï¼Œå¯¼è‡´ä¸€äº›å…¶ä»–çš„ä¸œè¥¿å¤±è´¥æˆ–è€…é”™è¯¯ï¼Œè™½ç„¶åšäº†æƒé™æ§åˆ¶ï¼Œä½†æ˜¯ä»–ä»¬è¿˜æ˜¯æ­»ä¸æ‰¿è®¤ï¼Œæ‰€ä»¥è¿™é‡Œä»‹å…¥ldapã€‚è°åŠ¨çš„å°±çŸ¥é“äº†ï¼Œè¿™æ ·å°±ä¸æ€•äº†ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="jenkins" scheme="https://xxlaila.github.io//categories/jenkins/"/>
    
    
      <category term="jenkins ldap" scheme="https://xxlaila.github.io//tags/jenkins-ldap/"/>
    
  </entry>
  
  <entry>
    <title>javaåº”ç”¨éƒ¨ç½²</title>
    <link href="https://xxlaila.github.io/2019/10/12/java%E5%BA%94%E7%94%A8%E9%83%A8%E7%BD%B2/"/>
    <id>https://xxlaila.github.io/2019/10/12/javaåº”ç”¨éƒ¨ç½²/</id>
    <published>2019-10-12T03:38:32.000Z</published>
    <updated>2019-10-15T02:18:36.026Z</updated>
    
    <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <div class="hbe-input-container">  <input type="password" id="hbePass" placeholder="Welcome to my blog, enter password to read." />    <label for="hbePass">Welcome to my blog, enter password to read.</label>    <div class="bottom-line"></div>  </div>  <script id="hbeData" type="hbeData" data-hmacdigest="228dd2936472938646206dad34a588890ef30d79a9156bb41a3a8245074c82c8">5eb3e5c27505009468733f45f0145da5298ac762ba1191d7310fd8276d8873acc03d49adae5b0e3bc8facaa1dd25e6dfcab33ca9b5948957d67b0ddba9c840335193949b60d352ab8b296cc6e3bcf428cb666d30bbc5d09694a7f8e4b859d88b5d40448d06dadbf5f179cec0100310a8e53db628d635010ebe84c57afa836e2a71b077f5894e230263aa2188661cbea84e3c20d4b26118a99ac0f483511de3592f64992da1dd3c8c6872a13e6a4346f1d959e02c671a8959615f10b056b245f6767cd9f4b9d6bcf4de495af824c87dad42391063938b0c4bb001b1c7be7f513dfc01854cf05be8161b181e5950ec004f74d848a9d8b221ff6bbf817555d05f492f0a79bdd4b1d9a652e5f23fb5c0fe732ac3aff1cfa4e964e24927b10da3d4b19ea52df54af5ab3d5ee280608214c093464fe027ae0e5144f74e7801d5b4fa4b4264e5a63d6669c0129dba8f5814923a7461a3d755f2831637371dc086d9e2412aae58515c4fa0cd8971934f7ddc5e89e1f996cef0fa6f2b3bf012be6b0768462d01e162b65b065fa7862f74835c2d68d26eb57e9e897b73c840ab26c3343a66ebdeaba0bdaa4cb5509642f9d1148a803ae2dfc4e7011b65c35d60179d159c6df50a71d23c410ed880d86bf7e10093062b02ba679bbb502a6dbc9fab6897b3fc056bfa5a2734662dbb1fadc6358aa32a870440193eaded84cb5cc596ebc6b69b499a68ca22d235ea74d1895bc121f50217ff88f8e2ddae58dcc8ae4b8db85cc07ac5748a9a98c30681e6abdc484bdf3d8fde05a66b352fc137cf4fb0f3659db828bbfaecc3c8e5a708fcbb8b59a152cd8ecf49aeb4b9ddcbb67fa6c229fb70f20745f55cb088cdfa19ba49764b4b112b6693485b5e7498fd8c998140da67c6b0f5c2e16c5b00a6dd8b5a9dd6a848da141cace54663273ea301a9b4b12f33d45004e8ab567a17a40ae1198dc1c5d57e2251489a1dfc8819dc3ba4386aa86b9161ec024067e159462e44857f152c9dae233a974ff117101666cade386117426d9200a773b1589fe74dfc956461aa28991b2653a5f797948f53d0e359d32bc0bc6561ad82e8b8ffbff680687a5594f20019cc0f318ece72c2eb167c86ccc8c4d121746fffa5a9a30e8cd27b805f8aa95fcd0b894b77b788f2831694acb4e831b8e872fd3e00455acdb1e911073caf478ea5cf58dddb5380a0de038d1dfad637b4fc4c6f81ba1b0bd43bfe2cb1349a2ae1af4d08068b69efbf9e4ee264bd2ae69843de805e8e7a6dff0882fbc963fc584bf7bdf30b844f13c48fffce9ea8a9fd383602260b629f258ba12c7e77b7a8fbc61ddabe13b4bc10ab1db06164b84dc8fe6a11afd9c397d0c9ed9dc5a810e7f926a30d252f5a6d476e8328ba0997def7d5e5db57f1e842297df8ae3b7cc123df51aa9382284716228999bd2a273ab1c818bf5b4789298cd6b3f2b101979baea6e6c50174dd3834bbfd8904df359837659179c5becbc6fde28b797b63acdafa28c424c10554a3df38d465eef3eaba2552cbd7ff292205eecfa93364b19fe196c676ce885d00e56bac527bc6d176dff99ddfd59c1e946ca7bb651d700fe1ad64d90d23dc4dce8d57065b402f528c404ddfcfdb85a0b44130422bbdcfcd88f677e869a41511b00680a8e80ab66e2ec35d443d7fe009ea3e5be52bf2d354530d8b873419f73ebbdb3bec4da25a93791bdea87a2b23fb78814049acff31db5d7a6c6a315ef9162eed22b7068e97eb60c2437f5d451cf8e222a5b393833e8b1328cc9fedcdb1c82d215f71b38ffc8b427f08718200e291fdae3acd93030dce44af6ca0ed81a8588533290d654fc607f34aa6d4bbd5a2aa3892a20ec4a8e6fe9eb1d0a8a6b87905fade468cdc5c1dc70057cb236c6d1d973bb3b235ceb5f1438c17bb4514deda051da47aab87cf3f56d240e69a05ce6e4e06804a24fb54a7924fe12d93e76df55dac1be49d77ddb25409655efb24c65aa79fec5f66a81d4d59137f2f75dc49e7bf51d0e64ecced0e7d285bb7d28b699253739e844337a7fd8af73205a5233fa9a565bbcf0ccd3ed7db6f58a0e96d13cf25ab2653759ec90bb0320bcadbd6a5d84c14dc332c555302d83544bd1e9dcea6f88267299961df51b0f8220797ac1d5140450cfc0bc6c896668045dea8ded218121c3c0cdb9332bae8c47f7775201d4e3188351ebefc4b4c8a220872a0736810219ad58ae2db2aa380d6afe497ac970e0f2913595f8c0d54a5697562f123009135374510efbe4b4643ce3d078b7eaac025b812ab593e19138f1e30f7b155f3d860dc96ee4451d38e43b07afc4604249aa087ef246eec361d8bd0b6b1204575d35423bf4a1625640de36547a113bbc2df59985cf0e1b1c63853134bccdb76ead845d4007e7683db529afb8d635e3ff4f92d73aa1e8ad878a29253869b94219f08666dc47dc21d1d80e9c1e4ce8e4b4ff9b221553c13273e3da50942242c18e8f1a969d111a3d9c7d1fac74387caa049cc3a0b583db3bc7ed020a37420470941f684f2ad4bc68b80e242a56d5a7961ae39f64320862671cfd1ec91896394823096dfddd4d4a1df125c8c614dd458c7acb61ec1eff66fa73d59f246e26012f2ae1e63bb90fee88ffd32ebe255a5c2d11484a432412420aa9566679324fab047c5652568546796f4c985dbb28800866597e51f49e33851742c54d6161d2571eccd38b8d9f25f83c52468a9731a7964ab767c24d3885782b01fd43fbd7ab5aae1f532bd570a2150b4478a51e8002f0ba81335414019c5d5fa2aa542b1c6303d5308db4b6b3d98a64e6cc149da090c2ffd559f29f2de5eea5c3fde7875c853a941275c4009896779924b2ed7df47f73437a6f7ca87ac89ec7e55d3bd0775fa91fed7a87b0daac18512a3f9a9cc6e3cb569bb88e58e51e25c2faa678e5c39bf19096598797387e027a0da7508259b8df017d6d21a9ec831c1211dfbca45ec1081cc477f354b37c00d7d738e4e1cab3533d0854aa69a69f28cf79b5761fb212ddd8496a24c609c2b9d038c93ecf24ae3c17516bbd2ccdc2485d4a07d782784aca6a123a2b21623a2d1abdeef55a57e1b912cfe2657c33fb99c6d73349c6b28434932072bc649ca0d6bf07a9246592d46583c346e90cffc60c21e60b46d8fda55f41988e87d0b789153caf3d0e9a0d853d01a2df1ae6c1a145e95e9a85951c7bd924c7e4c4a9592b0d9af92a3e59427d83b73f7fe52134a71f7bfb388ee60f0bf1c6e82f4eda39ac8431b05faeb1749a3e89a16a454bf87b7125e3bc34e30785e9da251419d1cdcc28f2bf1d65a5f948ded956b9df540885c70aaeb2f10b4e39cd5189c94a05cf5a5d8091bc2ff87d8280b6c983610edf30cec8bf93916fd2315ddbde2918b4739c0b80a42dc53f5ce90f388bdb57cfb8c425c655d718e003173ddd3de648a1b74111744089372645e810e0acc7c344dad58c3037b87fdc1919a03ce418c7f05f3bc9a66b04f063241abbf15539637113d43562a1f0a328f990bcfc452d864e8a2bda1163ecee5f59f3245b3a099a6a464c1b31ca1df50e79e30a93c5b85e91185298d9e3ba99a66e2ab0adfe502ee2e2981de5eaf9ee501c483e09d9fe3a36f5934d0ac8d52c2ae6baa554d422e7d18a5ab8a49a29206f6cc532dd5b0980b855750efdd65644d786a2174ca45728d3909bb78875b578d24c74229ef7e326ee54061098e2a4d7340aa46b0af26af7895b728839749beef78d0dda6ec590cde28d0b6fe65fdd76e3be9788ee898f77217d888d0de3d7e7d76e37e3ed4e6ccc82c96cee8bf0f443afd8b4776073e77ddc00196fedf61b1066a6534b4d80bb34aebb69d0b1e2cdc55fa4ac3fc1a93fd9bf07ffa565b1d7fe184efc44d81dab2f4f7e19c8414c303651e00fe624bba2ff236ff6af5f9aae1b8e30f19fba1b3f1f825e9473034d4f208d866aa25e962b3e59078bc4d6a9fdf75f37ca4568b81cda508bb9334eb67baeaed1e02a063cb483fcc44e0343b9e8e53714d608b5c55d8821bfb34ab571b3b9ae5a1ab4a9a9729653789b18c6a72ce17e8048b46d772de40a2a8e3f547b80aab2b21ec4aeb12d6c067924d5c139124f8ba2bfaccdd58e1c2b3a1dc56795e6537a0944a10b31440fa738b1dab23e239c2de729c85934bb323f5b82b03af3f83b1b976cbd1ce9b8abff9e583119cd85630bc377dd030de6140f0c13cfb20e1bf556d56d676b9e23c842a44afd281521ca326eec9a2fda23a87aada4b9cec96b82ee8aee3bfe6246e83ecd287fbe6792eb40f1bb9fef1961c639cb0b9f818dafb8ec944e3b860b03e0bca2a0552f17cadbdefdafda734fb9f633b35860978b946d9f3870fb83d583f437543b35821e9858f8bf634f2d07db82511dffbe0f2d2bc46fc4961c23be76040a24b311eb10be3dfd17e32774bc61ad725323f724588cce885f477bb202827c4e44ee173b41cc86cf0eaaa5e73306ed6ed699b6558cbe9a57b9d61ee59d28d233a3f5e96172538d5ff51545c9d8170ebe04014c0373a35b93e459908c5ffd73665581ec10ae05c844b168547fe791fdf406d1f0533a52552546db3a63abb240a23ad7d32f6215195342d890ade78e3bd0960a2f31a08521c571319efa5ac94b3540fa3d678a12030759c8504ae0f9da760a067a29a3826da1caec3fd0632bc6283795d9ce837a62238ed44a7caf5d168dfd5cb4bb9a3b1cf687af3794ee2f0fb158795f85982197534e9fe232195f0e1e91b53c542a498742a6770e1b34520862a379f77d2f3724e6119b2f995a9cdc5245cb9d396b0a6a037e29cfff60a631c2e9eed21005d169bcc1378388b294f6ddf7f99c2b901adf8c6db0834e2eee67d2fb92bda3ee52fbb41e301a7589f0475742d0f4f5a5c5dafc27039e9e7e0df88f74ab0a2e54c0023df1bc43d84fa0ac850d22e9e15ddd266efa0fc38459ac76dca66e49e50c54d025a59516877298046ef171ce9bc82d68c60258212fc7d5bece8930ccb0e722bf00a3c2b947f5954b2e5f5001152fffb12b6a2cdaddd7594d277d61ab2f7bda31f5e001ed00e09539cc364c827deace6f2fd1c8d63153b1967645ee8c4d945023ab42127d8d1bbcb145354d7b28168914e2515ab8302d9774efc9f8eb6caf8182844804ba5ee40b90aeb7e891d59f851ae92e0b936aa5eb154d9c218a283c7812008228dd6695f6eaecd6659727e222e1e28f4d7b6e6f428064bab4f3619fbca7a9385f857755725f9a06e8b895e6ae90c79150c5e7f5162f9e37bdcf5e60cdfb14c7ca82b3b54c80b76d2cc96d13ce3e80aceff87489f65e48ea0094f0c9e1aa5f852491df20ec9c38207cd20003a8bd09040174e1dd48629dbad820e99e4fe3bc4ecfa831f6fbd2708afc0639c2a38dc56e531b2dbda0892bf2b350fdbc654c54a9f4b7fb94c4c1ba961d26f93af6e378d5846e0d8078b0bcb086e3159e34ad6bfe1e40d8481fd3b750c2388e80c64f0cb034d4dccf928bfc9554fdf1c1470a5eb9354143b46c984b715371c9f9fbd45dc67ac248b2d9d32ad34b53f1f305f761769b8caa4337cbda0ba812c5224f9264196e65eda92502924075df178db7ea61f26b28e7587b728745c6dd6bb5beb7dce19e4872064b29e1905d360821a9469e3beab4fd095222e516fba37259fb275eb2ac8f679fe92fe5626ec7e1015691834de93ea9a4fe43932b737f77a02927db9c8925c1e7f8a8a102496061fb99df886a327bb2755239eee269fd8ff597a286d71101fd9571f6a88e40fb26bafa3144657ffd423dca8b0f513ef1dda883921d69544a850e0a9d3d15269ab3994bd92b90aa360f757896b29e78e9c566361cf80c7b91dda6fd599ae2cbc09a86c7b926f20a9ff0318f5cfab5b3adca7fa89ef0fba1710f385e4bf184e1b735e3f31bb07a6b7cd4dfe12de186ff5bd67cba23a3599dede14f1aee9c9e30b88095382e6b6dd7491e068559d60b99d45eeecefa0a567f69aba05d084673e16c6dae9d830de5ee71b534015e9b0ed57d96242fe96594a5c1f81514ec93971c758ccc8ec6e2bad0134a565345f1a733e6a74fceab5738d8a6cc3bb7834310f8177434974eda2e9d0272523e0449899ffa65fd888ac9d016afb0f0218dc9bffda5f3bb97d52981ba03eec62bdb3406e49d88b03dba2d716335eb63f64cb45f719998aa400cb75daa4ede93ec5008084421e146d31ad3f8170563640d65d0160bafff0ddae345b70374a3abd66a7b6a0b0e6770a7bafd5fe3c4da84030fc7f186a453321b729f25ddfea84f43d4de46159c49cb95472e51e4cb248a304bddf4e37b7d30ad2d9182688e592c54719155388ff3cf17f9fa5c8f78ad26249df6422d9d463624754e4ac0a1bfe498c199d9c2516fd5d537614a50500895a9055930be5af4e8bbbc489fe517ac328cefe89b4e54a9e094aee786e51213a4858b006dbe54469fc4b3a7c725d1c413bebdabb61548c091b53e125f0afb96109695f7afc8a37f8275a6e8ae1bd1ea4f9a28ca35f28a222173564361576899bdc682195d9320a96d0e5e9b8a2fb9ea639fd9cc7127799e17bb1c7b8f4abe5f45be3432681c252388345eb21faf822d1d5292ed630ab717944685731f80d880f7e66663253b838d7d3648948f4a0101098702fb0262302b77ea48ef54073226394d552cb5b10b9006ab130af7ba01860513fb9f240f60689d6260c057961be9a1cbc89e46b864c39076d023837e5e16aa69f7cd4c40b6c1322de37530eec57852d97271699391ef3c86f151a97e8a5d4c4f683c5912e50ce02c158de62a647ec40b7e09a7db04f90916f29fc9b3f8e7e5fde03f106dbdfa2cd425f76ec3c1beaa23ce8b5285998be9bc053b472d13de69297f9e69c0288f8bf319a66357445ce4dbbe85e37a7850e4cc4ace775fd920c101eef9e702b20894411c517a611b8a26dad6f2a4227039ac0961539ac93be5d9bcc65343d964aee4942e5e6254c07d81989042abea92e2ba5ee307900415b5c30de2d6bf68adcfd44b402dc67918d7c2d3a36425b4ce27eabb6feb8a643d7607a0926d69f446c8f471c62ae6363e3d4cf999ff3ebf2055ccf83fbcb1bc117e8ab138362074eba2c5f09602c281baf931540a4eedf3397ccdcc126b085608816dcb303073e94692744453fce5b5ac035e9255c06b06c59702430975918a4cb7c94bdba96f666c012f883aaadbf5be5ffce785406852ef0e58a991c962bba67fea5760cafb031e8c8dbda235953e722ba8744d565af24ef1540900a6de4ee91815c43c2136c3f2817ad3473d6c69f8705fede00597b260d225d7c173714655384d17eed2922c4af6f2b2adcfdc839ad96ad0864fc641f518748f1bfcaeb624f96e55f6317f92bf9668834ef3158dd9351853be98f9bf71d04efb1128c579d93bf0dfe7f48747e61e0a5aac9d23df32cc9f7f03087055e5ef951869ead49942bf8ed780261967921e1cf715238f5e2b46cbc1774560b98acbbc7a879b0def73d415429e6b847057d1ade01df81a659032950ecd25bf34c77d853cd50e35e2248d66f12346cb6a448a4856d10d25b93c748744330dc45b56175c488ed1262cacb34238efbb29f4fb2915f8bc9c75a05a35b71dd64629a1ca597247c63a1d39b58acef78e128f83db2b05a4160ea6a27303113abc4b77fe18f19ab552ab8c617918f0b8a5c21fbdffc3a948ddc0a651df4f1172fd54d59dc80527d4181cb177d9e96d942e0339bd7fc70ae801ad052ae7486fab5cbb2e22ce9da3c04938584f6b83f043426868a6a36f4bf48edcd290ed1db37df178b4436dc19faa3fbf40f48117290da31a31ca408347f5d63ccbc615afb8f381e5200b9f83c6ceafdbec826d8f6a8ff13028df679e3c817478f8ee61988bb98060915359c81bd810c8b6ad16d8a6f593fa2ad52cc9085de5b84ae0d2bf66d5ce3d279e76672600a34b9a9f2f2431e3a467aaf046ab517b23de7a23a0b06025e95a4c3e8bc427cce10c40c65d4c6c5795b8511b2e832106781148f629e5ddf842875d627881fad154468305561e41502bf48eb3100f9cb1b93be6f9bdeb52c239f7688631e9124e23c73eab76e30b4c0a9f8aaa82af20302c4c429c844cf447d48a7883669ffc68466f4d003c147a56b48639285149901d4b82b048e6b838dc53942a6219e95ff39cbcc6a40f6e6d20b319921cdc8d369be9aa7c9bf9df1b371c02c3f844ee34e261da36fe6d576da0304261eccce43f8a8d5557dad3aea1c5029e9977bf1e6831dbd722bbc6d4551af428ddfbaf4fc03017219acea512058c9eac8fe688710e1416c460fd05311613be7c47f19bc429efe155ef22ead15f564da24eb9f8ede7ef88356b94c7adcb2360e36c8ed20c8f73ef891026ae317bb2ad16854169c09ee3c835392854795e9811c53a1c9b530502805f880991791b5979cf07f52c0c67259bbc9675b7cf5f7d6e2fd5d9e9b57b6c5eb0e2550b3b6d828e3b9d606e25ad573c1ce1f9df827693efb6d8019ccae6338c3dbf9f65add97535abf738985ab5cc8cb9f23734cd696ca7190549ed576f0b80e3130518c13d1f758913e3e323473a145704013090f3dce16c5e817b8751ba6609b26611360608964b57f6340ccb18f5e5adec16d9c09563b153db8101baf9391c7aaf09bf9bb5f0b4916a47692076c5a0781dd482cd55d8f734fc6aea13d8053b29920e37fcb4f7f5481791cc1d94e1c8b76c187f44f740d8686c38751be0907ca578e612874f6af319e9879336ef95a576aeae52cfb2a2988965e566a0608e81bfed636a2766a9d1d7db51c1b5a4b383f5224b60b51458316111402a9fc5b9030b2cb9aefc4a7e392cb230a2d27e272146657a0590f373ef3fe1557cd55c1f04a2b5a3e88f477ab39c7484a83e6dec909422fc4398c3d8694f2e3f058fcd597366305d0d0a4aa8427b8dac404bb2ea3c1cfc754c092a5318086c2243ae5aef1cbb0080caf3dd789e9015b5ed93d1747bd5db4521891af10f519ed6382dd3f8821ad98681b2d96d50f6afed39d340cc803cc88ccf907a67000f89bea7b8d8363a1409892c99f55dcb86c5102b9a2c9ac59ea8f1ee574c5f5f23f27e21792f4c36266ed0945f94a6b85fefbde3e67168a47b21e17aaea68baacab91a037792ae117ce03baff9e367c2bc016dce1776ee046cb8c2a4b32694f17d0053ee3ca07ca19de2c67a2711b9dc23663bf562d87cc2167192f2b0b879240b715976fb64df8a39a3be5026d8687265b5fda740ae86a540e46f3c0558ebff9e054c8c49ea10ef7552b3c5dfd00cf803a7eea8f3f516265c9d327284634331ab248a5ca1987706316afdd5b1a1cd3a9be5bded42f5f5f609fb6e1a5df6c96d0eeabcf1f5a9013d63c9525f1e3ea76d7c1208bfc772a0325754368282cc8239fa78814859aa5bbc0381d45b9f2abfeb2e4af3025e53e5a6b1e1271498e097d539271b22a3336efa28208204a9aab20389dcd0bb6222fc3871f8cc85fc304b779f6792af9032b16f05992ab1643ba40b6a93d5bc787e2995e97660276ed55e6ffee17b608ff481025c206e7663a2a9080e2762d7bc800539011e8b239468ab1652c516e9a03c92e08f8bdca6ec112b3af9ab36c863bc7e4e55a4e4978c220a09f5b5d9fc081e5c70d10a077d3909f523fe5640caf304cdc2f15b39a063392784fdb679803c126319d51b09e7371864495b89c01d9c5a91cbee922d3b59b1bdb873bb351ba911a9e2232eed26a93bbb24e4a6078b1749af3bc17a1b217838e717ce31e4f7df1ee5866284ad9e4a3e7a0d41ecd176b34094cdf1b9b2b2f0ef37ac40a2dbb0ef98befb50f5abdb31d6072f4e6ea902e50cc787c1bef58fa9ea569ef27693a51856205fbd48f249c61bc3a33be16c5f0eba3a7fbb656caa507d7277b420fa4541e81642d46fb6b6bd68b1408a2d45563a510ec6787fa13928e1180f9936ade67d546a69af43c7138b3eecaaf7d4a0bd00f77c755349c48afe142bf861d712f4d21eb344eeb6c0b07fee5d504e26bbcb77e79b6efcb2fe61876ccf858d26fd5485b4f8484e34d88090a81d745ae1b1770f21634c4317fab677ba807cdee84b6c3d1c107c63da97f0668c304c4dd7179b58a295a3872de56db28f69028c2bcfc6470ef76ff425a0e4b997d2c5e7c89447328de93fe0f68867d3ea6ada59a37263b3fd43ff5748456b23bfc848c9775c3c8a0b36f32b089635a018426ff69d78968f588582fcf98b1e314a6f4624ded87f17f92f9b05ce1f74b5afd451d76e23ea63714c52ca5fa138dec1c6b699958564eda57c151ece2dbea38f701368f8d83255e024d231f1400a747e2ab780f6fa4332bdf13130f1ec5edeba35525a6c095b1382909f197ffdf208e7ad25c20c5791dc6c041bda654df9b3d6d3d9b76163ffdb56e140b891e001404966ed458e9154fbdb28250365b3cdd4d6fd05a4822b4fa0879289ac49b1f7309e6be54c0e283a3ce73013abac6390aec20841718c70b3bf42a0d70227a94b6e1cb690297ad8584db330140a59c9bcc0bf0fa481f39254c2bb7332aa16e916728b4bc21b05a9440f8a37e5b34a21d098925c218f8a4f67b531ad53728324a3304814e323bc0e0dfa57956520f1d36bf53c62f32216bfe322147a16e855f182dee82655d7ec058ef4a1a93537ee9b7adc2111d028395877c84ea6c118d0fe1ee3cff1ddb1f8f72b5c074611faa0d5539cb5403fc174fecfb26f2996a01e6aae6bab052aaf98875b10b04f1a5fa17a67ce83adde8b386f2fbdebf11333ee0afcd862ef98f7f76deec20f60d411809a7faab225e81fb4dea5d6afe3279317ffd3098de4013beeced19afa17885885c3ca09553183338cea9293dab1e5bf7c1d1d0369d72c84bf894bb0a220edb070cf734798eb6ee5587869deeb454e6a08dab27b65525cc536ecf43d60522898f3dddff05a4e13248b7f1690da3da0315e6ff430807b692e4020d6850e5bb96b753e481ca757cd7659ce96318f93e7d8896416e2ee7554c17970056f7de5aa5b3b15e47d285b0856d66711eed4631b6bcf7163a85b4e3173ce4f1c38d63888cca93da5ea43620db8cfabc112748fec1ce3b692aed277ea1ce33426ae8ef39700494de29af6306cb92b03c15a73025b70a1cae886a002911b447725f2090f53cc7a0803229129476f4e3b55d22762c83d85bc493e937989189f400ce845d5bbe021c51eb6d403a2f2029826efc54a6fa222e2e926dd55c8a1fef3fb0569399fa8a4fe3b6ca328af7567643deaeb8e484162d2917e66d40cd57fc5f54cb5e9a23084ed35aab858b5e0d3126e2a748aed77a418c5f562e71fcc09c37a6adaab98428058db6b05747d6babe18ea1b70012edaae88499417ef78085b34b37e1b318216bc02c49fedc0453a8cf8445b34113a2f0b8a205efc4be228fbb0749d89808afc04e30f9de3f5dc8d9dc1c92f3b9d8e31bc9fe0e2871ddf40aad88e994e0affc0a409f62998e6452192ce59fbf32878f9d4bb7502b927b4943e51a21d5c6f3d97e2ee344367ebca4f245d1c4219fe206fefa130b17428ef05ee387a8237834572846bf3afc076209d68f75d8a033b16ff7e43d95dd156767eabd49e025ab3e422358ceee287a5c4fa94867f607b8c6d43578d107fe4628f3492fc3b93ba679826a056a250b5282dc180e66b38410dd84c18aecd92677b53fe41442052e0685f2bd30184650a55a3c2f78ee8ab342510a009da1f6621a1d26604a13fb0b8d0a60114c7975c873e98d792f75ff86b06f7ea788956e1d91c604427607f6bb3c08bfa269af92c8e5b93e83ab4b113cd521ab8306ec227f6392ee7f4c0c2c64a3f75f1ef700b7e255fb43efa75cfa7c9da29f776d3da4a44c1957768999d946dbc1f9415621a3dbfbd7756ce4944004ee15e0b631363080bc0cd817ff3d89e201fd30daf9ea3da1f2b94e64a2716d6655178d85667fd99f621dc769cb696dbc79472cbe282c4f79dc71d5dd3969fd6c40ff1382d9acf2bb9ba16e9b08a8fe195e15702d7701e9792140cd34182aca4f8ff347900354a348064febd619ff67688b9d87b11693126fb4484faf8b4557e817bbc9ec877b7171f0988e68cebd3cea232d3b7533818753c0796e4082313b35c03fe98c645bf9ffd2bdfd0c2e6b4a94d3de7abfe7f71f7657ffbb543182d49e9a57f737199130154f5050257bace86ba5372ac00891c4d0777d0bd8f96e370e494b918469d592575913b159727aa7fc9dd9595fe363e4d9eb7cee66223ff5fab362e927e92959398ae2d0354bb473bc4dfc7400210d8a2dce5a3d47546d820501325ac6c19ab224e0ee03ec52e4e8e94c6759dd731efddbe05a8f6d4541be4f4439348a2ebfaa749cc9404b7a27c273883bb3eff74ddded101962302e89d8b38e70fc6b93da3d89ddf9ddbe6d06764b027485998bba4db6c6e71ad3216a5dfe10e8f9da9908e7c31e5a248d09c5f44b3345df61e3d2ef4a80bc660745c493c2946b2b330e8b80acfbc5d510c9b799f8e50f5aac6f322ec5e9d073a0847d3c2e0090223de07333ec2d99da1152e775dc44de22d7940fc7842504d0d220cf0b4637758a8b2958b903cc5b486daf0a6ebab4213e9947e1547a1624cf2922569eb0c9b94c07677f51bca5a836803ddb744be0991ce2f481ebbdb97a51c1fb2477d831c47a2359bbc1c7f7cdf7a76be3b18ff8c16be317bc4cd072178832b75cc09de3d4ccdfe925266c012f8f803a79ea2af5b3241a6e2d4f0233b16370d191d5d2742146b3f48fe73fb18fd8a891b2f3bbff81b000dbe2694020cc70ef13f52eb76e6394f1d731e9348b4392f66c5b8a57d89906d37e511b8bc50d0634b055bcc29264db2dc1b6ea0676cc753969dacbab82aa5f85a36c8a507fc9a5bf1249ff09a553979a7b76f2f369dfda396749d97996a52101b74e003a065170a75a1356f76930c79aa1c21ced1163d94f74a006b57cd6a743fcfc594803d424292e9e0b1bf5305233a32b8001e94913c0a0aec15bfc86024bd9ddd43dbe982f0974cba04050f252253d1dba31996ad11bdcf9bd4eeee12875dc9b12e694f45d1e31785c3b1d8b71eabbd729649a7bd6dc11e1a03222a2387325b4e07aa3851a8b8d5e7fe938d8015a50923dd74448836fbc350df957e9ce01d1f51297c5c0c4b81ba997f72124456e20370df27f8bedd9d461d47e046c5002ffd6ce04cbdbf827748bf4389f34cb803a7ba9619127d6911009eb8e66eabf6341c5a3bdfc0ec5dd0c41882c27b2bd90d54718382e763f73f104910fbcb86e1201a6d366b4aa577d54873829e061ecc1c28b3fa0b3edd958628f2288bb0344b82581db8cb4206baa286b4e639d816bf78fcc3f08614fa9520ab52e619eabae288e193db5db3f11ae850cb2783510ba6b266d34aa4011c23f973262df10019373bd74b16c49989b5b6b00becf30634d506ce6d251b602b651db0cd4a43316578374de1986caa11f69b45e5be7f0e470378751965a0cf6930efb5fcc8c30549ceb6b8c22045d28a38b18c8ea6e228244addd8f22d74ca5a221d9073423adca96bf885d09a66e2e0fa49f18aac03895e875ba118e08e1d202286b97097f5abe1cb0a86afabda31a6b9ec9225c1bce1d2fd668852f44502a368e376b14722ce9f4ca104f47dcfb18ca76152b178b32fe35c29fe559827380eb4c0bffd14d6dc4b3f3f6496dbca04513a72df0bde4967286831b79383d1f2af5c717af225b32fcff87f8da57ad88b998ece9ae238ff86e2c31b5013eb29d647e4dd16562b6d781280788f0b8104b6a8fa61dbc7a949d1a0270b6a9be3032fc819a5e165e9a0fbeefda50169f687a18ea89a4b5c810a6822a07f7f6672513599715ad3a782fba774c716b9094ba72fa8890e7ee73d98b505f3231f077cc2346d5c2deced568884a4a332ca168efbb9576b64fc9809414d3e523252d72b997d0b50dfa79873326237898416fd0ea692b963ddc328c46c0815dfe71f1504b2a60d8e2fe4af9a0aff3e4acd97542046e0167ace23cfb2bcbf62be9d57dcb42cd5f2c0d96473419bd5cd9c5d03af5c64f9768885d370e11e839ba1dbad4b6212291d258ce158df22a6cb1f8ef651c5ed1d1cbe1c7f9314212c0bf9bab8274ae85b5c85dc18f85e88d1c2f48d8d2db12962b0834326366d6dcc18b3ce3cbcb81be6eaa99f7646c3dac1abe9a9f29ace51d5f813daec012b2514d22553d8198a88d180022a1421e429cac1430a426a4bf7d8848000eb823d2b5905f41ac34cff79bbc54d1d1fe9793490ddc25325ee066f57abd9cf7dd8ca414b24614315a3a1c7d9135dcfe184066d1ac6223184ff3877a486e61e897e3810b991d000c5e0523074a767ed17e428f77a6c535ba308887692137c7706a418cd895d8d8dfffda9e125e814db0b18b3ca335ac93b59081f6176f190c9d4ef0d46d61ed76a6614075887a87d909f1e7812691213729ebfb1070976089e542a133ede42213c0e1108528e0e4ddf56b8e735c594216de582a965edb6f441f07858760a7276e781c3a068333a3dbd5c32964a9b3538efe346329ac5e54a9cc4867ff2b3ee693fc02f40a0a571ae79756a481905ce93f8dcf6ad2d3946a60453f821841c8f76238f4613df46047d5c8296d98b98d1ef28d154ad319cb9b59b7db6a44ae291dfd3629ff82e63ab5461ea6d6758f3e71d8684e25921c7b9669167004ab72ef7b84f2e701d115f551731431398321e031f30226710b5bf5220d877f0a958903ab40f18fc83e1703ce0e16e24c9218f5197772f7a17e8b80879f04a7a0bbe271bf0191efadf114267cee3c48c9dff8fbeb598f8b2901048243d46107ea77d3dbe09da5380a5106cadc85e6b4126f56eee90f291293e61c276f02de9688a804c4310410c6f50e2df23e793918bfcdee840bd26c63c8ba7114a8d28e1186321040af7079b91632fd9eb07fea29d5fa07bcd0077577f436022e360f6c80449aac9e879804241c6363fd005dc29d4e021b1a58a65856ff1eadfb203a82a09db72d636637114c55d2a6de0b34f5a328361c0f5907b52c0a5b6d01034550a12c70fe9712646305d89b5b957ea54a69ac01f401fb0856408e0fb28c48cb74d373d65b2b99a32304e773084c34165aa97aab2493906e4159225b9542d3af9042c2172f1482e28178d22781d5f49fee5c35636a5e6d1c1cb6a54b44da741b6489def0119da40e7318ecfbba52e58182a676b6d590415853816bca29ee578e63a8dadd80ea5a00066ec348f4f5fe0dccf007669fa37d4b91704279e4a3bfe9a9718bb21475db29afe3baf160236becb3e70a7d7ad437cb05aca0e850ec760c7a8382a71d593d374a46023c3da48b45df38e183527c7aa49ea742cc643367210d0b5d7f18a28337769b5b495683542460ef7197fccdb7772dd4b133bf70fe833729beccbd4d1089920f44dcaccf84da65bfc33883337720e786f55da94c31c10af15a3cd95615b9ace79f180cd5fd6da89364dd84156e7a8ed89f77d8200551b90c97191177b0f1818e4b3ee4df8fead6ae4466d663c01f0086c1165c962b3d6f0fdcfdbdd78ca24a4196141fc9c0c5a25fdadc836f239f880a073b2892d029d35822ccdeca349602f0b3021840a58eb70d631ca99355774ce5186724d4fe87e015521937a445af88316a5e762148ba3e425e92a2f5068dbd478502e8d995cd10648f2c4193dbdd765ddbee4fcbad92f432a8710e71452b76c2e44759d5e4956e90bd9c6f135a4934949b3ccc4b4ed3afc4445a91bb0817993bf1b319f5682a3eb8d26a2bc00737d7a6fe944f868090eef547b48743950975d39654fd9b6d30228eb18e682463c3ef0041dc89af4c3f8c289d16ee6e82e15cc14852f5aa6f61557ff47199117269af8e5b8d212787edcb01fe7075a55138b70ac9658fc77fbdcbeb6d35e353ad3e34138d67e843f2c4e6eb7ba16b25c7f75652176e0af955cfbc7f70b17bb21cc1ab3ec83bd2020b7a467f8d9a12d9c990948f92934bf40e9bcee58ad1976573e6318fd9b3d61225e39fdb9b7f9fdee153850e93eb5528ff6015525d45b5d03d262ccb31ade0b66561a7195c85e879e2f024f76e5586a6890c6382aafaa918cae6b996cc68e0604f9a140148168770868bb763788699dd67eeec25b99467ef8291736476fd7491573a929d0438854a59368d63fd2c3d3bec818f170a9a4088ae76f9680561b2b48ffcce0ac950dc903cbef25ce58ebed1e0583602ceddb5f9aa4b8a833f837f4c1f9c3f8d37284dabc1dc9b412a38438683569a84608ab33158f2e2a39e8f677c1f427e0a88c9a0e6eabc7105e056e1c4ce9d21a52d409ffed7f34c116524b9f2307a0606521ca58eb1ad1d807010399ca2de834b4099981ba136e77860715d491f13edc7dd6130544951d0b8c4f7367e8260ff6962c23ad1f14c244cc6595573d184404a8fd50ed8999f86fa865845996077d19b705594a89fcd8d6238c96679f5ca8301669b9d7ac3263c8bedcf2ef4f7122ff12315bca2bbc58fdc75110395ff2ddcfb4f315e1535bd52aab1796b7c141b0ebe56de96dc95c9a27f45624c741b380ddb87daaf2fe3dff8aabe880cddeb09b5855dd364101077f80f22c2c4c07095035c8c1c62d24d0fe2ae88f0ac4d2b2dc4b4d7e9ddce2c582f38608d7f0e058833793f3bf08e6bd2df2da8749da6642461c195e9b49b5aa74050d9d69eae52f2a2f5b2d8228785c1708d9e2af24573ca4d769c21ac26dc1351aa8ee5116168ed36844dfe4992578a1c3270fd57aee52bae6298af55e66148b57318c8d25db744b9d7706d49325527daaf57ed682cc2fde09d236a1abaf7145c1b8c6feffd5458d5f87a34de3b8c68928e5e89fa22d9eb2cb58e6b0ec4c9310019791c8f253aad701d95911e6f95ad34855c21b7bc0634059ba7cbbcbd2b2303c086b0f53c7b3c6a551e646f9ee29a57e2591c542a1995fda0ae2fe5cbe535e516a7b576d1d057f51e1b9144bd0bf3e7c50a92ef77ffb9b1f1c414dee7412176e710cabccd7107a7707c224fec63b7a1cd1fd9bfa0022be66ab030cbb1946ac41f50bb782d898bf8b68fe6f6d7eea184b2a9028a4835c87f04bb258f6dda53f285a340d9da8c206709d021e8285dc446bbbfaf7c72d0bd18c0269c5dd22f5c7158bb9194eaf7473ffae0c3904e2b3e2e0d6cf275fe41aea64f8d08f511fbdf5a51c5169eeea09b4e705ec36fe8b03f0f217749be872b69053fc10d4cb47032b94e8f925fec7bb8c896e2a6b28a172f2a0d7517ad0537ed1f3bb1f6dcb7b57ddbfbc7ecff245e2722a09881a1509f83a3c03010c0aa0302741dc6f7e2652cf66451265022eaf63f7103116e8b2f6c1cbfcf4389351c400c76e5a71eb7c29397da5c88f1868aee92c51e527980eddb179bcf88856fd44a0e30eb22ae5dd4ebb3cc0ca36aa723a7c674a7decc69626b3a7dce1b751c1107efe7c5fd96ed27692646709865255616570b7208474de7cb25db15ff6db2c42bcd68e552fbe112821adcded0b0aed43df6671784ae1c59cbc569359ea06e330d77b659410cd809de6b7c66b156d831f7fda73fc5ba66738227ba567c2629f42c8956156b6812db6bfadba848dbd81e62185689289eca202e3224a20d75f46338954cc35e4fbde99a962da3f128b141e3ec77ca88a9c51b31f6d4cef525a9d86ef9e9220d557746ce268dc644c8285f7430d1fbd3b0f585be89ed43c9f75f8fd06462b41feae0b25d6af84c86f59285e22e667ff12d49e06fcab024edac2923150011b96569067068bdab2e093e6697a3f4144bbad039a3c0603b2dc65b6019e2877d246d29d0116b3f18aba6d4f643f54a79997b7a1cb474c613e7346c2e0ac082f695b6092d7c2d4ed9ea82513ba13b87f06600be54bf9bad0269beba4ec9fa2b234816b9923c350e6c75d288b3c4f40967787824d695088bef4872d3ea32f2a592ea14d446a389fcf18c209e3a25a252a5a3daf7cf6bb22ee99086db10e13cf88141601fcf05e32db50bcf624b42c41e7ec21a46825011ffe8bc66ec5fe06336081b4008266aaf080faaa50b07777f125c648fe94a60187023f97db320b1e7b745ec20c56ddcf18b15f0e01d765211cfc7faa982eb87ce646e2a328573da5c324862d87a5a1838c3e2f413997b73cf73e3e0fd0f6dd918e21200078eb6b89f8377ac53e743bd4082e95cf87c076787a5cdb39ab7ec466b50c3d9533d7b059a69c6c47924d9e2888fb5505eb9c30e30af8a3704395bf61d7fd3f19ff9161bd897d46c27cee3549cbe8ec54ecfdeeb155918ad95c5c2ca75154942b97cadab78fc365498dfbde51564c50e8af2398d4814c63f7f27abd00d594d3e484c7cec02774c481f8c1d8009cee1480213322719e529e8eaaa405224a2e355999a58eed6f62f9af1638b651c81857fe2c0450280967f0dd411c906992c0de2f049a8c4f1f92c960c19ee8831adb1f9b854d72576d183d0f35fc5535297671fa92c4770d1d62dd7f120d96b4210f1724f2889f38d7e7d7596fd13c26c5c0ab7f6be20dc307a20347efa99dae596eb8e5d884df18ec2f78acf39f1092695348b2ef82f89fc2b16763fca87d798021b70a90d2550a806df648800b71cb46f0e1e430509fceafb618730ed3adb700b89eaea2fb0963d8a1b67beda3ba1d6cc3f2d9a7ba70713eaef2d680a92e1faa629c63980603faf6e1ba027bb8ca3d48b2514ce932ba679af18df7d659f54b76f8c8adeb86d9c5b520e16c0cb2a236bbe81327fc34290bc367f63b4de542911536cc82f9511f72bc59b1a0ccaa3f9110c74c128037d2fd1255ffd488d824d7dd8d27f45b462a70b6464d473e3630538e89d48deb1047cdd80f6b4f5f20fd2c800e7c19f502d2c35f00a70005aefe01fd38577d5ef045e205bcce9b17dd87907ec0a4682e0b09a0326d07c28d8fe9268e103cf03b157313db75e39d7b49bc0ea3775a4454a895b78b21c5525dad8a3405f53312be827cda6b72d0f4b93dbdc8b77b413338cbdc2e3db8c1d612d627e12b50a79ff97fa59e06b802cee0aec9c44fee97ab326a253310b5d5dada2720c116019e74f751f7675ace4edc05560ee3991b7c8836a674cc81bdb46364a04efe91243260fa4bb14d83f45926d13d37a48ac3ff74dae0241c1d78caa4461cb4d118b6b727e811c48635f4b05e75b263c6ec5d7db33c661fc09bf7c18e93234a113831894158bc9d6c6c03b6ea5e151688d19a42a45091ff271da08cb85db01ee0a487190a0c05bf062a4758b02c7528269a01eaff21798cdd50dac6d231ded19b62d3644ab5ddefd0e77b5e55afd3c3378eb12ef32f44213d6b2fc5d78160c50539a74c79771eeff1793eeead1ef80aba15b70339ecfabc5e929d2318862e437d497732d32e1f2f9848563a07fb1f417c22fbe7816db370c2e8144b44f27fb61c72188f6eb8c65f6a4afea403c25272f09084762c165edc4d0242978957339d061cc49da280ad5776f3902b4a3b8eb0b4c55cd1313944d19127571d779673dedcf6e60a7f2180f902f82c58182d43c10ea4bd69d80fa70791a6f4042c806a3113f29ca5df776872d137675ae8ff010417dd0e4fe4755b050e02f06b954b3234b13a5e6a2e1c4b9092a0c67ed578a2f02b8db6edfc5ca489ab7b01dfc5697ab3ab5856d450b15097b5bc4771a7c6f23ec0786c415a3def7841e23118766be0142c5a78e23f555ebc410161589af9dba5ddb174cf130531b32829f19b4528b8eb3a2f9d1f9ecf58bae09e6eff17f386b951dcb1438d34d0c1cb9a72642c1f54843b6a73cda0b0bb6bd6f46f5b1a8c93a20f4861977cea96e52b929974446956b24cb3c0ab9829bc13ed288551f07e594828cf30def6f3339879c967900a3b1e24c4e1008edd8dd6e162d60759b1586aecfd4279d5902aa0c9c70d53980ce411e1d6e6f8dfcee1f0a49409b789079ccf42c4a628a86784e5c4b930381f1800bb5d6ca491ee54f2e8c035f14ccd9f055c04e2bd84ebec17315439a52bced44a8fb73d7e4be68425419e606581ad5fc43cd674a12c047ca608e9bfc80783ae3b9d1cffb2bd6683d371b7998bcc3f2d1413e10fd3fda5f10e5ca97a2f3bde004f583489a33991f04baee6d46b8d6606d5011f5bb0b6a727979c3cce2e0c6ff01a307e15eb12234a43030f73322ec4ce6a83c95adda806780cf88fa5eb7fbbf3eb8ab71cdbe2bc4df6bf1f4377745d77cd6a947975525a0132f71353fa3c31c83c5a5801ac35931a76479d2f8d74a8dea12af66a4bcd59ae4887969ffaf966721e887a1fb03c81d4fcebb5727c086682f57b35961e4a31ee8292296996635a2e0434aa24e37d20ead4a3c7e4d284a48030e676e3036fb16c19044bed9c914fb34560015b9803d43939ac5eb360970bf20baf6798c483659af03f71f8ceb84db5b4d5701a6aac28dd26d6295e131b4da56dfb38a66d0fe11b94dfb3bbb0f5f303079666297e3ce14f0f8a1ca1ff6a77dd4208e00fce01186d3b1bb7f421903116b6ae162663ff68693023e2f9e9b77e1a8b212ca55933720ba707167ccb084f97e970aa0085a34934952e03d0a5e05f42ff6e29e841cb056298b0735e1882f813299df91e446996d9ee83335d817f3f557dcbe5b908b400c784585c633e75c2aa035ffad4d5b2b8db9ec24d7d6c541cc764d47714cb86089a4a9453a673c20beb154adf5ad9c8646219019ee79b956d5dd4a0aa32a5c6576ecd7a3ab82916e149e93a0adf7bb51583e764915d6a9bb96c4bfd4c9ab63b8165bf4e2c741603c28fe89fe0ee5f18a1d64054866f63d6f13ab691b2b70a0fbf0f625f60491a533beb9a83f25d5964b3687f5056e3c278e2cf45d29a9a2d2f411a954373e196bc8390fe94566b802704e0ca39f866530a5c3cb6022fcabd85eb70f6c21b7ba70add17e5a4198b7a64fa919949933205e9d463b39e6db03439cf05ab42ed9ab0b662bb01a0b1d52f72bad062c0e5914d195cbbbd482bc78459b522498608c8ee4741c1644a6aab176001c9069cb167a46257f995bef70d6a88f082b39f0d76a91fb51d5a6cfd8a63fa3264c78898d697743cf47d05dc9f79f1b2cbfa294d8dd4a05c42cb33f936ef80cfc123e5b8bdd08d249c10602787cadbfa59ba0f12f2bcb6f08af2664793291674446e95d3e2fba3092d788c627095e5a3f4eec75bf196de4b47eabc26a66a144c3f5ed75d8d0ed62206257d58e33d7c825c6b2c7b1e062cc1cced0c967886784a0a28f797ff0b63c80995b86ed903e596dda95e2bb9769d54e7eb88ecd3f72382244f1dd4e86d076341119874594268298f6da0f120cd23724f8df8560931e631099889b8aed4916cbd9ddfb0cea58c27dec9e1788856b7fc6392aa4e0e8daa6a99a8c74a0c7a0007e20ca3fd6c54a5e3941ec9d9541a929645a6c3a4597bdd04981118dabc5c7f39fd9b37ba9b0e690de23cfdf182c3d99777e96c069b54999f3aa488147c327e70264419e4284e79553f8ee71bd94ea02d182d933987fa41fc7c509374e53ca4be67132c5a9fc11639c3043b801fae7f33148e1bad290d686913e009e1056c5d666f78f8f757569e3446977bb4c357e22f6b1719613f692a5c1b0d5357de65417dcb8b217ad2d7520430346476b44994eae26c7a203a3e6c29d09dd3e3ee86e8751b21999802c9f9c9104f07187df15e1dc4714283e421567adb545fa314a3e7cd444d70ed8f63c7b1fc7e3de67b22dd947dc43955e205ee180f7e31438c267a96b94e1ce01743a44230bde6bfe2a22f0b132d40a245f10b12946abed16778d00d6750348672ee31bbeacc0d755e6f4ffff83d4af6094dda058245d006d9894eee1e7ab6cab06177266b4eda7837029cb52232423e19261abe1b299ccf7b2984339e1b31d510691ba8b9b895c4b5c1a0ca071b56fc8ac9c62e575ae76a0828cb155b27a2673aaa119e79cc3ac689bbbd0e2843691ef02d6e7ff900684ffa29ffc7fd0ad23ceaefdd1740e4cfda66968f6b766131a112c694a14fef8bdcad6857ca1de5f811ac4cb8b84018ea001c14dff9e078be6354859d669cdec560747346272c25d3dfec96be842fbe83e43fe6762b441824b54924a080e0879988aebc887dd67907d56d2e0385674582997efefbdb4155a1f5d953437384af529c3015ebd94705371d4e7c0f4bbf22d81815b645b72ebcb7add0b693719efd</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      Welcome to my blog, enter password to read.
    
    </summary>
    
      <category term="kubernetes" scheme="https://xxlaila.github.io//categories/kubernetes/"/>
    
    
      <category term="java" scheme="https://xxlaila.github.io//tags/java/"/>
    
  </entry>
  
  <entry>
    <title>harbor ä½¿ç”¨</title>
    <link href="https://xxlaila.github.io/2019/10/10/harbor-%E4%BD%BF%E7%94%A8/"/>
    <id>https://xxlaila.github.io/2019/10/10/harbor-ä½¿ç”¨/</id>
    <published>2019-10-10T08:49:41.000Z</published>
    <updated>2019-10-14T03:24:27.988Z</updated>
    
    <content type="html"><![CDATA[<h4 id="days-2019-10-10"><a href="#days-2019-10-10" class="headerlink" title="days(2019-10-10)"></a>days(2019-10-10)</h4><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å‰é¢æ–‡ç« ä»‹ç»äº†harborçš„éƒ¨ç½²ï¼Œä»Šå¤©ç¬¬ä¸€æ¬¡å­¦ä¹ å…¥é—¨ä½¿ç”¨ã€‚</p><a id="more"></a><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æœåŠ¡å™¨å®‰è£…dockerä»¥åï¼Œæˆ‘ä»¬æ€ä¹ˆå§é•œåƒpushåˆ°æˆ‘ä»¬çš„ç§æœ‰ä»“åº“ï¼Œå’Œæ€ä¹ˆå§é•œåƒpullåˆ°æœ¬åœ°ï¼Œé¦–å…ˆåœ¨æœåŠ¡å™¨ä¸Šè£…å¤‡dockerç¯å¢ƒ</p><h5 id="è¿æ¥harbor"><a href="#è¿æ¥harbor" class="headerlink" title="è¿æ¥harbor"></a>è¿æ¥harbor</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker login reg.xxlaila.cn</span></span><br><span class="line">Username: admin</span><br><span class="line">Password: </span><br><span class="line">Error response from daemon: Get https://172.21.16.90/v1/users/: dial tcp reg.xxlaila.cn:443: connect: connection refused</span><br></pre></td></tr></table></figure><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;è¿™é‡Œç¬¬ä¸€æ¬¡è¿æ¥æŠ¥é”™ï¼ŒDockerè‡ªä»1.3.Xä¹‹ådocker registryäº¤äº’é»˜è®¤ä½¿ç”¨çš„æ˜¯HTTPSï¼Œä½†æ˜¯æˆ‘ä»¬æ­å»ºç§æœ‰é•œåƒé»˜è®¤ä½¿ç”¨çš„æ˜¯HTTPæœåŠ¡ï¼Œæ‰€ä»¥ä¸ç§æœ‰é•œåƒäº¤æ—¶å‡ºç°ä»¥ä¸Šé”™è¯¯ã€‚</p><h5 id="è§£å†³é—®é¢˜"><a href="#è§£å†³é—®é¢˜" class="headerlink" title="è§£å†³é—®é¢˜"></a>è§£å†³é—®é¢˜</h5><ul><li><p>æ–¹æ³•ä¸€: ä¿®æ”¹æˆ–æ·»åŠ é…ç½®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /etc/docker/daemon.json </span></span><br><span class="line">&#123;</span><br><span class="line"><span class="string">"insecure-registries"</span> : [<span class="string">"reg.xxlaila.cn"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>é‡æ–°å¯åŠ¨dockerï¼Œå¹¶é‡æ–°ç™»å½•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl restart docker</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  docker login reg.xxlaila.cn</span></span><br><span class="line">Username: admin</span><br><span class="line">Password: </span><br><span class="line">Login Succeeded</span><br></pre></td></tr></table></figure></li><li><p>æ–¹æ³•äºŒï¼šä¿®æ”¹å¯åŠ¨æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /usr/lib/systemd/system/docker.service  </span></span><br><span class="line">ExecStart=/usr/bin/dockerd --insecure-registry reg.xxlaila.cn <span class="variable">$DOCKER_NETWORK_OPTIONS</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># systemctl daemon-reload</span></span><br><span class="line"><span class="comment"># systemctl restart docker</span></span><br></pre></td></tr></table></figure></li></ul><h5 id="Harborä¸Šåˆ›å»ºæ–°é¡¹ç›®ä¾›ä¸Šä¼ ä½¿ç”¨"><a href="#Harborä¸Šåˆ›å»ºæ–°é¡¹ç›®ä¾›ä¸Šä¼ ä½¿ç”¨" class="headerlink" title="Harborä¸Šåˆ›å»ºæ–°é¡¹ç›®ä¾›ä¸Šä¼ ä½¿ç”¨"></a>Harborä¸Šåˆ›å»ºæ–°é¡¹ç›®ä¾›ä¸Šä¼ ä½¿ç”¨</h5><p><img src="http://img.xxlaila.cn/1570697850857.jpg" alt="img"></p><h5 id="DockeræœåŠ¡å™¨ç»™é•œåƒæ‰“æ ‡ç­¾"><a href="#DockeræœåŠ¡å™¨ç»™é•œåƒæ‰“æ ‡ç­¾" class="headerlink" title="DockeræœåŠ¡å™¨ç»™é•œåƒæ‰“æ ‡ç­¾"></a>DockeræœåŠ¡å™¨ç»™é•œåƒæ‰“æ ‡ç­¾</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker images</span></span><br><span class="line">REPOSITORY                     TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">docker.io/xxlaila/kxl-eureka   v2                  eb8cf7e3f24f        7 months ago        474 MB</span><br><span class="line"></span><br><span class="line"><span class="comment"># docker tag docker.io/xxlaila/kxl-eureka:v2 reg.xxlaila.cn/kxl/kxl-eureka:v2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># docker images</span></span><br><span class="line">REPOSITORY                      TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">docker.io/xxlaila/kxl-eureka    v2                  eb8cf7e3f24f        7 months ago        474 MB</span><br><span class="line">reg.xxlaila.cn/kxl/kxl-eureka   v2                  eb8cf7e3f24f        7 months ago        474 MB</span><br></pre></td></tr></table></figure><h5 id="ä¸Šä¼ é•œåƒ"><a href="#ä¸Šä¼ é•œåƒ" class="headerlink" title="ä¸Šä¼ é•œåƒ"></a>ä¸Šä¼ é•œåƒ</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker push reg.xxlaila.cn/kxl/kxl-eureka:v2</span></span><br><span class="line">The push refers to a repository [reg.xxlaila.cn/kxl/kxl-eureka]</span><br><span class="line">f6026bf67b63: Pushed </span><br><span class="line">1489a4b0f1dd: Pushed </span><br><span class="line">2af6e035aa36: Pushed </span><br><span class="line">472cfce4528e: Pushed </span><br><span class="line">071d8bd76517: Pushed </span><br><span class="line">v2: digest: sha256:20d3bc74fdcb2fc4cdfc9066f742c828898c728f7e3f2114498ebe2848b71653 size: 1368</span><br></pre></td></tr></table></figure><p><img src="http://img.xxlaila.cn/1570698233987.jpg" alt="img"></p><h5 id="ä¸‹è½½é•œåƒ"><a href="#ä¸‹è½½é•œåƒ" class="headerlink" title="ä¸‹è½½é•œåƒ"></a>ä¸‹è½½é•œåƒ</h5><ul><li><p>åˆ é™¤æœ¬åœ°é•œåƒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker rmi reg.xxlaila.cn/kxl/kxl-eureka:v2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># docker rmi docker.io/xxlaila/kxl-eureka:v2</span></span><br></pre></td></tr></table></figure></li><li><p>ä¸‹è½½harborä¸Šçš„é•œåƒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker pull reg.xxlaila.cn/kxl/kxl-eureka:v2</span></span><br><span class="line">Trying to pull repository reg.xxlaila.cn/kxl/kxl-eureka ... </span><br><span class="line">v2: Pulling from reg.xxlaila.cn/kxl/kxl-eureka</span><br><span class="line">a02a4930cb5d: Pull complete </span><br><span class="line">6ea3dcbee0db: Extracting [==================================================&gt;]  81.4 MB/81.4 MB</span><br><span class="line">6ea3dcbee0db: Pull complete </span><br><span class="line">c423a7a79cc1: Pull complete </span><br><span class="line">7418081934c1: Pull complete </span><br><span class="line">f89b73853622: Pull complete </span><br><span class="line">Digest: sha256:20d3bc74fdcb2fc4cdfc9066f742c828898c728f7e3f2114498ebe2848b71653</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> reg.xxlaila.cn/kxl/kxl-eureka:v2</span><br></pre></td></tr></table></figure></li></ul><p><img src="http://img.xxlaila.cn/1570698681073.jpg" alt="img"></p><h4 id="days-2019-10-12"><a href="#days-2019-10-12" class="headerlink" title="days(2019-10-12)"></a>days(2019-10-12)</h4><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ç”±äºå…¬å¸éœ€æ±‚ï¼Œå¼€å‘äººå‘˜æ¯”è¾ƒå¤šï¼Œåˆä¸æƒ³ç ”å‘ç”¨ä¸€ä¸ªè´¦å·ï¼Œä¹Ÿä¸æƒ³ç»™ç ”å‘ä¸€ä¸ªä¸ªçš„å¼€è´¦å·ï¼Œä½ç½®harboræ”¯æŒäº†ldapã€‚æœ‰äº†è¿™ä¹ˆä¸€ä¸ªä¸œè¥¿ï¼Œæˆ‘ä»¬å°±èƒ½å¾ˆå¥½çš„ä¸ºç ”å‘åˆ›å»ºè´¦å·æ”¯æŒç ”å‘éšæ—¶æŸ¥çœ‹dockerçš„é•œåƒã€‚</p><h4 id="é…ç½®harbor-ldap"><a href="#é…ç½®harbor-ldap" class="headerlink" title="é…ç½®harbor ldap"></a>é…ç½®harbor ldap</h4><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æ–°ç‰ˆæœ¬çš„harborå¾ˆå¤šä¸œè¥¿éƒ½å¯ä»¥ç›´æ¥åœ¨ç•Œé¢é…ç½®ï¼Œä¸éœ€è¦å»ä¿®æ”¹æ–‡ä»¶ï¼Œçœå»äº†å¤§é‡çš„å·¥ä½œï¼Œwebç•Œé¢é…ç½®æ›´åŠ æ–¹ä¾¿å¿«æ·ï¼Œç™»å½•harborå¹³å°ï¼Œç‚¹å‡»é…ç½®ç®¡ç†â€”â€”&gt;ä¿®æ”¹è®¤è¯æ¨¡å¼ï¼Œè®¤è¯æ¨¡å¼æ”¯æŒå¾ˆå¤šç±»å‹ï¼Œè¿™é‡Œé€‰æ‹©ldapã€‚<br><img src="http://img.xxlaila.cn/1571019665079.jpg" alt="img"><br><strong>æ³¨</strong>: åœ¨å¯†ç è¿™æ å¡«å†™éœ€è¦å¡«å†™ç®¡ç†å‘˜çš„å¯†ç ï¼Œæ™®é€šç”¨æˆ·çš„å¯†ç æ˜¯ä¸è¡Œçš„ï¼Œå³ä½¿æ˜¯åœ¨ç®¡ç†å‘˜çš„ç”¨æˆ·ä¹Ÿæ˜¯ä¸è¡Œçš„ã€‚<br>ç‚¹å‡»æµ‹è¯•ldapï¼Œæç¤ºè¿æ¥æˆåŠŸåä¿å­˜<br><img src="http://img.xxlaila.cn/1571019741060.jpg" alt="img"></p><h4 id="é…ç½®é‚®ç®±"><a href="#é…ç½®é‚®ç®±" class="headerlink" title="é…ç½®é‚®ç®±"></a>é…ç½®é‚®ç®±</h4><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;åœ¨é…ç½®ldapé¡µé¢æ—è¾¹æœ‰ä¸€ä¸ªé‚®ç®±é…ç½®ï¼Œé‚®ä»¶æœåŠ¡å™¨ç”¨äºå‘è¯·æ±‚é‡è®¾å¯†ç çš„ç”¨æˆ·å‘é€å“åº”ã€‚<br><img src="http://img.xxlaila.cn/1570873497729.jpg" alt="img"><br>ç‚¹å‡»æµ‹è¯•ï¼Œæµ‹è¯•æ²¡é—®é¢˜ä¹‹åç‚¹å‡»ä¿å­˜ã€‚</p><h4 id="æµ‹è¯•ladpè¿æ¥"><a href="#æµ‹è¯•ladpè¿æ¥" class="headerlink" title="æµ‹è¯•ladpè¿æ¥"></a>æµ‹è¯•ladpè¿æ¥</h4><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æ–°æ‰“å¼€ä¸€ä¸ªä¸€ä¸ªæµè§ˆå™¨çª—å£ï¼Œåˆ©ç”¨ladpè´¦æˆ·è¿›è¡Œç™»å½•ã€‚<br><img src="http://img.xxlaila.cn/1571019859287.jpg" alt="img"><br><strong>æ³¨é‡Š</strong>: æ–°ç‰ˆæœ¬çš„åœ¨ç™»å½•ç•Œé¢æ²¡æœ‰ä»€ä¹ˆé€‰æ‹©ldapç™»å½•ï¼Œç›´æ¥ä½¿ç”¨ldapè´¦å·ç™»å½•å°±ok</p><h4 id="å°†é¡¹ç›®è§’è‰²åˆ†é…ç»™LDAP-ADç»„"><a href="#å°†é¡¹ç›®è§’è‰²åˆ†é…ç»™LDAP-ADç»„" class="headerlink" title="å°†é¡¹ç›®è§’è‰²åˆ†é…ç»™LDAP / ADç»„"></a>å°†é¡¹ç›®è§’è‰²åˆ†é…ç»™LDAP / ADç»„</h4><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ä¿®æ”¹ä¹‹å‰çš„ldapé…ç½®ï¼Œå¢åŠ ç»„çš„é…ç½®<br><img src="http://img.xxlaila.cn/1571023069387.jpg" alt="img"><br>åœ¨é¡¹ç›®-&gt;æˆå‘˜-&gt; +ç»„ä¸­ã€‚<br><img src="http://img.xxlaila.cn/1571023177214.jpg" alt="img"><br><img src="http://img.xxlaila.cn/1571023223796.jpg" alt="img"></p><h4 id="è®¾ç½®ldapè´¦æˆ·çš„æƒé™"><a href="#è®¾ç½®ldapè´¦æˆ·çš„æƒé™" class="headerlink" title="è®¾ç½®ldapè´¦æˆ·çš„æƒé™"></a>è®¾ç½®ldapè´¦æˆ·çš„æƒé™</h4><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å½“ldapé…ç½®ä»¥åï¼Œldapè´¦æˆ·ç™»å½•æ²¡æœ‰ç®¡ç†å‘˜æƒé™ï¼Œæˆ‘ä»¬ç®¡ç†harborè¿˜çš„ä½¿ç”¨<code>harbor</code>çš„adminè´¦æˆ·ç™»å½•ï¼Œè¿™æ ·æ— ç–‘å¯¹è¿ç»´äººå‘˜ç»´æŠ¤å¸¦æ¥äº†ä¸ä¾¿åˆ©ã€‚å½“ldapç”¨æˆ·ç™»å½•ï¼Œharborå°±ä¼šè®°å½•è¯¥ç”¨æˆ·ï¼Œæˆ‘ä»¬è®¾ç½®è¿ç»´ç”¨æˆ·ä¸ºè¶…çº§ç®¡ç†å‘˜ï¼Œè¿™æ ·å°±å®ç°äº†ä¸€ä¸ªè´¦å·ç™»å½•ï¼Œç»´æŠ¤çš„æ—¶å€™ä¹Ÿä¸ç”¨è´¦å·åˆ‡æ¢<br><img src="http://img.xxlaila.cn/1571023451423.jpg" alt="img"></p>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;days-2019-10-10&quot;&gt;&lt;a href=&quot;#days-2019-10-10&quot; class=&quot;headerlink&quot; title=&quot;days(2019-10-10)&quot;&gt;&lt;/a&gt;days(2019-10-10)&lt;/h4&gt;&lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;å‰é¢æ–‡ç« ä»‹ç»äº†harborçš„éƒ¨ç½²ï¼Œä»Šå¤©ç¬¬ä¸€æ¬¡å­¦ä¹ å…¥é—¨ä½¿ç”¨ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="kubrnetes" scheme="https://xxlaila.github.io//categories/kubrnetes/"/>
    
    
      <category term="harbor" scheme="https://xxlaila.github.io//tags/harbor/"/>
    
  </entry>
  
  <entry>
    <title>HPAè®¤è¯†</title>
    <link href="https://xxlaila.github.io/2019/10/09/hpa/"/>
    <id>https://xxlaila.github.io/2019/10/09/hpa/</id>
    <published>2019-10-09T07:12:23.000Z</published>
    <updated>2019-10-23T00:33:54.572Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Pod-è‡ªåŠ¨æ‰©ç¼©å®¹"><a href="#Pod-è‡ªåŠ¨æ‰©ç¼©å®¹" class="headerlink" title="Pod è‡ªåŠ¨æ‰©ç¼©å®¹"></a>Pod è‡ªåŠ¨æ‰©ç¼©å®¹</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Kubernetesæä¾›äº†è¿™æ ·ä¸€ä¸ªèµ„æºå¯¹è±¡: <code>Horizontal Pod Autoscaling</code> Podæ°´å¹³è‡ªåŠ¨ä¼¸ç¼©ï¼‰ï¼Œç®€ç§°HPAã€‚HAPé€šè¿‡ç›‘æ§åˆ†æRCæˆ–è€…Deploymentæ§åˆ¶çš„æ‰€æœ‰Podçš„è´Ÿè½½å˜åŒ–æƒ…å†µæ¥ç¡®å®šæ˜¯å¦éœ€è¦è°ƒæ•´Podçš„å‰¯æœ¬æ•°é‡ï¼Œè¿™æ˜¯HPAæœ€åŸºæœ¬çš„åŸç†ã€‚</p><a id="more"></a><p><img src="http://img.xxlaila.cn/1570605234009.jpg" alt="img"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HPAåœ¨kubernetesé›†ç¾¤ä¸­è¢«è®¾è®¡æˆä¸€ä¸ªKubernetes APIèµ„æºå’Œæ§åˆ¶å™¨ï¼Œå¯ä»¥é€šè¿‡kubectl autoscaleå‘½ä»¤æ¥åˆ›å»ºä¸€ä¸ªHPAèµ„æºå¯¹è±¡ï¼ŒHPA Controlleré»˜è®¤15sè½®è¯¢ä¸€æ¬¡ï¼ˆå¯é€šè¿‡kube-controller-managerçš„æ ‡å¿—â€“horizontal-pod-autoscaler-sync-periodè¿›è¡Œè®¾ç½®ï¼‰ï¼ŒæŸ¥è¯¢æŒ‡å®šçš„èµ„æºï¼ˆRCæˆ–è€…Deploymentï¼‰ä¸­Podçš„èµ„æºä½¿ç”¨ç‡ï¼Œå¹¶ä¸”ä¸åˆ›å»ºæ—¶è®¾å®šçš„å€¼å’ŒæŒ‡æ ‡åšå¯¹æ¯”ï¼Œä»è€Œå®ç°è‡ªåŠ¨ä¼¸ç¼©çš„åŠŸèƒ½ã€‚<br><a href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/" target="_blank" rel="noopener">è¯¦ç»†ä»‹ç»</a></p><h3 id="Podæ°´å¹³è‡ªåŠ¨ä¼¸ç¼©ç»ƒä¹ "><a href="#Podæ°´å¹³è‡ªåŠ¨ä¼¸ç¼©ç»ƒä¹ " class="headerlink" title="Podæ°´å¹³è‡ªåŠ¨ä¼¸ç¼©ç»ƒä¹ "></a>Podæ°´å¹³è‡ªåŠ¨ä¼¸ç¼©ç»ƒä¹ </h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ç”±äºHorizontal Pod Autoscalerä½¿ç”¨æ­¤APIæ”¶é›†æŒ‡æ ‡ï¼Œå› æ­¤éœ€è¦åœ¨ç¾¤é›†ä¸­éƒ¨ç½²metrics-serverç›‘è§†ä»¥é€šè¿‡èµ„æºæŒ‡æ ‡APIæä¾›æŒ‡æ ‡,</p><h4 id="è¿è¡Œphp-apacheæœåŠ¡å™¨"><a href="#è¿è¡Œphp-apacheæœåŠ¡å™¨" class="headerlink" title="è¿è¡Œphp-apacheæœåŠ¡å™¨"></a>è¿è¡Œphp-apacheæœåŠ¡å™¨</h4><p>é¦–å…ˆï¼Œæˆ‘ä»¬å°†å¼€å§‹è¿è¡Œè¯¥æ˜ åƒçš„éƒ¨ç½²ï¼Œå¹¶å°†å…¶æœåŠ¡å…¬å¼€</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl run php-apache --image=0layfolk0/hpa-example --requests=cpu=200m --limits=cpu=500m --expose --port=80</span><br><span class="line">kubectl run --generator=deployment/apps.v1 is DEPRECATED and will be removed <span class="keyword">in</span> a future version. Use kubectl run --generator=run-pod/v1 or kubectl create instead.</span><br><span class="line">service/php-apache created</span><br><span class="line">deployment.apps/php-apache created</span><br></pre></td></tr></table></figure><h4 id="åˆ›å»ºæ°´å¹³Podè‡ªåŠ¨ç¼©æ”¾å™¨"><a href="#åˆ›å»ºæ°´å¹³Podè‡ªåŠ¨ç¼©æ”¾å™¨" class="headerlink" title="åˆ›å»ºæ°´å¹³Podè‡ªåŠ¨ç¼©æ”¾å™¨"></a>åˆ›å»ºæ°´å¹³Podè‡ªåŠ¨ç¼©æ”¾å™¨</h4><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å½“æœåŠ¡è¿è¡Œä»¥åã€‚æˆ‘ä»¬å°†ä½¿ç”¨kubectl autoscaleåˆ›å»ºè‡ªåŠ¨ ç¼©æ”¾å™¨ã€‚ä»¥ä¸‹å‘½ä»¤å°†åˆ›å»ºä¸€ä¸ªæ°´å¹³Podè‡ªåŠ¨ç¼©æ”¾å™¨ï¼Œè¯¥ç¼©æ”¾å™¨å°†ç»´æŠ¤ç”±æˆ‘ä»¬åœ¨è¿™äº›è¯´æ˜çš„ç¬¬ä¸€æ­¥ä¸­åˆ›å»ºçš„php-apacheéƒ¨ç½²æ§åˆ¶çš„Podçš„1è‡³10ä¸ªå‰¯æœ¬ã€‚ç²—ç•¥åœ°è¯´ï¼ŒHPAå°†ï¼ˆé€šè¿‡éƒ¨ç½²ï¼‰å¢åŠ æˆ–å‡å°‘å‰¯æœ¬æ•°ï¼Œä»¥å°†æ‰€æœ‰Podçš„å¹³å‡CPUåˆ©ç”¨ç‡ç»´æŒåœ¨50ï¼…ï¼ˆå› ä¸ºæ¯ä¸ªpodé€šè¿‡kubectlè¿è¡Œè¯·æ±‚200æ¯«æ ¸ï¼Œè¿™æ„å‘³ç€å¹³å‡CPUåˆ©ç”¨ç‡ä¸º100æ¯«-æ ¸å¿ƒï¼‰ã€‚<a href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/#algorithm-details" target="_blank" rel="noopener">ç®—æ³•æ›´å¤šä¿¡æ¯</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl autoscale deployment php-apache --cpu-percent=50 --min=1 --max=10</span><br><span class="line">horizontalpodautoscaler.autoscaling/php-apache autoscaled</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤æ£€æŸ¥è‡ªåŠ¨å®šæ ‡å™¨çš„å½“å‰çŠ¶æ€:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get hpa</span><br><span class="line">NAME         REFERENCE               TARGETS   MINPODS   MAXPODS   REPLICAS   AGE</span><br><span class="line">php-apache   Deployment/php-apache   0%/50%    1         10        1          14s</span><br></pre></td></tr></table></figure><p><strong>æ³¨é‡Š</strong>: ç”±äºæˆ‘ä»¬æ²¡æœ‰å‘æœåŠ¡å™¨å‘é€ä»»ä½•è¯·æ±‚ï¼Œå› æ­¤å½“å‰CPUæ¶ˆè€—ä¸º0ï¼…ï¼ˆâ€œ CURRENTâ€åˆ—æ˜¾ç¤ºäº†ç”±ç›¸åº”éƒ¨ç½²æ§åˆ¶çš„æ‰€æœ‰Podçš„å¹³å‡å€¼ï¼‰ã€‚</p><h4 id="å¢åŠ å‹åŠ›æµ‹è¯•"><a href="#å¢åŠ å‹åŠ›æµ‹è¯•" class="headerlink" title="å¢åŠ å‹åŠ›æµ‹è¯•"></a>å¢åŠ å‹åŠ›æµ‹è¯•</h4><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ç°åœ¨æˆ‘ä»¬è¦å¯¹<code>php-apache</code>åšå‹åŠ›æµ‹è¯•æ¥è§‚çœ‹è‡ªåŠ¨ç¼©æ”¾å¦‚ä½•å¯¹å¢åŠ çš„è´Ÿè½½åšå‡ºååº”ï¼Œæˆ‘ä»¬å°†å¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼Œå¹¶å°†æ— é™å¾ªç¯çš„æŸ¥è¯¢å‘é€åˆ°php-apacheæœåŠ¡ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl run -i --tty load-generator --image=busybox /bin/sh</span><br><span class="line">kubectl run --generator=deployment/apps.v1 is DEPRECATED and will be removed <span class="keyword">in</span> a future version. Use kubectl run --generator=run-pod/v1 or kubectl create instead.</span><br><span class="line">If you don<span class="string">'t see a command prompt, try pressing enter.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/ # while true; do wget -q -O- http://php-apache.default.svc.cluster.local; done</span></span><br><span class="line"><span class="string">OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!O</span></span><br></pre></td></tr></table></figure><p>åœ¨ä¸€åˆ†é’Ÿå·¦å³çš„æ—¶é—´å†…ï¼Œæˆ‘ä»¬åº”è¯¥é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥çœ‹åˆ°æ›´é«˜çš„CPUè´Ÿè½½ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get hpa</span><br><span class="line">NAME         REFERENCE               TARGETS    MINPODS   MAXPODS   REPLICAS   AGE</span><br><span class="line">php-apache   Deployment/php-apache   250%/50%   1         10        1          9m12s</span><br><span class="line"></span><br><span class="line">$ kubectl get deployment php-apache</span><br><span class="line">NAME         READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">php-apache   3/5     5            3           88m</span><br></pre></td></tr></table></figure><p>è¿™é‡Œç”±äºç½‘ç»œé—®é¢˜å’Œpull é•œåƒå¤ªæ…¢äº†ï¼Œæˆ‘å°±ç›´æ¥ç»“æŸäº†æµ‹è¯•</p><h4 id="åœæ­¢å‹åŠ›æµ‹è¯•"><a href="#åœæ­¢å‹åŠ›æµ‹è¯•" class="headerlink" title="åœæ­¢å‹åŠ›æµ‹è¯•"></a>åœæ­¢å‹åŠ›æµ‹è¯•</h4><p>æˆ‘ä»¬åœ¨<code>busybox</code>å®¹å™¨çš„ç»ˆç«¯é‡Œé¢æ‰§è¡Œ<code>&lt;Ctrl&gt; + C</code>æ¥ç»“æŸå‹åŠ›æµ‹è¯•ï¼Œç„¶åæˆ‘ä»¬åœ¨è§‚å¯Ÿç»“æœ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$  kubectl get hpa</span><br><span class="line">NAME         REFERENCE               TARGETS   MINPODS   MAXPODS   REPLICAS   AGE</span><br><span class="line">php-apache   Deployment/php-apache   91%/50%   1         10        5          10m</span><br><span class="line"></span><br><span class="line">$ kubectl get deployment php-apache</span><br><span class="line">NAME         READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">php-apache   2/2     2            2           99m</span><br></pre></td></tr></table></figure><p><a href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale-walkthrough/" target="_blank" rel="noopener">è‡ªåŠ¨ç¼©æ”¾å¤šä¸ªæŒ‡æ ‡å’Œè‡ªå®šä¹‰æŒ‡æ ‡</a></p><h3 id="nginx-æµ‹è¯•"><a href="#nginx-æµ‹è¯•" class="headerlink" title="nginx æµ‹è¯•"></a>nginx æµ‹è¯•</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;åˆ©ç”¨ä¹‹å‰<a href="https://xxlaila.github.io/2019/10/09/Deployment%E4%BD%BF%E7%94%A8/">Deployment</a>é‡Œé¢çš„nginxåšæµ‹è¯•ï¼Œæˆ‘ä»¬åªéœ€è¦å§ä¹‹å‰çš„yamlæ–‡ä»¶ç¨ä½œä¿®æ”¹å³å¯</p><h4 id="ä¿®æ”¹nginx-deployment-yaml"><a href="#ä¿®æ”¹nginx-deployment-yaml" class="headerlink" title="ä¿®æ”¹nginx-deployment.yaml"></a>ä¿®æ”¹nginx-deployment.yaml</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">$ cat &gt; nginx-deployment.yaml &lt;&lt;EOF</span><br><span class="line">apiVersion: apps/v1beta1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-deploy</span><br><span class="line">  labels:</span><br><span class="line">    k8s-app: nginx-deploy</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  minReadySeconds: 5</span><br><span class="line">  revisionHistoryLimit: 10</span><br><span class="line">  strategy:</span><br><span class="line">    <span class="built_in">type</span>: RollingUpdate</span><br><span class="line">    rollingUpdate:</span><br><span class="line">      maxSurge: 1</span><br><span class="line">      maxUnavailable: 1</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: nginx-deploy</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: nginx-deploy</span><br><span class="line">        image: nginx:1.13.3</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 80</span><br><span class="line">        resources:</span><br><span class="line">          requests:</span><br><span class="line">            memory: <span class="string">"200Mi"</span></span><br><span class="line">            cpu: <span class="string">"200m"</span></span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h4 id="æ–°å»ºç«‹nginx-deploy-hpa-yaml"><a href="#æ–°å»ºç«‹nginx-deploy-hpa-yaml" class="headerlink" title="æ–°å»ºç«‹nginx-deploy-hpa.yaml"></a>æ–°å»ºç«‹nginx-deploy-hpa.yaml</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ cat &gt; nginx-deploy-hpa.yaml &lt;&lt;EOF</span><br><span class="line">apiVersion: autoscaling/v1</span><br><span class="line">kind: HorizontalPodAutoscaler</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-deploy</span><br><span class="line">  namespace: default</span><br><span class="line">spec:</span><br><span class="line">  maxReplicas: 5</span><br><span class="line">  minReplicas: 1</span><br><span class="line">  scaleTargetRef:</span><br><span class="line">    apiVersion: extensions/v1beta1</span><br><span class="line">    kind: Deployment</span><br><span class="line">    name: nginx-deploy</span><br><span class="line">  targetCPUUtilizationPercentage: 10</span><br><span class="line">status:</span><br><span class="line">  currentCPUUtilizationPercentage: 8</span><br><span class="line">  currentReplicas: 1</span><br><span class="line">  desiredReplicas: 0</span><br></pre></td></tr></table></figure><ul><li><p>æ‰§è¡Œåˆ›å»º</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl apply -f nginx-deployment.yaml</span><br><span class="line">$ kubectl apply -f kubectl apply -f nginx-deploy-hpa.yaml</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹éªŒè¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get hpa</span><br><span class="line">NAME           REFERENCE                 TARGETS   MINPODS   MAXPODS   REPLICAS   AGE</span><br><span class="line">nginx-deploy   Deployment/nginx-deploy   0%/10%    1         5         2          45s</span><br><span class="line"></span><br><span class="line">$ kubectl get rs</span><br><span class="line">NAME                        DESIRED   CURRENT   READY   AGE</span><br><span class="line">load-generator-7fbcc7489f   1         1         1       8m28s</span><br><span class="line">nginx-deploy-d494b9564      2         2         2       13m</span><br></pre></td></tr></table></figure></li><li><p>æ‰§è¡Œå‹åŠ›æµ‹è¯•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl run -i --tty load-generator --image=busybox /bin/sh</span><br><span class="line">kubectl run --generator=deployment/apps.v1 is DEPRECATED and will be removed <span class="keyword">in</span> a future version. Use kubectl run --generator=run-pod/v1 or kubectl create instead.</span><br><span class="line">If you don<span class="string">'t see a command prompt, try pressing enter.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/ # while true; do wget -q -O- http://172.30.224.5:80; done</span></span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹æ•ˆæœ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get hpa</span><br><span class="line">NAME           REFERENCE                 TARGETS   MINPODS   MAXPODS   REPLICAS   AGE</span><br><span class="line">nginx-deploy   Deployment/nginx-deploy   28%/10%   1         5         4          4m48s</span><br><span class="line"></span><br><span class="line">$ kubectl get rs</span><br><span class="line">NAME                        DESIRED   CURRENT   READY   AGE</span><br><span class="line">load-generator-7fbcc7489f   1         1         1       12m</span><br><span class="line">nginx-deploy-d494b9564      5         5         5       18m</span><br><span class="line"></span><br><span class="line">$ kubectl get hpa</span><br><span class="line">NAME           REFERENCE                 TARGETS   MINPODS   MAXPODS   REPLICAS   AGE</span><br><span class="line">nginx-deploy   Deployment/nginx-deploy   16%/10%   1         5         5          5m39s</span><br></pre></td></tr></table></figure></li><li><p>ç»“æŸå‹æµ‹<br>ç­‰å¾…ä¸€ä¼šæŸ¥çœ‹ç»“æœ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get hpa</span><br><span class="line">NAME           REFERENCE                 TARGETS   MINPODS   MAXPODS   REPLICAS   AGE</span><br><span class="line">nginx-deploy   Deployment/nginx-deploy   0%/10%    1         5         1          12m</span><br><span class="line"></span><br><span class="line">$ kubectl get rs</span><br><span class="line">NAME                        DESIRED   CURRENT   READY   AGE</span><br><span class="line">load-generator-7fbcc7489f   1         1         1       19m</span><br><span class="line">nginx-deploy-d494b9564      1         1         1       25m</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;Pod-è‡ªåŠ¨æ‰©ç¼©å®¹&quot;&gt;&lt;a href=&quot;#Pod-è‡ªåŠ¨æ‰©ç¼©å®¹&quot; class=&quot;headerlink&quot; title=&quot;Pod è‡ªåŠ¨æ‰©ç¼©å®¹&quot;&gt;&lt;/a&gt;Pod è‡ªåŠ¨æ‰©ç¼©å®¹&lt;/h3&gt;&lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Kubernetesæä¾›äº†è¿™æ ·ä¸€ä¸ªèµ„æºå¯¹è±¡: &lt;code&gt;Horizontal Pod Autoscaling&lt;/code&gt; Podæ°´å¹³è‡ªåŠ¨ä¼¸ç¼©ï¼‰ï¼Œç®€ç§°HPAã€‚HAPé€šè¿‡ç›‘æ§åˆ†æRCæˆ–è€…Deploymentæ§åˆ¶çš„æ‰€æœ‰Podçš„è´Ÿè½½å˜åŒ–æƒ…å†µæ¥ç¡®å®šæ˜¯å¦éœ€è¦è°ƒæ•´Podçš„å‰¯æœ¬æ•°é‡ï¼Œè¿™æ˜¯HPAæœ€åŸºæœ¬çš„åŸç†ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="kubernetes" scheme="https://xxlaila.github.io//categories/kubernetes/"/>
    
    
      <category term="hpa" scheme="https://xxlaila.github.io//tags/hpa/"/>
    
  </entry>
  
  <entry>
    <title>Deploymentä½¿ç”¨</title>
    <link href="https://xxlaila.github.io/2019/10/09/Deployment%E4%BD%BF%E7%94%A8/"/>
    <id>https://xxlaila.github.io/2019/10/09/Deploymentä½¿ç”¨/</id>
    <published>2019-10-09T01:59:08.000Z</published>
    <updated>2019-10-09T07:10:56.403Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Deploymentå’Œrcçš„å¯¹æ¯”"><a href="#Deploymentå’Œrcçš„å¯¹æ¯”" class="headerlink" title="Deploymentå’Œrcçš„å¯¹æ¯”"></a>Deploymentå’Œrcçš„å¯¹æ¯”</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;é¦–å…ˆRCæ˜¯Kubernetesçš„ä¸€ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼Œå½“æˆ‘ä»¬æŠŠåº”ç”¨éƒ¨ç½²åˆ°é›†ç¾¤ä¹‹åï¼Œéœ€è¦ä¿è¯åº”ç”¨èƒ½å¤ŸæŒç»­ç¨³å®šçš„è¿è¡Œï¼ŒRCå°±æ˜¯è¿™ä¸ªä¿è¯çš„å…³é”®ï¼Œä¸»è¦åŠŸèƒ½å¦‚:</p><ul><li>ç¡®ä¿Podæ•°é‡: å®ƒä¼šç¡®ä¿Kubernetesä¸­æœ‰æŒ‡å®šæ•°é‡çš„Podåœ¨è¿è¡Œï¼Œå¦‚æœå°‘äºæŒ‡å®šæ•°é‡çš„Podï¼ŒRCå°±ä¼šåˆ›å»ºæ–°çš„ï¼Œåä¹‹è¿™ä¼šåˆ é™¤å¤šä½™çš„ï¼Œä¿è¯Podçš„å‰¯æœ¬æ•°é‡ä¸å˜ã€‚</li><li>ç¡®ä¿Podå¥åº·: å½“Podä¸å¥åº·ï¼Œæ¯”å¦‚è¿è¡Œå‡ºé”™äº†ï¼Œæ€»ä¹‹æ— æ³•æä¾›æ­£å¸¸æœåŠ¡æ—¶ï¼ŒRCä¹Ÿä¼šæ€æ­»ä¸å¥åº·çš„Podï¼Œé‡æ–°åˆ›å»ºæ–°çš„ã€‚</li><li>å¼¹æ€§ä¼¸ç¼©: åœ¨ä¸šåŠ¡é«˜å³°æˆ–è€…ä½å³°çš„æ—¶å€™ï¼Œå¯ä»¥ç”¨è¿‡RCæ¥åŠ¨æ€çš„è°ƒæ•´Podæ•°é‡æ¥æä¾›èµ„æºçš„åˆ©ç”¨ç‡ï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿæåˆ°è¿‡å¦‚æœä½¿ç”¨HPAè¿™ç§èµ„æºå¯¹è±¡çš„è¯å¯ä»¥åšåˆ°è‡ªåŠ¨ä¼¸ç¼©ã€‚</li><li>æ»šåŠ¨å‡çº§: æ»šåŠ¨å‡çº§æ˜¯ä¸€ç§å¹³æ»‘çš„å‡çº§æ–¹å¼ï¼Œé€šè¿‡é€æ­¥æ›¿æ¢çš„ç­–ç•¥ï¼Œä¿è¯æ•´ä½“ç³»ç»Ÿçš„ç¨³å®šæ€§</li></ul><a id="more"></a><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DeploymentåŒæ ·ä¹Ÿæ˜¯Kubernetesç³»ç»Ÿçš„ä¸€ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼Œä¸»è¦èŒè´£å’ŒRCä¸€æ ·çš„éƒ½æ˜¯ä¿è¯Podçš„æ•°é‡å’Œå¥åº·ï¼ŒäºŒè€…å¤§éƒ¨åˆ†åŠŸèƒ½éƒ½æ˜¯å®Œå…¨ä¸€è‡´çš„ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªå‡çº§ç‰ˆçš„RCæ§åˆ¶å™¨ï¼ŒDeploymentå…·å¤‡çš„æ–°ç‰¹æ€§</p><ul><li>RCçš„å…¨éƒ¨åŠŸèƒ½: Deploymentå…·å¤‡ä¸Šé¢æè¿°çš„RCçš„å…¨éƒ¨åŠŸèƒ½</li><li>äº‹ä»¶å’ŒçŠ¶æ€æŸ¥çœ‹: å¯ä»¥æŸ¥çœ‹Deploymentçš„å‡çº§è¯¦ç»†è¿›åº¦å’ŒçŠ¶æ€</li><li>å›æ»š: å½“å‡çº§Podçš„æ—¶å€™å¦‚æœå‡ºç°é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨å›æ»šæ“ä½œå›æ»šåˆ°ä¹‹å‰çš„ä»»ä¸€ç‰ˆæœ¬</li><li>ç‰ˆæœ¬è®°å½•: æ¯ä¸€æ¬¡å¯¹Deploymentçš„æ“ä½œï¼Œéƒ½èƒ½å¤Ÿä¿å­˜ä¸‹æ¥ï¼Œè¿™ä¹Ÿæ˜¯ä¿è¯å¯ä»¥å›æ»šåˆ°ä»»ä¸€ç‰ˆæœ¬çš„åŸºç¡€</li><li>æš‚åœå’Œå¯åŠ¨: å¯¹äºæ¯ä¸€æ¬¡å‡çº§éƒ½èƒ½å¤Ÿéšæ—¶æš‚åœå’Œå¯åŠ¨</li></ul><p><strong>å¯¹æ¯”</strong>: Deploymentä½œä¸ºæ–°ä¸€ä»£çš„RCï¼Œåœ¨åŠŸèƒ½ä¸Šæ›´ä¸ºä¸°å¯Œï¼ŒåŒæ—¶å®˜æ–¹ä¹Ÿæ˜¯æ¨èä½¿ç”¨Deploymentæ¥ç®¡ç†Podï¼Œæ¯”å¦‚ä¸€äº›å®˜æ–¹ç»„ä»¶kube-dnsã€kube-proxyä¹Ÿéƒ½æ˜¯ä½¿ç”¨çš„Deploymentæ¥ç®¡ç†çš„ï¼Œæ‰€ä»¥æœ€å¥½ä½¿ç”¨Deploymentæ¥ç®¡ç†Podã€‚</p><h3 id="Deployment-ä»‹ç»"><a href="#Deployment-ä»‹ç»" class="headerlink" title="Deployment ä»‹ç»"></a>Deployment ä»‹ç»</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Deploymentæ‹¥æœ‰å¤šä¸ªReplica Setï¼Œè€Œä¸€ä¸ªReplica Setæ‹¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªPodã€‚ä¸€ä¸ªDeploymentæ§åˆ¶å¤šä¸ªrsä¸»è¦æ˜¯ä¸ºäº†æ”¯æŒå›æ»šæœºåˆ¶ï¼Œæ¯å½“Deploymentæ“ä½œæ—¶ï¼ŒKubernetesä¼šé‡æ–°ç”Ÿæˆä¸€ä¸ªReplica Setå¹¶ä¿ç•™ï¼Œä»¥åæœ‰éœ€è¦çš„è¯å°±å¯ä»¥å›æ»šè‡³ä¹‹å‰çš„çŠ¶æ€ã€‚</p><p><strong>å®ä¾‹</strong>: åˆ›å»ºä¸€ä¸ªDeploymentï¼Œå®ƒåˆ›å»ºäº†ä¸€ä¸ªReplica Setæ¥å¯åŠ¨3ä¸ªnginx podï¼Œyamlæ–‡ä»¶å¦‚ä¸‹:</p><ul><li><p>nginx-deployment.yaml</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ cat &gt; nginx-deployment.yaml &lt;&lt;EOF</span><br><span class="line">apiVersion: apps/v1beta1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-deploy</span><br><span class="line">  labels:</span><br><span class="line">    k8s-app: nginx-demo</span><br><span class="line">spec:</span><br><span class="line">  replicas: 3</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: nginx</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: nginx</span><br><span class="line">        image: nginx:1.7.9</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 80</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure></li><li><p>æ‰§è¡Œåˆ›å»º</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl create -f nginx-deployment.yaml</span><br><span class="line">deployment.apps/nginx-deploy created</span><br></pre></td></tr></table></figure></li><li><p>æ‰§è¡Œä¸€ä¸‹å‘½ä»¤æŸ¥çœ‹åˆšåˆšåˆ›å»ºçš„Deployment</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get deployments</span><br><span class="line">NAME           READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">nginx-deploy   0/3     3            0           12s</span><br><span class="line"></span><br><span class="line"><span class="comment"># å†æ¬¡æ‰§è¡Œä¸Šé¢å‘½ä»¤</span></span><br><span class="line">$ kubectl get deployments</span><br><span class="line">NAME           READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">nginx-deploy   1/3     3            1           35s</span><br></pre></td></tr></table></figure></li><li><p>å¯ä»¥çœ‹åˆ°Deploymentå·²ç»åˆ›å»ºäº†1ä¸ªReplica Setäº†ï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹rså’Œpod</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get rs</span><br><span class="line">NAME                     DESIRED   CURRENT   READY   AGE</span><br><span class="line">nginx-deploy-6dd86d77d   3         3         2       70s</span><br><span class="line"></span><br><span class="line"><span class="comment"># </span></span><br><span class="line">$ kubectl get pod --show-labels</span><br><span class="line">NAME                           READY   STATUS              RESTARTS   AGE   LABELS</span><br><span class="line">nginx-deploy-6dd86d77d-9n9vf   1/1     Running             0          99s   app=nginx,pod-template-hash=6dd86d77d</span><br><span class="line">nginx-deploy-6dd86d77d-bhrsk   0/1     ContainerCreating   0          99s   app=nginx,pod-template-hash=6dd86d77d</span><br><span class="line">nginx-deploy-6dd86d77d-jdnrh   1/1     Running             0          99s   app=nginx,pod-template-hash=6dd86d77d</span><br></pre></td></tr></table></figure></li></ul><p>ä¸Šé¢çš„Deploymentçš„yamlæ–‡ä»¶ä¸­çš„replicas:3å°†ä¼šä¿è¯æˆ‘ä»¬å§‹ç»ˆæœ‰3ä¸ªPODåœ¨è¿è¡Œã€‚</p><h3 id="æ»šåŠ¨å‡çº§"><a href="#æ»šåŠ¨å‡çº§" class="headerlink" title="æ»šåŠ¨å‡çº§"></a>æ»šåŠ¨å‡çº§</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ä¿®æ”¹ä¹‹å‰ä½¿ç”¨çš„nginx-deployment.yamlæ–‡ä»¶ä¸­çš„nginxé•œåƒä¿®æ”¹ä¸ºnginx:1.13.3ï¼Œç„¶ååœ¨specä¸‹é¢æ·»åŠ æ»šåŠ¨å‡çº§ç­–ç•¥ï¼š</p><ul><li><p>nginx-deploments.yml</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: apps/v1beta1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-deploy</span><br><span class="line">  labels:</span><br><span class="line">    k8s-app: nginx-demo</span><br><span class="line">spec:</span><br><span class="line">  replicas: 3</span><br><span class="line">  minReadySeconds: 5</span><br><span class="line">  strategy:</span><br><span class="line">    <span class="built_in">type</span>: RollingUpdate</span><br><span class="line">    rollingUpdate:</span><br><span class="line">      maxSurge: 1</span><br><span class="line">      maxUnavailable: 1</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: nginx</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: nginx</span><br><span class="line">        image: nginx:1.13.3</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 80</span><br></pre></td></tr></table></figure></li><li><p>minReadySeconds:</p><ul><li>æ»šåŠ¨å‡çº§æ—¶5såè®¤ä¸ºè¯¥podå°±ç»ª</li><li>å¦‚æœæ²¡æœ‰è®¾ç½®è¯¥å€¼ï¼ŒKubernetesä¼šå‡è®¾è¯¥å®¹å™¨å¯åŠ¨èµ·æ¥åå°±æä¾›æœåŠ¡äº†</li><li>å¦‚æœæ²¡æœ‰è®¾ç½®è¯¥å€¼ï¼Œåœ¨æŸäº›æç«¯æƒ…å†µä¸‹å¯èƒ½ä¼šé€ æˆæœåŠ¡ä¸æ­£å¸¸è¿è¡Œ</li></ul></li><li><p>rollingUpdate:</p><ul><li>äºreplicasä¸º3,åˆ™æ•´ä¸ªå‡çº§,podä¸ªæ•°åœ¨2-4ä¸ªä¹‹é—´</li></ul></li><li><p>maxSurge:</p><ul><li>å‡çº§è¿‡ç¨‹ä¸­æœ€å¤šå¯ä»¥æ¯”åŸå…ˆè®¾ç½®å¤šå‡ºçš„PODæ•°é‡</li><li>ä¾‹å¦‚ï¼šmaxSurage=1ï¼Œreplicas=3,åˆ™è¡¨ç¤ºKubernetesä¼šå…ˆå¯åŠ¨1ä¸€ä¸ªæ–°çš„Podåæ‰åˆ æ‰ä¸€ä¸ªæ—§çš„PODï¼Œæ•´ä¸ªå‡çº§è¿‡ç¨‹ä¸­æœ€å¤šä¼šæœ‰3+1ä¸ªPODã€‚</li></ul></li><li><p>maxUnavaible:</p><ul><li>å‡çº§è¿‡ç¨‹ä¸­æœ€å¤šæœ‰å¤šå°‘ä¸ªPODå¤„äºæ— æ³•æä¾›æœåŠ¡çš„çŠ¶æ€</li><li>å½“maxSurgeä¸ä¸º0æ—¶ï¼Œè¯¥å€¼ä¹Ÿä¸èƒ½ä¸º0</li><li>ä¾‹å¦‚ï¼šmaxUnavaible=1ï¼Œåˆ™è¡¨ç¤ºKubernetesæ•´ä¸ªå‡çº§è¿‡ç¨‹ä¸­æœ€å¤šä¼šæœ‰1ä¸ªPODå¤„äºæ— æ³•æœåŠ¡çš„çŠ¶æ€ã€‚</li></ul></li><li><p>æ‰§è¡Œåˆ›å»º</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl apply -f nginx-deployment.yaml</span><br><span class="line">deployment.apps/nginx-deploy configured</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹çŠ¶æ€</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨rolloutå‘½ä»¤</span></span><br><span class="line">$ kubectl rollout status deployment/nginx-deploy</span><br><span class="line">Waiting <span class="keyword">for</span> deployment <span class="string">"nginx-deploy"</span> rollout to finish: 2 out of 3 new replicas have been updated...</span><br><span class="line"></span><br><span class="line"><span class="comment"># æš‚åœå‡çº§</span></span><br><span class="line">$ kubectl rollout pause deployment deployment/nginx-deploy</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»§ç»­å‡çº§</span></span><br><span class="line">$ kubectl rollout resume deployment deployment/nginx-deploy</span><br></pre></td></tr></table></figure></li></ul><p>å‡çº§ç»“æŸåï¼Œç»§ç»­æŸ¥çœ‹rsçš„çŠ¶æ€</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get rs</span><br><span class="line">NAME                      DESIRED   CURRENT   READY   AGE</span><br><span class="line">nginx-deploy-6dd86d77d    0         0         0       21m</span><br><span class="line">nginx-deploy-799d666985   3         3         3       10m</span><br></pre></td></tr></table></figure><p>æ ¹æ®AGEæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç¦»æˆ‘ä»¬æœ€è¿‘çš„å½“å‰çŠ¶æ€æ˜¯ï¼š3ï¼Œå’Œæˆ‘ä»¬çš„yamlæ–‡ä»¶æ˜¯ä¸€è‡´çš„ï¼Œè¯æ˜å‡çº§æˆåŠŸäº†ã€‚ç”¨describeå‘½ä»¤å¯ä»¥æŸ¥çœ‹å‡çº§çš„å…¨éƒ¨ä¿¡æ¯:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl describe deploy nginx-deploy</span><br><span class="line">Name:                   nginx-deploy</span><br><span class="line">Namespace:              default</span><br><span class="line">CreationTimestamp:      Wed, 09 Oct 2019 10:12:56 +0800</span><br><span class="line">Labels:                 k8s-app=nginx-demo</span><br><span class="line">Annotations:            deployment.kubernetes.io/revision: 2</span><br><span class="line">                        kubectl.kubernetes.io/last-applied-configuration:</span><br><span class="line">                          &#123;<span class="string">"apiVersion"</span>:<span class="string">"apps/v1beta1"</span>,<span class="string">"kind"</span>:<span class="string">"Deployment"</span>,<span class="string">"metadata"</span>:&#123;<span class="string">"annotations"</span>:&#123;&#125;,<span class="string">"labels"</span>:&#123;<span class="string">"k8s-app"</span>:<span class="string">"nginx-demo"</span>&#125;,<span class="string">"name"</span>:<span class="string">"nginx-deploy"</span>,<span class="string">"nam...</span></span><br><span class="line"><span class="string">Selector:               app=nginx</span></span><br><span class="line"><span class="string">Replicas:               3 desired | 3 updated | 3 total | 3 available | 0 unavailable</span></span><br><span class="line"><span class="string">StrategyType:           RollingUpdate</span></span><br><span class="line"><span class="string">MinReadySeconds:        5</span></span><br><span class="line"><span class="string">RollingUpdateStrategy:  1 max unavailable, 1 max surge</span></span><br><span class="line"><span class="string">Pod Template:</span></span><br><span class="line"><span class="string">  Labels:  app=nginx</span></span><br><span class="line"><span class="string">  Containers:</span></span><br><span class="line"><span class="string">   nginx:</span></span><br><span class="line"><span class="string">    Image:        nginx:1.13.3</span></span><br><span class="line"><span class="string">    Port:         80/TCP</span></span><br><span class="line"><span class="string">    Host Port:    0/TCP</span></span><br><span class="line"><span class="string">    Environment:  &lt;none&gt;</span></span><br><span class="line"><span class="string">    Mounts:       &lt;none&gt;</span></span><br><span class="line"><span class="string">  Volumes:        &lt;none&gt;</span></span><br><span class="line"><span class="string">Conditions:</span></span><br><span class="line"><span class="string">  Type           Status  Reason</span></span><br><span class="line"><span class="string">  ----           ------  ------</span></span><br><span class="line"><span class="string">  Available      True    MinimumReplicasAvailable</span></span><br><span class="line"><span class="string">  Progressing    True    NewReplicaSetAvailable</span></span><br><span class="line"><span class="string">OldReplicaSets:  &lt;none&gt;</span></span><br><span class="line"><span class="string">NewReplicaSet:   nginx-deploy-799d666985 (3/3 replicas created)</span></span><br><span class="line"><span class="string">Events:</span></span><br><span class="line"><span class="string">  Type    Reason             Age   From                   Message</span></span><br><span class="line"><span class="string">  ----    ------             ----  ----                   -------</span></span><br><span class="line"><span class="string">  Normal  ScalingReplicaSet  23m   deployment-controller  Scaled up replica set nginx-deploy-6dd86d77d to 3</span></span><br><span class="line"><span class="string">  Normal  ScalingReplicaSet  12m   deployment-controller  Scaled up replica set nginx-deploy-799d666985 to 1</span></span><br><span class="line"><span class="string">  Normal  ScalingReplicaSet  12m   deployment-controller  Scaled down replica set nginx-deploy-6dd86d77d to 2</span></span><br><span class="line"><span class="string">  Normal  ScalingReplicaSet  12m   deployment-controller  Scaled up replica set nginx-deploy-799d666985 to 2</span></span><br><span class="line"><span class="string">  Normal  ScalingReplicaSet  11m   deployment-controller  Scaled down replica set nginx-deploy-6dd86d77d to 1</span></span><br><span class="line"><span class="string">  Normal  ScalingReplicaSet  11m   deployment-controller  Scaled up replica set nginx-deploy-799d666985 to 3</span></span><br><span class="line"><span class="string">  Normal  ScalingReplicaSet  10m   deployment-controller  Scaled down replica set nginx-deploy-6dd86d77d to 0</span></span><br></pre></td></tr></table></figure><h3 id="å›æ»šDeployment"><a href="#å›æ»šDeployment" class="headerlink" title="å›æ»šDeployment"></a>å›æ»šDeployment</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å‰é¢å·²ç»æ»šåŠ¨å¹³æ»‘çš„å‡çº§Deploymentï¼Œä½†æ˜¯å¦‚æœå‡çº§åçš„PODå‡ºäº†é—®é¢˜è¯¥æ€ä¹ˆåŠï¼Ÿæˆ‘ä»¬èƒ½å¤Ÿæƒ³åˆ°çš„æœ€å¥½æœ€å¿«çš„æ–¹å¼å½“ç„¶æ˜¯å›é€€åˆ°ä¸Šä¸€æ¬¡èƒ½å¤Ÿæä¾›æ­£å¸¸å·¥ä½œçš„ç‰ˆæœ¬ï¼ŒDeploymentå°±ä¸ºæˆ‘ä»¬æä¾›äº†å›æ»šæœºåˆ¶ã€‚</p><ul><li>é¦–å…ˆï¼ŒæŸ¥çœ‹Deploymentçš„å‡çº§å†å²:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl rollout <span class="built_in">history</span> deployment nginx-deploy</span><br><span class="line">deployment.extensions/nginx-deploy </span><br><span class="line">REVISION  CHANGE-CAUSE</span><br><span class="line">1         &lt;none&gt;</span><br><span class="line">2         &lt;none&gt;</span><br></pre></td></tr></table></figure></li></ul><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ä»ä¸Šé¢çš„ç»“æœå¯ä»¥çœ‹å‡ºåœ¨æ‰§è¡ŒDeploymentå‡çº§çš„æ—¶å€™æœ€å¥½å¸¦ä¸Šrecordå‚æ•°ï¼Œä¾¿äºæˆ‘ä»¬æŸ¥çœ‹å†å²ç‰ˆæœ¬ä¿¡æ¯ã€‚<code>kubectl apply --filename=nginx-deployment.yaml --record=true</code><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰é€šè¿‡kubectl xxxx â€“recordéƒ½ä¼šè¢«kubernetesè®°å½•åˆ°etcdè¿›è¡ŒæŒä¹…åŒ–ï¼Œè¿™æ— ç–‘ä¼šå ç”¨èµ„æºï¼Œæœ€é‡è¦çš„æ˜¯ï¼Œæ—¶é—´ä¹…äº†ï¼Œå½“ä½ kubectl get rsæ—¶ï¼Œä¼šæœ‰æˆç™¾ä¸Šåƒçš„åƒåœ¾RSè¿”å›ï¼Œè¿™å¯¹äºè¿ç»´æ¥è¯´ç»´æŠ¤å¾ˆä¸ä¾¿åˆ©ï¼Œ<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å½“æˆ‘ä»¬åœ¨ä¸Šç”Ÿäº§æ—¶ï¼Œæˆ‘ä»¬æœ€å¥½é€šè¿‡è®¾ç½®Deploymentçš„.spec.revisionHistoryLimitæ¥é™åˆ¶æœ€å¤§ä¿ç•™çš„revision numberï¼Œæ¯”å¦‚15ä¸ªç‰ˆæœ¬ï¼Œå›æ»šçš„æ—¶å€™ä¸€èˆ¬åªä¼šå›æ»šåˆ°æœ€è¿‘çš„å‡ ä¸ªç‰ˆæœ¬å°±è¶³å¤Ÿäº†ã€‚å…¶å®rollout historyä¸­è®°å½•çš„revisionéƒ½å’ŒReplicaSetsä¸€ä¸€å¯¹åº”ã€‚å¦‚æœæ‰‹åŠ¨deleteæŸä¸ªReplicaSetï¼Œå¯¹åº”çš„rollout historyå°±ä¼šè¢«åˆ é™¤ï¼Œä¹Ÿå°±æ˜¯è¿˜è¯´ä½ æ— æ³•å›æ»šåˆ°è¿™ä¸ªrevisonã€‚rollout historyå’ŒReplicaSetçš„å¯¹åº”å…³ç³»ï¼Œå¯ä»¥åœ¨kubectl describe rs $RSNAMEè¿”å›çš„revisionå­—æ®µä¸­å¾—åˆ°ï¼Œè¿™é‡Œçš„revisionå°±å¯¹åº”ç€rollout historyè¿”å›çš„revisonã€‚</p><ul><li><p>yamlä¾‹å­</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">$ cat nginx-deployment.yaml </span><br><span class="line">apiVersion: apps/v1beta1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-deploy</span><br><span class="line">  labels:</span><br><span class="line">    k8s-app: nginx-demo</span><br><span class="line">spec:</span><br><span class="line">  replicas: 3</span><br><span class="line">  minReadySeconds: 5</span><br><span class="line">  revisionHistoryLimit: 10</span><br><span class="line">  strategy:</span><br><span class="line">    <span class="built_in">type</span>: RollingUpdate</span><br><span class="line">    rollingUpdate:</span><br><span class="line">      maxSurge: 1</span><br><span class="line">      maxUnavailable: 1</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: nginx</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: nginx</span><br><span class="line">        image: nginx:1.13.3</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 80</span><br></pre></td></tr></table></figure></li><li><p>å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹å•ä¸ªrevisonçš„ä¿¡æ¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl rollout <span class="built_in">history</span> deployment nginx-deploy --revision=2</span><br><span class="line">deployment.extensions/nginx-deploy with revision <span class="comment">#2</span></span><br><span class="line">Pod Template:</span><br><span class="line">  Labels:app=nginx</span><br><span class="line">pod-template-hash=799d666985</span><br><span class="line">  Annotations:kubernetes.io/change-cause: kubectl apply --filename=nginx-deployment.yaml --record=<span class="literal">true</span></span><br><span class="line">  Containers:</span><br><span class="line">   nginx:</span><br><span class="line">    Image:nginx:1.13.3</span><br><span class="line">    Port:80/TCP</span><br><span class="line">    Host Port:0/TCP</span><br><span class="line">    Environment:&lt;none&gt;</span><br><span class="line">    Mounts:&lt;none&gt;</span><br><span class="line">  Volumes:&lt;none&gt;</span><br></pre></td></tr></table></figure></li><li><p>ç›´æ¥å›é€€åˆ°å½“å‰ç‰ˆæœ¬çš„å‰ä¸€ä¸ªç‰ˆæœ¬ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl rollout undo deployment nginx-deploy</span><br><span class="line">deployment.extensions/nginx-deploy rolled back</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¹Ÿå¯ä»¥ç”¨revisionå›é€€åˆ°æŒ‡å®šçš„ç‰ˆæœ¬</span></span><br><span class="line">$ kubectl rollout undo deployment nginx-deploy --to-revision=1</span><br><span class="line">deployment.extensions/nginx-deploy rolled back</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹Deploymentç°åœ¨çš„çŠ¶æ€</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get deployments</span><br><span class="line">NAME           READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">nginx-deploy   2/3     3            2           56m</span><br><span class="line"></span><br><span class="line">$ kubectl get rs</span><br><span class="line">NAME                      DESIRED   CURRENT   READY   AGE</span><br><span class="line">nginx-deploy-6dd86d77d    1         1         1       56m</span><br><span class="line">nginx-deploy-799d666985   3         3         1       46m</span><br><span class="line"></span><br><span class="line">$ kubectl rollout status deployment/nginx-deploy</span><br><span class="line">Waiting <span class="keyword">for</span> deployment <span class="string">"nginx-deploy"</span> rollout to finish: 2 of 3 updated replicas are available...</span><br><span class="line">Waiting <span class="keyword">for</span> deployment <span class="string">"nginx-deploy"</span> rollout to finish: 2 of 3 updated replicas are available...</span><br><span class="line">deployment <span class="string">"nginx-deploy"</span> successfully rolled out</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®ŒæˆåæŸ¥çœ‹</span></span><br><span class="line">$ kubectl get rs</span><br><span class="line">NAME                      DESIRED   CURRENT   READY   AGE</span><br><span class="line">nginx-deploy-6dd86d77d    0         0         0       57m</span><br><span class="line">nginx-deploy-799d666985   3         3         3       47m</span><br></pre></td></tr></table></figure></li></ul><p><a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/" target="_blank" rel="noopener">å®˜æ–¹å‚è€ƒ</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;Deploymentå’Œrcçš„å¯¹æ¯”&quot;&gt;&lt;a href=&quot;#Deploymentå’Œrcçš„å¯¹æ¯”&quot; class=&quot;headerlink&quot; title=&quot;Deploymentå’Œrcçš„å¯¹æ¯”&quot;&gt;&lt;/a&gt;Deploymentå’Œrcçš„å¯¹æ¯”&lt;/h3&gt;&lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;é¦–å…ˆRCæ˜¯Kubernetesçš„ä¸€ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼Œå½“æˆ‘ä»¬æŠŠåº”ç”¨éƒ¨ç½²åˆ°é›†ç¾¤ä¹‹åï¼Œéœ€è¦ä¿è¯åº”ç”¨èƒ½å¤ŸæŒç»­ç¨³å®šçš„è¿è¡Œï¼ŒRCå°±æ˜¯è¿™ä¸ªä¿è¯çš„å…³é”®ï¼Œä¸»è¦åŠŸèƒ½å¦‚:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¡®ä¿Podæ•°é‡: å®ƒä¼šç¡®ä¿Kubernetesä¸­æœ‰æŒ‡å®šæ•°é‡çš„Podåœ¨è¿è¡Œï¼Œå¦‚æœå°‘äºæŒ‡å®šæ•°é‡çš„Podï¼ŒRCå°±ä¼šåˆ›å»ºæ–°çš„ï¼Œåä¹‹è¿™ä¼šåˆ é™¤å¤šä½™çš„ï¼Œä¿è¯Podçš„å‰¯æœ¬æ•°é‡ä¸å˜ã€‚&lt;/li&gt;
&lt;li&gt;ç¡®ä¿Podå¥åº·: å½“Podä¸å¥åº·ï¼Œæ¯”å¦‚è¿è¡Œå‡ºé”™äº†ï¼Œæ€»ä¹‹æ— æ³•æä¾›æ­£å¸¸æœåŠ¡æ—¶ï¼ŒRCä¹Ÿä¼šæ€æ­»ä¸å¥åº·çš„Podï¼Œé‡æ–°åˆ›å»ºæ–°çš„ã€‚&lt;/li&gt;
&lt;li&gt;å¼¹æ€§ä¼¸ç¼©: åœ¨ä¸šåŠ¡é«˜å³°æˆ–è€…ä½å³°çš„æ—¶å€™ï¼Œå¯ä»¥ç”¨è¿‡RCæ¥åŠ¨æ€çš„è°ƒæ•´Podæ•°é‡æ¥æä¾›èµ„æºçš„åˆ©ç”¨ç‡ï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿæåˆ°è¿‡å¦‚æœä½¿ç”¨HPAè¿™ç§èµ„æºå¯¹è±¡çš„è¯å¯ä»¥åšåˆ°è‡ªåŠ¨ä¼¸ç¼©ã€‚&lt;/li&gt;
&lt;li&gt;æ»šåŠ¨å‡çº§: æ»šåŠ¨å‡çº§æ˜¯ä¸€ç§å¹³æ»‘çš„å‡çº§æ–¹å¼ï¼Œé€šè¿‡é€æ­¥æ›¿æ¢çš„ç­–ç•¥ï¼Œä¿è¯æ•´ä½“ç³»ç»Ÿçš„ç¨³å®šæ€§&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="kubernetes" scheme="https://xxlaila.github.io//categories/kubernetes/"/>
    
    
      <category term="Deployment" scheme="https://xxlaila.github.io//tags/Deployment/"/>
    
  </entry>
  
  <entry>
    <title>harborç§æœ‰ä»“åº“éƒ¨ç½²</title>
    <link href="https://xxlaila.github.io/2019/09/30/harbor%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93%E9%83%A8%E7%BD%B2/"/>
    <id>https://xxlaila.github.io/2019/09/30/harborç§æœ‰ä»“åº“éƒ¨ç½²/</id>
    <published>2019-09-30T06:55:28.000Z</published>
    <updated>2019-10-14T08:06:02.683Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Harboræ˜¯ä¸€ä¸ªç”¨äºå­˜å‚¨å’Œåˆ†å‘Dockeré•œåƒçš„ä¼ä¸šçº§RegistryæœåŠ¡å™¨ï¼Œé€šè¿‡æ·»åŠ ä¸€äº›ä¼ä¸šå¿…éœ€çš„åŠŸèƒ½ç‰¹æ€§ï¼Œä¾‹å¦‚å®‰å…¨ã€æ ‡è¯†å’Œç®¡ç†ç­‰ï¼Œæ‰©å±•äº†å¼€æºDocker Distributionã€‚ä½œä¸ºä¸€ä¸ªä¼ä¸šçº§ç§æœ‰RegistryæœåŠ¡å™¨ï¼ŒHarboræä¾›äº†æ›´å¥½çš„æ€§èƒ½å’Œå®‰å…¨ã€‚æå‡ç”¨æˆ·ä½¿ç”¨Registryæ„å»ºå’Œè¿è¡Œç¯å¢ƒä¼ è¾“é•œåƒçš„æ•ˆç‡ã€‚Harboræ”¯æŒå®‰è£…åœ¨å¤šä¸ªRegistryèŠ‚ç‚¹çš„é•œåƒèµ„æºå¤åˆ¶ï¼Œé•œåƒå…¨éƒ¨ä¿å­˜åœ¨ç§æœ‰Registryä¸­ï¼Œ ç¡®ä¿æ•°æ®å’ŒçŸ¥è¯†äº§æƒåœ¨å…¬å¸å†…éƒ¨ç½‘ç»œä¸­ç®¡æ§ã€‚å¦å¤–ï¼ŒHarborä¹Ÿæä¾›äº†é«˜çº§çš„å®‰å…¨ç‰¹æ€§ï¼Œè¯¸å¦‚ç”¨æˆ·ç®¡ç†ï¼Œè®¿é—®æ§åˆ¶å’Œæ´»åŠ¨å®¡è®¡ç­‰ã€‚</p><a id="more"></a><h3 id="éƒ¨ç½²ç¯å¢ƒå‡†å¤‡"><a href="#éƒ¨ç½²ç¯å¢ƒå‡†å¤‡" class="headerlink" title="éƒ¨ç½²ç¯å¢ƒå‡†å¤‡"></a>éƒ¨ç½²ç¯å¢ƒå‡†å¤‡</h3><h4 id="æœåŠ¡å™¨é…ç½®"><a href="#æœåŠ¡å™¨é…ç½®" class="headerlink" title="æœåŠ¡å™¨é…ç½®"></a>æœåŠ¡å™¨é…ç½®</h4><table><thead><tr><th>ç³»ç»Ÿ</th><th>é…ç½®</th><th>ip</th></tr></thead><tbody><tr><td>centos 7.4</td><td>4/8G/200G</td><td>172.21.16.90</td></tr></tbody></table><h4 id="ä¸‹è½½æ‰€éœ€æ–‡ä»¶"><a href="#ä¸‹è½½æ‰€éœ€æ–‡ä»¶" class="headerlink" title="ä¸‹è½½æ‰€éœ€æ–‡ä»¶"></a>ä¸‹è½½æ‰€éœ€æ–‡ä»¶</h4><h5 id="docker-compose-ä¸‹è½½"><a href="#docker-compose-ä¸‹è½½" class="headerlink" title="docker-compose ä¸‹è½½"></a>docker-compose ä¸‹è½½</h5><p>docker compose <a href="https://github.com/docker/compose/releases" target="_blank" rel="noopener">å‘å¸ƒé¡µé¢</a>ä¸‹è½½æœ€æ–°çš„ docker-compose äºŒè¿›åˆ¶æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># wget https://github.com/docker/compose/releases/download/1.24.1/docker-compose-Linux-x86_64</span></span><br><span class="line"><span class="comment"># mv ~/docker-compose-Linux-x86_64 /usr/bin/docker-compose </span></span><br><span class="line"><span class="comment"># chmod a+x  /ur/bin/docker-compose</span></span><br></pre></td></tr></table></figure><ul><li>å®˜æ–¹çš„å®‰è£…<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># curl -L https://github.com/docker/compose/releases/download/1.24.1/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose</span></span><br><span class="line"><span class="comment"># chmod +x /usr/local/bin/docker-compose</span></span><br></pre></td></tr></table></figure></li></ul><h5 id="harbor-ä¸‹è½½"><a href="#harbor-ä¸‹è½½" class="headerlink" title="harbor ä¸‹è½½"></a>harbor ä¸‹è½½</h5><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;harbor å®‰è£…æ–¹å¼æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯åœ¨çº¿å®‰è£…ï¼Œä¸€ç§æ˜¯ç¦»çº¿å®‰è£…ï¼Œè¿™é‡Œç”±äºç½‘ç»œä¸å¥½ï¼Œä½¿ç”¨çš„æ˜¯ç¦»çº¿å®‰è£…ï¼Œharbor<a href="https://github.com/goharbor/harbor/releases" target="_blank" rel="noopener">å‘å¸ƒé¡µé¢</a>ä¸‹è½½æœ€æ–°çš„ harbor ç¦»çº¿å®‰è£…åŒ…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># wget https://storage.googleapis.com/harbor-releases/release-1.9.0/harbor-offline-installer-v1.9.0.tgz</span></span><br><span class="line"><span class="comment"># tar -zxvf harbor-offline-installer-v1.9.0.tgz</span></span><br><span class="line"><span class="comment">#</span></span><br></pre></td></tr></table></figure><h3 id="å¼€å§‹å®‰è£…"><a href="#å¼€å§‹å®‰è£…" class="headerlink" title="å¼€å§‹å®‰è£…"></a>å¼€å§‹å®‰è£…</h3><h4 id="docker-å®‰è£…"><a href="#docker-å®‰è£…" class="headerlink" title="docker å®‰è£…"></a>docker å®‰è£…</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum-config-manager   --add-repo   https://download.docker.com/linux/centos/docker-ce.repo</span></span><br><span class="line"><span class="comment"># sudo yum -y install docker-ce-18.09.6-3.el7.x86_64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># cat /etc/sysctl.d/k8s.conf &lt;&lt;EOF</span></span><br><span class="line">net.bridge.bridge-nf-call-ip6tables: 1</span><br><span class="line">net.bridge.bridge-nf-call-iptables: 1</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># sysctl -p /etc/sysctl.d/k8s.conf</span></span><br><span class="line"><span class="comment"># systemctl  start docker</span></span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>: ä¸æ·»åŠ <code>/etc/sysctl.d/k8s.conf</code> å¯åŠ¨dockerä¼šæç¤º<code>WARNING: bridge-nf-call-iptables is disabled  WARNING: bridge-nf-call-ip6tables is disabled</code></p><h4 id="å¯¼å…¥-docker-images"><a href="#å¯¼å…¥-docker-images" class="headerlink" title="å¯¼å…¥ docker images"></a>å¯¼å…¥ docker images</h4><p>å¯¼å…¥ç¦»çº¿å®‰è£…åŒ…ä¸­harborç›¸å…³çš„ docker imagesï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cd harbor</span></span><br><span class="line"><span class="comment"># docker load -i harbor.v1.9.0.tar.gz </span></span><br><span class="line"><span class="comment"># docker images</span></span><br><span class="line">REPOSITORY                      TAG                        IMAGE ID            CREATED             SIZE</span><br><span class="line">goharbor/chartmuseum-photon     v0.9.0-v1.9.0              00c12627cbd7        2 weeks ago         131MB</span><br><span class="line">goharbor/harbor-migrator        v1.9.0                     75d4de5e0f16        2 weeks ago         362MB</span><br><span class="line">goharbor/redis-photon           v1.9.0                     3249afaa9965        2 weeks ago         109MB</span><br><span class="line">goharbor/clair-photon           v2.0.9-v1.9.0              e54ad567c58f        2 weeks ago         165MB</span><br><span class="line">goharbor/notary-server-photon   v0.6.1-v1.9.0              2cdecba59f38        2 weeks ago         138MB</span><br><span class="line">goharbor/notary-signer-photon   v0.6.1-v1.9.0              973378593def        2 weeks ago         135MB</span><br><span class="line">goharbor/harbor-registryctl     v1.9.0                     30a01bf0f4df        2 weeks ago         99.6MB</span><br><span class="line">goharbor/registry-photon        v2.7.1-patch-2819-v1.9.0   32571099a9fe        2 weeks ago         82.3MB</span><br><span class="line">goharbor/nginx-photon           v1.9.0                     f933d62f9952        2 weeks ago         43.9MB</span><br><span class="line">goharbor/harbor-log             v1.9.0                     28e27d511335        2 weeks ago         82.6MB</span><br><span class="line">goharbor/harbor-jobservice      v1.9.0                     f3cd0b181a89        2 weeks ago         141MB</span><br><span class="line">goharbor/harbor-core            v1.9.0                     f2814ed8aadd        2 weeks ago         155MB</span><br><span class="line">goharbor/harbor-portal          v1.9.0                     0778d4c5d27e        2 weeks ago         51.3MB</span><br><span class="line">goharbor/harbor-db              v1.9.0                     a809e14d2d49        2 weeks ago         147MB</span><br><span class="line">goharbor/prepare                v1.9.0                     aa594772c1e8        2 weeks ago         147MB</span><br></pre></td></tr></table></figure><h4 id="ä¿®æ”¹-harbor-yml-æ–‡ä»¶"><a href="#ä¿®æ”¹-harbor-yml-æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹ harbor.yml æ–‡ä»¶"></a>ä¿®æ”¹ harbor.yml æ–‡ä»¶</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim harbor.yml</span></span><br><span class="line">hostname: reg.xxlaila.cn</span><br><span class="line"></span><br><span class="line"><span class="comment"># email configure</span></span><br><span class="line">email_server: smtp.exmail.qq.com</span><br><span class="line">email_server_port: 465</span><br><span class="line">email_username: admin@xxlaila.cn</span><br><span class="line">email_password: 123</span><br><span class="line">email_from: admin&lt;admin@xxlaila.cn&gt;</span><br><span class="line">email_ssl: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># User registration is prohibited</span></span><br><span class="line">self_registration: off</span><br><span class="line"></span><br><span class="line"><span class="comment"># LDAP authentication configuration item</span></span><br><span class="line"><span class="comment">#ldap_url: ldaps://ldap.xxlaila.cn</span></span><br><span class="line"><span class="comment">#ldap_searchdn: uid=username,ou=people,dc=xxlaila,dc=com</span></span><br><span class="line"><span class="comment">#ldap_search_pwd: password</span></span><br><span class="line"><span class="comment">#ldap_basedn: ou=people,dc=xxlaila,dc=com</span></span><br><span class="line"><span class="comment">#ldap_filter: (objectClass=person)</span></span><br><span class="line"><span class="comment">#ldap_uid: uid </span></span><br><span class="line"><span class="comment">#ldap_scope: 3 </span></span><br><span class="line"><span class="comment">#ldap_timeout: 5</span></span><br></pre></td></tr></table></figure><p><strong>æ³¨</strong>: æ–°ç‰ˆæœ¬çš„é‚®ç®±ã€ldapç°åœ¨éƒ½ä¸éœ€è¦åœ¨é…ç½®æ–‡ä»¶é‡Œé¢æ¥æ·»åŠ é…ç½®äº†ï¼Œç›´æ¥é€šè¿‡webç•Œé¢æ¥è¿›è¡Œé…ç½®å³å¯ï¼Œè¿™é‡Œæˆ‘åªæ˜¯æ·»åŠ è¿›æ¥ï¼Œä¿ç•™ï¼ŒğŸ˜ğŸ˜ğŸ˜</p><h4 id="åŠ è½½å’Œå¯åŠ¨-harbor-é•œåƒ"><a href="#åŠ è½½å’Œå¯åŠ¨-harbor-é•œåƒ" class="headerlink" title="åŠ è½½å’Œå¯åŠ¨ harbor é•œåƒ"></a>åŠ è½½å’Œå¯åŠ¨ harbor é•œåƒ</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mkdir /data</span></span><br><span class="line"><span class="comment"># chmod 777 /var/run/docker.sock /data</span></span><br><span class="line"><span class="comment"># ./install.sh </span></span><br><span class="line"></span><br><span class="line">[Step 0]: checking installation environment ...</span><br><span class="line"></span><br><span class="line">Note: docker version: 19.03.2</span><br><span class="line"></span><br><span class="line">Note: docker-compose version: 1.24.1</span><br><span class="line"></span><br><span class="line">[Step 1]: loading Harbor images ...</span><br><span class="line">Loaded image: goharbor/harbor-portal:v1.9.0</span><br><span class="line">Loaded image: goharbor/harbor-core:v1.9.0</span><br><span class="line">Loaded image: goharbor/nginx-photon:v1.9.0</span><br><span class="line">Loaded image: goharbor/notary-signer-photon:v0.6.1-v1.9.0</span><br><span class="line">Loaded image: goharbor/registry-photon:v2.7.1-patch-2819-v1.9.0</span><br><span class="line">Loaded image: goharbor/harbor-migrator:v1.9.0</span><br><span class="line">Loaded image: goharbor/chartmuseum-photon:v0.9.0-v1.9.0</span><br><span class="line">Loaded image: goharbor/prepare:v1.9.0</span><br><span class="line">Loaded image: goharbor/harbor-log:v1.9.0</span><br><span class="line">Loaded image: goharbor/harbor-db:v1.9.0</span><br><span class="line">Loaded image: goharbor/clair-photon:v2.0.9-v1.9.0</span><br><span class="line">Loaded image: goharbor/harbor-jobservice:v1.9.0</span><br><span class="line">Loaded image: goharbor/harbor-registryctl:v1.9.0</span><br><span class="line">Loaded image: goharbor/redis-photon:v1.9.0</span><br><span class="line">Loaded image: goharbor/notary-server-photon:v0.6.1-v1.9.0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[Step 2]: preparing environment ...</span><br><span class="line">prepare base dir is <span class="built_in">set</span> to /opt/harbor</span><br><span class="line">Clearing the configuration file: /config/<span class="built_in">log</span>/logrotate.conf</span><br><span class="line">Clearing the configuration file: /config/<span class="built_in">log</span>/rsyslog_docker.conf</span><br><span class="line">Generated configuration file: /config/<span class="built_in">log</span>/logrotate.conf</span><br><span class="line">Generated configuration file: /config/<span class="built_in">log</span>/rsyslog_docker.conf</span><br><span class="line">Generated configuration file: /config/nginx/nginx.conf</span><br><span class="line">Generated configuration file: /config/core/env</span><br><span class="line">Generated configuration file: /config/core/app.conf</span><br><span class="line">Generated configuration file: /config/registry/config.yml</span><br><span class="line">Generated configuration file: /config/registryctl/env</span><br><span class="line">Generated configuration file: /config/db/env</span><br><span class="line">Generated configuration file: /config/jobservice/env</span><br><span class="line">Generated configuration file: /config/jobservice/config.yml</span><br><span class="line">Generated and saved secret to file: /secret/keys/secretkey</span><br><span class="line">Generated certificate, key file: /secret/core/private_key.pem, cert file: /secret/registry/root.crt</span><br><span class="line">Generated configuration file: /compose_location/docker-compose.yml</span><br><span class="line">Clean up the input dir</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[Step 3]: starting Harbor ...</span><br><span class="line">Creating network <span class="string">"harbor_harbor"</span> with the default driver</span><br><span class="line">Creating harbor-log ... <span class="keyword">done</span></span><br><span class="line">Creating registryctl   ... <span class="keyword">done</span></span><br><span class="line">Creating redis         ... <span class="keyword">done</span></span><br><span class="line">Creating harbor-portal ... <span class="keyword">done</span></span><br><span class="line">Creating harbor-db     ... <span class="keyword">done</span></span><br><span class="line">Creating registry      ... <span class="keyword">done</span></span><br><span class="line">Creating harbor-core   ... <span class="keyword">done</span></span><br><span class="line">Creating nginx             ... <span class="keyword">done</span></span><br><span class="line">Creating harbor-jobservice ... <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">âœ” ----Harbor has been installed and started successfully.----</span><br><span class="line"></span><br><span class="line">Now you should be able to visit the admin portal at http://reg.xxlaila.cn. </span><br><span class="line">For more details, please visit https://github.com/goharbor/harbor .</span><br></pre></td></tr></table></figure><h4 id="è®¿é—®ç®¡ç†ç•Œé¢"><a href="#è®¿é—®ç®¡ç†ç•Œé¢" class="headerlink" title="è®¿é—®ç®¡ç†ç•Œé¢"></a>è®¿é—®ç®¡ç†ç•Œé¢</h4><p>ç¡®è®¤æ‰€æœ‰ç»„ä»¶éƒ½å·¥ä½œæ­£å¸¸ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker-compose  ps</span></span><br><span class="line">      Name                     Command                       State                     Ports          </span><br><span class="line">------------------------------------------------------------------------------------------------------</span><br><span class="line">harbor-core         /harbor/harbor_core              Up (healthy)                                     </span><br><span class="line">harbor-db           /docker-entrypoint.sh            Up (healthy)            5432/tcp                 </span><br><span class="line">harbor-jobservice   /harbor/harbor_jobservice  ...   Up (health: starting)                            </span><br><span class="line">harbor-log          /bin/sh -c /usr/<span class="built_in">local</span>/bin/ ...   Up (healthy)            127.0.0.1:1514-&gt;10514/tcp</span><br><span class="line">harbor-portal       nginx -g daemon off;             Up (healthy)            8080/tcp                 </span><br><span class="line">nginx               nginx -g daemon off;             Up (healthy)            0.0.0.0:80-&gt;8080/tcp     </span><br><span class="line">redis               redis-server /etc/redis.conf     Up (healthy)            6379/tcp                 </span><br><span class="line">registry            /entrypoint.sh /etc/regist ...   Up (healthy)            5000/tcp                 </span><br><span class="line">registryctl         /harbor/start.sh                 Up (healthy)</span><br></pre></td></tr></table></figure><h5 id="harbor-ç»„å»ºä»‹ç»"><a href="#harbor-ç»„å»ºä»‹ç»" class="headerlink" title="harbor ç»„å»ºä»‹ç»"></a>harbor ç»„å»ºä»‹ç»</h5><ul><li>harbor-core:  Harborçš„æ ¸å¿ƒåŠŸèƒ½ï¼Œä¸»è¦æä¾›ä»¥ä¸‹æœåŠ¡ï¼š<ul><li>UIï¼šæä¾›å›¾å½¢åŒ–ç•Œé¢ï¼Œå¸®åŠ©ç”¨æˆ·ç®¡ç†registryä¸Šçš„é•œåƒï¼ˆimageï¼‰, å¹¶å¯¹ç”¨æˆ·è¿›è¡Œæˆæƒã€‚ </li><li>webhookï¼šä¸ºäº†åŠæ—¶è·å–registry ä¸ŠimageçŠ¶æ€å˜åŒ–çš„æƒ…å†µï¼Œ åœ¨Registryä¸Šé…ç½®webhookï¼ŒæŠŠçŠ¶æ€å˜åŒ–ä¼ é€’ç»™UIæ¨¡å—ã€‚</li><li>token æœåŠ¡ï¼šè´Ÿè´£æ ¹æ®ç”¨æˆ·æƒé™ç»™æ¯ä¸ªdocker push/pullå‘½ä»¤ç­¾å‘token. Docker å®¢æˆ·ç«¯å‘RegiÃ¸stryæœåŠ¡å‘èµ·çš„è¯·æ±‚,å¦‚æœä¸åŒ…å«tokenï¼Œä¼šè¢«é‡å®šå‘åˆ°è¿™é‡Œï¼Œè·å¾—tokenåå†é‡æ–°å‘Registryè¿›è¡Œè¯·æ±‚ã€‚</li></ul></li><li>harbor-db: ä¸ºcore servicesæä¾›æ•°æ®åº“æœåŠ¡ï¼Œè´Ÿè´£å‚¨å­˜ç”¨æˆ·æƒé™ã€å®¡è®¡æ—¥å¿—ã€Docker imageåˆ†ç»„ä¿¡æ¯ç­‰æ•°æ®ã€‚</li><li>harbor-jobservice: harbor-jobservice æ˜¯harborçš„jobç®¡ç†æ¨¡å—ï¼Œjobåœ¨harboré‡Œé¢ä¸»è¦æ˜¯ä¸ºäº†é•œåƒä»“åº“ä¹‹å‰åŒæ­¥ä½¿ç”¨çš„;</li><li>harbor-log: ä¸ºäº†å¸®åŠ©ç›‘æ§Harborè¿è¡Œï¼Œè´Ÿè´£æ”¶é›†å…¶ä»–ç»„ä»¶çš„logï¼Œä¾›æ—¥åè¿›è¡Œåˆ†æã€‚</li><li>nginx: nginxè´Ÿè´£æµé‡è½¬å‘å’Œå®‰å…¨éªŒè¯ï¼Œå¯¹å¤–æä¾›çš„æµé‡éƒ½æ˜¯ä»nginxä¸­è½¬ï¼Œæ‰€ä»¥å¼€æ”¾httpsçš„443ç«¯å£ï¼Œå®ƒå°†æµé‡åˆ†å‘åˆ°åç«¯çš„uiå’Œæ­£åœ¨dockeré•œåƒå­˜å‚¨çš„docker registryã€‚</li><li>redis: å­˜å‚¨ç¼“å­˜ä¿¡æ¯</li><li>registry: è´Ÿè´£å‚¨å­˜Dockeré•œåƒï¼Œå¹¶å¤„ç†docker push/pull å‘½ä»¤ã€‚ç”±äºæˆ‘ä»¬è¦å¯¹ç”¨æˆ·è¿›è¡Œè®¿é—®æ§åˆ¶ï¼Œå³ä¸åŒç”¨æˆ·å¯¹Docker imageæœ‰ä¸åŒçš„è¯»å†™æƒé™ï¼ŒRegistryä¼šæŒ‡å‘ä¸€ä¸ªtokenæœåŠ¡ï¼Œå¼ºåˆ¶ç”¨æˆ·çš„æ¯æ¬¡docker pull/pushè¯·æ±‚éƒ½è¦æºå¸¦ä¸€ä¸ªåˆæ³•çš„token, Registryä¼šé€šè¿‡å…¬é’¥å¯¹token è¿›è¡Œè§£å¯†éªŒè¯ã€‚</li><li>registryctl: æ˜¯harborçš„ç®¡ç†å‘˜é…ç½®harborçš„ä¸€äº›å¸¸ç”¨é…ç½®å’Œé«˜çº§é…ç½®</li></ul><p>åœ¨æµè§ˆå™¨è®¿é—®<a href="http://reg.xxlaila.cnï¼Œ" target="_blank" rel="noopener">http://reg.xxlaila.cnï¼Œ</a> ç”¨è´¦å· admin å’Œ harbor.yml é…ç½®æ–‡ä»¶ä¸­çš„é»˜è®¤å¯†ç  Harbor12345 ç™»é™†ç³»ç»Ÿ<br><img src="http://img.xxlaila.cn/8095d05-b9b7-4bdc-b0fc-7810db649e23.png" alt="img"><br><img src="http://img.xxlaila.cn/4bfab8be-e5de-4165-9268-fa591c5f12f8.png" alt="img"></p><h4 id="harbor-è¿è¡Œæ—¶äº§ç”Ÿçš„æ–‡ä»¶ã€ç›®å½•"><a href="#harbor-è¿è¡Œæ—¶äº§ç”Ÿçš„æ–‡ä»¶ã€ç›®å½•" class="headerlink" title="harbor è¿è¡Œæ—¶äº§ç”Ÿçš„æ–‡ä»¶ã€ç›®å½•"></a>harbor è¿è¡Œæ—¶äº§ç”Ÿçš„æ–‡ä»¶ã€ç›®å½•</h4><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;harbor å°†æ—¥å¿—æ‰“å°åˆ° /var/log/harbor çš„ç›¸å…³ç›®å½•ä¸‹ï¼Œä¼ ç»Ÿçš„docker logs XXX æˆ– docker-compose logs XXX çœ‹ä¸åˆ°å®¹å™¨çš„æ—¥å¿—ã€‚åªæœ‰ä½¿ç”¨å¸¸ç”¨ç³»ç»Ÿå‘½ä»¤æ¥è¿›è¡Œæ—¥å¿—çš„æŸ¥çœ‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># # æ—¥å¿—ç›®å½•</span></span><br><span class="line"><span class="comment"># ls /var/log/harbor</span></span><br><span class="line">core.log  jobservice.log  portal.log  postgresql.log  proxy.log  redis.log  registryctl.log  registry.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># # æ•°æ®ç›®å½•ï¼ŒåŒ…æ‹¬æ•°æ®åº“ã€é•œåƒä»“åº“</span></span><br><span class="line"><span class="comment"># ls /data/</span></span><br><span class="line">ca_download  database  job_logs  psc  redis  registry  secret</span><br></pre></td></tr></table></figure><h4 id="å…¶å®ƒæ“ä½œ"><a href="#å…¶å®ƒæ“ä½œ" class="headerlink" title="å…¶å®ƒæ“ä½œ"></a>å…¶å®ƒæ“ä½œ</h4><p>ä¸‹åˆ—æ“ä½œçš„å·¥ä½œç›®å½•å‡ä¸ºè§£å‹ç¦»çº¿å®‰è£…æ–‡ä»¶åç”Ÿæˆçš„ harbor ç›®å½•ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># # åœæ­¢ harbor</span></span><br><span class="line"><span class="comment"># docker-compose down -v</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># # å¯åŠ¨ harbor</span></span><br><span class="line"><span class="comment"># docker-compose up -d</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># # æ›´ä¿®æ”¹çš„é…ç½®æ›´æ–°åˆ° docker-compose.yml æ–‡ä»¶</span></span><br><span class="line"><span class="comment"># ./prepare</span></span><br><span class="line">prepare base dir is <span class="built_in">set</span> to /opt/harbor</span><br><span class="line">Clearing the configuration file: /config/<span class="built_in">log</span>/logrotate.conf</span><br><span class="line">Clearing the configuration file: /config/<span class="built_in">log</span>/rsyslog_docker.conf</span><br><span class="line">Clearing the configuration file: /config/nginx/nginx.conf</span><br><span class="line">Clearing the configuration file: /config/core/env</span><br><span class="line">Clearing the configuration file: /config/core/app.conf</span><br><span class="line">Clearing the configuration file: /config/registry/config.yml</span><br><span class="line">Clearing the configuration file: /config/registry/root.crt</span><br><span class="line">Clearing the configuration file: /config/registryctl/env</span><br><span class="line">Clearing the configuration file: /config/registryctl/config.yml</span><br><span class="line">Clearing the configuration file: /config/db/env</span><br><span class="line">Clearing the configuration file: /config/jobservice/env</span><br><span class="line">Clearing the configuration file: /config/jobservice/config.yml</span><br><span class="line">Generated configuration file: /config/<span class="built_in">log</span>/logrotate.conf</span><br><span class="line">Generated configuration file: /config/<span class="built_in">log</span>/rsyslog_docker.conf</span><br><span class="line">Generated configuration file: /config/nginx/nginx.conf</span><br><span class="line">Generated configuration file: /config/core/env</span><br><span class="line">Generated configuration file: /config/core/app.conf</span><br><span class="line">Generated configuration file: /config/registry/config.yml</span><br><span class="line">Generated configuration file: /config/registryctl/env</span><br><span class="line">Generated configuration file: /config/db/env</span><br><span class="line">Generated configuration file: /config/jobservice/env</span><br><span class="line">Generated configuration file: /config/jobservice/config.yml</span><br><span class="line">loaded secret from file: /secret/keys/secretkey</span><br><span class="line">Generated configuration file: /compose_location/docker-compose.yml</span><br><span class="line">Clean up the input dir</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;ä»‹ç»&quot;&gt;&lt;a href=&quot;#ä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;ä»‹ç»&quot;&gt;&lt;/a&gt;ä»‹ç»&lt;/h3&gt;&lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Harboræ˜¯ä¸€ä¸ªç”¨äºå­˜å‚¨å’Œåˆ†å‘Dockeré•œåƒçš„ä¼ä¸šçº§RegistryæœåŠ¡å™¨ï¼Œé€šè¿‡æ·»åŠ ä¸€äº›ä¼ä¸šå¿…éœ€çš„åŠŸèƒ½ç‰¹æ€§ï¼Œä¾‹å¦‚å®‰å…¨ã€æ ‡è¯†å’Œç®¡ç†ç­‰ï¼Œæ‰©å±•äº†å¼€æºDocker Distributionã€‚ä½œä¸ºä¸€ä¸ªä¼ä¸šçº§ç§æœ‰RegistryæœåŠ¡å™¨ï¼ŒHarboræä¾›äº†æ›´å¥½çš„æ€§èƒ½å’Œå®‰å…¨ã€‚æå‡ç”¨æˆ·ä½¿ç”¨Registryæ„å»ºå’Œè¿è¡Œç¯å¢ƒä¼ è¾“é•œåƒçš„æ•ˆç‡ã€‚Harboræ”¯æŒå®‰è£…åœ¨å¤šä¸ªRegistryèŠ‚ç‚¹çš„é•œåƒèµ„æºå¤åˆ¶ï¼Œé•œåƒå…¨éƒ¨ä¿å­˜åœ¨ç§æœ‰Registryä¸­ï¼Œ ç¡®ä¿æ•°æ®å’ŒçŸ¥è¯†äº§æƒåœ¨å…¬å¸å†…éƒ¨ç½‘ç»œä¸­ç®¡æ§ã€‚å¦å¤–ï¼ŒHarborä¹Ÿæä¾›äº†é«˜çº§çš„å®‰å…¨ç‰¹æ€§ï¼Œè¯¸å¦‚ç”¨æˆ·ç®¡ç†ï¼Œè®¿é—®æ§åˆ¶å’Œæ´»åŠ¨å®¡è®¡ç­‰ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="kubernetes" scheme="https://xxlaila.github.io//categories/kubernetes/"/>
    
    
      <category term="harbor" scheme="https://xxlaila.github.io//tags/harbor/"/>
    
  </entry>
  
  <entry>
    <title>k8s podå¥åº·æ£€æµ‹</title>
    <link href="https://xxlaila.github.io/2019/09/27/k8s-pod%E5%81%A5%E5%BA%B7%E6%A3%80%E6%B5%8B/"/>
    <id>https://xxlaila.github.io/2019/09/27/k8s-podå¥åº·æ£€æµ‹/</id>
    <published>2019-09-27T05:37:53.000Z</published>
    <updated>2019-09-29T03:25:26.771Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Podå¥åº·æ£€æµ‹æœºåˆ¶"><a href="#Podå¥åº·æ£€æµ‹æœºåˆ¶" class="headerlink" title="Podå¥åº·æ£€æµ‹æœºåˆ¶"></a>Podå¥åº·æ£€æµ‹æœºåˆ¶</h3><p>å¯¹äºPodçš„å¥åº·çŠ¶æ€æ£€æµ‹ï¼Œkubernetesæä¾›äº†ä¸¤ç±»æ¢é’ˆ(Probe)æ¥æ‰§è¡Œå¯¹Podçš„å¥åº·çŠ¶æ€æ£€æµ‹:</p><ul><li><strong>LivenessProbeæ¢é’ˆ</strong>:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ç”¨äºåˆ¤æ–­å®¹å™¨æ˜¯å¦å­˜æ´»ï¼Œå³Podæ˜¯å¦ä¸ºrunningçŠ¶æ€ï¼Œå¦‚æœLivenessProbeæ¢é’ˆæ¢æµ‹åˆ°å®¹å™¨ä¸å¥åº·ï¼Œåˆ™kubeletå°†killæ‰å®¹å™¨ï¼Œå¹¶æ ¹æ®å®¹å™¨çš„é‡å¯ç­–ç•¥æ˜¯å¦é‡å¯ï¼Œå¦‚æœä¸€ä¸ªå®¹å™¨ä¸åŒ…å«LivenessProbeæ¢é’ˆï¼Œåˆ™Kubeletè®¤ä¸ºå®¹å™¨çš„LivenessProbeæ¢é’ˆçš„è¿”å›å€¼æ°¸è¿œæˆåŠŸ.</li></ul><a id="more"></a><ul><li><strong>ReadinessProbeæ¢é’ˆ</strong>:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ç”¨äºåˆ¤æ–­å®¹å™¨æ˜¯å¦å¯åŠ¨å®Œæˆï¼Œå³å®¹å™¨çš„Readyæ˜¯å¦ä¸ºTrueï¼Œå¯ä»¥æ¥æ”¶è¯·æ±‚ï¼Œå¦‚æœReadinessProbeæ¢æµ‹å¤±è´¥ï¼Œåˆ™å®¹å™¨çš„Readyå°†ä¸ºFalseï¼Œæ§åˆ¶å™¨å°†æ­¤Podçš„Endpointä»å¯¹åº”çš„serviceçš„Endpointåˆ—è¡¨ä¸­ç§»é™¤ï¼Œä»æ­¤ä¸å†å°†ä»»ä½•è¯·æ±‚è°ƒåº¦æ­¤Podä¸Šï¼Œç›´åˆ°ä¸‹æ¬¡æ¢æµ‹æˆåŠŸã€‚</li></ul><!--more--><p>æ¯ç±»æ¢é’ˆéƒ½æ”¯æŒä¸‰ç§æ¢æµ‹æ–¹æ³•:</p><ul><li><strong>exec</strong>: é€šè¿‡æ‰§è¡Œå‘½ä»¤æ¥æ£€æŸ¥æœåŠ¡æ˜¯å¦æ­£å¸¸ï¼Œé’ˆå¯¹å¤æ‚æ£€æµ‹æˆ–æ— HTTPæ¥å£çš„æœåŠ¡ï¼Œå‘½ä»¤è¿”å›å€¼ä¸º0åˆ™è¡¨ç¤ºå®¹å™¨å¥åº·ã€‚</li><li><strong>httpGet</strong>: é€šè¿‡å‘é€httpè¯·æ±‚æ£€æŸ¥æœåŠ¡æ˜¯å¦æ­£å¸¸ï¼Œè¿”å›200-399çŠ¶æ€ç åˆ™è¡¨æ˜å®¹å™¨å¥åº·ã€‚</li><li><strong>tcpSocket</strong>: é€šè¿‡å®¹å™¨çš„IPå’ŒPortæ‰§è¡ŒTCPæ£€æŸ¥ï¼Œå¦‚æœèƒ½å¤Ÿå»ºç«‹TCPè¿æ¥ï¼Œåˆ™è¡¨æ˜å®¹å™¨å¥åº·ã€‚</li></ul><p>æ¢é’ˆæ¢æµ‹çš„ç»“æœæœ‰ä»¥ä¸‹ä¸‰è€…ä¹‹ä¸€:</p><ul><li><strong>Success</strong>: Containeré€šè¿‡äº†æ£€æŸ¥</li><li><strong>Failure</strong>: Containeræœªé€šè¿‡æ£€æŸ¥</li><li><strong>Unknown</strong>: æœªèƒ½æ‰§è¡Œæ£€æŸ¥ï¼Œå› æ­¤ä¸é‡‡å–ä»»ä½•æªæ–½</li></ul><h3 id="LivenessProbeæ¢é’ˆé…ç½®"><a href="#LivenessProbeæ¢é’ˆé…ç½®" class="headerlink" title="LivenessProbeæ¢é’ˆé…ç½®"></a>LivenessProbeæ¢é’ˆé…ç½®</h3><h4 id="ä¾‹ä¸€ï¼šé€šè¿‡execæ–¹å¼åšå¥åº·æ¢æµ‹"><a href="#ä¾‹ä¸€ï¼šé€šè¿‡execæ–¹å¼åšå¥åº·æ¢æµ‹" class="headerlink" title="ä¾‹ä¸€ï¼šé€šè¿‡execæ–¹å¼åšå¥åº·æ¢æµ‹"></a>ä¾‹ä¸€ï¼šé€šè¿‡execæ–¹å¼åšå¥åº·æ¢æµ‹</h4><ul><li>exec-liveness.yaml<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$ cat &gt; <span class="built_in">exec</span>-liveness.yaml &lt;&lt;EOF</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    <span class="built_in">test</span>: liveness</span><br><span class="line">  name: liveness-exec</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: liveness</span><br><span class="line">    image: busybox</span><br><span class="line">    args:</span><br><span class="line">    - /bin/sh</span><br><span class="line">    - -c</span><br><span class="line">    - touch /tmp/healthy; sleep 30; rm -rf /tmp/healthy; sleep 600</span><br><span class="line">    livenessProbe:</span><br><span class="line">      <span class="built_in">exec</span>:</span><br><span class="line">        <span class="built_in">command</span>:</span><br><span class="line">        - cat</span><br><span class="line">        - /tmp/healthy</span><br><span class="line">      initialDelaySeconds: 5</span><br><span class="line">      periodSeconds: 5</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure></li></ul><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;åœ¨è¯¥é…ç½®æ–‡ä»¶ä¸­ï¼Œå¯¹å®¹å™¨æ‰§è¡ŒlivenessProbeæ£€æŸ¥ï¼ŒperiodSecondså­—æ®µæŒ‡å®škubeletæ¯5sæ‰§è¡Œä¸€æ¬¡æ£€æŸ¥ï¼Œæ£€æŸ¥çš„å‘½ä»¤ä¸ºcat /tmp/healthyï¼ŒinitialDelaySecondså­—æ®µå‘Šè¯‰kubeletåº”è¯¥åœ¨æ‰§è¡Œç¬¬ä¸€æ¬¡æ£€æŸ¥ä¹‹å‰ç­‰å¾…5ç§’ï¼Œå¦‚æœå‘½ä»¤æ‰§è¡ŒæˆåŠŸï¼Œåˆ™è¿”å›0ï¼Œé‚£ä¹ˆkubeletå°±è®¤ä¸ºå®¹å™¨æ˜¯å¥åº·çš„ï¼Œå¦‚æœä¸ºé0ï¼Œåˆ™Kubeletä¼šKillæ‰å®¹å™¨å¹¶æ ¹æ®é‡å¯ç­–ç•¥æ¥å†³å®šæ˜¯å¦éœ€è¦é‡å¯ã€‚</p><ul><li>å½“å®¹å™¨å¯åŠ¨æ—¶ï¼Œå®ƒä¼šæ‰§è¡Œä»¥ä¸‹å‘½ä»¤<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/bin/sh -c <span class="string">"touch /tmp/healthy; sleep 30; rm -rf /tmp/healthy; sleep 600"</span></span><br></pre></td></tr></table></figure></li></ul><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å¯¹äºå®¹å™¨çš„å‰30ç§’ï¼Œæœ‰ä¸€ä¸ª/tmp/healthyæ–‡ä»¶ã€‚å› æ­¤ï¼Œåœ¨å‰30ç§’å†…ï¼Œè¯¥å‘½ä»¤cat /tmp/healthyè¿”å›æˆåŠŸä»£ç ã€‚30ç§’åï¼Œcat /tmp/healthyè¿”å›å¤±è´¥ä»£ç ã€‚</p><ul><li><p>åˆ›å»ºPod</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$  kubectl create -f  <span class="built_in">exec</span>-liveness.yaml </span><br><span class="line">pod/liveness-exec created</span><br></pre></td></tr></table></figure></li><li><p>åœ¨30ç§’å†…ï¼ŒæŸ¥çœ‹Podäº‹ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl describe pod liveness-exec</span><br><span class="line">â€¦â€¦â€¦â€¦</span><br><span class="line">QoS Class:       BestEffort</span><br><span class="line">Node-Selectors:  &lt;none&gt;</span><br><span class="line">Tolerations:     node.kubernetes.io/not-ready:NoExecute <span class="keyword">for</span> 360s</span><br><span class="line">                 node.kubernetes.io/unreachable:NoExecute <span class="keyword">for</span> 360s</span><br><span class="line">Events:</span><br><span class="line">  Type    Reason     Age   From                   Message</span><br><span class="line">  ----    ------     ----  ----                   -------</span><br><span class="line">  Normal  Scheduled  23s   default-scheduler      Successfully assigned default/liveness-exec to 172.21.17.34</span><br><span class="line">  Normal  Pulling    20s   kubelet, 172.21.17.34  Pulling image <span class="string">"busybox"</span></span><br><span class="line">  Normal  Pulled     2s    kubelet, 172.21.17.34  Successfully pulled image <span class="string">"busybox"</span></span><br><span class="line">  Normal  Created    2s    kubelet, 172.21.17.34  Created container liveness</span><br><span class="line">  Normal  Started    1s    kubelet, 172.21.17.34  Started container liveness</span><br></pre></td></tr></table></figure></li><li><p>35ç§’åï¼Œå†æ¬¡æŸ¥çœ‹Podäº‹ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl describe pod liveness-exec</span><br><span class="line">â€¦â€¦â€¦â€¦</span><br><span class="line">Tolerations:     node.kubernetes.io/not-ready:NoExecute <span class="keyword">for</span> 360s</span><br><span class="line">                 node.kubernetes.io/unreachable:NoExecute <span class="keyword">for</span> 360s</span><br><span class="line">Events:</span><br><span class="line">  Type     Reason     Age              From                   Message</span><br><span class="line">  ----     ------     ----             ----                   -------</span><br><span class="line">  Normal   Scheduled  58s              default-scheduler      Successfully assigned default/liveness-exec to 172.21.17.34</span><br><span class="line">  Normal   Pulling    55s              kubelet, 172.21.17.34  Pulling image <span class="string">"busybox"</span></span><br><span class="line">  Normal   Pulled     37s              kubelet, 172.21.17.34  Successfully pulled image <span class="string">"busybox"</span></span><br><span class="line">  Normal   Created    37s              kubelet, 172.21.17.34  Created container liveness</span><br><span class="line">  Normal   Started    36s              kubelet, 172.21.17.34  Started container liveness</span><br><span class="line">  Warning  Unhealthy  0s (x2 over 5s)  kubelet, 172.21.17.34  Liveness probe failed: cat: can<span class="string">'t open '</span>/tmp/healthy<span class="string">': No such file or directory</span></span><br></pre></td></tr></table></figure></li><li><p>å†ç­‰30ç§’ï¼Œç¡®è®¤Containerå·²é‡æ–°å¯åŠ¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get pod liveness-exec</span><br><span class="line">NAME            READY   STATUS    RESTARTS   AGE</span><br><span class="line">liveness-exec   1/1     Running   1          115s</span><br><span class="line"></span><br><span class="line">$ kubectl describe pod liveness-exec</span><br><span class="line">â€¦â€¦â€¦â€¦â€¦â€¦</span><br><span class="line">QoS Class:       BestEffort</span><br><span class="line">Node-Selectors:  &lt;none&gt;</span><br><span class="line">Tolerations:     node.kubernetes.io/not-ready:NoExecute <span class="keyword">for</span> 360s</span><br><span class="line">                 node.kubernetes.io/unreachable:NoExecute <span class="keyword">for</span> 360s</span><br><span class="line">Events:</span><br><span class="line">  Type     Reason     Age                 From                   Message</span><br><span class="line">  ----     ------     ----                ----                   -------</span><br><span class="line">  Normal   Scheduled  2m7s                default-scheduler      Successfully assigned default/liveness-exec to 172.21.17.34</span><br><span class="line">  Warning  Unhealthy  64s (x3 over 74s)   kubelet, 172.21.17.34  Liveness probe failed: cat: can<span class="string">'t open '</span>/tmp/healthy<span class="string">': No such file or directory</span></span><br><span class="line"><span class="string">  Normal   Killing    64s                 kubelet, 172.21.17.34  Container liveness failed liveness probe, will be restarted</span></span><br><span class="line"><span class="string">  Normal   Pulling    34s (x2 over 2m4s)  kubelet, 172.21.17.34  Pulling image "busybox"</span></span><br><span class="line"><span class="string">  Normal   Pulled     25s (x2 over 106s)  kubelet, 172.21.17.34  Successfully pulled image "busybox"</span></span><br><span class="line"><span class="string">  Normal   Created    25s (x2 over 106s)  kubelet, 172.21.17.34  Created container liveness</span></span><br><span class="line"><span class="string">  Normal   Started    25s (x2 over 105s)  kubelet, 172.21.17.34  Started container liveness</span></span><br></pre></td></tr></table></figure></li></ul><h4 id="ä¾‹äºŒ-é€šè¿‡HTTPæ–¹å¼åšå¥åº·æ¢æµ‹"><a href="#ä¾‹äºŒ-é€šè¿‡HTTPæ–¹å¼åšå¥åº·æ¢æµ‹" class="headerlink" title="ä¾‹äºŒ: é€šè¿‡HTTPæ–¹å¼åšå¥åº·æ¢æµ‹"></a>ä¾‹äºŒ: é€šè¿‡HTTPæ–¹å¼åšå¥åº·æ¢æµ‹</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$ cat &gt; http-liveness.yaml &lt;&lt;EOF</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    <span class="built_in">test</span>: liveness</span><br><span class="line">  name: liveness-http</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: liveness</span><br><span class="line">    image: carlziess/liveness</span><br><span class="line">    args:</span><br><span class="line">    - /server</span><br><span class="line">    livenessProbe:</span><br><span class="line">      httpGet:</span><br><span class="line">        path: /healthz</span><br><span class="line">        port: 8080</span><br><span class="line">        httpHeaders:</span><br><span class="line">        - name: X-Custom-Header</span><br><span class="line">          value: Awesome</span><br><span class="line">      initialDelaySeconds: 3</span><br><span class="line">      periodSeconds: 3</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;åˆ›å»ºä¸€ä¸ªPodï¼Œå…¶ä¸­periodSecondså­—æ®µæŒ‡å®škubeletæ¯3ç§’æ‰§è¡Œä¸€æ¬¡æ¢æµ‹ï¼ŒinitialDelaySecondså­—æ®µå‘Šè¯‰kubeletå»¶è¿Ÿç­‰å¾…3ç§’ï¼Œæ¢æµ‹æ–¹å¼ä¸ºå‘å®¹å™¨ä¸­è¿è¡Œçš„æœåŠ¡å‘é€HTTP GETè¯·æ±‚ï¼Œè¯·æ±‚8080ç«¯å£ä¸‹çš„/healthz, ä»»ä½•å¤§äºæˆ–ç­‰äº200ä¸”å°äº400çš„ä»£ç è¡¨ç¤ºæˆåŠŸã€‚ä»»ä½•å…¶ä»–ä»£ç è¡¨ç¤ºå¤±è´¥ã€‚</p><ul><li><p>åˆ›å»ºpod</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl apply -f http-liveness.yaml </span><br><span class="line">pod/liveness-http created</span><br></pre></td></tr></table></figure></li><li><p>æ£€æŸ¥éªŒè¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl describe pod liveness-http</span><br><span class="line">â€¦â€¦â€¦â€¦â€¦â€¦</span><br><span class="line">Node-Selectors:  &lt;none&gt;</span><br><span class="line">Tolerations:     node.kubernetes.io/not-ready:NoExecute <span class="keyword">for</span> 360s</span><br><span class="line">                 node.kubernetes.io/unreachable:NoExecute <span class="keyword">for</span> 360s</span><br><span class="line">Events:</span><br><span class="line">  Type     Reason     Age                   From                   Message</span><br><span class="line">  ----     ------     ----                  ----                   -------</span><br><span class="line">  Normal   Scheduled  2m59s                 default-scheduler      Successfully assigned default/liveness-http to 172.21.17.34</span><br><span class="line">  Normal   Pulled     119s (x3 over 2m46s)  kubelet, 172.21.17.34  Successfully pulled image <span class="string">"carlziess/liveness"</span></span><br><span class="line">  Normal   Created    119s (x3 over 2m46s)  kubelet, 172.21.17.34  Created container liveness</span><br><span class="line">  Normal   Started    118s (x3 over 2m45s)  kubelet, 172.21.17.34  Started container liveness</span><br><span class="line"></span><br><span class="line">$ kubectl get pod</span><br><span class="line">NAME            READY   STATUS    RESTARTS   AGE</span><br><span class="line">liveness-http   1/1     Running   0          26s</span><br></pre></td></tr></table></figure></li><li><p><strong>httpGet</strong>æ¢æµ‹æ–¹å¼æœ‰å¦‚ä¸‹å¯é€‰çš„æ§åˆ¶å­—æ®µ</p><ul><li>host: è¦è¿æ¥çš„ä¸»æœºåï¼Œé»˜è®¤ä¸ºPod IPï¼Œå¯ä»¥åœ¨http request headä¸­è®¾ç½®hostå¤´éƒ¨ã€‚</li><li>scheme: ç”¨äºè¿æ¥hostçš„åè®®ï¼Œé»˜è®¤ä¸ºHTTPã€‚</li><li>path: httpæœåŠ¡å™¨ä¸Šçš„è®¿é—®URL</li><li>httpHeaders: è‡ªå®šä¹‰HTTPè¯·æ±‚headersï¼ŒHTTPå…è®¸é‡å¤headers</li><li>port: å®¹å™¨ä¸Šè¦è®¿é—®ç«¯å£å·æˆ–åç§°</li></ul></li></ul><h4 id="ä¾‹ä¸‰-é€šè¿‡TCPæ–¹å¼åšå¥åº·æ¢æµ‹"><a href="#ä¾‹ä¸‰-é€šè¿‡TCPæ–¹å¼åšå¥åº·æ¢æµ‹" class="headerlink" title="ä¾‹ä¸‰: é€šè¿‡TCPæ–¹å¼åšå¥åº·æ¢æµ‹"></a>ä¾‹ä¸‰: é€šè¿‡TCPæ–¹å¼åšå¥åº·æ¢æµ‹</h4><p>Kubeletå°†å°è¯•åœ¨æŒ‡å®šçš„ç«¯å£ä¸Šæ‰“å¼€å®¹å™¨ä¸Šçš„å¥—æ¥å­—ï¼Œå¦‚æœèƒ½å»ºç«‹è¿æ¥ï¼Œåˆ™è¡¨æ˜å®¹å™¨å¥åº·ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ cat &gt; tcp-liveness-readiness.yaml &lt;&lt;EOF</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: goproxy</span><br><span class="line">  labels:</span><br><span class="line">    app: goproxy</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: goproxy</span><br><span class="line">    image: goproxy/goproxy</span><br><span class="line">    ports:</span><br><span class="line">    - containerPort: 8080</span><br><span class="line">    readinessProbe:</span><br><span class="line">      tcpSocket:</span><br><span class="line">        port: 8080</span><br><span class="line">      initialDelaySeconds: 5</span><br><span class="line">      periodSeconds: 10</span><br><span class="line">    livenessProbe:</span><br><span class="line">      tcpSocket:</span><br><span class="line">        port: 8080</span><br><span class="line">      initialDelaySeconds: 15</span><br><span class="line">      periodSeconds: 20</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TCPæ£€æŸ¥æ–¹å¼å’ŒHTTPæ£€æŸ¥æ–¹å¼éå¸¸ç›¸ä¼¼ï¼Œç¤ºä¾‹ä¸­ä¸¤ç§æ¢é’ˆéƒ½ä½¿ç”¨äº†ï¼Œåœ¨å®¹å™¨å¯åŠ¨5ç§’åï¼Œkubeletå°†å‘é€ç¬¬ä¸€ä¸ªreadinessProbeæ¢é’ˆï¼Œè¿™å°†è¿æ¥åˆ°å®¹å™¨çš„8080ç«¯å£ï¼Œå¦‚æœæ¢æµ‹æˆåŠŸï¼Œåˆ™è¯¥Podå°†è¢«æ ‡è¯†ä¸ºreadyï¼Œ10ç§’åï¼Œkubeletå°†è¿›è¡Œç¬¬äºŒæ¬¡è¿æ¥ã€‚<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;é™¤æ­¤ï¼Œé…ç½®è¿˜åŒ…å«äº†livenessProbeæ¢é’ˆï¼Œåœ¨å®¹å™¨å¯åŠ¨15ç§’åï¼Œkubeletå°†å‘é€ç¬¬ä¸€ä¸ªlivenessProbeæ¢é’ˆï¼Œä»ç„¶å°è¯•è¿æ¥å®¹å™¨çš„8080ç«¯å£ï¼Œå¦‚æœè¿æ¥å¤±è´¥åˆ™é‡å¯å®¹å™¨ã€‚</p><ul><li><p>æ‰§è¡Œåˆ›å»º</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl apply -f tcp-liveness-readiness.yaml</span><br><span class="line">pod/goproxy created</span><br></pre></td></tr></table></figure></li><li><p>15ç§’åï¼ŒæŸ¥çœ‹Podäº‹ä»¶ä»¥éªŒè¯æ´»åŠ¨æ¢æµ‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl describe pod goproxy</span><br><span class="line">â€¦â€¦â€¦â€¦â€¦â€¦</span><br><span class="line">Node-Selectors:  &lt;none&gt;</span><br><span class="line">Tolerations:     node.kubernetes.io/not-ready:NoExecute <span class="keyword">for</span> 360s</span><br><span class="line">                 node.kubernetes.io/unreachable:NoExecute <span class="keyword">for</span> 360s</span><br><span class="line">Events:</span><br><span class="line">  Type    Reason     Age   From                    Message</span><br><span class="line">  ----    ------     ----  ----                    -------</span><br><span class="line">  Normal  Scheduled  26s   default-scheduler       Successfully assigned default/goproxy to 172.21.16.231</span><br><span class="line">  Normal  Pulling    22s   kubelet, 172.21.16.231  Pulling image <span class="string">"goproxy/goproxy"</span></span><br></pre></td></tr></table></figure></li></ul><p>å½“å®¹å™¨æœ‰å¤šä¸ªç«¯å£æ—¶ï¼Œé€šå¸¸ä¼šç»™æ¯ä¸ªç«¯å£å‘½åï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨æ¢é’ˆæ¢æµ‹æ—¶ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å†™è‡ªå®šä¹‰çš„ç«¯å£åç§°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ports:</span><br><span class="line">- name: liveness-port</span><br><span class="line">  containerPort: 8080</span><br><span class="line">  hostPort: 8080</span><br><span class="line">livenessProbe:</span><br><span class="line">  httpGet:</span><br><span class="line">    path: /healthz</span><br><span class="line">    port: liveness-port</span><br></pre></td></tr></table></figure><h3 id="ReadinessProbeæ¢é’ˆé…ç½®"><a href="#ReadinessProbeæ¢é’ˆé…ç½®" class="headerlink" title="ReadinessProbeæ¢é’ˆé…ç½®"></a>ReadinessProbeæ¢é’ˆé…ç½®</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ReadinessProbeæ¢é’ˆçš„ä½¿ç”¨åœºæ™¯livenessProbeç¨æœ‰ä¸åŒï¼Œæœ‰çš„æ—¶å€™åº”ç”¨ç¨‹åºå¯èƒ½æš‚æ—¶æ— æ³•æ¥å—è¯·æ±‚ï¼Œæ¯”å¦‚Podå·²ç»Runningäº†ï¼Œä½†æ˜¯å®¹å™¨å†…åº”ç”¨ç¨‹åºå°šæœªå¯åŠ¨æˆåŠŸï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœæ²¡æœ‰ReadinessProbeï¼Œåˆ™Kubernetesè®¤ä¸ºå®ƒå¯ä»¥å¤„ç†è¯·æ±‚äº†ï¼Œç„¶è€Œæ­¤æ—¶ï¼Œæˆ‘ä»¬çŸ¥é“ç¨‹åºè¿˜æ²¡å¯åŠ¨æˆåŠŸæ˜¯ä¸èƒ½æ¥æ”¶ç”¨æˆ·è¯·æ±‚çš„ï¼Œæ‰€ä»¥ä¸å¸Œæœ›kubernetesæŠŠè¯·æ±‚è°ƒåº¦ç»™å®ƒï¼Œåˆ™ä½¿ç”¨ReadinessProbeæ¢é’ˆã€‚<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ReadinessProbeå’ŒlivenessProbeå¯ä»¥ä½¿ç”¨ç›¸åŒæ¢æµ‹æ–¹å¼ï¼Œåªæ˜¯å¯¹Podçš„å¤„ç½®æ–¹å¼ä¸åŒï¼ŒReadinessProbeæ˜¯å°†Pod IP:Portä»å¯¹åº”çš„EndPointåˆ—è¡¨ä¸­åˆ é™¤ï¼Œè€ŒlivenessProbeåˆ™Killå®¹å™¨å¹¶æ ¹æ®Podçš„é‡å¯ç­–ç•¥æ¥å†³å®šä½œå‡ºå¯¹åº”çš„æªæ–½ã€‚<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æ¢é’ˆæ¢æµ‹å®¹å™¨æ˜¯å¦å·²å‡†å¤‡å°±ç»ªï¼Œå¦‚æœæœªå‡†å¤‡å°±ç»ªåˆ™kubernetesä¸ä¼šå°†æµé‡è½¬å‘ç»™æ­¤Podã€‚</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ReadinessProbeæ¢é’ˆä¸livenessProbeä¸€æ ·ä¹Ÿæ”¯æŒexecã€httpGetã€TCPçš„æ¢æµ‹æ–¹å¼ï¼Œé…ç½®æ–¹å¼ç›¸åŒï¼Œåªä¸è¿‡æ˜¯å°†livenessProbeå­—æ®µä¿®æ”¹ä¸ºReadinessProbeã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">readinessProbe:</span><br><span class="line">  <span class="built_in">exec</span>:</span><br><span class="line">    <span class="built_in">command</span>:</span><br><span class="line">    - cat</span><br><span class="line">    - /tmp/healthy</span><br><span class="line">  initialDelaySeconds: 5</span><br><span class="line">  periodSeconds: 5</span><br></pre></td></tr></table></figure><p>ReadinessProbeæ¢é’ˆçš„HTTPã€TCPçš„æ¢æµ‹æ–¹å¼ä¹Ÿä¸livenessProbeçš„åŸºæœ¬ä¸€è‡´ã€‚</p><h4 id="ä¾‹å››-ReadinessProbeç¤ºä¾‹"><a href="#ä¾‹å››-ReadinessProbeç¤ºä¾‹" class="headerlink" title="ä¾‹å››: ReadinessProbeç¤ºä¾‹"></a>ä¾‹å››: ReadinessProbeç¤ºä¾‹</h4><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;åŠ å…¥ReadinessProbeæ¢é’ˆå’Œä¸€ä¸ªæ²¡æœ‰ReadinessProbeæ¢é’ˆçš„ç¤ºä¾‹ï¼Œè¯¥ç¤ºä¾‹ä¸­ï¼Œåˆ›å»ºäº†ä¸€ä¸ªdeployï¼Œåä¸ºJavaAppï¼Œå¯åŠ¨çš„å®¹å™¨è¿è¡Œä¸€ä¸ªjavaåº”ç”¨ç¨‹åºï¼Œç¨‹åºç›‘å¬ç«¯å£ä¸º9093ã€‚</p><ul><li><p>æ²¡æœ‰ReadinessProbe</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">$ cat &gt; k8s.yaml &lt;&lt; EOF</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: biz-gateway</span><br><span class="line">  labels:</span><br><span class="line">    app: biz-gateway</span><br><span class="line">  namespace:</span><br><span class="line">spec:</span><br><span class="line">  ports:</span><br><span class="line">  - port: 9093</span><br><span class="line">    name: biz-gateway</span><br><span class="line">  selector:</span><br><span class="line">    app: biz-gateway</span><br><span class="line">---</span><br><span class="line">apiVersion: extensions/v1beta1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: biz-gateway</span><br><span class="line">  namespace:</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: biz-gateway</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: biz-gateway</span><br><span class="line">        image: docker.io/xxlaila/biz-gateway:dev-08c8a4e</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 9093</span><br><span class="line">        env:</span><br><span class="line">        - name: RUN_ENV</span><br><span class="line">          value: dev</span><br><span class="line">        - name: CONFIG_API_SERVER</span><br><span class="line">          value: http://api.conf.xxlaila.cn</span><br><span class="line">        - name: RUN_CLUSTER</span><br><span class="line">          value: default</span><br><span class="line">        - name: RUN_MODE</span><br><span class="line">          value: AUTO</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure></li><li><p>æ‰§è¡Œåˆ›å»º</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl apply -f k8s.yaml </span><br><span class="line">service/biz-gateway created</span><br><span class="line">deployment.extensions/biz-gateway created</span><br></pre></td></tr></table></figure></li><li><p>åˆšåˆ›å»ºåï¼Œç­‰ä¸€ä¼šåï¼ŒæŸ¥çœ‹PodçŠ¶æ€ï¼Œè®°ç€è¦ç»™imageç•™ä¸‹pullçš„æ—¶é—´</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get pods  |grep <span class="string">"biz-gateway"</span></span><br><span class="line">NAME                          READY   STATUS    RESTARTS   AGE</span><br><span class="line">biz-gateway-95f6b677f-rnz22   1/1     Running   0          2m8s</span><br></pre></td></tr></table></figure></li></ul><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å¯ä»¥çœ‹åˆ°ï¼Œæ•´ä¸ªè¿‡ç¨‹Podç”¨äº†2m8sï¼Œè‡ªèº«çŠ¶æ€å·²Runningï¼Œå…¶READå­—æ®µï¼Œ1/1 è¡¨ç¤º1ä¸ªå®¹å™¨çŠ¶æ€å·²å‡†å¤‡å°±ç»ªäº†ï¼Œæ­¤æ—¶ï¼Œå¯¹äºkubernetesè€Œè¨€ï¼Œå·²ç»å¯ä»¥æ¥æ”¶è¯·æ±‚äº†,è€Œå®é™…ä¸ŠæœåŠ¡è¿˜æ— æ³•è®¿é—®ï¼Œå› ä¸ºJAVAç¨‹åºè¿˜å°šå¯åŠ¨èµ·æ¥ï¼Œ2m8ssåæ–¹å¯æ­£å¸¸è®¿é—®ï¼Œæ‰€ä»¥é’ˆå¯¹æ­¤ç±»ç¨‹åºï¼Œå¿…é¡»é…ç½®ReadinessProbeã€‚</p><ul><li>åŠ å…¥readinessProbe<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">$ cat &gt; k8s.yaml &lt;&lt; EOF</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: biz-gateway</span><br><span class="line">  labels:</span><br><span class="line">    app: biz-gateway</span><br><span class="line">  namespace:</span><br><span class="line">spec:</span><br><span class="line">  ports:</span><br><span class="line">  - protocol: TCP</span><br><span class="line">    port: 9093</span><br><span class="line">    name: biz-gateway</span><br><span class="line">  selector:</span><br><span class="line">    app: biz-gateway</span><br><span class="line">---</span><br><span class="line">apiVersion: extensions/v1beta1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: biz-gateway</span><br><span class="line">  namespace:</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: biz-gateway</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: biz-gateway</span><br><span class="line">        image: docker.io/xxlaila/biz-gateway:dev-08c8a4e</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 9093</span><br><span class="line">        readinessProbe:</span><br><span class="line">          tcpSocket:</span><br><span class="line">            port: 9093</span><br><span class="line">          initialDelaySeconds: 140</span><br><span class="line">          periodSeconds: 10</span><br><span class="line">        env:</span><br><span class="line">        - name: RUN_ENV</span><br><span class="line">          value: dev</span><br><span class="line">        - name: CONFIG_API_SERVER</span><br><span class="line">          value: http://api.conf.xxlaila.cn</span><br><span class="line">        - name: RUN_CLUSTER</span><br><span class="line">          value: default</span><br><span class="line">        - name: RUN_MODE</span><br><span class="line">          value: AUTO</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure></li></ul><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;åœ¨è¯¥é…ç½®æ–‡ä»¶ä¸­ï¼ŒReadinessProbeæ¢é’ˆçš„æ¢æµ‹æ–¹å¼ä¸ºtcpSocketï¼Œå› ä¸ºç¨‹åºç›‘å¬åœ¨9093ç«¯å£ï¼Œæ‰€ä»¥è¿™é‡Œæ¢æµ‹ä¸ºå¯¹9093å»ºç«‹è¿æ¥,è¿™é‡Œç¬¬ä¸€æ¬¡æ¢æµ‹æ—¶é—´æ˜¯åœ¨Pod Runingå140ç§’åï¼Œé—´éš”10ç§’åæ‰§è¡Œç¬¬äºŒæ¬¡æ¢æµ‹ã€‚</p><ul><li><p>åˆ›å»º</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f ./</span><br><span class="line">service/biz-gateway created</span><br><span class="line">deployment.extensions/biz-gateway created</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹éªŒè¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºåç­‰å¾…äº†60s</span></span><br><span class="line">$ kubectl get pod -o wide</span><br><span class="line">NAME                          READY   STATUS    RESTARTS   AGE   IP            NODE           NOMINATED NODE   READINESS GATES</span><br><span class="line">biz-gateway-f69cc8678-qs8s7   0/1     Running   0          60s   172.30.56.6   172.21.17.40   &lt;none&gt;           &lt;none&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»§ç»­ç­‰å¾…ä¸€ä¼š</span></span><br><span class="line">$ kubectl get pod -o wide</span><br><span class="line">NAME                          READY   STATUS    RESTARTS   AGE     IP            NODE           NOMINATED NODE   READINESS GATES</span><br><span class="line">biz-gateway-f69cc8678-qs8s7   1/1     Running   0          2m36s   172.30.56.6   172.21.17.40   &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></table></figure></li></ul><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å¯ä»¥çœ‹åˆ°åœ¨2m36ç§’åï¼Œpodå¯åŠ¨okï¼Œåœ¨ç¬¬ä¸€æ¬¡æŸ¥çœ‹çš„æ—¶å€™ï¼ŒPodè™½ç„¶å·²å¤„äºRunnigçŠ¶æ€ï¼Œä½†æ˜¯ç”±äºç¬¬ä¸€æ¬¡æ¢æµ‹æ—¶é—´æœªåˆ°ï¼Œæ‰€ä»¥READYå­—æ®µä¸º0/1ï¼Œå³å®¹å™¨çš„çŠ¶æ€ä¸ºæœªå‡†å¤‡å°±ç»ªï¼Œåœ¨æœªå‡†å¤‡å°±ç»ªçš„æƒ…å†µä¸‹ï¼Œå…¶Podå¯¹åº”çš„Serviceä¸‹çš„Endpointä¹Ÿä¸ºç©ºï¼Œæ‰€ä»¥æ‰ä¸ä¼šæœ‰ä»»ä½•è¯·æ±‚è¢«è°ƒåº¦è¿›æ¥ã€‚</p><ul><li>æŸ¥çœ‹Endpoint<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¬¬ä¸€æ¬¡æ‰§è¡Œ</span></span><br><span class="line">$ kubectl get endpoints</span><br><span class="line">NAME          ENDPOINTS                                                AGE</span><br><span class="line">biz-gateway                                                            57s</span><br><span class="line">kubernetes    172.21.16.110:6443,172.21.17.30:6443,172.21.17.31:6443   13d</span><br><span class="line"></span><br><span class="line">åœ¨2m36sååœ¨æ¬¡æ‰§è¡Œ</span><br><span class="line">$ kubectl get endpoints</span><br><span class="line">NAME          ENDPOINTS                                                AGE</span><br><span class="line">biz-gateway   172.30.56.6:9093                                         2m41s</span><br><span class="line">kubernetes    172.21.16.110:6443,172.21.17.30:6443,172.21.17.31:6443   13d</span><br></pre></td></tr></table></figure></li></ul><h3 id="é…ç½®æ¢é’ˆ-Probe-ç›¸å…³å±æ€§"><a href="#é…ç½®æ¢é’ˆ-Probe-ç›¸å…³å±æ€§" class="headerlink" title="é…ç½®æ¢é’ˆ(Probe)ç›¸å…³å±æ€§"></a>é…ç½®æ¢é’ˆ(Probe)ç›¸å…³å±æ€§</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æ¢é’ˆ(Probe)æœ‰è®¸å¤šå¯é€‰å­—æ®µï¼Œå¯ä»¥ç”¨æ¥æ›´åŠ ç²¾ç¡®çš„æ§åˆ¶Livenesså’ŒReadinessä¸¤ç§æ¢é’ˆçš„è¡Œä¸º(Probe)ï¼š</p><ul><li>initialDelaySecondsï¼šPodå¯åŠ¨åå»¶è¿Ÿå¤šä¹…æ‰è¿›è¡Œæ£€æŸ¥ï¼Œå•ä½ï¼šç§’</li><li>periodSecondsï¼šæ£€æŸ¥çš„é—´éš”æ—¶é—´ï¼Œé»˜è®¤ä¸º10ï¼Œå•ä½ï¼šç§’ã€‚</li><li>timeoutSecondsï¼šæ¢æµ‹çš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ä¸º1ï¼Œå•ä½ï¼šç§’ã€‚</li><li>successThresholdï¼šæ¢æµ‹å¤±è´¥åè®¤ä¸ºæˆåŠŸçš„æœ€å°è¿æ¥æˆåŠŸæ¬¡æ•°ï¼Œé»˜è®¤ä¸º1ï¼Œåœ¨Livenessæ¢é’ˆä¸­å¿…é¡»ä¸º1ï¼Œæœ€å°å€¼ä¸º1ã€‚</li><li>failureThresholdï¼šæ¢æµ‹å¤±è´¥çš„é‡è¯•æ¬¡æ•°ï¼Œé‡è¯•ä¸€å®šæ¬¡æ•°åå°†è®¤ä¸ºå¤±è´¥ï¼Œåœ¨readinessæ¢é’ˆä¸­ï¼ŒPodä¼šè¢«æ ‡è®°ä¸ºæœªå°±ç»ªï¼Œé»˜è®¤ä¸º3ï¼Œæœ€å°å€¼ä¸º1ã€‚</li></ul><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>ä¹‹å‰é”™è¯¯å‚è€ƒæ’æŸ¥ä»‹ç»</strong>: åœ¨ä¹‹å‰å®‰è£…jenkinsçš„æ—¶å€™ï¼Œåˆ›å»ºpodå°±ä¸€å€¼å¤„äº<code>running</code>,ä½†æ˜¯è¿‡ä¸€ä¼šï¼Œç•Œé¢å°±æŠ¥é”™ï¼Œé”™è¯¯å¦‚ä¸‹å›¾<br><img src="http://img.xxlaila.cn/15008WechatIMG.png" alt="img"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ç„¶åæŸ¥çœ‹podæ—¥å¿—å’Œç³»ç»Ÿç³»ç»Ÿï¼Œéƒ½æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œpodæ—¥å¿—å¦‚ä¸‹ï¼Œç„¶åå°±é—®äº†æœ‹å‹ï¼Œå°±è¯´æœ‰å¯èƒ½æ˜¯podçš„å¥åº·æ£€æµ‹æœºåˆ¶ï¼Œæœ€åå°±ä¿®æ”¹äº†podçš„å¥åº·æ£€æµ‹æœºåˆ¶ï¼ŒjenkinsæœåŠ¡å™¨éƒ¨ç½²okã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">kubectl <span class="built_in">log</span> $(kubectl get pods -n kube-ops | awk <span class="string">'&#123;print $1&#125;'</span> | grep jenkins) -n kube-ops</span><br><span class="line"><span class="built_in">log</span> is DEPRECATED and will be removed <span class="keyword">in</span> a future version. Use logs instead.</span><br><span class="line">VM settings:</span><br><span class="line">    Max. Heap Size: 3.00G</span><br><span class="line">    Ergonomics Machine Class: server</span><br><span class="line">    Using VM: OpenJDK 64-Bit Server VM</span><br><span class="line"></span><br><span class="line">Running from: /usr/share/jenkins/jenkins.war</span><br><span class="line">webroot: EnvVars.masterEnvVars.get(<span class="string">"JENKINS_HOME"</span>)</span><br><span class="line">2019-09-27 03:02:24.133+0000 [id=1] INFO org.eclipse.jetty.util.log.Log<span class="comment">#initialized: Logging initialized @429ms to org.eclipse.jetty.util.log.JavaUtilLog</span></span><br><span class="line">2019-09-27 03:02:24.247+0000 [id=1] INFO winstone.Logger<span class="comment">#logInternal: Beginning extraction from war file</span></span><br></pre></td></tr></table></figure><p><strong>åç»­</strong>: è™½ç„¶å¥åº·æ£€æµ‹å¯ä»¥å–æ¶ˆï¼Œä¸åŠ å…¥ï¼Œä½†æ˜¯å½“æˆ‘ä»¬åœ¨ä¸Šç”Ÿäº§ç¯å¢ƒçš„æ—¶å€™è¿˜æ˜¯è¦åŠ ä¸Šï¼Œæ­£å¦‚ä¾‹å››ä»‹ç»çš„é‚£æ ·ã€‚å¦‚æœæˆ‘ä»¬åœ¨ç”Ÿäº§ç¯å¢ƒé”™æ•…éšœè‡ªæ„ˆã€è½®è¯¢å‘å¸ƒç­‰ã€‚éƒ½éœ€è¦è¿™ä¸ªä¸œè¥¿ï¼ŒåŠ å…¥å†å‡çº§çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨éƒ½è¿˜æ²¡èµ·æ¥ï¼Œk8så°±å§æµé‡ç»™è°ƒåº¦è¿‡æ¥ï¼Œå‡çº§ä¸‹ä¸€ä¸ªpodï¼Œå¤–éƒ¨ç”¨æˆ·è®¿é—®å°±ä¼šæŠ¥é”™ï¼Œé‚£å°±æ˜¯å¾ˆå°´å°¬</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;Podå¥åº·æ£€æµ‹æœºåˆ¶&quot;&gt;&lt;a href=&quot;#Podå¥åº·æ£€æµ‹æœºåˆ¶&quot; class=&quot;headerlink&quot; title=&quot;Podå¥åº·æ£€æµ‹æœºåˆ¶&quot;&gt;&lt;/a&gt;Podå¥åº·æ£€æµ‹æœºåˆ¶&lt;/h3&gt;&lt;p&gt;å¯¹äºPodçš„å¥åº·çŠ¶æ€æ£€æµ‹ï¼Œkubernetesæä¾›äº†ä¸¤ç±»æ¢é’ˆ(Probe)æ¥æ‰§è¡Œå¯¹Podçš„å¥åº·çŠ¶æ€æ£€æµ‹:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;LivenessProbeæ¢é’ˆ&lt;/strong&gt;:&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;ç”¨äºåˆ¤æ–­å®¹å™¨æ˜¯å¦å­˜æ´»ï¼Œå³Podæ˜¯å¦ä¸ºrunningçŠ¶æ€ï¼Œå¦‚æœLivenessProbeæ¢é’ˆæ¢æµ‹åˆ°å®¹å™¨ä¸å¥åº·ï¼Œåˆ™kubeletå°†killæ‰å®¹å™¨ï¼Œå¹¶æ ¹æ®å®¹å™¨çš„é‡å¯ç­–ç•¥æ˜¯å¦é‡å¯ï¼Œå¦‚æœä¸€ä¸ªå®¹å™¨ä¸åŒ…å«LivenessProbeæ¢é’ˆï¼Œåˆ™Kubeletè®¤ä¸ºå®¹å™¨çš„LivenessProbeæ¢é’ˆçš„è¿”å›å€¼æ°¸è¿œæˆåŠŸ.&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="kubernetes" scheme="https://xxlaila.github.io//categories/kubernetes/"/>
    
    
      <category term="pod" scheme="https://xxlaila.github.io//tags/pod/"/>
    
  </entry>
  
  <entry>
    <title>EFK</title>
    <link href="https://xxlaila.github.io/2019/09/25/EFK/"/>
    <id>https://xxlaila.github.io/2019/09/25/EFK/</id>
    <published>2019-09-25T07:24:18.000Z</published>
    <updated>2019-09-26T03:13:12.627Z</updated>
    
    <content type="html"><![CDATA[<h3 id="åˆå§‹åŒ–é…ç½®æ–‡ä»¶å‡†å¤‡"><a href="#åˆå§‹åŒ–é…ç½®æ–‡ä»¶å‡†å¤‡" class="headerlink" title="åˆå§‹åŒ–é…ç½®æ–‡ä»¶å‡†å¤‡"></a>åˆå§‹åŒ–é…ç½®æ–‡ä»¶å‡†å¤‡</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å°†ä¸‹è½½çš„ kubernetes-server-linux-amd64.tar.gz è§£å‹åï¼Œå†è§£å‹å…¶ä¸­çš„ kubernetes-src.tar.gz æ–‡ä»¶ã€‚<code>kubernetes/cluster/addons/fluentd-elasticsearch</code>è¿™æ˜¯æ–‡ä»¶æ‰€åœ¨çš„è·¯å¾„</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;es æ•°æ®é»˜è®¤çš„å­˜å‚¨åœ¨dockeré‡Œé¢ï¼Œåœ¨ç”¨çš„æ˜¯nodeèŠ‚ç‚¹çš„ç©ºé—´ï¼Œè€ŒnodeèŠ‚ç‚¹æˆ‘ä»¬ä¸å¯èƒ½éƒ½å‡†å¤‡å¾ˆå¤§çš„ç©ºé—´ï¼Œé‚£æ ·å¾ˆæµªè´¹èµ„æºï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬éœ€è¦å‡†å¤‡å¤–éƒ¨çš„nfså­˜å‚¨ç©ºé—´ï¼Œç„¶åé€šè¿‡<a href="https://xxlaila.github.io/2019/09/24/%E5%88%A9%E7%94%A8NFS%E5%8A%A8%E6%80%81%E6%8F%90%E4%BE%9BKubernetes%E5%90%8E%E7%AB%AF%E5%AD%98%E5%82%A8%E5%8D%B7/">pv</a>çš„æ¨¡å¼è¿›è¡ŒæŒ‚è½½ï¼Œæ•°æ®å­˜å‚¨åˆ°nfsæœåŠ¡å™¨ä¸Šï¼Œè¿™æ ·ä¿éšœäº†esæ”¶é›†æ•°æ®çš„å¯ç”¨æ€§ã€‚</p><a id="more"></a><h3 id="åˆ›å»ºå­˜å‚¨ä»‹è´¨"><a href="#åˆ›å»ºå­˜å‚¨ä»‹è´¨" class="headerlink" title="åˆ›å»ºå­˜å‚¨ä»‹è´¨"></a>åˆ›å»ºå­˜å‚¨ä»‹è´¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ cat &gt; pvc.yaml &lt;&lt;EOF</span><br><span class="line">---</span><br><span class="line">apiVersion: storage.k8s.io/v1</span><br><span class="line">kind: StorageClass</span><br><span class="line">metadata:</span><br><span class="line">  name: es-nfs-data</span><br><span class="line">provisioner: fuseim.pri/ifs</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">$ kubectl apply -f pvc.yaml</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹é…ç½®æ–‡ä»¶"><a href="#ä¿®æ”¹é…ç½®æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹é…ç½®æ–‡ä»¶"></a>ä¿®æ”¹é…ç½®æ–‡ä»¶</h3><ul><li><p>es-statefulset.yaml</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># RBAC authn and authz</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ServiceAccount</span><br><span class="line">metadata:</span><br><span class="line">  name: elasticsearch-logging</span><br><span class="line">  namespace: kube-system</span><br><span class="line">  labels:</span><br><span class="line">    k8s-app: elasticsearch-logging</span><br><span class="line">    kubernetes.io/cluster-service: <span class="string">"true"</span></span><br><span class="line">    addonmanager.kubernetes.io/mode: Reconcile</span><br><span class="line">---</span><br><span class="line">kind: ClusterRole</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">metadata:</span><br><span class="line">  name: elasticsearch-logging</span><br><span class="line">  labels:</span><br><span class="line">    k8s-app: elasticsearch-logging</span><br><span class="line">    kubernetes.io/cluster-service: <span class="string">"true"</span></span><br><span class="line">    addonmanager.kubernetes.io/mode: Reconcile</span><br><span class="line">rules:</span><br><span class="line">- apiGroups:</span><br><span class="line">  - <span class="string">""</span></span><br><span class="line">  resources:</span><br><span class="line">  - <span class="string">"services"</span></span><br><span class="line">  - <span class="string">"namespaces"</span></span><br><span class="line">  - <span class="string">"endpoints"</span></span><br><span class="line">  verbs:</span><br><span class="line">  - <span class="string">"get"</span></span><br><span class="line">---</span><br><span class="line">kind: ClusterRoleBinding</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">metadata:</span><br><span class="line">  namespace: kube-system</span><br><span class="line">  name: elasticsearch-logging</span><br><span class="line">  labels:</span><br><span class="line">    k8s-app: elasticsearch-logging</span><br><span class="line">    kubernetes.io/cluster-service: <span class="string">"true"</span></span><br><span class="line">    addonmanager.kubernetes.io/mode: Reconcile</span><br><span class="line">subjects:</span><br><span class="line">- kind: ServiceAccount</span><br><span class="line">  name: elasticsearch-logging</span><br><span class="line">  namespace: kube-system</span><br><span class="line">  apiGroup: <span class="string">""</span></span><br><span class="line">roleRef:</span><br><span class="line">  kind: ClusterRole</span><br><span class="line">  name: elasticsearch-logging</span><br><span class="line">  apiGroup: <span class="string">""</span></span><br><span class="line">---</span><br><span class="line"><span class="comment"># Elasticsearch deployment itself</span></span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: StatefulSet</span><br><span class="line">metadata:</span><br><span class="line">  name: elasticsearch-logging</span><br><span class="line">  namespace: kube-system</span><br><span class="line">  labels:</span><br><span class="line">    k8s-app: elasticsearch-logging</span><br><span class="line">    version: v6.6.1</span><br><span class="line">    kubernetes.io/cluster-service: <span class="string">"true"</span></span><br><span class="line">    addonmanager.kubernetes.io/mode: Reconcile</span><br><span class="line">spec:</span><br><span class="line">  serviceName: elasticsearch-logging</span><br><span class="line">  replicas: 2</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      k8s-app: elasticsearch-logging</span><br><span class="line">      version: v6.6.1</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        k8s-app: elasticsearch-logging</span><br><span class="line">        version: v6.6.1</span><br><span class="line">        kubernetes.io/cluster-service: <span class="string">"true"</span></span><br><span class="line">    spec:</span><br><span class="line">      serviceAccountName: elasticsearch-logging</span><br><span class="line">      containers:</span><br><span class="line">      - image: elasticsearch:6.6.1</span><br><span class="line">        name: elasticsearch-logging</span><br><span class="line">        resources:</span><br><span class="line">          <span class="comment"># need more cpu upon initialization, therefore burstable class</span></span><br><span class="line">          limits:</span><br><span class="line">            cpu: 1000m</span><br><span class="line">          requests:</span><br><span class="line">            cpu: 100m</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 9200</span><br><span class="line">          name: db</span><br><span class="line">          protocol: TCP</span><br><span class="line">        - containerPort: 9300</span><br><span class="line">          name: transport</span><br><span class="line">          protocol: TCP</span><br><span class="line">        volumeMounts:</span><br><span class="line">        - name: elasticsearch-logging</span><br><span class="line">          mountPath: /data</span><br><span class="line">        env:</span><br><span class="line">        - name: <span class="string">"NAMESPACE"</span></span><br><span class="line">          valueFrom:</span><br><span class="line">            fieldRef:</span><br><span class="line">              fieldPath: metadata.namespace</span><br><span class="line">      <span class="comment"># Elasticsearch requires vm.max_map_count to be at least 262144.</span></span><br><span class="line">      <span class="comment"># If your OS already sets up this number to a higher value, feel free</span></span><br><span class="line">      <span class="comment"># to remove this init container.</span></span><br><span class="line">      initContainers:</span><br><span class="line">      - image: alpine:3.6</span><br><span class="line">        <span class="built_in">command</span>: [<span class="string">"/sbin/sysctl"</span>, <span class="string">"-w"</span>, <span class="string">"vm.max_map_count=262144"</span>]</span><br><span class="line">        name: elasticsearch-logging-init</span><br><span class="line">        securityContext:</span><br><span class="line">          privileged: <span class="literal">true</span></span><br><span class="line">  volumeClaimTemplates:</span><br><span class="line">  - metadata:</span><br><span class="line">      name: elasticsearch-logging</span><br><span class="line">    spec:</span><br><span class="line">      accessModes: [ <span class="string">"ReadWriteMany"</span> ]</span><br><span class="line">      storageClassName: <span class="string">"es-nfs-data"</span></span><br><span class="line">      resources:</span><br><span class="line">        requests:</span><br><span class="line">          storage: 30Gi</span><br></pre></td></tr></table></figure></li><li><p>fluentd-es-ds.yaml</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: ServiceAccount</span><br><span class="line">metadata:</span><br><span class="line">  name: fluentd-es</span><br><span class="line">  namespace: kube-system</span><br><span class="line">  labels:</span><br><span class="line">    k8s-app: fluentd-es</span><br><span class="line">    kubernetes.io/cluster-service: <span class="string">"true"</span></span><br><span class="line">    addonmanager.kubernetes.io/mode: Reconcile</span><br><span class="line">---</span><br><span class="line">kind: ClusterRole</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">metadata:</span><br><span class="line">  name: fluentd-es</span><br><span class="line">  labels:</span><br><span class="line">    k8s-app: fluentd-es</span><br><span class="line">    kubernetes.io/cluster-service: <span class="string">"true"</span></span><br><span class="line">    addonmanager.kubernetes.io/mode: Reconcile</span><br><span class="line">rules:</span><br><span class="line">- apiGroups:</span><br><span class="line">  - <span class="string">""</span></span><br><span class="line">  resources:</span><br><span class="line">  - <span class="string">"namespaces"</span></span><br><span class="line">  - <span class="string">"pods"</span></span><br><span class="line">  verbs:</span><br><span class="line">  - <span class="string">"get"</span></span><br><span class="line">  - <span class="string">"watch"</span></span><br><span class="line">  - <span class="string">"list"</span></span><br><span class="line">---</span><br><span class="line">kind: ClusterRoleBinding</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">metadata:</span><br><span class="line">  name: fluentd-es</span><br><span class="line">  labels:</span><br><span class="line">    k8s-app: fluentd-es</span><br><span class="line">    kubernetes.io/cluster-service: <span class="string">"true"</span></span><br><span class="line">    addonmanager.kubernetes.io/mode: Reconcile</span><br><span class="line">subjects:</span><br><span class="line">- kind: ServiceAccount</span><br><span class="line">  name: fluentd-es</span><br><span class="line">  namespace: kube-system</span><br><span class="line">  apiGroup: <span class="string">""</span></span><br><span class="line">roleRef:</span><br><span class="line">  kind: ClusterRole</span><br><span class="line">  name: fluentd-es</span><br><span class="line">  apiGroup: <span class="string">""</span></span><br><span class="line">---</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: DaemonSet</span><br><span class="line">metadata:</span><br><span class="line">  name: fluentd-es-v2.4.0</span><br><span class="line">  namespace: kube-system</span><br><span class="line">  labels:</span><br><span class="line">    k8s-app: fluentd-es</span><br><span class="line">    version: v2.4.0</span><br><span class="line">    kubernetes.io/cluster-service: <span class="string">"true"</span></span><br><span class="line">    addonmanager.kubernetes.io/mode: Reconcile</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      k8s-app: fluentd-es</span><br><span class="line">      version: v2.4.0</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        k8s-app: fluentd-es</span><br><span class="line">        kubernetes.io/cluster-service: <span class="string">"true"</span></span><br><span class="line">        version: v2.4.0</span><br><span class="line">      <span class="comment"># This annotation ensures that fluentd does not get evicted if the node</span></span><br><span class="line">      <span class="comment"># supports critical pod annotation based priority scheme.</span></span><br><span class="line">      <span class="comment"># Note that this does not guarantee admission on the nodes (#40573).</span></span><br><span class="line">      annotations:</span><br><span class="line">        scheduler.alpha.kubernetes.io/critical-pod: <span class="string">''</span></span><br><span class="line">        seccomp.security.alpha.kubernetes.io/pod: <span class="string">'docker/default'</span></span><br><span class="line">    spec:</span><br><span class="line">      priorityClassName: system-node-critical</span><br><span class="line">      serviceAccountName: fluentd-es</span><br><span class="line">      containers:</span><br><span class="line">      - name: fluentd-es</span><br><span class="line">        image: docker.io/xxlaila/fluentd-elasticsearch:v2.4.0</span><br><span class="line">        env:</span><br><span class="line">        - name: FLUENTD_ARGS</span><br><span class="line">          value: --no-supervisor -q</span><br><span class="line">        resources:</span><br><span class="line">          limits:</span><br><span class="line">            memory: 500Mi</span><br><span class="line">          requests:</span><br><span class="line">            cpu: 100m</span><br><span class="line">            memory: 200Mi</span><br><span class="line">        volumeMounts:</span><br><span class="line">        - name: varlog</span><br><span class="line">          mountPath: /var/<span class="built_in">log</span></span><br><span class="line">        - name: varlibdockercontainers</span><br><span class="line">          mountPath: /var/lib/docker/containers</span><br><span class="line">          readOnly: <span class="literal">true</span></span><br><span class="line">        - name: config-volume</span><br><span class="line">          mountPath: /etc/fluent/config.d</span><br><span class="line">      terminationGracePeriodSeconds: 30</span><br><span class="line">      volumes:</span><br><span class="line">      - name: varlog</span><br><span class="line">        hostPath:</span><br><span class="line">          path: /var/<span class="built_in">log</span></span><br><span class="line">      - name: varlibdockercontainers</span><br><span class="line">        hostPath:</span><br><span class="line">          path: /var/lib/docker/containers</span><br><span class="line">      - name: config-volume</span><br><span class="line">        configMap:</span><br><span class="line">          name: fluentd-es-config-v0.2.0</span><br></pre></td></tr></table></figure></li><li><p>kibana-deployment.yaml<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æ³¨é‡Šé‡Œé¢çš„ä¸¤è¡Œé…ç½®,ä¸æ³¨é‡Šçš„è¯ï¼Œæ‰“å¼€kibanaçš„æ—¶å€™ä¼šæç¤º<code>kibana {&quot;statusCode&quot;:404,&quot;error&quot;:&quot;Not Found&quot;,&quot;message&quot;:&quot;Not Found&quot;}</code>,å‚è€ƒ<a href="https://github.com/kubernetes-sigs/kubespray/issues/3322" target="_blank" rel="noopener">è§£å†³æ–¹æ¡ˆ</a>,æ³¨é‡Šé…ç½®å¦‚ä¸‹:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- name: SERVER_BASEPATH</span><br><span class="line">  value: /api/v1/namespaces/kube-system/services/kibana-logging/proxy</span><br></pre></td></tr></table></figure></li></ul><h4 id="æ‰§è¡Œåˆ›å»º"><a href="#æ‰§è¡Œåˆ›å»º" class="headerlink" title="æ‰§è¡Œåˆ›å»º"></a>æ‰§è¡Œåˆ›å»º</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl apply -f ./</span><br></pre></td></tr></table></figure><h4 id="æŸ¥çœ‹åˆ›å»º"><a href="#æŸ¥çœ‹åˆ›å»º" class="headerlink" title="æŸ¥çœ‹åˆ›å»º"></a>æŸ¥çœ‹åˆ›å»º</h4><ul><li><p>æŸ¥çœ‹pod</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get pods -n kube-system |egrep <span class="string">"kibana|elasticsearch|fluentd"</span></span><br><span class="line">elasticsearch-logging-0                       1/1     Running   0          65m</span><br><span class="line">elasticsearch-logging-1                       1/1     Running   0          61m</span><br><span class="line">fluentd-es-v2.4.0-4fp28                       1/1     Running   0          30m</span><br><span class="line">fluentd-es-v2.4.0-b7k67                       1/1     Running   0          30m</span><br><span class="line">fluentd-es-v2.4.0-f8jzp                       1/1     Running   0          30m</span><br><span class="line">fluentd-es-v2.4.0-shwzm                       1/1     Running   0          30m</span><br><span class="line">fluentd-es-v2.4.0-ww8r8                       1/1     Running   0          30m</span><br><span class="line">kibana-logging-57b55f58bc-xh5lp               1/1     Running   0          6m35s</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹service</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get svc -n kube-system |egrep <span class="string">"kibana|elasticsearch"</span></span><br><span class="line">elasticsearch-logging     ClusterIP   10.254.30.110    &lt;none&gt;        9200/TCP                 9s</span><br><span class="line">kibana-logging            ClusterIP   10.254.188.5     &lt;none&gt;        5601/TCP                 16h</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹pvï¼Œpvc</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$  kubectl get pv,pvc -n kube-system</span><br><span class="line">NAME                                                        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                                                       STORAGECLASS   REASON   AGE</span><br><span class="line">persistentvolume/pvc-65fdd14e-dffc-11e9-bc90-fa163e5af833   30Gi       RWX            Delete           Bound    kube-system/elasticsearch-logging-elasticsearch-logging-0   es-nfs-data             21m</span><br><span class="line">persistentvolume/pvc-fe818f55-dffc-11e9-bc90-fa163e5af833   30Gi       RWX            Delete           Bound    kube-system/elasticsearch-logging-elasticsearch-logging-1   es-nfs-data             16m</span><br><span class="line"></span><br><span class="line">NAME                                                                  STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE</span><br><span class="line">persistentvolumeclaim/elasticsearch-logging-elasticsearch-logging-0   Bound    pvc-65fdd14e-dffc-11e9-bc90-fa163e5af833   30Gi       RWX            es-nfs-data    21m</span><br><span class="line">persistentvolumeclaim/elasticsearch-logging-elasticsearch-logging-1   Bound    pvc-fe818f55-dffc-11e9-bc90-fa163e5af833   30Gi       RWX            es-nfs-data    17m</span><br></pre></td></tr></table></figure></li></ul><h3 id="åˆ›å»ºwebè®¿é—®"><a href="#åˆ›å»ºwebè®¿é—®" class="headerlink" title="åˆ›å»ºwebè®¿é—®"></a>åˆ›å»ºwebè®¿é—®</h3><ul><li><p>kibana-Ingress.yaml</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ cat &gt; kibana-Ingress.yaml &lt;&lt;EOF</span><br><span class="line">---</span><br><span class="line">apiVersion: extensions/v1beta1</span><br><span class="line">kind: Ingress</span><br><span class="line">metadata:</span><br><span class="line">  name: kibana-web-ui</span><br><span class="line">  namespace: kube-system</span><br><span class="line">  annotations:</span><br><span class="line">    kubernetes.io/ingress.class: traefik</span><br><span class="line">spec:</span><br><span class="line">  rules:</span><br><span class="line">  - host: kibana.xxlaila.cn</span><br><span class="line">    http:</span><br><span class="line">      paths:</span><br><span class="line">      - path: /</span><br><span class="line">        backend:</span><br><span class="line">          serviceName: kibana-logging</span><br><span class="line">          servicePort: 5601</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure></li><li><p>es-Ingress.yaml </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ cat &gt; es-Ingress &lt;&lt;EOF</span><br><span class="line">---</span><br><span class="line">apiVersion: extensions/v1beta1</span><br><span class="line">kind: Ingress</span><br><span class="line">metadata:</span><br><span class="line">  name: es-web-ui</span><br><span class="line">  namespace: kube-system</span><br><span class="line">  annotations:</span><br><span class="line">    kubernetes.io/ingress.class: traefik</span><br><span class="line">spec:</span><br><span class="line">  rules:</span><br><span class="line">  - host: es.xxlaila.cn</span><br><span class="line">    http:</span><br><span class="line">      paths:</span><br><span class="line">      - path: /</span><br><span class="line">        backend:</span><br><span class="line">          serviceName: elasticsearch-logging</span><br><span class="line">          servicePort: 9200</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure></li><li><p>æ‰§è¡Œåˆ›å»º</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl apply -f es-Ingress.yaml kibana-Ingress.yaml</span><br></pre></td></tr></table></figure></li><li><p>åœ¨æµè§ˆå™¨è®¿é—®es<br><img src="http://img.xxlaila.cn/1569462606884.jpg" alt="img"></p></li><li><p>æµè§ˆå™¨è®¿é—®kibana<br><img src="http://img.xxlaila.cn/1569464839630.jpg" alt="img"><br>å»ºç«‹ç´¢å¼•ï¼Œé»˜è®¤çš„ç´¢å¼•æ˜¯æ ¹æ®å¤©æ¥è‡ªåŠ¨åˆ›å»ºåœ¨esé‡Œé¢ï¼Œè¿™é‡Œæˆ‘æ˜¯åœ¨kibanaé‡Œé¢æ˜¯æ ¹æ®æœˆæ¥å´åˆ†çš„<br><img src="http://img.xxlaila.cn/1569464950776.jpg" alt="img"></p></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;åˆå§‹åŒ–é…ç½®æ–‡ä»¶å‡†å¤‡&quot;&gt;&lt;a href=&quot;#åˆå§‹åŒ–é…ç½®æ–‡ä»¶å‡†å¤‡&quot; class=&quot;headerlink&quot; title=&quot;åˆå§‹åŒ–é…ç½®æ–‡ä»¶å‡†å¤‡&quot;&gt;&lt;/a&gt;åˆå§‹åŒ–é…ç½®æ–‡ä»¶å‡†å¤‡&lt;/h3&gt;&lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;å°†ä¸‹è½½çš„ kubernetes-server-linux-amd64.tar.gz è§£å‹åï¼Œå†è§£å‹å…¶ä¸­çš„ kubernetes-src.tar.gz æ–‡ä»¶ã€‚&lt;code&gt;kubernetes/cluster/addons/fluentd-elasticsearch&lt;/code&gt;è¿™æ˜¯æ–‡ä»¶æ‰€åœ¨çš„è·¯å¾„&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;es æ•°æ®é»˜è®¤çš„å­˜å‚¨åœ¨dockeré‡Œé¢ï¼Œåœ¨ç”¨çš„æ˜¯nodeèŠ‚ç‚¹çš„ç©ºé—´ï¼Œè€ŒnodeèŠ‚ç‚¹æˆ‘ä»¬ä¸å¯èƒ½éƒ½å‡†å¤‡å¾ˆå¤§çš„ç©ºé—´ï¼Œé‚£æ ·å¾ˆæµªè´¹èµ„æºï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬éœ€è¦å‡†å¤‡å¤–éƒ¨çš„nfså­˜å‚¨ç©ºé—´ï¼Œç„¶åé€šè¿‡&lt;a href=&quot;https://xxlaila.github.io/2019/09/24/%E5%88%A9%E7%94%A8NFS%E5%8A%A8%E6%80%81%E6%8F%90%E4%BE%9BKubernetes%E5%90%8E%E7%AB%AF%E5%AD%98%E5%82%A8%E5%8D%B7/&quot;&gt;pv&lt;/a&gt;çš„æ¨¡å¼è¿›è¡ŒæŒ‚è½½ï¼Œæ•°æ®å­˜å‚¨åˆ°nfsæœåŠ¡å™¨ä¸Šï¼Œè¿™æ ·ä¿éšœäº†esæ”¶é›†æ•°æ®çš„å¯ç”¨æ€§ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="kubernetes" scheme="https://xxlaila.github.io//categories/kubernetes/"/>
    
    
      <category term="efk" scheme="https://xxlaila.github.io//tags/efk/"/>
    
  </entry>
  
  <entry>
    <title>ç½‘ç»œçŠ¶æ€ç›‘æ§</title>
    <link href="https://xxlaila.github.io/2019/09/25/%E7%BD%91%E7%BB%9C%E7%8A%B6%E6%80%81%E7%9B%91%E6%8E%A7/"/>
    <id>https://xxlaila.github.io/2019/09/25/ç½‘ç»œçŠ¶æ€ç›‘æ§/</id>
    <published>2019-09-25T05:27:04.000Z</published>
    <updated>2019-09-26T03:13:12.554Z</updated>
    
    <content type="html"><![CDATA[<h3 id="éœ€æ±‚"><a href="#éœ€æ±‚" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ç›‘æ§IDCæœºæˆ¿ç½‘ç»œè´¨é‡æƒ…å†µï¼Œæœ¬åœ°åŒºåˆ°å…¶ä»–åœ°åŒºï¼Œå…¶ä»–åœ°åŒºåˆ°æœ¬èŠ‚ç‚¹ï¼Œæˆ–è€…å„çœå¸‚æ—¶é—´ç½‘ç»œã€è¿è¥å•†ç½‘ç»œçŠ¶æ€ï¼Œç›‘è§†ç½‘ç»œæ€§èƒ½ï¼ŒåŒ…æ‹¬å¸¸è§„çš„ pingï¼Œç”¨ fpingã€echopingã€tracert ç›‘è§† www æœåŠ¡å™¨æ€§èƒ½ï¼Œç›‘è§† dns æŸ¥è¯¢æ€§èƒ½ï¼Œç›‘è§† ssh æ€§èƒ½ç­‰ã€‚åº•å±‚ä¹Ÿæ˜¯ rrdtool åšæ”¯æŒï¼Œç‰¹ç‚¹æ˜¯ç”»çš„å›¾éå¸¸æ¼‚äº®ï¼Œç½‘ç»œä¸¢åŒ…å’Œå»¶è¿Ÿç”¨é¢œè‰²å’Œé˜´å½±æ¥è¡¨ç¤ºã€‚</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Smokepingã€‚æœ€æ–°ç‰ˆæœ¬çš„ Smokeping æ”¯æŒå¤šä¸ªèŠ‚ç‚¹çš„æ£€æµ‹ç»“æœä»ä¸€ä¸ªå›¾ä¸Šç”»å‡ºæ¥</p><a id="more"></a><h3 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h3><h4 id="å®‰è£…yumæº"><a href="#å®‰è£…yumæº" class="headerlink" title="å®‰è£…yumæº"></a>å®‰è£…yumæº</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rpmforge-release-0.5.3-1.el6.rf.x86_64.rpm               </span></span><br><span class="line"><span class="comment"># rpm â€“Uvh http://mirrors.neusoft.edu.cn/epel/6/i386/epel-release-6-8.noarch.rpm</span></span><br></pre></td></tr></table></figure><h4 id="å®‰è£…ä¾èµ–åŒ…"><a href="#å®‰è£…ä¾èµ–åŒ…" class="headerlink" title="å®‰è£…ä¾èµ–åŒ…"></a>å®‰è£…ä¾èµ–åŒ…</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum â€“y install perl perl-Net-Telnet perl-Net-DNS perl-LDAP perl-libwww-perl perl-RadiusPerl perl-IO-Socket-SSL perl-Socket6 perl-CGI-SpeedyCGI perl-FCGI perl-CGI-SpeedCGI perl-Time-HiRes perl-ExtUtils-MakeMaker perl-RRD-Simple rrdtool rrdtool-perl curl fping echo</span></span><br><span class="line">ping  httpd httpd-devel gcc make  wget libxml2-devel libpng-devel glib pango pango-devel freetype freetype-devel fontconfig cairo cairo-devel libart_lgpl libart_lgpl-devel mod_fastcgi</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…smokeping"><a href="#å®‰è£…smokeping" class="headerlink" title="å®‰è£…smokeping"></a>å®‰è£…smokeping</h3><h4 id="ä¸‹è½½"><a href="#ä¸‹è½½" class="headerlink" title="ä¸‹è½½"></a>ä¸‹è½½</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># wget http://oss.oetiker.ch/smokeping/pub/smokeping-2.6.11.tar.gz è¿™é‡Œä¸‹è½½çš„æœ€æ–°ç‰ˆ</span></span><br></pre></td></tr></table></figure><h4 id="å®‰è£…FCGI"><a href="#å®‰è£…FCGI" class="headerlink" title="å®‰è£…FCGI"></a>å®‰è£…FCGI</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tar zxf CGI-4.33.tar.gz</span></span><br><span class="line"><span class="comment"># cd CGI-4.33</span></span><br><span class="line"><span class="comment"># perl Makefile.PL</span></span><br><span class="line"><span class="comment"># make &amp;&amp; make install</span></span><br></pre></td></tr></table></figure><h4 id="å®‰è£…Config-Grammar"><a href="#å®‰è£…Config-Grammar" class="headerlink" title="å®‰è£…Config-Grammar"></a>å®‰è£…Config-Grammar</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tar zxf Config-Grammar-1.10.tar.gz</span></span><br><span class="line"><span class="comment"># cd Config-Grammar-1.10</span></span><br><span class="line"><span class="comment"># perl Makefile.PL</span></span><br><span class="line"><span class="comment"># make &amp;&amp; make install</span></span><br></pre></td></tr></table></figure><h4 id="å®‰è£…ExtUtils-MakeMaker"><a href="#å®‰è£…ExtUtils-MakeMaker" class="headerlink" title="å®‰è£…ExtUtils-MakeMaker"></a>å®‰è£…ExtUtils-MakeMaker</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tar zxf ExtUtils-MakeMaker-7.24.tar.gz</span></span><br><span class="line"><span class="comment"># cd ExtUtils-MakeMaker</span></span><br><span class="line"><span class="comment"># perl Makefile.PL</span></span><br><span class="line"><span class="comment"># make &amp;&amp; make install</span></span><br></pre></td></tr></table></figure><h4 id="å®‰è£…Simple"><a href="#å®‰è£…Simple" class="headerlink" title="å®‰è£…Simple"></a>å®‰è£…Simple</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tar zxf Test-Simple-1.302056.tar.gz</span></span><br><span class="line"><span class="comment"># cd Test-Simple-1.302056</span></span><br><span class="line"><span class="comment"># perl Makefile.PL</span></span><br><span class="line"><span class="comment"># make &amp;&amp; make install</span></span><br><span class="line">`</span><br></pre></td></tr></table></figure><h4 id="å®‰è£…Net-OpenSSH"><a href="#å®‰è£…Net-OpenSSH" class="headerlink" title="å®‰è£…Net-OpenSSH"></a>å®‰è£…Net-OpenSSH</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tar zxf Net-OpenSSH-0.73.tar.gz</span></span><br><span class="line"><span class="comment"># cd Net-OpenSSH-0.73</span></span><br><span class="line"><span class="comment"># perl Makefile.PL</span></span><br><span class="line"><span class="comment"># make &amp;&amp; make install</span></span><br></pre></td></tr></table></figure><h4 id="å®‰è£…Net-SNMP"><a href="#å®‰è£…Net-SNMP" class="headerlink" title="å®‰è£…Net-SNMP"></a>å®‰è£…Net-SNMP</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tar Net-SNMP-v6.0.1.tar.gz</span></span><br><span class="line"><span class="comment"># cd Net-SNMP-v6.0.1</span></span><br><span class="line"><span class="comment"># perl Makefile.PL</span></span><br><span class="line"><span class="comment"># make &amp;&amp; make install</span></span><br></pre></td></tr></table></figure><h4 id="å®‰è£…perl-ldap"><a href="#å®‰è£…perl-ldap" class="headerlink" title="å®‰è£…perl-ldap"></a>å®‰è£…perl-ldap</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tar zxf perl-ldap-0.65.tar.gz</span></span><br><span class="line"><span class="comment"># cd perl-ldap-0.65</span></span><br><span class="line"><span class="comment"># ./install-nomake</span></span><br></pre></td></tr></table></figure><h4 id="å®‰è£…Net-DNS"><a href="#å®‰è£…Net-DNS" class="headerlink" title="å®‰è£…Net-DNS"></a>å®‰è£…Net-DNS</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tar zxf Net-DNS-1.06.tar.gz</span></span><br><span class="line"><span class="comment"># cd Net-DNS-1.06</span></span><br><span class="line"><span class="comment"># perl Makefile.PL</span></span><br><span class="line"><span class="comment"># make &amp;&amp; make install</span></span><br></pre></td></tr></table></figure><h4 id="å®‰è£…IO-Tty"><a href="#å®‰è£…IO-Tty" class="headerlink" title="å®‰è£…IO-Tty"></a>å®‰è£…IO-Tty</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tar IO-Tty-1.12.tar.gz</span></span><br><span class="line"><span class="comment"># cd IO-Tty-1.12</span></span><br><span class="line"><span class="comment"># perl Makefile.PL</span></span><br><span class="line"><span class="comment"># make &amp;&amp; make install</span></span><br></pre></td></tr></table></figure><h4 id="å®‰è£…libwww-perl"><a href="#å®‰è£…libwww-perl" class="headerlink" title="å®‰è£…libwww-perl"></a>å®‰è£…libwww-perl</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tar zxf libwww-perl-6.15.tar.gz</span></span><br><span class="line"><span class="comment"># cd libwww-perl-6.15</span></span><br><span class="line"><span class="comment"># perl Makefile.PL</span></span><br><span class="line"><span class="comment"># make &amp;&amp; make install</span></span><br></pre></td></tr></table></figure><h4 id="å®‰è£…smokeping-1"><a href="#å®‰è£…smokeping-1" class="headerlink" title="å®‰è£…smokeping"></a>å®‰è£…smokeping</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tar zxf smokeping-2.6.11.tar.gz</span></span><br><span class="line"><span class="comment"># cd smokeping-2.6.11</span></span><br><span class="line"><span class="comment"># ./configure --prefix=/usr/local/smokeping</span></span><br><span class="line"><span class="comment"># /usr/bin/gmake install</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢æ˜¯æ‰‹åŠ¨å®‰è£…ï¼Œé’ˆå¯¹ç½‘ç»œä¸èƒ½ç¿»å¢™ã€‚ä¹Ÿå¯ä»¥é‡‡å–smokepingä¸€é”®å®‰è£…çš„æ–¹å¼è¿›è¡Œå®‰è£…</p><h3 id="smokepingä¸€é”®å®‰è£…"><a href="#smokepingä¸€é”®å®‰è£…" class="headerlink" title="smokepingä¸€é”®å®‰è£…"></a>smokepingä¸€é”®å®‰è£…</h3><h4 id="å®‰è£…smokeping-2"><a href="#å®‰è£…smokeping-2" class="headerlink" title="å®‰è£…smokeping"></a>å®‰è£…smokeping</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tar zxf smokeping-2.6.11.tar.gz</span></span><br><span class="line"><span class="comment"># cd smokeping-2.6.11</span></span><br><span class="line"><span class="comment"># ./setup/build-perl-modules.sh /usr/local/smokeping/thirdparty</span></span><br><span class="line"><span class="comment"># ./configure --prefix=/usr/local/smokeping</span></span><br><span class="line"><span class="comment"># /usr/bin/gmake install</span></span><br></pre></td></tr></table></figure><h3 id="é…ç½®smkeping"><a href="#é…ç½®smkeping" class="headerlink" title="é…ç½®smkeping"></a>é…ç½®smkeping</h3><h4 id="åˆ›å»ºcacheã€dataã€varç›®å½•"><a href="#åˆ›å»ºcacheã€dataã€varç›®å½•" class="headerlink" title="åˆ›å»ºcacheã€dataã€varç›®å½•"></a>åˆ›å»ºcacheã€dataã€varç›®å½•</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cd /usr/local/smokeping/</span></span><br><span class="line"><span class="comment"># mkdir &#123;cache,data,var&#125;</span></span><br></pre></td></tr></table></figure><h4 id="åˆ›å»ºæ—¥å¿—æ–‡ä»¶"><a href="#åˆ›å»ºæ—¥å¿—æ–‡ä»¶" class="headerlink" title="åˆ›å»ºæ—¥å¿—æ–‡ä»¶"></a>åˆ›å»ºæ—¥å¿—æ–‡ä»¶</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># touch /var/log/smokeping.log</span></span><br></pre></td></tr></table></figure><h4 id="èµ‹æƒé™"><a href="#èµ‹æƒé™" class="headerlink" title="èµ‹æƒé™"></a>èµ‹æƒé™</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># chown apache:apache cache/ data/ var/</span></span><br><span class="line"><span class="comment"># chown  apache:apache /var/log/smokeping.log</span></span><br><span class="line"><span class="comment"># chmod 755 cache/ data/ var/    #è¿™é‡Œä¹Ÿè¦èµ‹æƒé™ï¼Œä¼šå½±å“å›¾ç‰‡æ— æ³•åŠ è½½</span></span><br></pre></td></tr></table></figure><h4 id="ä¿®æ”¹é…ç½®æ–‡ä»¶"><a href="#ä¿®æ”¹é…ç½®æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹é…ç½®æ–‡ä»¶"></a>ä¿®æ”¹é…ç½®æ–‡ä»¶</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /usr/local/smokeping/htdocs</span></span><br><span class="line"><span class="comment"># cp -arp smokeping.fcgi.dist smokeping.fcgi</span></span><br><span class="line"><span class="comment"># cd ../etc/</span></span><br><span class="line"><span class="comment"># cp -arp config.dist config</span></span><br><span class="line"><span class="comment"># chmod 600 /usr/local/smokeping/etc/smokeping_secrets.dist</span></span><br><span class="line"><span class="comment"># vim config</span></span><br><span class="line">*** General ***</span><br><span class="line">owner    = Peter Random</span><br><span class="line">contact  = some@address.nowhere</span><br><span class="line">mailhost = my.mail.host</span><br><span class="line">sendmail = /usr/sbin/sendmail</span><br><span class="line"><span class="comment"># <span class="doctag">NOTE:</span> do not put the Image Cache below cgi-bin</span></span><br><span class="line"><span class="comment"># since all files under cgi-bin will be executed ... this is not</span></span><br><span class="line"><span class="comment"># good for images.</span></span><br><span class="line">imgcache = /usr/<span class="built_in">local</span>/smokeping/cache</span><br><span class="line">imgurl   = http://172.16.1.100/cache                                                      <span class="comment">#è¿™é‡Œå¦‚æœä¸é…ç½®æ­£ç¡®ï¼Œä¼šå½±å“åé¢å‡ºå›¾ï¼Œè¿™é‡Œä¸€ä¸ªå‘</span></span><br><span class="line">datadir  = /usr/<span class="built_in">local</span>/smokeping/data</span><br><span class="line">piddir  = /usr/<span class="built_in">local</span>/smokeping/var</span><br><span class="line">cgiurl   = http://172.16.1.100/smokeping/smokeping.cgi</span><br><span class="line"><span class="comment">#cgiurl   = http://some.url/smokeping.cgi</span></span><br><span class="line">smokemail = /usr/<span class="built_in">local</span>/smokeping/etc/smokemail.dist</span><br><span class="line">tmail = /usr/<span class="built_in">local</span>/smokeping/etc/tmail.dist</span><br><span class="line"><span class="comment"># specify this to get syslog logging</span></span><br><span class="line">syslogfacility = local0</span><br><span class="line"><span class="comment"># each probe is now run in its own process</span></span><br><span class="line"><span class="comment"># disable this to revert to the old behaviour</span></span><br><span class="line"><span class="comment"># concurrentprobes = no</span></span><br><span class="line">*** Alerts ***</span><br><span class="line">to = alertee@address.somewhere</span><br><span class="line">from = smokealert@company.xy</span><br><span class="line">+someloss</span><br><span class="line"><span class="built_in">type</span> = loss</span><br><span class="line"><span class="comment"># in percent</span></span><br><span class="line">pattern = &gt;0%,*12*,&gt;0%,*12*,&gt;0%</span><br><span class="line">comment = loss 3 <span class="built_in">times</span>  <span class="keyword">in</span> a row</span><br><span class="line">*** Database ***</span><br><span class="line">step     = 60                                              <span class="comment">#æ£€æµ‹æ—¶é—´ï¼Œé»˜è®¤300</span></span><br><span class="line">pings    = 20</span><br></pre></td></tr></table></figure><p>é…ç½®æ–‡ä»¶ä¸Šè¿°ä¿®æ”¹å¸¦æœ‰æ³¨è§†éƒ¨åˆ†ï¼Œå…¶ä»–å‚æ•°å‚è€ƒå®˜æ–¹ï¼Œè€Œä¸”éƒ½èƒ½çœ‹æ‡‚ã€‚åé¢æœ‰å¾ˆå¤šé…ç½®ä¸å…¨éƒ¨è´´å‡ºæ¥</p><h3 id="é…ç½®apache"><a href="#é…ç½®apache" class="headerlink" title="é…ç½®apache"></a>é…ç½®apache</h3><h4 id="é…ç½®httpd-conf"><a href="#é…ç½®httpd-conf" class="headerlink" title="é…ç½®httpd.conf"></a>é…ç½®httpd.conf</h4><p>åœ¨DocumentRoot â€œ/var/www/htmlâ€è¿™è¡Œå¢åŠ å¦‚ä¸‹å†…å®¹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/httpd/conf/httpd.conf</span></span><br><span class="line">Alias /cache <span class="string">"/usr/local/smokeping/cache"</span></span><br><span class="line">Alias /cropper <span class="string">"/usr/local/smokeping/htdocs/cropper"</span></span><br><span class="line">Alias /smokeping <span class="string">"/usr/local/smokeping/htdocs/smokeping.fcgi"</span></span><br><span class="line">&lt;Directory <span class="string">"/usr/local/smokeping"</span>&gt;</span><br><span class="line">        AllowOverride None</span><br><span class="line">        Options All</span><br><span class="line">        AddHandler cgi-script .fcgi .cgi</span><br><span class="line">        Order allow,deny</span><br><span class="line">        Allow from all</span><br><span class="line">        AuthName <span class="string">"Smokeping"</span></span><br><span class="line">        AuthType Basic</span><br><span class="line">        AuthUserFile /usr/<span class="built_in">local</span>/smokeping/htdocs/htpasswd</span><br><span class="line">        Require valid-user</span><br><span class="line">        DirectoryIndex smokeping.fcgi</span><br><span class="line">&lt;/Directory&gt;</span><br></pre></td></tr></table></figure><h4 id="apacheç™»å½•è®¤è¯"><a href="#apacheç™»å½•è®¤è¯" class="headerlink" title="apacheç™»å½•è®¤è¯"></a>apacheç™»å½•è®¤è¯</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /usr/local/smokeping/htdocs</span></span><br><span class="line"><span class="comment"># htpasswd -c /usr/local/smokeping/htdocs/htpasswd admin                   #å›è½¦è®¾ç½®adminè´¦æˆ·çš„å¯†ç </span></span><br></pre></td></tr></table></figure><h4 id="å®‰è£…ç½‘é¡µæ”¯æŒçš„ä¸­æ–‡å­—ä½“"><a href="#å®‰è£…ç½‘é¡µæ”¯æŒçš„ä¸­æ–‡å­—ä½“" class="headerlink" title="å®‰è£…ç½‘é¡µæ”¯æŒçš„ä¸­æ–‡å­—ä½“"></a>å®‰è£…ç½‘é¡µæ”¯æŒçš„ä¸­æ–‡å­—ä½“</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum -y install wqy-zenhei-fonts.noarch</span></span><br></pre></td></tr></table></figure><h4 id="smokepingå¼€æœºè„šæœ¬"><a href="#smokepingå¼€æœºè„šæœ¬" class="headerlink" title="smokepingå¼€æœºè„šæœ¬"></a>smokepingå¼€æœºè„šæœ¬</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/init.d/smokeping</span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">PIDFILE=/usr/<span class="built_in">local</span>/smokeping/var/smokeping.pid</span><br><span class="line">SMOKEPING=/usr/<span class="built_in">local</span>/smokeping/bin/smokeping</span><br><span class="line">ERROR=0</span><br><span class="line">RUNNING=0</span><br><span class="line">ARGV=<span class="string">"<span class="variable">$@</span>"</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"x<span class="variable">$ARGV</span>"</span> = <span class="string">"x"</span> ] ; <span class="keyword">then</span></span><br><span class="line">ARGS=<span class="built_in">help</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">for</span> ARG <span class="keyword">in</span> <span class="variable">$@</span> <span class="variable">$ARGS</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="keyword">if</span> [ -f <span class="variable">$PIDFILE</span> ] ; <span class="keyword">then</span></span><br><span class="line">PID=`cat <span class="variable">$PIDFILE</span>`</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">kill</span> -0 <span class="variable">$PID</span> 2&gt;/dev/null ; <span class="keyword">then</span></span><br><span class="line"><span class="comment"># smokeping is running</span></span><br><span class="line">RUNNING=1</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="comment"># smokeping not running but PID file exists =&gt; delete PID file</span></span><br><span class="line">rm -f <span class="variable">$PIDFILE</span></span><br><span class="line">RUNNING=0</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="comment"># smokeping (no pid file) not running</span></span><br><span class="line">RUNNING=0</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$ARG</span> <span class="keyword">in</span></span><br><span class="line">start)</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$RUNNING</span> -eq 0 ] ; <span class="keyword">then</span></span><br><span class="line"><span class="keyword">if</span> <span class="variable">$SMOKEPING</span> &gt; /dev/null; <span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$0</span> <span class="variable">$ARG</span>: smokeping started"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$0</span> <span class="variable">$ARG</span>: smokeping could not be started"</span></span><br><span class="line">ERROR=1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$0</span> <span class="variable">$ARG</span>: smokeping is running with PID <span class="variable">$PID</span>"</span></span><br><span class="line">ERROR=2</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">;;</span><br><span class="line">stop)</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$RUNNING</span> -eq 1 ] ; <span class="keyword">then</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">kill</span> <span class="variable">$PID</span> ; <span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$0</span> <span class="variable">$ARG</span>: smokeping (<span class="variable">$PID</span>) stopped"</span></span><br><span class="line">rm <span class="variable">$PIDFILE</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$0</span> <span class="variable">$ARG</span>: smokeping could not be stopped"</span></span><br><span class="line">ERROR=3</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$0</span> <span class="variable">$ARG</span>: smokeping not running"</span></span><br><span class="line">ERROR=4</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">;;</span><br><span class="line">restart)</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$RUNNING</span> -eq 1 ] ; <span class="keyword">then</span></span><br><span class="line"><span class="keyword">if</span> <span class="variable">$SMOKEPING</span> --restart &gt; /dev/null; <span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$0</span> <span class="variable">$ARG</span>: smokeping restarted"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$0</span> <span class="variable">$ARG</span>: smokeping could not be started"</span></span><br><span class="line">ERROR=5</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="variable">$0</span> start</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">;;</span><br><span class="line">strace_debug)</span><br><span class="line">rm -f /tmp/strace_smokeping</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$RUNNING</span> -eq 1 ] ; <span class="keyword">then</span></span><br><span class="line"><span class="keyword">if</span> strace -o/tmp/strace_smokeping <span class="variable">$SMOKEPING</span> --restart &gt;/dev/null; <span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$0</span> <span class="variable">$ARG</span>: smokeping restarted with strace debug in /tmp/strace_smokeping"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$0</span> <span class="variable">$ARG</span>: smokeping strace debug could not be started"</span></span><br><span class="line">ERROR=6</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">if</span> strace -o/tmp/strace_smokeping <span class="variable">$SMOKEPING</span> &gt;/dev/null; <span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$0</span> <span class="variable">$ARG</span>: smokeping started with strace debug in /tmp/strace_smokeping"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$0</span> <span class="variable">$ARG</span>: smokeping strace debug could not be started"</span></span><br><span class="line">ERROR=7</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">;;</span><br><span class="line">status)</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$RUNNING</span> -eq 1 ] ; <span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$0</span> <span class="variable">$ARG</span>: smokeping is running with PID (<span class="variable">$PID</span>)"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$0</span> <span class="variable">$ARG</span>: smokeping is not running"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">;;</span><br><span class="line">*)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"usage: <span class="variable">$0</span> (start|stop|restart|status|strace_debug|help)"</span></span><br><span class="line">cat</span><br><span class="line">start - start smokeping</span><br><span class="line">stop - stop smokeping</span><br><span class="line">restart - restart smokeping <span class="keyword">if</span> running or start <span class="keyword">if</span> not running</span><br><span class="line">status - show status <span class="keyword">if</span> smokeping is running or not</span><br><span class="line"><span class="built_in">help</span> - this screen</span><br><span class="line">EOF</span><br><span class="line">;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">exit</span> <span class="variable">$ERROR</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># chmod +x /etc/init.d/smokeping</span></span><br></pre></td></tr></table></figure><h4 id="å¯åŠ¨æœåŠ¡"><a href="#å¯åŠ¨æœåŠ¡" class="headerlink" title="å¯åŠ¨æœåŠ¡"></a>å¯åŠ¨æœåŠ¡</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># service httpd start</span></span><br><span class="line"><span class="comment"># /etc/init.d/smokeping start</span></span><br></pre></td></tr></table></figure><p>æ‰“å¼€æµè§ˆå™¨æµ‹è¯•http://{ip}/smokeping  ä¼šæç¤ºè¾“å…¥ç”¨æˆ·å’Œå¯†ç <br><img src="http://img.xxlaila.cn/74D2C8DE-129F-4219-87C5-D6A771D19484.png" alt="img"><br><img src="http://img.xxlaila.cn/91D9FA70-65B1-4752-8F15-68A158E72A49.png" alt="img"></p><h4 id="é…ç½®æ–‡ä»¶æ·»åŠ "><a href="#é…ç½®æ–‡ä»¶æ·»åŠ " class="headerlink" title="é…ç½®æ–‡ä»¶æ·»åŠ "></a>é…ç½®æ–‡ä»¶æ·»åŠ </h4><p>é…ç½®æ–‡ä»¶æ·»ä»‹ç»ï¼Œåœ¨é…ç½®æ–‡ä»¶é‡Œé¢+è¡¨ç¤ºä¸€çº§++è¡¨ç¤ºäºŒçº§+++ä¸‰çº§<br>æœ¬æ¬¡æ·»åŠ çš„å†…å®¹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br></pre></td><td class="code"><pre><span class="line">+ Other</span><br><span class="line">menu = å…¶ä»–ç½‘ç»œç›‘æ§</span><br><span class="line">title = å…¶ä»–æ‰€æœ‰ç½‘ç»œç›‘æ§åˆ—è¡¨</span><br><span class="line">++ dianxin</span><br><span class="line">menu = ç”µä¿¡ç½‘ç»œç›‘æ§</span><br><span class="line">title = ç”µä¿¡ç½‘ç»œç›‘æ§åˆ—è¡¨</span><br><span class="line">host = /Other/dianxin/dianxin-hlj /Other/dianxin/dianxin-gd /Other/dianxin/dianxin-gs /Other/dianxin/dianxin-sh /Other/dianxin/dianxin-sc /Other/dianxin/dianxin-cq /Other/dianxin/dianxin-gz /Other/dianxin/dianxin-ln /Other/dianxin/dianxin-zj /Other/dianxin/dianxin-sd /Other/dianxin/dianxin-hib /Other/dianxin/dianxin-ah /Other/dianxin/dianxin-hb /Other/dianxin/dianxin-jl /Other/dianxin/dianxin-jx</span><br><span class="line">+++ dianxin-hlj</span><br><span class="line">menu = é»‘é¾™æ±Ÿç”µä¿¡</span><br><span class="line">title = é»‘é¾™æ±Ÿç”µä¿¡</span><br><span class="line">alerts = someloss</span><br><span class="line"><span class="comment">#slaves = boomer slave2</span></span><br><span class="line">host = 219.150.32.132</span><br><span class="line">+++ dianxin-gd</span><br><span class="line">menu = å¹¿ä¸œç”µä¿¡</span><br><span class="line">title = å¹¿ä¸œç”µä¿¡</span><br><span class="line">alerts = someloss</span><br><span class="line"><span class="comment">#slaves = boomer slave2</span></span><br><span class="line">host = 202.96.134.133</span><br><span class="line">+++ dianxin-gs</span><br><span class="line">menu = ç”˜è‚ƒç”µä¿¡</span><br><span class="line">title = ç”˜è‚ƒç”µä¿¡</span><br><span class="line">alerts = someloss</span><br><span class="line"><span class="comment">#slaves = boomer slave2</span></span><br><span class="line">host = 202.100.64.68</span><br><span class="line">+++ dianxin-sh</span><br><span class="line">menu = ä¸Šæµ·ç”µä¿¡</span><br><span class="line">title = ä¸Šæµ·ç”µä¿¡</span><br><span class="line">alerts = someloss</span><br><span class="line"><span class="comment">#slaves = boomer slave2</span></span><br><span class="line">host = 202.96.209.5</span><br><span class="line">+++ dianxin-sc</span><br><span class="line">menu = å››å·ç”µä¿¡</span><br><span class="line">title = å››å·ç”µä¿¡</span><br><span class="line">alerts = someloss</span><br><span class="line">host = 218.6.145.111</span><br><span class="line">+++ dianxin-cq</span><br><span class="line">menu = é‡åº†ç”µä¿¡</span><br><span class="line">title = é‡åº†ç”µä¿¡</span><br><span class="line">alerts = someloss</span><br><span class="line">host = 61.128.128.68</span><br><span class="line">+++ dianxin-gz</span><br><span class="line">menu = è´µå·ç”µä¿¡</span><br><span class="line">title = è´µå·ç”µä¿¡</span><br><span class="line">alerts = someloss</span><br><span class="line">host = 202.98.192.68</span><br><span class="line">+++ dianxin-ln</span><br><span class="line">menu = è¾½å®ç”µä¿¡</span><br><span class="line">title = è¾½å®ç”µä¿¡</span><br><span class="line">alerts = someloss</span><br><span class="line">host = 219.149.6.99</span><br><span class="line">+++ dianxin-zj</span><br><span class="line">menu = æµ™æ±Ÿç”µä¿¡</span><br><span class="line">title = æµ™æ±Ÿç”µä¿¡</span><br><span class="line">alerts = someloss</span><br><span class="line">host = 202.96.96.68</span><br><span class="line">+++ dianxin-sd</span><br><span class="line">menu = å±±ä¸œç”µä¿¡</span><br><span class="line">title = å±±ä¸œç”µä¿¡</span><br><span class="line">alerts = someloss</span><br><span class="line">host = 222.173.95.53</span><br><span class="line">+++ dianxin-hib</span><br><span class="line">menu = æ¹–åŒ—ç”µä¿¡</span><br><span class="line">title = æ¹–åŒ—ç”µä¿¡</span><br><span class="line">alerts = someloss</span><br><span class="line">host = 202.103.0.68</span><br><span class="line">+++ dianxin-ah</span><br><span class="line">menu = å®‰å¾½ç”µä¿¡</span><br><span class="line">title = å®‰å¾½ç”µä¿¡</span><br><span class="line">alerts = someloss</span><br><span class="line">host = 220.178.75.134</span><br><span class="line">+++ dianxin-hb</span><br><span class="line">menu = æ²³åŒ—ç”µä¿¡</span><br><span class="line">title = æ²³åŒ—ç”µä¿¡</span><br><span class="line">alerts = someloss</span><br><span class="line">host = 202.99.160.68</span><br><span class="line">+++ dianxin-jl</span><br><span class="line">menu = å‰æ—ç”µä¿¡</span><br><span class="line">title = å‰æ—ç”µä¿¡</span><br><span class="line">alerts = someloss</span><br><span class="line">host =  219.149.194.55</span><br><span class="line">+++ dianxin-jx</span><br><span class="line">menu = æ±Ÿè¥¿ç”µä¿¡</span><br><span class="line">title = æ±Ÿè¥¿ç”µä¿¡</span><br><span class="line">alerts = someloss</span><br><span class="line">host = 202.101.224.68</span><br><span class="line"><span class="comment">#+++ dianxin-multi</span></span><br><span class="line"><span class="comment">#menu = å¤šä¸ªç”µä¿¡ç½‘ç»œç›‘æ§åˆ—è¡¨</span></span><br><span class="line"><span class="comment">#title = å¤šä¸ªç”µä¿¡ç½‘ç»œç›‘æ§åˆ—è¡¨</span></span><br><span class="line"><span class="comment">#alerts = someloss</span></span><br><span class="line"><span class="comment">#slaves = boomer slave2</span></span><br><span class="line"><span class="comment">#host = /Other/dianxin/dianxin-hlj /Other/dianxin/dianxin-gd /Other/dianxin/dianxin-gs /Other/dianxin/dianxin-sh</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">++ liantong</span><br><span class="line">menu = è”é€šç½‘ç»œç›‘æ§</span><br><span class="line">title = è”é€šç½‘ç»œç›‘æ§åˆ—è¡¨</span><br><span class="line">host = /Other/liantong/liantong-hlj /Other/liantong/liantong-gd /Other/liantong/liantong-gs /Other/liantong/liantong-sh /Other/liantong/liantong-sc /Other/liantong/liantong-cq /Other/liantong/liantong-gz /Other/liantong/liantong-ln /Other/liantong/liantong-zj /Other/liantong/liantong-sd /Other/liantong/liantong-hib /Other/liantong/liantong-ah /Other/liantong/liantong-hb /Other/liantong/liantong-jl /Other/liantong/liantong-jx</span><br><span class="line">+++ liantong-hlj</span><br><span class="line">menu = é»‘é¾™æ±Ÿè”é€š</span><br><span class="line">title = é»‘é¾™æ±Ÿè”é€š</span><br><span class="line">alerts = someloss</span><br><span class="line"><span class="comment">#slaves = boomer slave2</span></span><br><span class="line">host = 202.97.224.68</span><br><span class="line">+++ liantong-gd</span><br><span class="line">menu = å¹¿ä¸œè”é€š</span><br><span class="line">title = å¹¿ä¸œè”é€š</span><br><span class="line">alerts = someloss</span><br><span class="line"><span class="comment">#slaves = boomer slave2</span></span><br><span class="line">host = 221.4.66.66</span><br><span class="line">+++ liantong-gs</span><br><span class="line">menu = ç”˜è‚ƒè”é€š</span><br><span class="line">title = ç”˜è‚ƒè”é€š</span><br><span class="line">alerts = someloss</span><br><span class="line"><span class="comment">#slaves = boomer slave2</span></span><br><span class="line">host = 221.7.34.10</span><br><span class="line">+++ liantong-sh</span><br><span class="line">menu = ä¸Šæµ·è”é€š</span><br><span class="line">title = ä¸Šæµ·è”é€š</span><br><span class="line">alerts = someloss</span><br><span class="line"><span class="comment">#slaves = boomer slave2</span></span><br><span class="line">host = 210.22.70.3</span><br><span class="line">+++ liantong-sc</span><br><span class="line">menu = å››å·è”é€š</span><br><span class="line">title = å››å·è”é€š</span><br><span class="line">alerts = someloss</span><br><span class="line">host = 119.6.6.6</span><br><span class="line">+++ liantong-cq</span><br><span class="line">menu = é‡åº†è”é€š</span><br><span class="line">title = é‡åº†è”é€š</span><br><span class="line">alerts = someloss</span><br><span class="line">host = 221.7.92.98</span><br><span class="line">+++ liantong-gz</span><br><span class="line">menu = è´µå·è”é€š</span><br><span class="line">title = è´µå·è”é€š</span><br><span class="line">alerts = someloss</span><br><span class="line">host = 221.13.30.242</span><br><span class="line">+++ liantong-ln</span><br><span class="line">menu = è¾½å®è”é€š</span><br><span class="line">title = è¾½å®è”é€š</span><br><span class="line">alerts = someloss</span><br><span class="line">host = 124.161.97.234</span><br><span class="line">+++ liantong-zj</span><br><span class="line">menu = æµ™æ±Ÿè”é€š</span><br><span class="line">title = æµ™æ±Ÿè”é€š</span><br><span class="line">alerts = someloss</span><br><span class="line">host = 221.12.33.227</span><br><span class="line">+++ liantong-sd</span><br><span class="line">menu = å±±ä¸œè”é€š</span><br><span class="line">title = å±±ä¸œè”é€š</span><br><span class="line">alerts = someloss</span><br><span class="line">host = 202.102.152.3</span><br><span class="line">+++ liantong-hib</span><br><span class="line">menu = æ¹–åŒ—è”é€š</span><br><span class="line">title = æ¹–åŒ—è”é€š</span><br><span class="line">alerts = someloss</span><br><span class="line">host = 218.104.111.114</span><br><span class="line">+++ liantong-ah</span><br><span class="line">menu = å®‰å¾½è”é€š</span><br><span class="line">title = å®‰å¾½è”é€š</span><br><span class="line">alerts = someloss</span><br><span class="line">host = 211.91.88.129</span><br><span class="line">+++ liantong-hb</span><br><span class="line">menu = æ²³åŒ—è”é€š</span><br><span class="line">title = æ²³åŒ—è”é€š</span><br><span class="line">alerts = someloss</span><br><span class="line">host = 202.99.160.68</span><br><span class="line">+++ liantong-jl</span><br><span class="line">menu = å‰æ—è”é€š</span><br><span class="line">title = å‰æ—è”é€š</span><br><span class="line">alerts = someloss</span><br><span class="line">host = 202.98.5.6</span><br><span class="line">+++ liantong-jx</span><br><span class="line">menu = æ±Ÿè¥¿è”é€š</span><br><span class="line">title = æ±Ÿè¥¿è”é€š</span><br><span class="line">alerts = someloss</span><br><span class="line">host = 220.248.192.12</span><br><span class="line"><span class="comment">#+++ liantong-multi</span></span><br><span class="line"><span class="comment">#menu = å¤šä¸ªè”é€šç½‘ç»œç›‘æ§åˆ—è¡¨</span></span><br><span class="line"><span class="comment">#title = å¤šä¸ªè”é€šç½‘ç»œç›‘æ§åˆ—è¡¨</span></span><br><span class="line"><span class="comment">#alerts = someloss</span></span><br><span class="line"><span class="comment">#slaves = boomer slave2</span></span><br><span class="line"><span class="comment">#host = /Other/liantong/liantong-hlj /Other/liantong/liantong-gd /Other/liantong/liantong-gs /Other/liantong/liantong-sh</span></span><br><span class="line">++ yidong</span><br><span class="line">menu = ç§»åŠ¨ç½‘ç»œç›‘æ§</span><br><span class="line">title = ç§»åŠ¨ç½‘ç»œç›‘æ§åˆ—è¡¨</span><br><span class="line">host = /Other/yidong/yidong-hlj /Other/yidong/yidong-gd /Other/yidong/yidong-gs /Other/yidong/yidong-sh /Other/yidong/yidong-sc /Other/yidong/yidong-cq /Other/yidong/yidong-gz /Other/yidong/yidong-ln /Other/yidong/yidong-zj /Other/yidong/yidong-sd /Other/yidong/yidong-hib /Other/yidong/yidong-ah /Other/yidong/yidong-hb</span><br><span class="line">+++ yidong-hlj</span><br><span class="line">menu = é»‘é¾™æ±Ÿç§»åŠ¨</span><br><span class="line">title = é»‘é¾™æ±Ÿç§»åŠ¨</span><br><span class="line">alerts = someloss</span><br><span class="line"><span class="comment">#slaves = boomer slave2</span></span><br><span class="line">host = 211.137.241.34</span><br><span class="line">+++ yidong-gd</span><br><span class="line">menu = å¹¿ä¸œç§»åŠ¨</span><br><span class="line">title = å¹¿ä¸œç§»åŠ¨</span><br><span class="line">alerts = someloss</span><br><span class="line"><span class="comment">#slaves = boomer slave2</span></span><br><span class="line">host = 211.137.241.34</span><br><span class="line">+++ yidong-gs</span><br><span class="line">menu = ç”˜è‚ƒç§»åŠ¨</span><br><span class="line">title = ç”˜è‚ƒç§»åŠ¨</span><br><span class="line">alerts = someloss</span><br><span class="line"><span class="comment">#slaves = boomer slave2</span></span><br><span class="line">host = 218.203.160.194</span><br><span class="line">+++ yidong-sh</span><br><span class="line">menu = ä¸Šæµ·ç§»åŠ¨</span><br><span class="line">title = ä¸Šæµ·ç§»åŠ¨</span><br><span class="line">alerts = someloss</span><br><span class="line"><span class="comment">#slaves = boomer slave2</span></span><br><span class="line">host = 117.131.0.22</span><br><span class="line">+++ yidong-sc</span><br><span class="line">menu = å››å·ç§»åŠ¨</span><br><span class="line">title = å››å·ç§»åŠ¨</span><br><span class="line">alerts = someloss</span><br><span class="line">host = 211.137.96.205</span><br><span class="line">+++ yidong-cq</span><br><span class="line">menu = é‡åº†ç§»åŠ¨</span><br><span class="line">title = é‡åº†ç§»åŠ¨</span><br><span class="line">alerts = someloss</span><br><span class="line">host = 218.201.4.3</span><br><span class="line">+++ yidong-gz</span><br><span class="line">menu = è´µå·ç§»åŠ¨</span><br><span class="line">title = è´µå·ç§»åŠ¨</span><br><span class="line">alerts = someloss</span><br><span class="line">host = 211.139.1.3</span><br><span class="line">+++ yidong-ln</span><br><span class="line">menu = è¾½å®ç§»åŠ¨</span><br><span class="line">title = è¾½å®ç§»åŠ¨</span><br><span class="line">alerts = someloss</span><br><span class="line">host = 218.59.181.182</span><br><span class="line">+++ yidong-zj</span><br><span class="line">menu = æµ™æ±Ÿç§»åŠ¨</span><br><span class="line">title = æµ™æ±Ÿç§»åŠ¨</span><br><span class="line">alerts = someloss</span><br><span class="line">host = 211.140.10.2</span><br><span class="line">+++ yidong-sd</span><br><span class="line">menu = å±±ä¸œç§»åŠ¨</span><br><span class="line">title = å±±ä¸œç§»åŠ¨</span><br><span class="line">alerts = someloss</span><br><span class="line">host = 211.137.191.26</span><br><span class="line">+++ yidong-hib</span><br><span class="line">menu = æ¹–åŒ—ç§»åŠ¨</span><br><span class="line">title = æ¹–åŒ—ç§»åŠ¨</span><br><span class="line">alerts = someloss</span><br><span class="line">host = 211.137.76.68</span><br><span class="line">+++ yidong-ah</span><br><span class="line">menu = å®‰å¾½ç§»åŠ¨</span><br><span class="line">title = å®‰å¾½ç§»åŠ¨</span><br><span class="line">alerts = someloss</span><br><span class="line">host = 211.138.180.2</span><br><span class="line">+++ yidong-hb</span><br><span class="line">menu = æ²³åŒ—ç§»åŠ¨</span><br><span class="line">title = æ²³åŒ—ç§»åŠ¨</span><br><span class="line">alerts = someloss</span><br><span class="line">host = 211.98.2.4</span><br><span class="line"><span class="comment">#+++ yidong-multi</span></span><br><span class="line"><span class="comment">#menu = å¤šä¸ªç§»åŠ¨ç½‘ç»œç›‘æ§åˆ—è¡¨</span></span><br><span class="line"><span class="comment">#title = å¤šä¸ªç§»åŠ¨ç½‘ç»œç›‘æ§åˆ—è¡¨</span></span><br><span class="line"><span class="comment">#alerts = someloss</span></span><br><span class="line"><span class="comment">#slaves = boomer slave2</span></span><br><span class="line"><span class="comment">#host = /Other/yidong/yidong-hlj /Other/yidong/yidong-gd /Other/yidong/yidong-gs /Other/yidong/yidong-sh</span></span><br><span class="line">++ jiaoyu</span><br><span class="line">menu = æ•™è‚²ç½‘ç»œç›‘æ§</span><br><span class="line">title = æ•™è‚²ç½‘ç»œç›‘æ§åˆ—è¡¨</span><br><span class="line">host = /Other/jiaoyu/jiaoyu-qh /Other/jiaoyu/jiaoyu-sh /Other/jiaoyu/jiaoyu-wh /Other/jiaoyu/jiaoyu-hn</span><br><span class="line">+++ jiaoyu-qh</span><br><span class="line">menu = æ¸…åå¤§å­¦</span><br><span class="line">title = æ¸…åå¤§å­¦</span><br><span class="line">alerts = someloss</span><br><span class="line"><span class="comment">#slaves = boomer slave2</span></span><br><span class="line">host = 166.111.8.28</span><br><span class="line">+++ jiaoyu-sh</span><br><span class="line">menu = ä¸Šæµ·äº¤å¤§</span><br><span class="line">title = ä¸Šæµ·äº¤å¤§</span><br><span class="line">alerts = someloss</span><br><span class="line"><span class="comment">#slaves = boomer slave2</span></span><br><span class="line">host = 202.112.26.34</span><br><span class="line">+++ jiaoyu-wh</span><br><span class="line">menu = æ­¦æ±‰ç§‘æŠ€å¤§å­¦</span><br><span class="line">title = æ­¦æ±‰ç§‘æŠ€å¤§å­¦</span><br><span class="line">alerts = someloss</span><br><span class="line"><span class="comment">#slaves = boomer slave2</span></span><br><span class="line">host = 202.114.240.6</span><br><span class="line">+++ jiaoyu-hn</span><br><span class="line">menu = åå—å†œä¸šå¤§å­¦</span><br><span class="line">title = åå—å†œä¸šå¤§å­¦</span><br><span class="line">alerts = someloss</span><br><span class="line"><span class="comment">#slaves = boomer slave2</span></span><br><span class="line">host = 202.116.160.33</span><br><span class="line"><span class="comment">#+++ jiaoyu-multi</span></span><br><span class="line"><span class="comment">#menu = å¤šä¸ªæ•™è‚²ç½‘ç»œç›‘æ§åˆ—è¡¨</span></span><br><span class="line"><span class="comment">#title = å¤šä¸ªæ•™è‚²ç½‘ç»œç›‘æ§åˆ—è¡¨</span></span><br><span class="line"><span class="comment">#alerts = someloss</span></span><br><span class="line"><span class="comment">#slaves = boomer slave2</span></span><br><span class="line"><span class="comment">#host = /Other/jiaoyu/jiaoyu-qh /Other/jiaoyu/jiaoyu-sh /Other/jiaoyu/jiaoyu-wh /Other/jiaoyu/jiaoyu-hn</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;éœ€æ±‚&quot;&gt;&lt;a href=&quot;#éœ€æ±‚&quot; class=&quot;headerlink&quot; title=&quot;éœ€æ±‚&quot;&gt;&lt;/a&gt;éœ€æ±‚&lt;/h3&gt;&lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;ç›‘æ§IDCæœºæˆ¿ç½‘ç»œè´¨é‡æƒ…å†µï¼Œæœ¬åœ°åŒºåˆ°å…¶ä»–åœ°åŒºï¼Œå…¶ä»–åœ°åŒºåˆ°æœ¬èŠ‚ç‚¹ï¼Œæˆ–è€…å„çœå¸‚æ—¶é—´ç½‘ç»œã€è¿è¥å•†ç½‘ç»œçŠ¶æ€ï¼Œç›‘è§†ç½‘ç»œæ€§èƒ½ï¼ŒåŒ…æ‹¬å¸¸è§„çš„ pingï¼Œç”¨ fpingã€echopingã€tracert ç›‘è§† www æœåŠ¡å™¨æ€§èƒ½ï¼Œç›‘è§† dns æŸ¥è¯¢æ€§èƒ½ï¼Œç›‘è§† ssh æ€§èƒ½ç­‰ã€‚åº•å±‚ä¹Ÿæ˜¯ rrdtool åšæ”¯æŒï¼Œç‰¹ç‚¹æ˜¯ç”»çš„å›¾éå¸¸æ¼‚äº®ï¼Œç½‘ç»œä¸¢åŒ…å’Œå»¶è¿Ÿç”¨é¢œè‰²å’Œé˜´å½±æ¥è¡¨ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Smokepingã€‚æœ€æ–°ç‰ˆæœ¬çš„ Smokeping æ”¯æŒå¤šä¸ªèŠ‚ç‚¹çš„æ£€æµ‹ç»“æœä»ä¸€ä¸ªå›¾ä¸Šç”»å‡ºæ¥&lt;/p&gt;
    
    </summary>
    
      <category term="ç›‘æ§" scheme="https://xxlaila.github.io//categories/%E7%9B%91%E6%8E%A7/"/>
    
    
  </entry>
  
  <entry>
    <title>Linux å¸¸ç”¨å‘½ä»¤å­¦ä¹ </title>
    <link href="https://xxlaila.github.io/2019/09/25/Linux%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E5%AD%A6%E4%B9%A0/"/>
    <id>https://xxlaila.github.io/2019/09/25/Linuxå¸¸ç”¨å‘½ä»¤å­¦ä¹ /</id>
    <published>2019-09-25T03:38:07.000Z</published>
    <updated>2019-10-23T00:39:00.657Z</updated>
    
    <content type="html"><![CDATA[<h4 id="æŸ¥æ‰¾æ–‡ä»¶ä½¿ç”¨å‘½ä»¤"><a href="#æŸ¥æ‰¾æ–‡ä»¶ä½¿ç”¨å‘½ä»¤" class="headerlink" title="æŸ¥æ‰¾æ–‡ä»¶ä½¿ç”¨å‘½ä»¤"></a>æŸ¥æ‰¾æ–‡ä»¶ä½¿ç”¨å‘½ä»¤</h4><ul><li><p>æŸ¥æ‰¾ç›®å½•ä¸‹é¢å¤§å°è¶…è¿‡5Mçš„æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ find /home/ -size +5M</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥æ‰¾ç›®å½•ä¸‹100å¤©ä¹‹å‰ä¿®æ”¹è¿‡çš„æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ find /home/ -mtime +100</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥æ‰¾ç›®å½•ä¸‹60å¤©æœªè¢«è®¿é—®è¿‡çš„æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ find /home/ \! atime -60</span><br></pre></td></tr></table></figure></li></ul><a id="more"></a><ul><li>æŸ¥æ‰¾ç›®å½•ä¸‹é¢æ–‡ä»¶â€œcoreâ€œï¼Œå¦‚æœå‘ç°æ— éœ€æç¤ºç›´æ¥åˆ é™¤ã€‚<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ find / -name core -<span class="built_in">exec</span> rm &#123;&#125; \</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥æ‰¾æ’é™¤æŸä¸€ä¸ªæ–‡ä»¶ç„¶åè¿›è¡Œåˆ é™¤</span></span><br><span class="line">$ find / -<span class="built_in">type</span> f ! -name <span class="string">"test"</span> -<span class="built_in">exec</span> rm &#123;&#125; \;</span><br><span class="line">$ find ./ -mtime +3 -name <span class="string">"*.log"</span> -<span class="built_in">exec</span> rm -rf &#123;&#125; \;</span><br><span class="line">$ find /tmp -mtime +30 -<span class="built_in">type</span> f -name <span class="string">"*.sh[ab]"</span> -<span class="built_in">exec</span> rm -f &#123;&#125; \;</span><br></pre></td></tr></table></figure></li></ul><p>åœ¨ä¸€ä¸ªç›®å½•ä¸­ä¿ç•™æœ€è¿‘30å¤©çš„æ–‡ä»¶ï¼Œ30å¤©å‰çš„æ–‡ä»¶è‡ªåŠ¨åˆ é™¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ find /tmp -mtime +30 -<span class="built_in">type</span> f -name <span class="string">"*.sh[ab]"</span> -<span class="built_in">exec</span> rm -f &#123;&#125; \;</span><br></pre></td></tr></table></figure><ul><li>/tmp  â€“è®¾ç½®æŸ¥æ‰¾çš„ç›®å½•ï¼›</li><li>-mtime +30 â€“è®¾ç½®æ—¶é—´ä¸º30å¤©å‰ï¼›</li><li>-type f â€“è®¾ç½®æŸ¥æ‰¾çš„ç±»å‹ä¸ºæ–‡ä»¶ï¼›</li><li>-name *.sh[ab] â€“è®¾ç½®æ–‡ä»¶åç§°ä¸­åŒ…å«shaæˆ–è€…shbï¼›</li><li>-exec rm -f â€“æŸ¥æ‰¾å®Œæ¯•åæ‰§è¡Œåˆ é™¤æ“ä½œï¼›</li><li><strong>æç¤º</strong>ï¼šå°†æ­¤å‘½ä»¤å†™å…¥crontabåå³å¯è‡ªåŠ¨å®ŒæˆæŸ¥æ‰¾å¹¶åˆ é™¤çš„å·¥ä½œ</li></ul><ul><li>æ˜¾ç¤ºç›®å½•æ–‡ä»¶çš„æ–‡ä»¶åå’Œå®ƒä»¬çš„æ‹¥æœ‰è€…<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ll | awk <span class="string">'&#123;print $3,"owns",$9&#125;'</span></span><br></pre></td></tr></table></figure></li></ul><p>æ˜¾ç¤ºä½ çš„ç³»ç»Ÿä¸ŠPCIæ€»çº¿å’Œé™„åŠ è®¾å¤‡çš„ä¿¡æ¯ã€‚æŒ‡å®š-vï¼Œ-vvæˆ–-vvvæ¥è·å–è¶Šæ¥è¶Šè¯¦ç»†çš„è¾“å‡º</p><ul><li><p>lspci å®‰è£…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ sudo yum whatprovides */lspci</span><br><span class="line">pciutils-3.5.1-2.el7.x86_64 : PCI bus related utilities</span><br><span class="line">Repo        : base</span><br><span class="line">Matched from:</span><br><span class="line">Filename    : /usr/sbin/lspci</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pciutils-3.5.1-3.el7.x86_64 : PCI bus related utilities</span><br><span class="line">Repo        : base</span><br><span class="line">Matched from:</span><br><span class="line">Filename    : /usr/sbin/lspci</span><br><span class="line"></span><br><span class="line">$ sudo yum install pciutils</span><br><span class="line"></span><br><span class="line">lspci æ›´å¤š[è¯¦ç»†ä½¿ç”¨](https://blog.csdn.net/styshoo/article/details/51281437)</span><br><span class="line"></span><br><span class="line">$ lspci -vvvvv</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹å½“å‰çš„LinuxæœåŠ¡å™¨çš„è¿è¡Œçº§åˆ«</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ who -r</span><br><span class="line">$ who -b </span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç³»ç»Ÿæœ€åä¸€æ¬¡å¯åŠ¨çš„æ—¶é—´</span></span><br><span class="line"></span><br><span class="line">$ last reboot</span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç³»ç»Ÿå†å²å¯åŠ¨çš„æ—¶é—´</span></span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹ç³»ç»Ÿè¿è¡Œäº†å¤šé•¿æ—¶é—´</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ cat /proc/uptime| awk -F. <span class="string">'&#123;run_days=$1 / 86400;run_hour=($1 % 86400)/3600;run_minute=($1 % 3600)/60;run_second=$1 % 60;printf("ç³»ç»Ÿå·²è¿è¡Œï¼š%då¤©%dæ—¶%dåˆ†%dç§’",run_days,run_hour,run_minute,run_second)&#125;'</span></span><br><span class="line">$ w</span><br><span class="line">$ uptime</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹ç³»ç»Ÿå¯åŠ¨çš„æ—¥æœŸ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ date -d <span class="string">"<span class="variable">$(awk -F. '&#123;print $1&#125;' /proc/uptime)</span> second ago"</span> +<span class="string">"%Y-%m-%d %H:%M:%S"</span></span><br></pre></td></tr></table></figure></li><li><p>æŸ¥æ‰¾ç›®å½•ä¸‹æ–‡ä»¶å†…å®¹æ²¡æœ‰åŒ…æ‹¬â€œnginxâ€ã€â€œmsgTypeâ€å­—ç¬¦ä¸²çš„æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ grep -r -l -v <span class="string">"nginx"</span> /data/</span><br><span class="line">$ grep -r  -v <span class="string">"msgType"</span> /data/</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥æ‰¾ç›®å½•ä¸‹æ–‡ä»¶å†…å®¹åŒ…æ‹¬â€nginxâ€å­—ç¬¦ä¸²çš„æ–‡ä»¶ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ grep -r <span class="string">"nginx"</span> /data/                                             ä¼šæŠŠ<span class="string">"nginx"</span>å­—ç¬¦ä¸²æ‰€åœ¨è¿™è¡Œçš„å†…å®¹æ˜¾ç¤ºå‡ºæ¥</span><br><span class="line">$ grep -o â€œnginxâ€ /data/</span><br><span class="line">$ grep -r -l <span class="string">"nginx"</span> /data/                                          ä¸æ˜¾ç¤º<span class="string">"nginx"</span>å­—ç¬¦ä¸²æ‰€åœ¨è¡Œï¼Œæ˜¯æ˜¾ç¤ºæ–‡ä»¶</span><br></pre></td></tr></table></figure></li><li><p>catä½¿ç”¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ cat sentry.conf.py |grep -v <span class="string">"^#"</span>          æŸ¥çœ‹é…ç½®æ–‡ä»¶ä¸åŒ…æ‹¬æ³¨é‡Šå†…å®¹</span><br><span class="line">$ cat -b `find /var/<span class="built_in">log</span>/httpd/ -cmin -60 -<span class="built_in">print</span> |sed <span class="string">"1d"</span>`\ |awk <span class="string">'&#123;print $2&#125;'</span>|sort |uniq -c |sort -n -k 1 -r |head -n 1               ç»Ÿè®¡å½“å‰ç›®å½•ä¸‹æ—¥å¿—æ–‡ä»¶é‡Œé¢Iå¹³è®¿é—®é‡æœ€å¤šçš„ä¸€ä¸ªIP</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æŸä¸€ä¸ªæ—¶é—´æ®µçš„IPåœ°å€è®¿é—®æ’åå‰10</span></span><br><span class="line">$ cat nginx_access.log|grep <span class="string">'+0800'</span>|awk <span class="string">'&#123;split($1,array,"[");if(array[2]&gt;="25/Jul/2017:14:17:30" &amp;&amp; array[2]&lt;="25/Jul/2017:20:17:30")&#123;print $0&#125;&#125;'</span>|awk -F<span class="string">"^`"</span> &amp;&amp; <span class="string">"-"</span> &amp;&amp; <span class="string">"^`"</span> <span class="string">'&#123;print $1&#125;'</span>|sort|uniq -c|sort -n -k 1 -r|head -n 10</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»Ÿè®¡å½“å‰æ—¥å¿—ipè®¿é—®å‰10</span></span><br><span class="line">$ cat nginx_access.log |awk -F<span class="string">"^"</span> <span class="string">'&#123;print $1&#125;'</span>|sort|uniq -c|sort -n -k 1 -r|head -n 10</span><br></pre></td></tr></table></figure></li><li><p>è·å–IPåœ°å€é€šç”¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ifconfig |sed -n 2p |awk <span class="string">'&#123;print $1$2&#125;'</span>|sed <span class="string">'s/^.*[^0-9]\([0-9]\&#123;1,3\&#125;\)\.\([0-9]\&#123;1,3\&#125;\)\.\([0-9]\&#123;1,3\&#125;\)\.\([0-9]\&#123;1,3\&#125;\)$/\1\.\2\.\3\.\4/g'</span></span><br></pre></td></tr></table></figure></li><li><p>curlä½¿ç”¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç›‘æ§ç½‘é¡µçš„å“åº”æ—¶é—´</span></span><br><span class="line">$ curl -o /dev/null -s -w <span class="string">"time_connect: %&#123;time_connect&#125;\ntime_starttransfer: %&#123;time_starttransfer&#125;\ntime_total: %&#123;time_total&#125;\n"</span> <span class="string">"http://www.baidu.com"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç›‘æ§ç«™ç‚¹å¯ç”¨æ€§</span></span><br><span class="line">$ curl -o /dev/null -s -w %&#123;http_code&#125; <span class="string">"http://www.baidu.com"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼€å¯gzipè¯·æ±‚</span></span><br><span class="line">$ curl -I http://www.sina.com.cn/ -H Accept-Encoding:gzip,defalte</span><br></pre></td></tr></table></figure></li><li><p>æ¯10ç§’æ˜¾ç¤ºä¸€æ¬¡å¤åˆ¶çš„å¤§å°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ watch -n 10 du -sh /root</span><br></pre></td></tr></table></figure></li><li><p>ç»Ÿè®¡ç›®å½•(åŒ…æ‹¬å­ç›®å½•)ä¸‹é¢æ–‡ä»¶ä¸ªæ•°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ find ./ -<span class="built_in">type</span> f | wc -l</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”¨findå‘½ä»¤æŸ¥æ‰¾å½“å‰ç›®å½•ä¸‹æ˜¯æ–‡ä»¶ç±»å‹çš„æ–‡ä»¶ï¼Œç„¶åç”¨wcæ¥è®¡æ•°</span></span><br><span class="line">$ ls -lR|grep <span class="string">"^-"</span>|wc -l</span><br><span class="line"><span class="comment"># lså‘½ä»¤åŠ Rå‚æ•°ï¼Œåˆ—å‡ºä¸‹çº§å­ç›®å½•ï¼Œä½¿ç”¨grepå‘½ä»¤è¿‡æ»¤ä»¥â€œ-â€å¼€å¤´çš„ï¼Œå¦‚æœæ˜¯ç›®å½•å°±æ”¹æˆâ€œ^dâ€ï¼Œåé¢ç”¨wcè®¡æ•°ã€‚</span></span><br><span class="line"></span><br><span class="line">$ find ./ -name <span class="string">"*.*"</span> |xargs cat|grep -v ^$|wc -l</span><br><span class="line">$ find . \( ! -name <span class="string">'*.png'</span> ! -name <span class="string">'*.gif'</span> ! -name <span class="string">'*.jpg'</span> ! -name <span class="string">'*.swf'</span> \) -<span class="built_in">type</span> f |wc -l</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»Ÿè®¡ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶çš„çš„è¡Œæ•°ï¼Œå»æ‰ç©ºè¡Œ</span></span><br><span class="line">$ find ./ -name <span class="string">"*.*"</span> |xargs cat|wc -l   </span><br><span class="line">$ find . \( ! -name <span class="string">'*.png'</span> ! -name <span class="string">'*.gif'</span> ! -name <span class="string">'*.jpg'</span> ! -name <span class="string">'*.swf'</span> \) -<span class="built_in">type</span> f |xargs cat|wc -l</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹ç³»ç»Ÿtcpè¿æ¥ä¸­å„ä¸ªçŠ¶æ€çš„è¿æ¥æ•°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># netstat -an | awk '/^tcp/ &#123;++S[$NF]&#125; END &#123;for(a in S) print a, S[a]&#125;'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºæ¯ä¸ªIPçš„è¿æ¥æ•°ï¼Œä»¥åŠæ€»çš„å„ä¸ªçŠ¶æ€çš„è¿æ¥æ•°</span></span><br><span class="line">$ netstat -n | awk <span class="string">'/^tcp/ &#123;n=split($(NF-1),array,":");if(n&lt;=2)++S[array[(1)]];else++S[array[(4)]];++s[$NF];++N&#125; END &#123;for(a in S)&#123;printf("%-20s %s\n", a, S[a]);++I&#125;printf("%-20s %s\n","TOTAL_IP",I);for(a in s) printf("%-20s %s\n",a, s[a]);printf("%-20s %s\n","TOTAL_LINK",N);&#125;'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»Ÿè®¡å½“å‰tcp/ipé“¾æ¥æ•°æ’åå‰10çš„IP</span></span><br><span class="line">$ netstat -n|awk <span class="string">'/^tcp/ &#123;print $5&#125;'</span>|awk -F<span class="string">':'</span> <span class="string">'&#123;print $1&#125;'</span>|sort|uniq -c|sort -n -k 1 -r|head -n 10</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ©ç”¨grepç»Ÿè®¡å½“å‰æ–‡ä»¶é‡Œé¢æ‰€æœ‰çš„IPåœ°å€</span></span><br><span class="line">$ grep -E -o <span class="string">"(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)"</span> nginx_access.log</span><br></pre></td></tr></table></figure></li></ul><p>æŸ¥çœ‹ç³»ç»Ÿå½“å‰è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶å¥æŸ„æ•°ï¼ŒæŒ‰ç…§æœ€å¤§çš„è¿›è¡Œæ’åº</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ lsof -n | awk <span class="string">'&#123;print $2&#125;'</span> | sort | uniq -c | sort -nr | more</span><br></pre></td></tr></table></figure><ul><li>pingå‘½ä»¤æ˜¾ç¤ºæ—¶é—´ä»¥åŠæ—¥æœŸ<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ping www.sina.com.cn -i 3 | awk <span class="string">'&#123; print $0"\t" strftime("%Y-%m-%d %H:%M:%S",systime()) &#125; '</span> &gt; /opt/sina.log &amp;</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;æŸ¥æ‰¾æ–‡ä»¶ä½¿ç”¨å‘½ä»¤&quot;&gt;&lt;a href=&quot;#æŸ¥æ‰¾æ–‡ä»¶ä½¿ç”¨å‘½ä»¤&quot; class=&quot;headerlink&quot; title=&quot;æŸ¥æ‰¾æ–‡ä»¶ä½¿ç”¨å‘½ä»¤&quot;&gt;&lt;/a&gt;æŸ¥æ‰¾æ–‡ä»¶ä½¿ç”¨å‘½ä»¤&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;æŸ¥æ‰¾ç›®å½•ä¸‹é¢å¤§å°è¶…è¿‡5Mçš„æ–‡ä»¶&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ find /home/ -size +5M&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;æŸ¥æ‰¾ç›®å½•ä¸‹100å¤©ä¹‹å‰ä¿®æ”¹è¿‡çš„æ–‡ä»¶&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ find /home/ -mtime +100&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;æŸ¥æ‰¾ç›®å½•ä¸‹60å¤©æœªè¢«è®¿é—®è¿‡çš„æ–‡ä»¶&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ find /home/ \! atime -60&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="linux" scheme="https://xxlaila.github.io//categories/linux/"/>
    
    
      <category term="shell" scheme="https://xxlaila.github.io//tags/shell/"/>
    
  </entry>
  
  <entry>
    <title>iptables</title>
    <link href="https://xxlaila.github.io/2019/09/25/iptables/"/>
    <id>https://xxlaila.github.io/2019/09/25/iptables/</id>
    <published>2019-09-25T02:19:11.000Z</published>
    <updated>2019-09-25T03:34:08.113Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Iptables"><a href="#Iptables" class="headerlink" title="Iptables"></a>Iptables</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Iptalbes æ˜¯ç”¨æ¥è®¾ç½®ã€ç»´æŠ¤å’Œæ£€æŸ¥Linuxå†…æ ¸çš„IPåŒ…è¿‡æ»¤è§„åˆ™çš„ã€‚å¯ä»¥å®šä¹‰ä¸åŒçš„è¡¨ï¼Œæ¯ä¸ªè¡¨éƒ½åŒ…å«å‡ ä¸ªå†…éƒ¨çš„é“¾ï¼Œä¹Ÿèƒ½åŒ…å«ç”¨æˆ·å®šä¹‰çš„é“¾ã€‚æ¯ä¸ªé“¾éƒ½æ˜¯ä¸€ä¸ªè§„åˆ™åˆ—è¡¨ï¼Œå¯¹å¯¹åº”çš„åŒ…è¿›è¡ŒåŒ¹é…ï¼šæ¯æ¡è§„åˆ™æŒ‡å®šåº”å½“å¦‚ä½•å¤„ç†ä¸ä¹‹ç›¸åŒ¹é…çš„åŒ…ã€‚è¿™è¢«ç§°ä½œâ€™targetâ€™ï¼ˆç›®æ ‡ï¼‰ï¼Œä¹Ÿå¯ä»¥è·³å‘åŒä¸€ä¸ªè¡¨å†…çš„ç”¨æˆ·å®šä¹‰çš„é“¾ã€‚</p><a id="more"></a><h4 id="iptablesé™åˆ¶IPè®¿é—®ç‰¹å®šç«¯å£"><a href="#iptablesé™åˆ¶IPè®¿é—®ç‰¹å®šç«¯å£" class="headerlink" title="iptablesé™åˆ¶IPè®¿é—®ç‰¹å®šç«¯å£"></a>iptablesé™åˆ¶IPè®¿é—®ç‰¹å®šç«¯å£</h4><ul><li><p>å…è®¸æŸä¸ªIP ï¼ˆ192.168.6.100ï¼‰çš„æœºå™¨è¿›è¡ŒSSHè¿æ¥ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ iptables -A INPUT -s 192.168.6.100 -p tcp --dport 22 -j ACCEPT</span><br><span class="line">$ iptables -L -n</span><br><span class="line">Chain INPUT (policy ACCEPT)</span><br><span class="line">target prot opt <span class="built_in">source</span> destination</span><br><span class="line">ACCEPT tcp -- 192.168.6.100 0.0.0.0/0 tcp dpt:22</span><br></pre></td></tr></table></figure></li><li><p>å…è®¸æŸä¸€æ®µçš„IP è®¿é—®SSH</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ iptables -A INPUT -s 192.168.6.0/24 -p tcp --dport 22 -j ACCEPT</span><br><span class="line">$ iptables -L -n</span><br><span class="line">Chain INPUT (policy ACCEPT)</span><br><span class="line">target prot opt <span class="built_in">source</span> destination</span><br><span class="line">ACCEPT tcp -- 192.168.6.0/24 0.0.0.0/0 tcp dpt:22</span><br></pre></td></tr></table></figure></li><li><p>é™åˆ¶æŸä¸€IP è®¿é—®SSH</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ iptables -A INPUT -p tcp -s ! 192.168.6.100 --dport 22 -j ACCEPT --æ³¨æ„ï¼å·æœ‰ä¸ªç©ºæ ¼</span><br><span class="line">$ iptables -L -n</span><br><span class="line">Chain INPUT (policy ACCEPT)</span><br><span class="line">target prot opt <span class="built_in">source</span> destination</span><br><span class="line">ACCEPT tcp -- 192.168.6.0/24 0.0.0.0/0 tcp dpt:22</span><br></pre></td></tr></table></figure></li></ul><h3 id="é…ç½®ä¸€ä¸ªNATè¡¨æ”¾ç«å¢™"><a href="#é…ç½®ä¸€ä¸ªNATè¡¨æ”¾ç«å¢™" class="headerlink" title="é…ç½®ä¸€ä¸ªNATè¡¨æ”¾ç«å¢™"></a>é…ç½®ä¸€ä¸ªNATè¡¨æ”¾ç«å¢™</h3><ul><li><p>é˜²æ­¢å¤–ç½‘ç”¨å†…ç½‘IPæ¬ºéª—</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ iptables -t nat -A PREROUTING -i eth0 -s 10.0.0.0/8 -j DROP</span><br><span class="line">$ iptables -t nat -A PREROUTING -i eth0 -s 172.16.0.0/12 -j DROP</span><br><span class="line">$ iptables -t nat -A PREROUTING -i eth0 -s 192.168.0.0/16 -j DROP</span><br></pre></td></tr></table></figure></li><li><p>ç¦æ­¢ä¸211.101.46.253çš„æ‰€æœ‰è¿æ¥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ iptables -t nat -A PREROUTING -d 211.101.46.253 -j DROP</span><br></pre></td></tr></table></figure></li><li><p>ç¦ç”¨FTP(21)ç«¯å£</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ iptables -t nat -A PREROUTING -p tcp --dport 21 -j DROP</span><br><span class="line"><span class="comment"># è¿™æ ·å†™èŒƒå›´å¤ªå¤§äº†,æˆ‘ä»¬å¯ä»¥æ›´ç²¾ç¡®çš„å®šä¹‰.</span></span><br><span class="line">$ iptables -t nat -A PREROUTING -p tcp --dport 21 -d 211.101.46.253 -j DROP</span><br><span class="line"><span class="comment"># è¿™æ ·åªç¦ç”¨211.101.46.253åœ°å€çš„FTPè¿æ¥,å…¶ä»–è¿æ¥è¿˜å¯ä»¥.å¦‚web(80ç«¯å£)è¿æ¥.</span></span><br></pre></td></tr></table></figure></li><li><p>iptablesç™½åå•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ iptables -A INPUT -s 0.0.0.0/0 -p tcp --dport 80 -j DROP</span><br><span class="line"><span class="comment"># æ‹’ç»æ‰€æœ‰IPé“¾æ¥80ç«¯å£</span></span><br><span class="line"></span><br><span class="line">$ iptables -A INPUT -s 58.17.245.222 -p tcp --dport 80 -j ACCEPT</span><br><span class="line"><span class="comment"># å…è®¸æŒ‡å®šIPè®¿é—®80ç«¯å£</span></span><br></pre></td></tr></table></figure></li><li><p>å…è®¸æ‰€æœ‰å·²ç»å»ºç«‹çš„å’Œç›¸å…³çš„è¿æ¥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT</span><br><span class="line">$ iptables -A OUTPUT -m state --state ESTABLISHED,RELATED -j ACCEPT</span><br></pre></td></tr></table></figure></li><li><p>dropéæ³•è¿æ¥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ iptables -A INPUT -m state --state INVALID -j DROP</span><br><span class="line">$ iptables -A OUTPUT -m state --state INVALID -j DROP</span><br><span class="line">$ iptables -A FORWARD -m state --state INVALID -j DROP</span><br></pre></td></tr></table></figure></li></ul><h3 id="ç«¯å£æ˜ å°„"><a href="#ç«¯å£æ˜ å°„" class="headerlink" title="ç«¯å£æ˜ å°„"></a>ç«¯å£æ˜ å°„</h3><ul><li>è¿™é‡Œä½¿ç”¨çš„æ˜¯FTPæœåŠ¡(36542)<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ iptables -t nat -A PREROUTING -p tcp --dport 36542 -j DNAT --to 192.168.50.2:36542</span><br><span class="line">$ iptables -t nat -A POSTROUTING -p tcp --dport 36542 -j MASQUERADE</span><br><span class="line"><span class="comment"># å› ä¸ºFTPä½¿ç”¨äº†ä¸¤ä¸ªç«¯å£21å’Œ20ï¼Œ21åªæ˜¯ç”¨äºè¿æ¥ï¼Œ20æ˜¯æ‰§è¡Œå‘½ä»¤çš„ã€‚20æ²¡åŠæ³•ä¿®æ”¹ï¼Œè¿™é‡Œä½¿ç”¨äº†è¢«åŠ¨æ¨¡å¼è¿æ¥ã€‚</span></span><br><span class="line"></span><br><span class="line">$ iptables -t nat -I PREROUTING -p tcp --dport 60000:65000 -j DNAT --to 192.168.50.2</span><br><span class="line"><span class="comment"># è¢«åŠ¨è¿æ¥ç«¯å£60000-65000å…¨éƒ¨è½¬å‘ç»™50.2</span></span><br><span class="line"></span><br><span class="line">$ iptables -t nat -I POSTROUTING -p tcp --dport 60000:65000 -j MASQUERADE</span><br><span class="line"><span class="comment"># éœ€è¦å¼€æ”¾60000:65000ç«¯å£ï¼Œ</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="ç«¯å£è½¬å‘"><a href="#ç«¯å£è½¬å‘" class="headerlink" title="ç«¯å£è½¬å‘"></a>ç«¯å£è½¬å‘</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å…¬å¸æœ‰ä¸€å°æœåŠ¡å™¨è¿æ¥å¤–ç½‘ï¼Œå…¶ä»–çš„æœåŠ¡å™¨éƒ½ä¸èƒ½ä¸Šå¤–ç½‘ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªå¤–ç½‘æœåŠ¡å™¨ç”¨ä½œç½‘å…³æœåŠ¡å™¨ï¼Œåšç«¯å£è½¬å‘ï¼Œè¿æ¥åˆ°å†…ç½‘æœåŠ¡å™¨</p><ul><li><p>è¿™é‡Œä½¿ç”¨æ•°æ®åº“çš„3306æ˜ å°„åˆ°å¤–ç½‘çš„çš„36544</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ iptables -t nat -A PREROUTING  -m tcp -p tcp --dport 36544 -j DNAT --to-destination 172.16.1.11:3306</span><br><span class="line">$ iptables -t nat -A POSTROUTING -m tcp -p tcp --dport 3306 -d 172.16.1.11 -j SNAT --to-source 172.16.1.1</span><br></pre></td></tr></table></figure></li><li><p>æ·»åŠ è¿ç»­ç«¯å£</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ iptables -A INPUT -p tcp --dport 60000:65000 -j ACCEPT</span><br><span class="line"><span class="comment"># å†’å·è¡¨ç¤ºæ·»åŠ ä¸€ä¸ªè¿ç»­çš„ç«¯å£</span></span><br><span class="line"></span><br><span class="line">$ iptables -A INPUT -p tcp -m multiport â€“dport 21:25,135:139 -j DROP</span><br><span class="line"><span class="comment">#ä½¿ç”¨multiportå‚æ•°é…ç½®ä¸è¿ç»­ç«¯å£å’Œå¤šä¸ªç«¯å£</span></span><br></pre></td></tr></table></figure></li><li><p>ä»£ç†ä¸Šç½‘<br>å†…ç½‘æœºå­æ— æ³•ä¸Šç½‘ï¼Œé€šè¿‡ä¸€å°å¯ä»¥ä¸Šç½‘çš„ç”µè„‘ï¼Œåœ¨å¯ä»¥è®¿é—®å¤–ç½‘çš„serverä¸Šiptablesè®©å…¶ä¸€ä¸ªç½‘æ®µå†…çš„æœºå­è®¿é—®å¤–ç½‘ï¼Œè¿™é‡Œæ˜¯é˜¿é‡Œäº‘ç¯å¢ƒæ¥åšçš„ï¼Œå¼€å¯IPè½¬å‘åŠŸèƒ½</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sed -i <span class="string">'s/net.ipv4.ip_forward = 0/net.ipv4.ip_forward = 1/g'</span> /etc/sysctl.conf</span><br><span class="line">$ iptables -t nat -I POSTROUTING -s 172.16.3.0/24 -j SNAT --to-source 172.16.3.2</span><br></pre></td></tr></table></figure></li></ul><h4 id="æ“ä½œiptablesçš„natè§„åˆ™"><a href="#æ“ä½œiptablesçš„natè§„åˆ™" class="headerlink" title="æ“ä½œiptablesçš„natè§„åˆ™"></a>æ“ä½œiptablesçš„natè§„åˆ™</h4><ul><li><p>æŸ¥çœ‹è§„åˆ™</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ iptables -nvL -t nat</span><br><span class="line">$ iptables -t nat -L -n --line-numbers</span><br></pre></td></tr></table></figure></li><li><p>åˆ é™¤è§„åˆ™</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ iptables -t nat -D POSTROUTING 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># iptablesçš„è§„åˆ™å·</span></span><br><span class="line">$ iptables -nL --line-number</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹/æ›¿æ¢è§„åˆ™</span></span><br><span class="line">$ iptbales -R INPUT &#123;1&#125; -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤è§„åˆ™</span></span><br><span class="line">$ iptables -D INPUT &#123;1&#125;</span><br></pre></td></tr></table></figure></li><li><p>iptalesç«¯å£é€šè¿‡ä¸€å¼ ç½‘å¡å‡ºå»</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ iptables -A INPUT -i eth0 -p tcp -s 192.168.100.0/24 --dport 22 -m state --state NEW,ESTABLESHED -j ACCEPT</span><br><span class="line">$ iptables -A OUTPUT -o eth0 -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT</span><br></pre></td></tr></table></figure></li><li><p>æœ¬æœºç«¯å£ï¼Œæ˜ å°„åˆ°æœ¬æœºç«¯å£</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ iptables -t nat -A PREROUTING -i eth0 -p tcp --dport 25 -j REDIRECT --to-port 2525</span><br><span class="line">$ iptables -t nat -I PREROUTING --src 0/0 --dst 192.168.1.5 -p tcp --dport 80 -j REDIRECT --to-ports 8123</span><br><span class="line">$ iptables -t nat -I OUTPUT --src 0/0 --dst 192.168.1.5 -p tcp --dport 80 -j REDIRECT --to-ports 8123</span><br></pre></td></tr></table></figure></li><li><p>ä¿å­˜é˜²ç«å¢™</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo /usr/libexec/iptables/iptables.init save</span><br></pre></td></tr></table></figure></li><li><p>å¥‡è‘©éœ€æ±‚ï¼Œå¼€æ”¾sshç«¯å£æŒ‡å®šçš„IPåœ°å€è®¿é—®ï¼Œå…¶ä»–ç«¯å£å¤ªå¤šä¸æƒ³æ·»åŠ èƒ½å¯¹å¤–è®¿é—®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ cat /etc/sysconfig/iptables</span><br><span class="line"></span><br><span class="line"><span class="comment"># sample configuration for iptables service</span></span><br><span class="line"><span class="comment"># you can edit this manually or use system-config-firewall</span></span><br><span class="line"><span class="comment"># please do not ask us to add additional ports/services to this default configuration</span></span><br><span class="line">*filter</span><br><span class="line">:INPUT ACCEPT [0:0]</span><br><span class="line">:FORWARD ACCEPT [0:0]</span><br><span class="line">:OUTPUT ACCEPT [0:0]</span><br><span class="line">-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT</span><br><span class="line">-A INPUT -s 192.168.10.1/32 -p tcp -m tcp --dport 22 -j ACCEPT</span><br><span class="line">-A INPUT -p tcp -m tcp --dport 22 -j  REJECT --reject-with icmp-port-unreachable</span><br><span class="line"><span class="comment">#-A INPUT -j REJECT --reject-with icmp-host-prohibited</span></span><br><span class="line"><span class="comment">#-A FORWARD -j REJECT --reject-with icmp-host-prohibited</span></span><br><span class="line">COMMIT</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;Iptables&quot;&gt;&lt;a href=&quot;#Iptables&quot; class=&quot;headerlink&quot; title=&quot;Iptables&quot;&gt;&lt;/a&gt;Iptables&lt;/h3&gt;&lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Iptalbes æ˜¯ç”¨æ¥è®¾ç½®ã€ç»´æŠ¤å’Œæ£€æŸ¥Linuxå†…æ ¸çš„IPåŒ…è¿‡æ»¤è§„åˆ™çš„ã€‚å¯ä»¥å®šä¹‰ä¸åŒçš„è¡¨ï¼Œæ¯ä¸ªè¡¨éƒ½åŒ…å«å‡ ä¸ªå†…éƒ¨çš„é“¾ï¼Œä¹Ÿèƒ½åŒ…å«ç”¨æˆ·å®šä¹‰çš„é“¾ã€‚æ¯ä¸ªé“¾éƒ½æ˜¯ä¸€ä¸ªè§„åˆ™åˆ—è¡¨ï¼Œå¯¹å¯¹åº”çš„åŒ…è¿›è¡ŒåŒ¹é…ï¼šæ¯æ¡è§„åˆ™æŒ‡å®šåº”å½“å¦‚ä½•å¤„ç†ä¸ä¹‹ç›¸åŒ¹é…çš„åŒ…ã€‚è¿™è¢«ç§°ä½œâ€™targetâ€™ï¼ˆç›®æ ‡ï¼‰ï¼Œä¹Ÿå¯ä»¥è·³å‘åŒä¸€ä¸ªè¡¨å†…çš„ç”¨æˆ·å®šä¹‰çš„é“¾ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="linux" scheme="https://xxlaila.github.io//categories/linux/"/>
    
    
      <category term="iptables" scheme="https://xxlaila.github.io//tags/iptables/"/>
    
  </entry>
  
  <entry>
    <title>äº¤æ¢æœºåšç«¯å£èšåˆ</title>
    <link href="https://xxlaila.github.io/2019/09/25/%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%81%9A%E7%AB%AF%E5%8F%A3%E8%81%9A%E5%90%88/"/>
    <id>https://xxlaila.github.io/2019/09/25/äº¤æ¢æœºåšç«¯å£èšåˆ/</id>
    <published>2019-09-25T02:09:47.000Z</published>
    <updated>2019-09-26T03:13:12.855Z</updated>
    
    <content type="html"><![CDATA[<p><strong>åº”ç”¨åœºæ™¯</strong>ï¼šh3c s5500 (Switch A)ã€‚huawei s5720S-SI-ACï¼ˆSwitch Bï¼‰</p><p>Switch A ä½œä¸ºä¸Šè¡Œäº¤æ¢æœºï¼ŒSwitch Bä½œä¸ºä¸‹è¡Œäº¤æ¢æœº</p><p><strong>ç»„ç½‘</strong>ï¼šä¸¤ä¸ªäº¤æ¢æœºçš„idã€vlanå·è¿™é‡Œä½¿ç”¨çš„æ˜¯ç›¸åŒ</p><a id="more"></a><p><img src="http://img.xxlaila.cn/2846sjdhausiy84yhks.png" alt="img"></p><h3 id="Switch-Aé…ç½®"><a href="#Switch-Aé…ç½®" class="headerlink" title="Switch Aé…ç½®"></a>Switch Aé…ç½®</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[Switch A-SW]vlan 50</span><br><span class="line">[Switch A-SW-vlan50]quit</span><br><span class="line">[Switch A-SW]interface Bridge-Aggregation 50</span><br><span class="line">[Switch A-SW-Bridge-Aggregation50]port access vlan 50</span><br><span class="line">[Switch A-SW]interface GigabitEthernet 1/0/19</span><br><span class="line">[Switch A-SW-GigabitEthernet1/0/19]port link-aggregation group 50</span><br><span class="line">[Switch A-SW-GigabitEthernet1/0/19] port access vlan 50</span><br><span class="line">[Switch A-SW]interface GigabitEthernet 1/0/20</span><br><span class="line">[Switch A-SW-GigabitEthernet1/0/20]port link-aggregation group 50</span><br><span class="line">[Switch A-SW-GigabitEthernet1/0/20]port access vlan 50</span><br><span class="line">[Switch A-SW]link-aggregation load-sharing mode <span class="built_in">source</span>-mac destination-mac</span><br></pre></td></tr></table></figure><ul><li>æŸ¥çœ‹ç«¯å£èšåˆ<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Switch A-SW]dis link-aggregation verbose</span><br></pre></td></tr></table></figure></li></ul><h3 id="Switch-Bé…ç½®"><a href="#Switch-Bé…ç½®" class="headerlink" title="Switch Bé…ç½®"></a>Switch Bé…ç½®</h3><h4 id="1ã€åˆ›å»ºeth-trunkæ¥å£å¹¶åŠ å…¥æˆå‘˜"><a href="#1ã€åˆ›å»ºeth-trunkæ¥å£å¹¶åŠ å…¥æˆå‘˜" class="headerlink" title="1ã€åˆ›å»ºeth-trunkæ¥å£å¹¶åŠ å…¥æˆå‘˜"></a>1ã€åˆ›å»ºeth-trunkæ¥å£å¹¶åŠ å…¥æˆå‘˜</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[Switch B] interface eth-trunk 50</span><br><span class="line">[Switch B-Eth-Trunk1] trunkport gigabitethernet 0/0/1 to 0/0/3</span><br><span class="line">[Switch B-Eth-Trunk1] quit</span><br></pre></td></tr></table></figure><h4 id="2ã€åˆ›å»ºvlanå¹¶å§ä¸²è¡ŒåŠ å…¥vlan"><a href="#2ã€åˆ›å»ºvlanå¹¶å§ä¸²è¡ŒåŠ å…¥vlan" class="headerlink" title="2ã€åˆ›å»ºvlanå¹¶å§ä¸²è¡ŒåŠ å…¥vlan"></a>2ã€åˆ›å»ºvlanå¹¶å§ä¸²è¡ŒåŠ å…¥vlan</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[Switch B] vlan batch 50</span><br><span class="line">[Switch B] interface eth-trunk 50</span><br><span class="line">[Switch B-Eth-Trunk1] port link-type trunk</span><br><span class="line">[Switch B-Eth-Trunk1] port trunk allow-pass vlan 50</span><br><span class="line">[Switch B-Eth-Trunk1] quit</span><br></pre></td></tr></table></figure><h4 id="3ã€é…ç½®eth-trunkçš„è´Ÿè½½åˆ†æ‹…æ–¹å¼"><a href="#3ã€é…ç½®eth-trunkçš„è´Ÿè½½åˆ†æ‹…æ–¹å¼" class="headerlink" title="3ã€é…ç½®eth-trunkçš„è´Ÿè½½åˆ†æ‹…æ–¹å¼"></a>3ã€é…ç½®eth-trunkçš„è´Ÿè½½åˆ†æ‹…æ–¹å¼</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[Switch B] interface eth-trunk 1</span><br><span class="line">[Switch B-Eth-Trunk1] load-balance src-dst-mac</span><br><span class="line">[Switch B-Eth-Trunk1] quit</span><br></pre></td></tr></table></figure><h3 id="Switch-Aé…ç½®åœ°å€æ®µ"><a href="#Switch-Aé…ç½®åœ°å€æ®µ" class="headerlink" title="Switch Aé…ç½®åœ°å€æ®µ"></a>Switch Aé…ç½®åœ°å€æ®µ</h3><p>åœ¨vlané‡Œé¢èµ·ä¸€ä¸ªç½‘ç»œï¼Œä½†ä¸å¯ç”¨dhcpæœåŠ¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[Switch A-SW]int vlan 50</span><br><span class="line">[Switch A-SW-Vlan-interface50]ip ad 172.21.16.1 20</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;åº”ç”¨åœºæ™¯&lt;/strong&gt;ï¼šh3c s5500 (Switch A)ã€‚huawei s5720S-SI-ACï¼ˆSwitch Bï¼‰&lt;/p&gt;
&lt;p&gt;Switch A ä½œä¸ºä¸Šè¡Œäº¤æ¢æœºï¼ŒSwitch Bä½œä¸ºä¸‹è¡Œäº¤æ¢æœº&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç»„ç½‘&lt;/strong&gt;ï¼šä¸¤ä¸ªäº¤æ¢æœºçš„idã€vlanå·è¿™é‡Œä½¿ç”¨çš„æ˜¯ç›¸åŒ&lt;/p&gt;
    
    </summary>
    
      <category term="ç½‘ç»œè®¾å¤‡" scheme="https://xxlaila.github.io//categories/%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87/"/>
    
    
      <category term="äº¤æ¢æœº" scheme="https://xxlaila.github.io//tags/%E4%BA%A4%E6%8D%A2%E6%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>pv pvc</title>
    <link href="https://xxlaila.github.io/2019/09/25/pv-pvc/"/>
    <id>https://xxlaila.github.io/2019/09/25/pv-pvc/</id>
    <published>2019-09-25T01:46:10.000Z</published>
    <updated>2019-09-25T01:59:18.795Z</updated>
    
    <content type="html"><![CDATA[<h3 id="1ã€ä»‹ç»"><a href="#1ã€ä»‹ç»" class="headerlink" title="1ã€ä»‹ç»"></a>1ã€ä»‹ç»</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PersistentVolumeï¼ˆpvï¼‰å’ŒPersistentVolumeClaimï¼ˆpvcï¼‰æ˜¯k8sæä¾›çš„ä¸¤ç§APIèµ„æºï¼Œç”¨äºæŠ½è±¡å­˜å‚¨ç»†èŠ‚ã€‚ç®¡ç†å‘˜å…³æ³¨äºå¦‚ä½•é€šè¿‡pvæä¾›å­˜å‚¨åŠŸèƒ½è€Œæ— éœ€å…³æ³¨ç”¨æˆ·å¦‚ä½•ä½¿ç”¨ï¼ŒåŒæ ·çš„ç”¨æˆ·åªéœ€è¦æŒ‚è½½pvcåˆ°å®¹å™¨ä¸­è€Œä¸éœ€è¦å…³æ³¨å­˜å‚¨å·é‡‡ç”¨ä½•ç§æŠ€æœ¯å®ç°ã€‚</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pvcå’Œpvçš„å…³ç³»ä¸podå’Œnodeå…³ç³»ç±»ä¼¼ï¼Œå‰è€…æ¶ˆè€—åè€…çš„èµ„æºã€‚pvcå¯ä»¥å‘pvç”³è¯·æŒ‡å®šå¤§å°çš„å­˜å‚¨èµ„æºå¹¶è®¾ç½®è®¿é—®æ¨¡å¼,è¿™å°±å¯ä»¥é€šè¿‡Provision -&gt; Claim çš„æ–¹å¼ï¼Œæ¥å¯¹å­˜å‚¨èµ„æºè¿›è¡Œæ§åˆ¶ã€‚</p><a id="more"></a><h3 id="2ã€ç”Ÿå‘½å‘¨æœŸ"><a href="#2ã€ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="2ã€ç”Ÿå‘½å‘¨æœŸ"></a>2ã€ç”Ÿå‘½å‘¨æœŸ</h3><p>pvå’Œpvcéµå¾ªä»¥ä¸‹ç”Ÿå‘½å‘¨æœŸ:</p><ul><li>ä¾›åº”å‡†å¤‡ã€‚é€šè¿‡é›†ç¾¤å¤–çš„å­˜å‚¨ç³»ç»Ÿæˆ–è€…äº‘å¹³å°æ¥æä¾›å­˜å‚¨æŒä¹…åŒ–æ”¯æŒã€‚<ul><li><strong>é™æ€æä¾›</strong>: ç®¡ç†å‘˜æ‰‹åŠ¨åˆ›å»ºå¤šä¸ªPVï¼Œä¾›PVCä½¿ç”¨ã€‚</li><li><strong>åŠ¨æ€æä¾›</strong>: åŠ¨æ€åˆ›å»ºPVCç‰¹å®šçš„PVï¼Œå¹¶ç»‘å®šã€‚</li></ul></li><li>ç»‘å®šã€‚ç”¨æˆ·åˆ›å»ºpvcå¹¶æŒ‡å®šéœ€è¦çš„èµ„æºå’Œè®¿é—®æ¨¡å¼ã€‚åœ¨æ‰¾åˆ°å¯ç”¨pvä¹‹å‰ï¼Œpvcä¼šä¿æŒæœªç»‘å®šçŠ¶æ€ã€‚</li><li>ä½¿ç”¨ã€‚ç”¨æˆ·å¯åœ¨podä¸­åƒvolumeä¸€æ ·ä½¿ç”¨pvcã€‚</li><li>é‡Šæ”¾ã€‚ç”¨æˆ·åˆ é™¤pvcæ¥å›æ”¶å­˜å‚¨èµ„æºï¼Œpvå°†å˜æˆâ€œreleasedâ€çŠ¶æ€ã€‚ç”±äºè¿˜ä¿ç•™ç€ä¹‹å‰çš„æ•°æ®ï¼Œè¿™äº›æ•°æ®éœ€è¦æ ¹æ®ä¸åŒçš„ç­–ç•¥æ¥å¤„ç†ï¼Œå¦åˆ™è¿™äº›å­˜å‚¨èµ„æºæ— æ³•è¢«å…¶ä»–pvcä½¿ç”¨ã€‚</li><li>å›æ”¶(Reclaiming)ã€‚pvå¯ä»¥è®¾ç½®ä¸‰ç§å›æ”¶ç­–ç•¥ï¼šä¿ç•™ï¼ˆRetainï¼‰ï¼Œå›æ”¶ï¼ˆRecycleï¼‰å’Œåˆ é™¤ï¼ˆDeleteï¼‰ã€‚</li></ul><ul><li><strong>ä¿ç•™ç­–ç•¥</strong>: å…è®¸äººå·¥å¤„ç†ä¿ç•™çš„æ•°æ®ã€‚</li><li><strong>åˆ é™¤ç­–ç•¥</strong>: å°†åˆ é™¤pvå’Œå¤–éƒ¨å…³è”çš„å­˜å‚¨èµ„æºï¼Œéœ€è¦æ’ä»¶æ”¯æŒã€‚</li><li><strong>å›æ”¶ç­–ç•¥</strong>: å°†æ‰§è¡Œæ¸…é™¤æ“ä½œï¼Œä¹‹åå¯ä»¥è¢«æ–°çš„pvcä½¿ç”¨ï¼Œéœ€è¦æ’ä»¶æ”¯æŒã€‚</li></ul><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ç›®å‰åªæœ‰NFSå’ŒHostPathç±»å‹å·æ”¯æŒå›æ”¶ç­–ç•¥ï¼ŒAWS EBS,GCE PD,Azure Diskå’ŒCinderæ”¯æŒåˆ é™¤(Delete)ç­–ç•¥ã€‚</p><h4 id="2-1ã€Provisioning"><a href="#2-1ã€Provisioning" class="headerlink" title="2.1ã€Provisioning"></a>2.1ã€Provisioning</h4><p>ä¸¤ç§æ–¹å¼æä¾›çš„PVèµ„æºä¾›ç»™ï¼š</p><ul><li><p>static:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;é€šè¿‡é›†ç¾¤ç®¡ç†è€…åˆ›å»ºå¤šä¸ªPVï¼Œä¸ºé›†ç¾¤â€œä½¿ç”¨è€…â€æä¾›å­˜å‚¨èƒ½åŠ›è€Œéšè—çœŸå®å­˜å‚¨çš„ç»†èŠ‚ã€‚å¹¶ä¸”å­˜åœ¨äºkubenretes apiä¸­ï¼Œå¯è¢«ç›´æ¥ä½¿ç”¨ã€‚</p></li><li><p>dynamic:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;åŠ¨æ€å·ä¾›ç»™æ˜¯kubernetesç‹¬æœ‰çš„åŠŸèƒ½ï¼Œè¿™ä¸€åŠŸèƒ½å…è®¸æŒ‰éœ€åˆ›å»ºå­˜å‚¨å»ºã€‚åœ¨æ­¤ä¹‹å‰ï¼Œé›†ç¾¤ç®¡ç†å‘˜éœ€è¦äº‹å…ˆåœ¨é›†ç¾¤å¤–ç”±å­˜å‚¨æä¾›è€…æˆ–è€…äº‘æä¾›å•†åˆ›å»º<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å­˜å‚¨å·ï¼ŒæˆåŠŸä¹‹åå†åˆ›å»ºPersistentVolumeå¯¹è±¡ï¼Œæ‰èƒ½å¤Ÿåœ¨kubernetesä¸­ä½¿ç”¨ã€‚åŠ¨æ€å·ä¾›ç»™èƒ½è®©é›†ç¾¤ç®¡ç†å‘˜ä¸å¿…è¿›è¡Œé¢„å…ˆåˆ›å»ºå­˜å‚¨å·ï¼Œè€Œæ˜¯éšç€ç”¨æˆ·éœ€æ±‚è¿›è¡Œåˆ›å»ºã€‚åœ¨1.5ç‰ˆæœ¬æé«˜äº†åŠ¨æ€å·çš„å¼¹æ€§å’Œå¯ç”¨æ€§ã€‚</p></li></ul><h3 id="PVç±»å‹"><a href="#PVç±»å‹" class="headerlink" title="PVç±»å‹"></a>PVç±»å‹</h3><p>pvæ”¯æŒä»¥ä¸‹ç±»å‹:</p><ul><li>GCEPersistentDisk</li><li>AWSElasticBlockStore</li><li>NFS</li><li>iSCSI</li><li>RBD (Ceph Block Device)</li><li>Glusterfs</li><li>AzureFile</li><li>AzureDisk</li><li>CephFS</li><li>cinder</li><li>FC</li><li>FlexVolume</li><li>Flocker</li><li>PhotonPersistentDisk</li><li>Quobyte</li><li>VsphereVolume</li><li>HostPath (single node testing only â€“ local storage is not supported in any way and WILL NOT WORK in a multi-node cluster)</li></ul><h4 id="3-1ã€PVå±æ€§"><a href="#3-1ã€PVå±æ€§" class="headerlink" title="3.1ã€PVå±æ€§"></a>3.1ã€PVå±æ€§</h4><ul><li>è®¿é—®æ¨¡å¼,ä¸pvçš„è¯­ä¹‰ç›¸åŒã€‚åœ¨è¯·æ±‚èµ„æºæ—¶ä½¿ç”¨ç‰¹å®šæ¨¡å¼ã€‚</li><li>èµ„æº,ç”³è¯·çš„å­˜å‚¨èµ„æºæ•°é¢ã€‚</li></ul><h4 id="3-2ã€PVå·é˜¶æ®µçŠ¶æ€"><a href="#3-2ã€PVå·é˜¶æ®µçŠ¶æ€" class="headerlink" title="3.2ã€PVå·é˜¶æ®µçŠ¶æ€"></a>3.2ã€PVå·é˜¶æ®µçŠ¶æ€</h4><ul><li>Available â€“ èµ„æºå°šæœªè¢«claimä½¿ç”¨</li><li>Bound â€“ å·å·²ç»è¢«ç»‘å®šåˆ°claimäº†</li><li>Released â€“ claimè¢«åˆ é™¤ï¼Œå·å¤„äºé‡Šæ”¾çŠ¶æ€ï¼Œä½†æœªè¢«é›†ç¾¤å›æ”¶ã€‚</li><li>Failed â€“ å·è‡ªåŠ¨å›æ”¶å¤±è´¥</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;1ã€ä»‹ç»&quot;&gt;&lt;a href=&quot;#1ã€ä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;1ã€ä»‹ç»&quot;&gt;&lt;/a&gt;1ã€ä»‹ç»&lt;/h3&gt;&lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;PersistentVolumeï¼ˆpvï¼‰å’ŒPersistentVolumeClaimï¼ˆpvcï¼‰æ˜¯k8sæä¾›çš„ä¸¤ç§APIèµ„æºï¼Œç”¨äºæŠ½è±¡å­˜å‚¨ç»†èŠ‚ã€‚ç®¡ç†å‘˜å…³æ³¨äºå¦‚ä½•é€šè¿‡pvæä¾›å­˜å‚¨åŠŸèƒ½è€Œæ— éœ€å…³æ³¨ç”¨æˆ·å¦‚ä½•ä½¿ç”¨ï¼ŒåŒæ ·çš„ç”¨æˆ·åªéœ€è¦æŒ‚è½½pvcåˆ°å®¹å™¨ä¸­è€Œä¸éœ€è¦å…³æ³¨å­˜å‚¨å·é‡‡ç”¨ä½•ç§æŠ€æœ¯å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;pvcå’Œpvçš„å…³ç³»ä¸podå’Œnodeå…³ç³»ç±»ä¼¼ï¼Œå‰è€…æ¶ˆè€—åè€…çš„èµ„æºã€‚pvcå¯ä»¥å‘pvç”³è¯·æŒ‡å®šå¤§å°çš„å­˜å‚¨èµ„æºå¹¶è®¾ç½®è®¿é—®æ¨¡å¼,è¿™å°±å¯ä»¥é€šè¿‡Provision -&amp;gt; Claim çš„æ–¹å¼ï¼Œæ¥å¯¹å­˜å‚¨èµ„æºè¿›è¡Œæ§åˆ¶ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="kubernetes" scheme="https://xxlaila.github.io//categories/kubernetes/"/>
    
    
      <category term="pv, pvc" scheme="https://xxlaila.github.io//tags/pv-pvc/"/>
    
  </entry>
  
  <entry>
    <title>åˆ©ç”¨NFSåŠ¨æ€æä¾›Kubernetesåç«¯å­˜å‚¨å·</title>
    <link href="https://xxlaila.github.io/2019/09/24/%E5%88%A9%E7%94%A8NFS%E5%8A%A8%E6%80%81%E6%8F%90%E4%BE%9BKubernetes%E5%90%8E%E7%AB%AF%E5%AD%98%E5%82%A8%E5%8D%B7/"/>
    <id>https://xxlaila.github.io/2019/09/24/åˆ©ç”¨NFSåŠ¨æ€æä¾›Kubernetesåç«¯å­˜å‚¨å·/</id>
    <published>2019-09-24T09:53:32.000Z</published>
    <updated>2019-09-25T04:32:59.526Z</updated>
    
    <content type="html"><![CDATA[<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nfs-client-provisioneræ˜¯ä¸€ä¸ªautomatic provisionerï¼Œä½¿ç”¨NFSä½œä¸ºå­˜å‚¨ï¼Œè‡ªåŠ¨åˆ›å»ºPVå’Œå¯¹åº”çš„PVCï¼Œæœ¬èº«ä¸æä¾›NFSå­˜å‚¨ï¼Œéœ€è¦å¤–éƒ¨å…ˆæœ‰ä¸€å¥—NFSå­˜å‚¨æœåŠ¡ã€‚</p><ul><li>PVä»¥ ${namespace}-${pvcName}-${pvName}çš„å‘½åæ ¼å¼æä¾›ï¼ˆåœ¨NFSæœåŠ¡å™¨ä¸Šï¼‰</li><li>PVå›æ”¶çš„æ—¶å€™ä»¥ archieved-${namespace}-${pvcName}-${pvName} çš„å‘½åæ ¼å¼ï¼ˆåœ¨NFSæœåŠ¡å™¨ä¸Šï¼‰</li></ul><p><a href="https://github.com/kubernetes-incubator/external-storage/tree/master/nfs-client" target="_blank" rel="noopener">å®˜æ–¹è®¿é—®åœ°å€</a></p><a id="more"></a><h3 id="1ã€æƒé™ä½“ç³»æ„å»º"><a href="#1ã€æƒé™ä½“ç³»æ„å»º" class="headerlink" title="1ã€æƒé™ä½“ç³»æ„å»º"></a>1ã€æƒé™ä½“ç³»æ„å»º</h3><h4 id="1-1ã€åˆ›å»ºserviceaccount"><a href="#1-1ã€åˆ›å»ºserviceaccount" class="headerlink" title="1.1ã€åˆ›å»ºserviceaccount"></a>1.1ã€åˆ›å»ºserviceaccount</h4><p>ServiceAccountä¹Ÿæ˜¯ä¸€ç§è´¦å·, ä¾›è¿è¡Œåœ¨podä¸­çš„è¿›ç¨‹ä½¿ç”¨, ä¸ºpodä¸­çš„è¿›ç¨‹æä¾›å¿…è¦çš„èº«ä»½è¯æ˜</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ cat &gt; serviceaccount.yaml &lt;&lt;EOF</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ServiceAccount</span><br><span class="line">metadata:</span><br><span class="line">  name: nfs-client-provisioner</span><br><span class="line">  namespace: kube-ops</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h4 id="1-2ã€åˆ›å»ºrole"><a href="#1-2ã€åˆ›å»ºrole" class="headerlink" title="1.2ã€åˆ›å»ºrole"></a>1.2ã€åˆ›å»ºrole</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$ cat &gt;clusterrole.yaml&lt;&lt;EOF</span><br><span class="line">kind: ClusterRole</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">metadata:</span><br><span class="line">  name: nfs-client-provisioner-runner</span><br><span class="line">  namespace: kube-ops</span><br><span class="line">rules:</span><br><span class="line">  - apiGroups: [<span class="string">""</span>]</span><br><span class="line">    resources: [<span class="string">"persistentvolumes"</span>]</span><br><span class="line">    verbs: [<span class="string">"get"</span>, <span class="string">"list"</span>, <span class="string">"watch"</span>, <span class="string">"create"</span>, <span class="string">"delete"</span>]</span><br><span class="line">  - apiGroups: [<span class="string">""</span>]</span><br><span class="line">    resources: [<span class="string">"persistentvolumeclaims"</span>]</span><br><span class="line">    verbs: [<span class="string">"get"</span>, <span class="string">"list"</span>, <span class="string">"watch"</span>, <span class="string">"update"</span>]</span><br><span class="line">  - apiGroups: [<span class="string">"storage.k8s.io"</span>]</span><br><span class="line">    resources: [<span class="string">"storageclasses"</span>]</span><br><span class="line">    verbs: [<span class="string">"get"</span>, <span class="string">"list"</span>, <span class="string">"watch"</span>]</span><br><span class="line">  - apiGroups: [<span class="string">""</span>]</span><br><span class="line">    resources: [<span class="string">"events"</span>]</span><br><span class="line">    verbs: [<span class="string">"watch"</span>, <span class="string">"create"</span>, <span class="string">"update"</span>, <span class="string">"patch"</span>]</span><br><span class="line">  - apiGroups: [<span class="string">""</span>]</span><br><span class="line">    resources: [<span class="string">"services"</span>, <span class="string">"endpoints"</span>]</span><br><span class="line">    verbs: [<span class="string">"get"</span>, <span class="string">"create"</span>,<span class="string">"list"</span>, <span class="string">"watch"</span>,<span class="string">"update"</span>]</span><br><span class="line">  - apiGroups: [<span class="string">"extensions"</span>]</span><br><span class="line">    resources: [<span class="string">"podsecuritypolicies"</span>]</span><br><span class="line">    resourceNames: [<span class="string">"nfs-client-provisioner"</span>]</span><br><span class="line">    verbs: [<span class="string">"use"</span>]</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h4 id="1-3ã€è´¦æˆ·å’Œè§’è‰²ç»‘å®š"><a href="#1-3ã€è´¦æˆ·å’Œè§’è‰²ç»‘å®š" class="headerlink" title="1.3ã€è´¦æˆ·å’Œè§’è‰²ç»‘å®š"></a>1.3ã€è´¦æˆ·å’Œè§’è‰²ç»‘å®š</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ cat &gt;clusterrolebinding.yaml &lt;&lt;EOF</span><br><span class="line">kind: ClusterRoleBinding</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">metadata:</span><br><span class="line">  namespace: kube-ops</span><br><span class="line">  name: run-nfs-client-provisioner</span><br><span class="line">subjects:</span><br><span class="line">  - kind: ServiceAccount</span><br><span class="line">    name: nfs-client-provisioner</span><br><span class="line">    namespace: kube-ops</span><br><span class="line">roleRef:</span><br><span class="line">  kind: ClusterRole</span><br><span class="line">  name: nfs-client-provisioner-runner</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h4 id="1-4ã€æ‰§è¡Œåˆ›å»º"><a href="#1-4ã€æ‰§è¡Œåˆ›å»º" class="headerlink" title="1.4ã€æ‰§è¡Œåˆ›å»º"></a>1.4ã€æ‰§è¡Œåˆ›å»º</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl create -f serviceaccount.yaml -f clusterrole.yaml -f clusterrolebinding.yaml</span><br><span class="line">serviceaccount/nfs-client-provisioner created</span><br><span class="line">clusterrole.rbac.authorization.k8s.io/nfs-client-provisioner-runner created</span><br><span class="line">clusterrolebinding.rbac.authorization.k8s.io/run-nfs-client-provisioner created</span><br></pre></td></tr></table></figure><h3 id="2ã€å®‰è£…éƒ¨ç½²"><a href="#2ã€å®‰è£…éƒ¨ç½²" class="headerlink" title="2ã€å®‰è£…éƒ¨ç½²"></a>2ã€å®‰è£…éƒ¨ç½²</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ä¸‹è½½deployment.yamlæ–‡ä»¶,éœ€è¦ä¿®æ”¹NFSæœåŠ¡å™¨æ‰€åœ¨çš„IPåœ°å€ï¼ˆ10.10.10.60ï¼‰ï¼Œä»¥åŠNFSæœåŠ¡å™¨å…±äº«çš„è·¯å¾„ï¼ˆ/ifs/kubernetesï¼‰ï¼Œä¸¤å¤„éƒ½éœ€è¦ä¿®æ”¹ä¸ºä½ å®é™…çš„NFSæœåŠ¡å™¨å’Œå…±äº«ç›®å½•</p><h4 id="2-1ã€éƒ¨ç½²å­˜å‚¨ä¾›åº”å·"><a href="#2-1ã€éƒ¨ç½²å­˜å‚¨ä¾›åº”å·" class="headerlink" title="2.1ã€éƒ¨ç½²å­˜å‚¨ä¾›åº”å·"></a>2.1ã€éƒ¨ç½²å­˜å‚¨ä¾›åº”å·</h4><p>æ ¹æ®PVCçš„è¯·æ±‚, åŠ¨æ€åˆ›å»ºPVå­˜å‚¨.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">$ cat &gt; deployment.yaml &lt;&lt;EOF</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ServiceAccount</span><br><span class="line">metadata:</span><br><span class="line">  namespace: kube-ops</span><br><span class="line">  name: nfs-client-provisioner</span><br><span class="line">---</span><br><span class="line">kind: Deployment</span><br><span class="line">apiVersion: extensions/v1beta1</span><br><span class="line">metadata:</span><br><span class="line">  namespace: kube-ops</span><br><span class="line">  name: nfs-client-provisioner</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  strategy:</span><br><span class="line">    <span class="built_in">type</span>: Recreate</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: nfs-client-provisioner</span><br><span class="line">    spec:</span><br><span class="line">      serviceAccountName: nfs-client-provisioner</span><br><span class="line">      containers:</span><br><span class="line">        - name: nfs-client-provisioner</span><br><span class="line">          image: quay.io/external_storage/nfs-client-provisioner:latest</span><br><span class="line">          volumeMounts:</span><br><span class="line">            - name: nfs-client-root</span><br><span class="line">              mountPath: /persistentvolumes</span><br><span class="line">          env:</span><br><span class="line">            - name: PROVISIONER_NAME</span><br><span class="line">              value: fuseim.pri/ifs</span><br><span class="line">            - name: NFS_SERVER</span><br><span class="line">              value: 172.21.17.39</span><br><span class="line">            - name: NFS_PATH</span><br><span class="line">              value: /opt</span><br><span class="line">      volumes:</span><br><span class="line">        - name: nfs-client-root</span><br><span class="line">          nfs:</span><br><span class="line">            server: /opt</span><br><span class="line">            path: 172.21.17.39</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><ul><li>ä¿®æ”¹StorageClassæ–‡ä»¶å¹¶éƒ¨ç½²class.yaml</li></ul><p>æ­¤å¤„å¯ä»¥ä¸ä¿®æ”¹ï¼Œæˆ–è€…ä¿®æ”¹provisionerçš„åå­—ï¼Œéœ€è¦ä¸ä¸Šé¢çš„deploymentçš„PROVISIONER_NAMEåå­—ä¸€è‡´</p><h4 id="2-2ã€åˆ›å»ºstorageclass"><a href="#2-2ã€åˆ›å»ºstorageclass" class="headerlink" title="2.2ã€åˆ›å»ºstorageclass"></a>2.2ã€åˆ›å»ºstorageclass</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ cat &gt; class.yaml &lt;&lt;EOF</span><br><span class="line">apiVersion: storage.k8s.io/v1</span><br><span class="line">kind: StorageClass</span><br><span class="line">metadata:</span><br><span class="line">  name: managed-nfs-storage</span><br><span class="line">provisioner: fuseim.pri/ifs <span class="comment"># or choose another name, must match deployment's env PROVISIONER_NAME'</span></span><br><span class="line">parameters:</span><br><span class="line">  archiveOnDelete: <span class="string">"false"</span></span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h4 id="2-3ã€æ‰§è¡Œåˆ›å»º"><a href="#2-3ã€æ‰§è¡Œåˆ›å»º" class="headerlink" title="2.3ã€æ‰§è¡Œåˆ›å»º"></a>2.3ã€æ‰§è¡Œåˆ›å»º</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl apply -f deployment.yaml </span><br><span class="line">serviceaccount/nfs-client-provisioner created</span><br><span class="line">deployment.extensions/nfs-client-provisioner created</span><br><span class="line"></span><br><span class="line">$ kubectl apply -f class.yaml </span><br><span class="line">storageclass.storage.k8s.io/managed-nfs-storage created</span><br></pre></td></tr></table></figure><h5 id="2-3-1ã€æŸ¥çœ‹StorageClass"><a href="#2-3-1ã€æŸ¥çœ‹StorageClass" class="headerlink" title="2.3.1ã€æŸ¥çœ‹StorageClass"></a>2.3.1ã€æŸ¥çœ‹StorageClass</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get storageclass</span><br><span class="line">NAME                  PROVISIONER      AGE</span><br><span class="line">managed-nfs-storage   fuseim.pri/ifs   18s</span><br></pre></td></tr></table></figure><h5 id="2-3-2ã€è®¾ç½®é»˜è®¤åç«¯å­˜å‚¨"><a href="#2-3-2ã€è®¾ç½®é»˜è®¤åç«¯å­˜å‚¨" class="headerlink" title="2.3.2ã€è®¾ç½®é»˜è®¤åç«¯å­˜å‚¨"></a>2.3.2ã€è®¾ç½®é»˜è®¤åç«¯å­˜å‚¨</h5><p>è®¾ç½®è¿™ä¸ªdefaultåå­—çš„SCä¸ºKubernetesçš„é»˜è®¤å­˜å‚¨åç«¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl patch storageclass managed-nfs-storage -p <span class="string">'&#123;"metadata": &#123;"annotations":&#123;"storageclass.kubernetes.io/is-default-class":"true"&#125;&#125;&#125;'</span></span><br><span class="line">storageclass.storage.k8s.io/managed-nfs-storage patched</span><br></pre></td></tr></table></figure><ul><li>storage.yaml (å’Œä¸Šé¢ä¸€æ ·)<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ cat &gt; storage.yaml &lt;&lt;EOF</span><br><span class="line">apiVersion: storage.k8s.io/v1</span><br><span class="line">kind: StorageClass</span><br><span class="line">metadata:</span><br><span class="line">  name: managed-nfs-storage</span><br><span class="line">  annotations:</span><br><span class="line">    storageclass.kubernetes.io/is-default-class: <span class="string">"true"</span></span><br><span class="line">provisioner: fuseim.pri/ifs</span><br><span class="line">parameters:</span><br><span class="line">  archiveOnDelete: <span class="string">"false"</span></span><br><span class="line">EOF</span><br></pre></td></tr></table></figure></li></ul><h4 id="2-3-3ã€æŸ¥çœ‹éªŒè¯"><a href="#2-3-3ã€æŸ¥çœ‹éªŒè¯" class="headerlink" title="2.3.3ã€æŸ¥çœ‹éªŒè¯"></a>2.3.3ã€æŸ¥çœ‹éªŒè¯</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get all -n kube-ops</span><br><span class="line">NAME                                          READY   STATUS    RESTARTS   AGE</span><br><span class="line">pod/nfs-client-provisioner-77f678858b-8d2d6   1/1     Running   0          26m</span><br><span class="line"></span><br><span class="line">NAME                                     READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">deployment.apps/nfs-client-provisioner   1/1     1            1           29m</span><br><span class="line"></span><br><span class="line">NAME                                                DESIRED   CURRENT   READY   AGE</span><br><span class="line">replicaset.apps/nfs-client-provisioner-77f678858b   1         1         1       26m</span><br></pre></td></tr></table></figure><h3 id="3ã€éªŒè¯æµ‹è¯•"><a href="#3ã€éªŒè¯æµ‹è¯•" class="headerlink" title="3ã€éªŒè¯æµ‹è¯•"></a>3ã€éªŒè¯æµ‹è¯•</h3><h4 id="3-1ã€åˆ›å»ºä¸€ä¸ªæµ‹è¯•å­˜å‚¨"><a href="#3-1ã€åˆ›å»ºä¸€ä¸ªæµ‹è¯•å­˜å‚¨" class="headerlink" title="3.1ã€åˆ›å»ºä¸€ä¸ªæµ‹è¯•å­˜å‚¨"></a>3.1ã€åˆ›å»ºä¸€ä¸ªæµ‹è¯•å­˜å‚¨</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ cat &gt; <span class="built_in">test</span>-claim.yaml &lt;&lt;EOF</span><br><span class="line">kind: PersistentVolumeClaim</span><br><span class="line">apiVersion: v1</span><br><span class="line">metadata:</span><br><span class="line">  name: <span class="built_in">test</span>-claim</span><br><span class="line">  namespace: kube-ops</span><br><span class="line">  annotations:</span><br><span class="line">    volume.beta.kubernetes.io/storage-class: <span class="string">"managed-nfs-storage"</span></span><br><span class="line">spec:</span><br><span class="line">  accessModes:</span><br><span class="line">    - ReadWriteMany</span><br><span class="line">  resources:</span><br><span class="line">    requests:</span><br><span class="line">      storage: 1Mi</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h4 id="3-2ã€å¯åŠ¨æµ‹è¯•POD"><a href="#3-2ã€å¯åŠ¨æµ‹è¯•POD" class="headerlink" title="3.2ã€å¯åŠ¨æµ‹è¯•POD"></a>3.2ã€å¯åŠ¨æµ‹è¯•POD</h4><p>PODæ–‡ä»¶å¦‚ä¸‹ï¼Œä½œç”¨å°±æ˜¯åœ¨test-claimçš„PVé‡Œtouchä¸€ä¸ªSUCCESSæ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$ cat  &gt; <span class="built_in">test</span>-pod.yaml &lt;&lt;EOF</span><br><span class="line">kind: Pod</span><br><span class="line">apiVersion: v1</span><br><span class="line">metadata:</span><br><span class="line">  name: <span class="built_in">test</span>-pod</span><br><span class="line">  namespace: kube-ops</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: <span class="built_in">test</span>-pod</span><br><span class="line">    image: docker.io/busybox:1.24</span><br><span class="line">    <span class="built_in">command</span>:</span><br><span class="line">      - <span class="string">"/bin/sh"</span></span><br><span class="line">    args:</span><br><span class="line">      - <span class="string">"-c"</span></span><br><span class="line">      - <span class="string">"touch /mnt/SUCCESS &amp;&amp; exit 0 || exit 1"</span></span><br><span class="line">    volumeMounts:</span><br><span class="line">      - name: nfs-pvc</span><br><span class="line">        mountPath: <span class="string">"/mnt"</span></span><br><span class="line">  restartPolicy: <span class="string">"Never"</span></span><br><span class="line">  volumes:</span><br><span class="line">    - name: nfs-pvc</span><br><span class="line">      persistentVolumeClaim:</span><br><span class="line">        claimName: <span class="built_in">test</span>-claim</span><br></pre></td></tr></table></figure><h4 id="3-3ã€æ‰§è¡Œåˆ›å»º"><a href="#3-3ã€æ‰§è¡Œåˆ›å»º" class="headerlink" title="3.3ã€æ‰§è¡Œåˆ›å»º"></a>3.3ã€æ‰§è¡Œåˆ›å»º</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl apply -f ./</span><br><span class="line">persistentvolumeclaim/<span class="built_in">test</span>-claim created</span><br><span class="line">pod/<span class="built_in">test</span>-pod created</span><br></pre></td></tr></table></figure><h4 id="3-4ã€æŸ¥çœ‹éªŒè¯"><a href="#3-4ã€æŸ¥çœ‹éªŒè¯" class="headerlink" title="3.4ã€æŸ¥çœ‹éªŒè¯"></a>3.4ã€æŸ¥çœ‹éªŒè¯</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get pod,pv -n kube-ops</span><br><span class="line">NAME                                          READY   STATUS      RESTARTS   AGE</span><br><span class="line">pod/nfs-client-provisioner-77f678858b-8d2d6   1/1     Running     0          3h26m</span><br><span class="line">pod/<span class="built_in">test</span>-pod                                  0/1     Completed   0          172m</span><br><span class="line"></span><br><span class="line">NAME                                                        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                 STORAGECLASS          REASON   AGE</span><br><span class="line">persistentvolume/pvc-2f0057b0-df35-11e9-ad62-fa163e53d4c8   1Mi        RWX            Retain           Bound    kube-ops/<span class="built_in">test</span>-claim   managed-nfs-storage            172m</span><br></pre></td></tr></table></figure><ul><li>ç™»å½•nfsæœåŠ¡å™¨æŸ¥çœ‹æ˜¯å¦æˆåŠŸçš„åˆ›å»ºç›®å½•<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ls /opt/</span><br><span class="line">kube-ops-test-claim-pvc-2f0057b0-df35-11e9-ad62-fa163e53d4c8</span><br></pre></td></tr></table></figure></li></ul><h4 id="3-5ã€æ›´æ”¹PersistentVolumes-ä¸­çš„ä¸€ä¸ªå›æ”¶ç­–ç•¥"><a href="#3-5ã€æ›´æ”¹PersistentVolumes-ä¸­çš„ä¸€ä¸ªå›æ”¶ç­–ç•¥" class="headerlink" title="3.5ã€æ›´æ”¹PersistentVolumes ä¸­çš„ä¸€ä¸ªå›æ”¶ç­–ç•¥"></a>3.5ã€æ›´æ”¹PersistentVolumes ä¸­çš„ä¸€ä¸ªå›æ”¶ç­–ç•¥</h4><ul><li><p>æŸ¥çœ‹é›†ç¾¤ä¸­PersistentVolumes</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get pv -n kube-ops</span><br><span class="line">NAME                                       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                 STORAGECLASS          REASON   AGE</span><br><span class="line">pvc-2f0057b0-df35-11e9-ad62-fa163e53d4c8   1Mi        RWX            Delete           Bound    kube-ops/<span class="built_in">test</span>-claim   managed-nfs-storage            3m6s</span><br></pre></td></tr></table></figure></li><li><p>æ›´æ”¹PersistentVolumes</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl patch pv pvc-2f0057b0-df35-11e9-ad62-fa163e53d4c8  -p <span class="string">'&#123;"spec":&#123;"persistentVolumeReclaimPolicy":"Retain"&#125;&#125;'</span></span><br><span class="line">persistentvolume/pvc-2f0057b0-df35-11e9-ad62-fa163e53d4c8 patched</span><br><span class="line"></span><br><span class="line">$ kubectl get pv -n kube-ops</span><br><span class="line">NAME                                       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                 STORAGECLASS          REASON   AGE</span><br><span class="line">pvc-2f0057b0-df35-11e9-ad62-fa163e53d4c8   1Mi        RWX            Retain           Bound    kube-ops/<span class="built_in">test</span>-claim   managed-nfs-storage            3m54s</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;nfs-client-provisioneræ˜¯ä¸€ä¸ªautomatic provisionerï¼Œä½¿ç”¨NFSä½œä¸ºå­˜å‚¨ï¼Œè‡ªåŠ¨åˆ›å»ºPVå’Œå¯¹åº”çš„PVCï¼Œæœ¬èº«ä¸æä¾›NFSå­˜å‚¨ï¼Œéœ€è¦å¤–éƒ¨å…ˆæœ‰ä¸€å¥—NFSå­˜å‚¨æœåŠ¡ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;PVä»¥ ${namespace}-${pvcName}-${pvName}çš„å‘½åæ ¼å¼æä¾›ï¼ˆåœ¨NFSæœåŠ¡å™¨ä¸Šï¼‰&lt;/li&gt;
&lt;li&gt;PVå›æ”¶çš„æ—¶å€™ä»¥ archieved-${namespace}-${pvcName}-${pvName} çš„å‘½åæ ¼å¼ï¼ˆåœ¨NFSæœåŠ¡å™¨ä¸Šï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/kubernetes-incubator/external-storage/tree/master/nfs-client&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;å®˜æ–¹è®¿é—®åœ°å€&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="kubernetes" scheme="https://xxlaila.github.io//categories/kubernetes/"/>
    
    
      <category term="pvc,pv" scheme="https://xxlaila.github.io//tags/pvc-pv/"/>
    
  </entry>
  
  <entry>
    <title>k8s v1.14 prometheus</title>
    <link href="https://xxlaila.github.io/2019/09/20/k8s-v1-14-prometheus/"/>
    <id>https://xxlaila.github.io/2019/09/20/k8s-v1-14-prometheus/</id>
    <published>2019-09-20T08:12:48.000Z</published>
    <updated>2019-09-26T03:13:12.713Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Prometheusã€Grafana-éƒ¨ç½²"><a href="#Prometheusã€Grafana-éƒ¨ç½²" class="headerlink" title="Prometheusã€Grafana éƒ¨ç½²"></a>Prometheusã€Grafana éƒ¨ç½²</h1><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Grafanaæ˜¯ä¸€ä¸ªå¼€æºçš„åº¦é‡åˆ†æä¸å¯è§†åŒ–å¥—ä»¶ã€‚ç»å¸¸è¢«ç”¨ä½œåŸºç¡€è®¾æ–½çš„æ—¶é—´åºåˆ—æ•°æ®å’Œåº”ç”¨ç¨‹åºåˆ†æçš„å¯è§†åŒ–ï¼Œæˆ‘ä»¬è¿™é‡Œç”¨å®ƒæ¥åšKubernetesé›†ç¾¤ç›‘æ§æ•°æ®çš„å¯è§†åŒ–ã€‚</p><h3 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æˆªè‡³å½“å‰ï¼Œprometheusã€grafanaå‡é‡‡ç”¨æœ€æ–°çš„é•œåƒåŒ…ï¼Œåœ¨åœ¨ç¬¬ä¸€æ¬¡éƒ¨ç½²çš„æ—¶å€™grafanaæŠ¥äº†ä¸€ä¸ªé”™è¯¯<code>mkdir: cannot create directory &#39;/var/lib/grafana/plugins&#39;: No such file or directory</code>,è¿™æ˜¯å› ä¸ºGrafanaå¯åŠ¨ä½¿ç”¨çš„ç”¨æˆ·å’Œç”¨æˆ·ç»„éƒ½æ˜¯472ï¼Œé€ æˆå¯¹å¤–æŒ‚å­˜å‚¨æ²¡æœ‰æƒé™ã€‚<a href="https://grafana.com/docs/installation/docker/#migration-from-a-previous-version-of-the-docker-container-to-5-1-or-later" target="_blank" rel="noopener">å‚è€ƒå®˜æ–¹</a></p><a id="more"></a><h3 id="å¼€å§‹éƒ¨ç½²"><a href="#å¼€å§‹éƒ¨ç½²" class="headerlink" title="å¼€å§‹éƒ¨ç½²"></a>å¼€å§‹éƒ¨ç½²</h3><p>æ–°å»ºyamlæ–‡ä»¶</p><ul><li>monitor-namespace.yaml<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat  monitor-namespace.yaml </span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Namespace</span><br><span class="line">metadata:</span><br><span class="line">  name: monitoring</span><br></pre></td></tr></table></figure></li></ul><p>å…¶ä»–çš„æ–‡ä»¶å‡é‡‡ç”¨ä»¥å‰å†å²çš„ï¼Œç„¶åç¨åŠ ä¿®æ”¹ï¼Œå…¶ä»–<a href="https://github.com/xxlaila/kubernetes-yaml.git" target="_blank" rel="noopener">yaml</a>æ–‡ä»¶,ç§»é™¤<code>grafana-ingress.yaml</code>ã€<code>prometheus-ingress.yaml</code></p><h3 id="æ–‡ä»¶ä¿®æ”¹"><a href="#æ–‡ä»¶ä¿®æ”¹" class="headerlink" title="æ–‡ä»¶ä¿®æ”¹"></a>æ–‡ä»¶ä¿®æ”¹</h3><ul><li><p>grafana-deploy.yaml</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: extensions/v1beta1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: grafana-core</span><br><span class="line">  namespace: monitoring</span><br><span class="line">  labels:</span><br><span class="line">    app: grafana</span><br><span class="line">    component: core</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: grafana</span><br><span class="line">        component: core</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - image: grafana/grafana:latest</span><br><span class="line">        name: grafana-core</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        <span class="comment"># env:</span></span><br><span class="line">        resources:</span><br><span class="line">          <span class="comment"># keep request = limit to keep this container in guaranteed class</span></span><br><span class="line">          limits:</span><br><span class="line">            cpu: 100m</span><br><span class="line">            memory: 100Mi</span><br><span class="line">          requests:</span><br><span class="line">            cpu: 100m</span><br><span class="line">            memory: 100Mi</span><br><span class="line">        env:</span><br><span class="line">          <span class="comment"># The following env variables set up basic auth twith the default admin user and admin password.</span></span><br><span class="line">          - name: GF_AUTH_BASIC_ENABLED</span><br><span class="line">            value: <span class="string">"true"</span></span><br><span class="line">          - name: GF_AUTH_ANONYMOUS_ENABLED</span><br><span class="line">            value: <span class="string">"false"</span></span><br><span class="line">          <span class="comment"># - name: GF_AUTH_ANONYMOUS_ORG_ROLE</span></span><br><span class="line">          <span class="comment">#   value: Admin</span></span><br><span class="line">          <span class="comment"># does not really work, because of template variables in exported dashboards:</span></span><br><span class="line">          <span class="comment"># - name: GF_DASHBOARDS_JSON_ENABLED</span></span><br><span class="line">          <span class="comment">#   value: "true"</span></span><br><span class="line">        readinessProbe:</span><br><span class="line">          httpGet:</span><br><span class="line">            path: /login</span><br><span class="line">            port: 3000</span><br><span class="line">          <span class="comment"># initialDelaySeconds: 30</span></span><br><span class="line">          <span class="comment"># timeoutSeconds: 1</span></span><br><span class="line">        volumeMounts:</span><br><span class="line">        - name: grafana-persistent-storage</span><br><span class="line">          mountPath: /var/lib/grafana</span><br><span class="line">      volumes:</span><br><span class="line">      - name: grafana-persistent-storage</span><br><span class="line">        emptyDir: &#123;&#125;</span><br></pre></td></tr></table></figure></li><li><p>prometheus-deploy.yaml</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">spec:</span><br><span class="line">      containers:</span><br><span class="line">      - image: prom/prometheus:latest</span><br><span class="line">        name: prometheus</span><br><span class="line">        <span class="built_in">command</span>:</span><br><span class="line">        - <span class="string">"/bin/prometheus"</span></span><br></pre></td></tr></table></figure></li><li><p>prometheus-svc.yaml</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">kind: Service</span><br><span class="line">apiVersion: v1</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    app: prometheus</span><br><span class="line">  name: prometheus</span><br><span class="line">  namespace: monitoring</span><br><span class="line">spec:</span><br><span class="line">  <span class="comment">#type: NodePort</span></span><br><span class="line">  ports:</span><br><span class="line">  - port: 9090</span><br><span class="line">    targetPort: 9090</span><br><span class="line">    <span class="comment">#nodePort: 30005</span></span><br><span class="line">  selector:</span><br><span class="line">    app: prometheus</span><br></pre></td></tr></table></figure></li><li><p>grafana-svc.yaml</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat grafana-svc.yaml</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: grafana</span><br><span class="line">  namespace: monitoring</span><br><span class="line">  labels:</span><br><span class="line">    app: grafana</span><br><span class="line">    component: core</span><br><span class="line">spec:</span><br><span class="line">  <span class="comment">#type: NodePort</span></span><br><span class="line">  ports:</span><br><span class="line">    - port: 3000</span><br><span class="line">  selector:</span><br><span class="line">    app: grafana</span><br><span class="line">    component: core</span><br></pre></td></tr></table></figure></li></ul><h3 id="æ‰§è¡Œåˆ›å»º"><a href="#æ‰§è¡Œåˆ›å»º" class="headerlink" title="æ‰§è¡Œåˆ›å»º"></a>æ‰§è¡Œåˆ›å»º</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># kubectl apply -f ./</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤šæ‰§è¡Œå‡ æ¬¡</span></span><br></pre></td></tr></table></figure><h3 id="æ£€æŸ¥éƒ¨ç½²"><a href="#æ£€æŸ¥éƒ¨ç½²" class="headerlink" title="æ£€æŸ¥éƒ¨ç½²"></a>æ£€æŸ¥éƒ¨ç½²</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># kubectl get pod,svc,deploy -n monitoring</span></span><br><span class="line">NAME                                READY   STATUS    RESTARTS   AGE</span><br><span class="line">pod/grafana-core-7b5989cf9d-snbk5   1/1     Running   0          2m31s</span><br><span class="line">pod/node-exporter-dddv7             1/1     Running   0          12m</span><br><span class="line">pod/node-exporter-fhfp6             1/1     Running   0          12m</span><br><span class="line">pod/node-exporter-m46bf             1/1     Running   0          12m</span><br><span class="line">pod/node-exporter-xkrzp             1/1     Running   0          12m</span><br><span class="line">pod/node-exporter-zfcxh             1/1     Running   0          12m</span><br><span class="line">pod/prometheus-67bcf457db-999ns     1/1     Running   0          12m</span><br><span class="line"></span><br><span class="line">NAME                    TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)          AGE</span><br><span class="line">service/grafana         ClusterIP   10.254.95.151    &lt;none&gt;        3000/TCP         12m</span><br><span class="line">service/node-exporter   ClusterIP   10.254.114.12    &lt;none&gt;        9100/TCP         12m</span><br><span class="line">service/prometheus      ClusterIP   10.254.104.216   &lt;none&gt;        9090/TCP         12m</span><br><span class="line"></span><br><span class="line">NAME                                 READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">deployment.extensions/grafana-core   1/1     1            1           12m</span><br><span class="line">deployment.extensions/prometheus     1/1     1            1           12m</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºIngress"><a href="#åˆ›å»ºIngress" class="headerlink" title="åˆ›å»ºIngress"></a>åˆ›å»ºIngress</h3><h4 id="prometheus-Ingress"><a href="#prometheus-Ingress" class="headerlink" title="prometheus Ingress"></a>prometheus Ingress</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat prometheus-Ingress.yaml </span></span><br><span class="line">---</span><br><span class="line">apiVersion: extensions/v1beta1</span><br><span class="line">kind: Ingress</span><br><span class="line">metadata:</span><br><span class="line">  name: prometheus-web-ui</span><br><span class="line">  namespace: monitoring</span><br><span class="line">  annotations:</span><br><span class="line">    kubernetes.io/ingress.class: traefik</span><br><span class="line">spec:</span><br><span class="line">  rules:</span><br><span class="line">  - host: prometheus.xxlaila.cn</span><br><span class="line">    http:</span><br><span class="line">      paths:</span><br><span class="line">      - path: /</span><br><span class="line">        backend:</span><br><span class="line">          serviceName: prometheus</span><br><span class="line">          servicePort: 9090</span><br></pre></td></tr></table></figure><h4 id="grafana-Ingress"><a href="#grafana-Ingress" class="headerlink" title="grafana Ingress"></a>grafana Ingress</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat grafana-Ingress.yaml </span></span><br><span class="line">---</span><br><span class="line">apiVersion: extensions/v1beta1</span><br><span class="line">kind: Ingress</span><br><span class="line">metadata:</span><br><span class="line">  name: grafana-web-ui</span><br><span class="line">  namespace: monitoring</span><br><span class="line">  annotations:</span><br><span class="line">    kubernetes.io/ingress.class: traefik</span><br><span class="line">spec:</span><br><span class="line">  rules:</span><br><span class="line">  - host: grafana.xxlaila.cn</span><br><span class="line">    http:</span><br><span class="line">      paths:</span><br><span class="line">      - path: /</span><br><span class="line">        backend:</span><br><span class="line">          serviceName: grafana</span><br><span class="line">          servicePort: 3000</span><br></pre></td></tr></table></figure><h4 id="æ‰§è¡Œåˆ›å»º-1"><a href="#æ‰§è¡Œåˆ›å»º-1" class="headerlink" title="æ‰§è¡Œåˆ›å»º"></a>æ‰§è¡Œåˆ›å»º</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># kubectl apply -f prometheus-Ingress.yaml </span></span><br><span class="line">ingress.extensions/prometheus-web-ui created</span><br><span class="line"></span><br><span class="line"><span class="comment"># kubectl apply -f grafana-Ingress.yaml </span></span><br><span class="line">ingress.extensions/grafana-web-ui created</span><br></pre></td></tr></table></figure><p>åœ¨æµè§ˆå™¨è¾“å…¥prometheus.xxlaila.cnè®¿é—®prometheusï¼Œè¾“å…¥grafana.xxlaila.cnè®¿é—®grafanaã€‚</p><h3 id="è®¿é—®prometheus"><a href="#è®¿é—®prometheus" class="headerlink" title="è®¿é—®prometheus"></a>è®¿é—®prometheus</h3><p><img src="http://img.xxlaila.cn/1569218750254.jpg" alt="img"></p><h3 id="é…ç½®grafana"><a href="#é…ç½®grafana" class="headerlink" title="é…ç½®grafana"></a>é…ç½®grafana</h3><p><img src="http://img.xxlaila.cn/1568968344227.jpg" alt="img"></p><p>åˆ°grafanaçš„å®˜æ–¹ä¸‹è½½å¯¹åº”çš„æ¨¡ç‰ˆæ–‡ä»¶å¯¼å…¥ï¼Œå°±å¯ä»¥å‡ºå›¾å•¦<br><img src="http://img.xxlaila.cn/1568968420655.jpg" alt="img"></p><p><a href="https://github.com/kubernetes/kubernetes/tree/master/cluster/addons/prometheus" target="_blank" rel="noopener">åç»­åˆ©ç”¨pvc</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Prometheusã€Grafana-éƒ¨ç½²&quot;&gt;&lt;a href=&quot;#Prometheusã€Grafana-éƒ¨ç½²&quot; class=&quot;headerlink&quot; title=&quot;Prometheusã€Grafana éƒ¨ç½²&quot;&gt;&lt;/a&gt;Prometheusã€Grafana éƒ¨ç½²&lt;/h1&gt;&lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Grafanaæ˜¯ä¸€ä¸ªå¼€æºçš„åº¦é‡åˆ†æä¸å¯è§†åŒ–å¥—ä»¶ã€‚ç»å¸¸è¢«ç”¨ä½œåŸºç¡€è®¾æ–½çš„æ—¶é—´åºåˆ—æ•°æ®å’Œåº”ç”¨ç¨‹åºåˆ†æçš„å¯è§†åŒ–ï¼Œæˆ‘ä»¬è¿™é‡Œç”¨å®ƒæ¥åšKubernetesé›†ç¾¤ç›‘æ§æ•°æ®çš„å¯è§†åŒ–ã€‚&lt;/p&gt;
&lt;h3 id=&quot;å‡†å¤‡å·¥ä½œ&quot;&gt;&lt;a href=&quot;#å‡†å¤‡å·¥ä½œ&quot; class=&quot;headerlink&quot; title=&quot;å‡†å¤‡å·¥ä½œ&quot;&gt;&lt;/a&gt;å‡†å¤‡å·¥ä½œ&lt;/h3&gt;&lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;æˆªè‡³å½“å‰ï¼Œprometheusã€grafanaå‡é‡‡ç”¨æœ€æ–°çš„é•œåƒåŒ…ï¼Œåœ¨åœ¨ç¬¬ä¸€æ¬¡éƒ¨ç½²çš„æ—¶å€™grafanaæŠ¥äº†ä¸€ä¸ªé”™è¯¯&lt;code&gt;mkdir: cannot create directory &amp;#39;/var/lib/grafana/plugins&amp;#39;: No such file or directory&lt;/code&gt;,è¿™æ˜¯å› ä¸ºGrafanaå¯åŠ¨ä½¿ç”¨çš„ç”¨æˆ·å’Œç”¨æˆ·ç»„éƒ½æ˜¯472ï¼Œé€ æˆå¯¹å¤–æŒ‚å­˜å‚¨æ²¡æœ‰æƒé™ã€‚&lt;a href=&quot;https://grafana.com/docs/installation/docker/#migration-from-a-previous-version-of-the-docker-container-to-5-1-or-later&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;å‚è€ƒå®˜æ–¹&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="kubenertes" scheme="https://xxlaila.github.io//categories/kubenertes/"/>
    
    
      <category term="k8s v1.14,prometheus" scheme="https://xxlaila.github.io//tags/k8s-v1-14-prometheus/"/>
    
  </entry>
  
</feed>
